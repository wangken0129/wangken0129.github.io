<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Openshift on Ken's blog</title><link>https://wangken0129.github.io/tags/openshift/</link><description>Recent content in Openshift on Ken's blog</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Thu, 06 Mar 2025 03:05:48 +0800</lastBuildDate><atom:link href="https://wangken0129.github.io/tags/openshift/index.xml" rel="self" type="application/rss+xml"/><item><title>OCP-4.16.3_on_Nutanix(IPI)</title><link>https://wangken0129.github.io/p/ocp-4.16.3_on_nutanixipi/</link><pubDate>Thu, 06 Mar 2025 03:05:48 +0800</pubDate><guid>https://wangken0129.github.io/p/ocp-4.16.3_on_nutanixipi/</guid><description>&lt;h1 id="ocp-4163_on_nutanix-ipi">OCP 4.16.3_on_Nutanix (IPI)
&lt;/h1>&lt;p>整合測試 OCP 4.16.3 透過 IPI (Installer-provisioned Infrastructure) 安裝在 Nutanix&lt;/p>
&lt;p>並且結合 Nutanix CSI、COSI、NDK (Nutanix Data service for kubernetes) 、 Autoscaler 自動擴展Worker&lt;/p>
&lt;h2 id="大致流程">大致流程
&lt;/h2>&lt;ol>
&lt;li>建立Bastion&lt;/li>
&lt;li>Prism Central 更換憑證&lt;/li>
&lt;li>建立 install-config.yaml , CCO&lt;/li>
&lt;li>建立 Openshift Cluster&lt;/li>
&lt;li>安裝Nutanix CSI 3.0 (beta)連線NUS&lt;/li>
&lt;li>安裝測試 Nutanix NDK (For VG Only)&lt;/li>
&lt;li>建立Machine Config ，worker node autoscaler&lt;/li>
&lt;/ol>
&lt;h2 id="reference">Reference
&lt;/h2>&lt;p>Openshift:&lt;/p>
&lt;p>&lt;a class="link" href="https://docs.openshift.com/container-platform/4.16/installing/installing_nutanix/preparing-to-install-on-nutanix.html" target="_blank" rel="noopener"
>https://docs.openshift.com/container-platform/4.16/installing/installing_nutanix/preparing-to-install-on-nutanix.html&lt;/a>&lt;/p>
&lt;p>Openshift Download:&lt;/p>
&lt;p>&lt;a class="link" href="https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.16.3/" target="_blank" rel="noopener"
>https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.16.3/&lt;/a>&lt;/p>
&lt;p>Nutanix NVD for OCP:&lt;/p>
&lt;p>&lt;a class="link" href="https://portal.nutanix.com/page/documents/solutions/details?targetId=NVD-2177-Cloud-Native-6-5-OpenShift:NVD-2177-Cloud-Native-6-5-OpenShift" target="_blank" rel="noopener"
>https://portal.nutanix.com/page/documents/solutions/details?targetId=NVD-2177-Cloud-Native-6-5-OpenShift:NVD-2177-Cloud-Native-6-5-OpenShift&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://portal.nutanix.com/page/documents/solutions/details?targetId=TN-2030-Red-Hat-OpenShift-on-Nutanix:TN-2030-Red-Hat-OpenShift-on-Nutanix" target="_blank" rel="noopener"
>https://portal.nutanix.com/page/documents/solutions/details?targetId=TN-2030-Red-Hat-OpenShift-on-Nutanix:TN-2030-Red-Hat-OpenShift-on-Nutanix&lt;/a>&lt;/p>
&lt;p>Nutanix NDK:&lt;/p>
&lt;p>&lt;a class="link" href="https://portal.nutanix.com/page/documents/details?targetId=Nutanix-Data-Services-for-Kubernetes-v1_0:Nutanix-Data-Services-for-Kubernetes-v1_0" target="_blank" rel="noopener"
>https://portal.nutanix.com/page/documents/details?targetId=Nutanix-Data-Services-for-Kubernetes-v1_0:Nutanix-Data-Services-for-Kubernetes-v1_0&lt;/a>&lt;/p>
&lt;p>Nutanix PC CA:&lt;/p>
&lt;p>&lt;a class="link" href="https://www.nutanix.dev/2023/09/26/generating-a-self-signed-san-certificate-to-use-red-hat-openshift-in-nutanix-marketplace/" target="_blank" rel="noopener"
>https://www.nutanix.dev/2023/09/26/generating-a-self-signed-san-certificate-to-use-red-hat-openshift-in-nutanix-marketplace/&lt;/a>&lt;/p>
&lt;h2 id="架構與版本">架構與版本
&lt;/h2>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>名稱&lt;/th>
&lt;th>IP / DNS&lt;/th>
&lt;th>版本&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>AOS / PE&lt;/td>
&lt;td>172.16.90.74&lt;/td>
&lt;td>6.8&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Prism Central&lt;/td>
&lt;td>172.16.90.75&lt;/td>
&lt;td>pc2024.1.0.1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>NDK&lt;/td>
&lt;td>none&lt;/td>
&lt;td>1.0.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Nutanix CSI&lt;/td>
&lt;td>none&lt;/td>
&lt;td>nutanix-csi-storage-3.0.0-beta.1912&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Nutanix Object&lt;/td>
&lt;td>none&lt;/td>
&lt;td>5.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Nutanix IPAM&lt;/td>
&lt;td>172.16.90.x&lt;/td>
&lt;td>none&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>bastion&lt;/td>
&lt;td>172.16.90.206&lt;/td>
&lt;td>RHEL 9.3&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>OCP Cluster Name&lt;/td>
&lt;td>ocplab.nutanixlab.local&lt;/td>
&lt;td>4.16.3&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>OCP API VIP&lt;/td>
&lt;td>172.16.90.205 / api.ocplab.nutanixlab.local&lt;/td>
&lt;td>none&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>OCP Ingress VIP&lt;/td>
&lt;td>172.16.90.207 / *.apps.ocplab.nutanixlab.local&lt;/td>
&lt;td>none&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/07/image-20240716100928430.png"
loading="lazy"
alt="image-20240716100928430"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/07/image-20240716094638388.png"
loading="lazy"
alt="image-20240716094638388"
>&lt;/p>
&lt;h2 id="ocp-installation">OCP Installation
&lt;/h2>&lt;h3 id="prepare-bastion">Prepare Bastion
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>準備一台 RHEL VM&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[nutanix@ken-rhel9 ~]$ cat /etc/os-release
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME=&amp;#34;Red Hat Enterprise Linux&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VERSION=&amp;#34;9.3 (Plow)&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>下載安裝檔 ccoctl , oc , openshift-install ,&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 建立安裝目錄
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ mkdir ocp-install-4-16-3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ cd ocp-install-4-16-3/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 下載檔案
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ wget https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.16.3/ccoctl-linux-rhel9-4.16.3.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ wget https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.16.3/openshift-client-linux-amd64-rhel9-4.16.3.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ wget https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.16.3/openshift-install-linux-4.16.3.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 解壓縮檔案
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ tar xvf ccoctl-linux-rhel9-4.16.3.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ tar xvf openshift-client-linux-amd64-rhel9-4.16.3.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ tar xvf openshift-install-linux-4.16.3.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total 1689088
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rwxr-xr-x. 1 nutanix nutanix 89185776 Jul 4 05:23 ccoctl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r--. 1 nutanix nutanix 35912054 Jul 12 03:52 ccoctl-linux-rhel9-4.16.3.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rwxr-xr-x. 2 nutanix nutanix 159916496 Jul 9 04:50 kubectl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rwxr-xr-x. 2 nutanix nutanix 159916496 Jul 9 04:50 oc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r--. 1 nutanix nutanix 66698442 Jul 12 03:52 openshift-client-linux-amd64-rhel9-4.16.3.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rwxr-xr-x. 1 nutanix nutanix 707719168 Jul 9 20:10 openshift-install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r--. 1 nutanix nutanix 510267167 Jul 12 03:52 openshift-install-linux-4.16.3.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ./oc version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Client Version: 4.16.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Kustomize Version: v5.0.4-0.20230601165947-6ce0bf390ce3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ./openshift-install version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./openshift-install 4.16.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">built from commit e1f9f057ce87c1a4a5f3c268812fa4c9dc003cb7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">release image quay.io/openshift-release-dev/ocp-release@sha256:3ec3a43ded1decc18134e5677f56037d8929f4442930f5d1156e7a77cdf1b9b3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">release architecture amd64
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="prism-central-ca">Prism Central CA
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>產生 CA 憑證&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="n">PC_IP&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">172.16&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">90.75&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="n">PC_FQDN&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">ntnxselabpc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nutanixlab&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">local&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">openssl&lt;/span> &lt;span class="n">req&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">x509&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">nodes&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">days&lt;/span> &lt;span class="mi">3650&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>&lt;span class="n">newkey&lt;/span> &lt;span class="n">rsa&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">2048&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">keyout&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">PC_IP&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">key&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">out&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">PC_IP&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">crt&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>&lt;span class="n">subj&lt;/span> &lt;span class="s2">&amp;#34;/C=US/ST=CA/L=San Jose/O=Nutanix Inc./OU=Manageability/CN=*.nutanix.local&amp;#34;&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>&lt;span class="n">addext&lt;/span> &lt;span class="s2">&amp;#34;subjectAltName=IP:${PC_IP},DNS:${PC_FQDN}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">ll&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">total&lt;/span> &lt;span class="mi">1689096&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>&lt;span class="n">rw&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="o">--&lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="o">--.&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">nutanix&lt;/span> &lt;span class="n">nutanix&lt;/span> &lt;span class="mi">1444&lt;/span> &lt;span class="n">Jul&lt;/span> &lt;span class="mi">16&lt;/span> &lt;span class="mi">14&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">48&lt;/span> &lt;span class="mf">172.16&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">90.75&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">crt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>&lt;span class="n">rw&lt;/span>&lt;span class="o">-------.&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">nutanix&lt;/span> &lt;span class="n">nutanix&lt;/span> &lt;span class="mi">1704&lt;/span> &lt;span class="n">Jul&lt;/span> &lt;span class="mi">16&lt;/span> &lt;span class="mi">14&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">48&lt;/span> &lt;span class="mf">172.16&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">90.75&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">key&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>置換 Prism Central CA&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/07/image-20240716144747534.png"
loading="lazy"
alt="image-20240716144747534"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/07/image-20240716144805568.png"
loading="lazy"
alt="image-20240716144805568"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/07/image-20240716144834705.png"
loading="lazy"
alt="image-20240716144834705"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>檢視憑證&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/07/image-20240716144925561.png"
loading="lazy"
alt="image-20240716144925561"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>將憑證匯入至Bastion&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ sudo cp 172.16.90.75.* /etc/pki/ca-trust/source/anchors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo update-ca-trust extract
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="install-configyaml">Install-config.yaml
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>建立install-config.yaml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 建立安裝目錄
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ mkdir install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 產生install-config.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ./openshift-install create install-config --dir /home/nutanix/ocp-install-4-16-3/install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">? SSH Public Key /home/nutanix/.ssh/id_rsa.pub
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">? Platform nutanix
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">? Prism Central 172.16.90.75
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">? Port 9440
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">? Username ocpadmin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">? Password [? for help] ***********
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Connecting to Prism Central 172.16.90.75
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">? Prism Element NX1365G6PE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">? Subnet Netfos_90_Access_IPAM
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">? Virtual IP Address for API 172.16.90.205
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">? Virtual IP Address for Ingress 172.16.90.207
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">? Base Domain nutanixlab.local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">? Cluster Name ocplab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">? Pull Secret [? for help] *****************************************************************************************************************INFO Install-Config created in: /home/nutanix/ocp-install-4-16-3/install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ll install/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total 8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r-----. 1 nutanix nutanix 4374 Jul 16 14:59 install-config.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>修改檔案&lt;/p>
&lt;p>additionalTrustBundle: 加入 Prism Central 的 root CA&lt;/p>
&lt;p>additionalTrustBundlePolicy: 改為 Always&lt;/p>
&lt;p>machineNetwork: 改為與VM相同網段 xxx.xxx.xxx.xxx/24&lt;/p>
&lt;p>platform 自定義cpu、memory、disk&lt;/p>
&lt;p>完成後如下，建議備份此檔案以利部署到其他地方或是重新部署&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ cat install-config.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">additionalTrustBundlePolicy: Always
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">additionalTrustBundle: |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----BEGIN CERTIFICATE-----
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">MIID/jCCAuagAwIBAgIUKDpX++EriXrP4L1R+e15qqR3+4owDQYJKoZIhvcNAQEL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BQAwdjELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAkNBMREwDwYDVQQHDAhTYW4gSm9z
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ZTEVMBMGxxx....
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----END CERTIFICATE-----
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">baseDomain: nutanixlab.local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">compute:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- architecture: amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hyperthreading: Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> platform:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nutanix:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cpus: 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> coresPerSocket: 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> memoryMiB: 8196
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> osDisk:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> diskSizeGiB: 120
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> categories:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - key: ocplab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">controlPlane:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> architecture: amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hyperthreading: Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> platform:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nutanix:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cpus: 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> coresPerSocket: 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> memoryMiB: 16384
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> osDisk:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> diskSizeGiB: 120
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> categories:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - key: ocpalb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">credentialsMode: Manual
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> creationTimestamp: null
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: ocplab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">networking:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> clusterNetwork:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - cidr: 10.128.0.0/14
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hostPrefix: 23
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machineNetwork:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - cidr: 172.16.90.0/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> networkType: OVNKubernetes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> serviceNetwork:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 172.30.0.0/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">platform:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nutanix:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> apiVIPs:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 172.16.90.205
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ingressVIPs:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 172.16.90.207
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> prismCentral:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> endpoint:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> address: 172.16.90.75
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port: 9440
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> password: password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> username: ocpadmin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> prismElements:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - endpoint:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> address: 172.16.90.74
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port: 9440
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> uuid: 00061972-aeba-fee2-0000-000000028e95
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> subnetUUIDs:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 060837bb-aefc-41f2-aaae-25c95267d87a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">publish: External
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pullSecret: &amp;#39;{&amp;#34;auths&amp;#34;:{&amp;#34;cloud.openshift.com&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;b3BlbnN....&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sshKey: |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCy4sUIXB5QMIETJe6+niy4SrO0ly/ymlwBtnCbgAPNtIKfQfkjFrbcUgsdUsjEQ+M0giXfjlgDcAMiasxaFvfhKCNJ1dR5L6hyi/JrWAdG/Ue5ydbc84vFgQRQ1AolnovlxWcM4xdsYYQvpZwo9v1dOIAQ9rasubEiDxHaw7HK+mGChu+6uRli4EdJ7HvRg9Ha5dKAQFawsZ/cBcMZZnW84bfK72naHI7XyVOEPnbQ8NG+Pk55S2za6J7VIIHDr3rSbNYBZUJnTroYMLxXnC0I0xqcXZMDiUm6ZQzE6kJnrFHIdqVEXkgqtbdXQDK+zdeA/vOttq8ojYSFpa9qCHMCHK66OC2P0vE54hI439uEHPJI7aIYNGPxPJtL6k8rDklWyMnkh8jJMtxM+sZkZxI2/+L4szC/S4qJ/OmRJI3TeTob+0kptqwJrAuWK3T/YiCWbyqytr4RyGJTFA5pB0SucJHaqJ4PbiJ633hJ8AJ7KepYHB65KyvHgDga2v3QDf0= nutanix@ken-rhel9.nutanixlab.local
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="cloud-credential-operator">Cloud Credential Operator
&lt;/h3>&lt;p>安裝Cluster需要Cloud Credential Operator (CCO)，讓OCP能與Prism溝通&lt;/p>
&lt;p>大致作法為&lt;/p>
&lt;ol>
&lt;li>
&lt;p>建立帳號密碼檔案&lt;/p>
&lt;/li>
&lt;li>
&lt;p>建立要求帳密的目錄及檔案&lt;/p>
&lt;/li>
&lt;li>
&lt;p>利用上述檔案建立OCP Shared Secret&lt;/p>
&lt;/li>
&lt;li>
&lt;p>建立cred.yaml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ vim credentials.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">credentials:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- type: basic_auth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> data:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> prismCentral:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> username: ocpadmin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> password: password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> prismElements:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> username: ocpadmin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> password: password
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>設定Image環境變數&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ RELEASE_IMAGE=$(./openshift-install version | awk &amp;#39;/release image/ {print $3}&amp;#39;)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>建立credrequests資料夾&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ mkdir credrequests
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>建立0000_30_machine-api-operator_00_credentials-request.yaml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">oc&lt;/span> &lt;span class="n">adm&lt;/span> &lt;span class="n">release&lt;/span> &lt;span class="n">extract&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">credentials&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">requests&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">cloud&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">nutanix&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">=./&lt;/span>&lt;span class="n">credrequests&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">RELEASE_IMAGE&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">warning&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">you&lt;/span> &lt;span class="n">intend&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="k">pass&lt;/span> &lt;span class="n">CredentialsRequests&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">ccoctl&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">you&lt;/span> &lt;span class="n">should&lt;/span> &lt;span class="n">use&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">included&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">filter&lt;/span> &lt;span class="n">out&lt;/span> &lt;span class="n">requests&lt;/span> &lt;span class="n">that&lt;/span> &lt;span class="n">your&lt;/span> &lt;span class="n">cluster&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">expected&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">need&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Extracted&lt;/span> &lt;span class="n">release&lt;/span> &lt;span class="n">payload&lt;/span> &lt;span class="n">created&lt;/span> &lt;span class="n">at&lt;/span> &lt;span class="mi">2024&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">07&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">11&lt;/span>&lt;span class="n">T11&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">19&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">04&lt;/span>&lt;span class="n">Z&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">ll&lt;/span> &lt;span class="n">credrequests&lt;/span>&lt;span class="o">/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">total&lt;/span> &lt;span class="mi">8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>&lt;span class="n">rw&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="o">--&lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="o">--.&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">nutanix&lt;/span> &lt;span class="n">nutanix&lt;/span> &lt;span class="mi">599&lt;/span> &lt;span class="n">Jul&lt;/span> &lt;span class="mi">16&lt;/span> &lt;span class="mi">15&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">43&lt;/span> &lt;span class="mi">0000&lt;/span>&lt;span class="n">_26_cloud&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">controller&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator_18_credentialsrequest&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>&lt;span class="n">rw&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="o">--&lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="o">--.&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">nutanix&lt;/span> &lt;span class="n">nutanix&lt;/span> &lt;span class="mi">543&lt;/span> &lt;span class="n">Jul&lt;/span> &lt;span class="mi">16&lt;/span> &lt;span class="mi">15&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">43&lt;/span> &lt;span class="mi">0000&lt;/span>&lt;span class="n">_30_machine&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">api&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator_00_credentials&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>建立 CCO Secret&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ ./ccoctl nutanix create-shared-secrets --credentials-requests-dir=/home/nutanix/ocp-install-4-16-3/credrequests --output-dir=/home/nutanix/ocp-install-4-16-3/install --credentials-source-filepath=/home/nutanix/ocp-install-4-16-3/install/credentials.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/07/16 15:45:45 Saved credentials configuration to: /home/nutanix/ocp-install-4-16-3/install/manifests/openshift-cloud-controller-manager-nutanix-credentials-credentials.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/07/16 15:45:45 Saved credentials configuration to: /home/nutanix/ocp-install-4-16-3/install/manifests/openshift-machine-api-nutanix-credentials-credentials.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ tree install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── credentials.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── install-config.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── manifests
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── openshift-cloud-controller-manager-nutanix-credentials-credentials.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └── openshift-machine-api-nutanix-credentials-credentials.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1 directory, 4 files
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="create-cluster">Create Cluster
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>Create manifests&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ ./openshift-install create manifests --dir /home/nutanix/ocp-install-4-16-3/install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Consuming Install Config from target directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Manifests created in: /home/nutanix/ocp-install-4-16-3/install/cluster-api, /home/nutanix/ocp-install-4-16-3/install/manifests and /home/nutanix/ocp-install-4-16-3/install/openshift
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ tree install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── cluster-api
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── 000_capi-namespace.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── 01_capi-cluster.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── 01_nutanix-cluster.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── 01_nutanix-creds.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   └── machines
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── 10_inframachine_ocplab-k7zds-bootstrap.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── 10_inframachine_ocplab-k7zds-master-0.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── 10_inframachine_ocplab-k7zds-master-1.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── 10_inframachine_ocplab-k7zds-master-2.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── 10_machine_ocplab-k7zds-bootstrap.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── 10_machine_ocplab-k7zds-master-0.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── 10_machine_ocplab-k7zds-master-1.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   └── 10_machine_ocplab-k7zds-master-2.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── credentials.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── manifests
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── cloud-provider-config.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── cluster-config.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── cluster-dns-02-config.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── cluster-infrastructure-02-config.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── cluster-ingress-02-config.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── cluster-network-02-config.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── cluster-proxy-01-config.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── cluster-scheduler-02-config.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── cvo-overrides.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── kube-cloud-config.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── kube-system-configmap-root-ca.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── machine-config-server-tls-secret.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── openshift-cloud-controller-manager-nutanix-credentials-credentials.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── openshift-config-secret-pull-secret.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── openshift-machine-api-nutanix-credentials-credentials.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   └── user-ca-bundle-config.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── openshift
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── 99_feature-gate.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── 99_kubeadmin-password-secret.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── 99_openshift-cluster-api_master-machines-0.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── 99_openshift-cluster-api_master-machines-1.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── 99_openshift-cluster-api_master-machines-2.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── 99_openshift-cluster-api_master-user-data-secret.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── 99_openshift-cluster-api_worker-machineset-0.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── 99_openshift-cluster-api_worker-user-data-secret.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── 99_openshift-machine-api_master-control-plane-machine-set.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── 99_openshift-machineconfig_99-master-ssh.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── 99_openshift-machineconfig_99-worker-ssh.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └── openshift-install-manifests.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4 directories, 41 files
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>Create Cluster&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">install&lt;/span> &lt;span class="n">create&lt;/span> &lt;span class="n">cluster&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">dir&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">install&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">16&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">install&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">level&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">debug&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">DEBUG&lt;/span> &lt;span class="n">Generating&lt;/span> &lt;span class="n">Cluster&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">INFO&lt;/span> &lt;span class="n">Creating&lt;/span> &lt;span class="n">infrastructure&lt;/span> &lt;span class="n">resources&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">INFO&lt;/span> &lt;span class="n">created&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">category&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="s2">&amp;#34;kubernetes-io-cluster-ocplab-k7zds&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">INFO&lt;/span> &lt;span class="n">created&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">category&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="s2">&amp;#34;owned&amp;#34;&lt;/span> &lt;span class="n">with&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="s2">&amp;#34;kubernetes-io-cluster-ocplab-k7zds&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">INFO&lt;/span> &lt;span class="n">created&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">category&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="s2">&amp;#34;shared&amp;#34;&lt;/span> &lt;span class="n">with&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="s2">&amp;#34;kubernetes-io-cluster-ocplab-k7zds&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">INFO&lt;/span> &lt;span class="n">creating&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">rhcos&lt;/span> &lt;span class="n">image&lt;/span> &lt;span class="n">ocplab&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">k7zds&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">rhcos&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">uuid&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">c8db94e&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">17&lt;/span>&lt;span class="n">aa&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="n">eea&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">bc75&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">2e05876&lt;/span>&lt;span class="n">e8f31&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">INFO&lt;/span> &lt;span class="n">waiting&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">image&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="n">uploading&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">rhcos&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mirror&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">art&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">prod&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">streams&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">4.16&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">9.4&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">builds&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">416.94&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">202406251923&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">x86_64&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">rhcos&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">416.94&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">202406251923&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">x86_64&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">qcow2&lt;/span>&lt;span class="err">?&lt;/span>&lt;span class="n">sha256&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">taskUUID&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">cf6ef687&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">c95d&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">4648&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">b97e&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">c0bccfcb3052&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">INFO&lt;/span> &lt;span class="n">Network&lt;/span> &lt;span class="n">infrastructure&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">ready&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">DEBUG&lt;/span> &lt;span class="n">No&lt;/span> &lt;span class="n">infrastructure&lt;/span> &lt;span class="n">ready&lt;/span> &lt;span class="n">requirements&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">nutanix&lt;/span> &lt;span class="n">provider&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">INFO&lt;/span> &lt;span class="n">creating&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">image&lt;/span> &lt;span class="n">ocplab&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">k7zds&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">bootstrap&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ign&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">iso&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">uuid&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">466&lt;/span>&lt;span class="n">b5db5&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">69e4&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="n">f39&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">aaac&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="n">ae65594a09f&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">taskUUID&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">04588942&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">57&lt;/span>&lt;span class="n">c9&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="n">b0b&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="n">bb2&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">321e6&lt;/span>&lt;span class="n">eaf60ad&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">INFO&lt;/span> &lt;span class="n">created&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">image&lt;/span> &lt;span class="n">ocplab&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">k7zds&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">bootstrap&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ign&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">iso&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">uuid&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">466&lt;/span>&lt;span class="n">b5db5&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">69e4&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="n">f39&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">aaac&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="n">ae65594a09f&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">used_time&lt;/span> &lt;span class="mf">10.829777095&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">INFO&lt;/span> &lt;span class="n">preparing&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">upload&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">image&lt;/span> &lt;span class="n">ocplab&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">k7zds&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">bootstrap&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ign&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">iso&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">uuid&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">466&lt;/span>&lt;span class="n">b5db5&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">69e4&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="n">f39&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">aaac&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="n">ae65594a09f&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">file&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">/.&lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">installer&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">image_cache&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ocplab&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">k7zds&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">bootstrap&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ign&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">iso&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">INFO&lt;/span> &lt;span class="n">All&lt;/span> &lt;span class="n">cluster&lt;/span> &lt;span class="n">operators&lt;/span> &lt;span class="n">have&lt;/span> &lt;span class="n">completed&lt;/span> &lt;span class="n">progressing&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">INFO&lt;/span> &lt;span class="n">Checking&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">see&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">there&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">route&lt;/span> &lt;span class="n">at&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">console&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">console&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">DEBUG&lt;/span> &lt;span class="n">Route&lt;/span> &lt;span class="n">found&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">console&lt;/span> &lt;span class="n">namespace&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">console&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">DEBUG&lt;/span> &lt;span class="n">OpenShift&lt;/span> &lt;span class="n">console&lt;/span> &lt;span class="n">route&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">admitted&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">INFO&lt;/span> &lt;span class="n">Install&lt;/span> &lt;span class="n">complete&lt;/span>&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">INFO&lt;/span> &lt;span class="n">To&lt;/span> &lt;span class="n">access&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">cluster&lt;/span> &lt;span class="n">as&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">system&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">admin&lt;/span> &lt;span class="n">user&lt;/span> &lt;span class="n">when&lt;/span> &lt;span class="n">using&lt;/span> &lt;span class="s1">&amp;#39;oc&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">run&lt;/span> &lt;span class="s1">&amp;#39;export KUBECONFIG=/home/nutanix/ocp-install-4-16-3/install/auth/kubeconfig&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">INFO&lt;/span> &lt;span class="n">Access&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">OpenShift&lt;/span> &lt;span class="n">web&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">console&lt;/span> &lt;span class="n">here&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">console&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">console&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apps&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocplab&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nutanixlab&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">local&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">INFO&lt;/span> &lt;span class="n">Login&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">console&lt;/span> &lt;span class="n">with&lt;/span> &lt;span class="n">user&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;kubeadmin&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">password&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;JrHfc-s958g-V3oQ7-eXHxY&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">DEBUG&lt;/span> &lt;span class="n">Time&lt;/span> &lt;span class="n">elapsed&lt;/span> &lt;span class="n">per&lt;/span> &lt;span class="n">stage&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">DEBUG&lt;/span> &lt;span class="n">Infrastructure&lt;/span> &lt;span class="n">Pre&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">provisioning&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="n">m6s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">DEBUG&lt;/span> &lt;span class="n">Network&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">infrastructure&lt;/span> &lt;span class="n">Provisioning&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">54&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">DEBUG&lt;/span> &lt;span class="n">Bootstrap&lt;/span> &lt;span class="n">Ignition&lt;/span> &lt;span class="n">Provisioning&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">18&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">DEBUG&lt;/span> &lt;span class="n">Machine&lt;/span> &lt;span class="n">Provisioning&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">30&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">DEBUG&lt;/span> &lt;span class="n">Bootstrap&lt;/span> &lt;span class="n">Complete&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">22&lt;/span>&lt;span class="n">m27s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">DEBUG&lt;/span> &lt;span class="n">API&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="n">m0s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">DEBUG&lt;/span> &lt;span class="n">Bootstrap&lt;/span> &lt;span class="n">Destroy&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">11&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">DEBUG&lt;/span> &lt;span class="n">Cluster&lt;/span> &lt;span class="n">Operators&lt;/span> &lt;span class="n">Available&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">12&lt;/span>&lt;span class="n">m37s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">DEBUG&lt;/span> &lt;span class="n">Cluster&lt;/span> &lt;span class="n">Operators&lt;/span> &lt;span class="n">Stable&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">INFO&lt;/span> &lt;span class="n">Time&lt;/span> &lt;span class="n">elapsed&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">39&lt;/span>&lt;span class="n">m33s&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/07/image-20240716155629530.png"
loading="lazy"
alt="image-20240716155629530"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/07/image-20240716163717437.png"
loading="lazy"
alt="image-20240716163717437"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>安裝完畢確認連線&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/07/image-20240716163827676.png"
loading="lazy"
alt="image-20240716163827676"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/07/image-20240716163936258.png"
loading="lazy"
alt="image-20240716163936258"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/07/image-20240716163947487.png"
loading="lazy"
alt="image-20240716163947487"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>指令確認&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ cp /home/nutanix/ocp-install-4-16-3/install/auth/kubeconfig ~/.kube/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo cp oc /usr/local/bin/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[sudo] password for nutanix:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ocplab-k7zds-master-0 Ready control-plane,master 34m v1.29.6+aba1e8d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ocplab-k7zds-master-1 Ready control-plane,master 34m v1.29.6+aba1e8d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ocplab-k7zds-master-2 Ready control-plane,master 34m v1.29.6+aba1e8d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ocplab-k7zds-worker-27snp Ready worker 19m v1.29.6+aba1e8d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ocplab-k7zds-worker-29wr6 Ready worker 19m v1.29.6+aba1e8d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ocplab-k7zds-worker-bdgmd Ready worker 19m v1.29.6+aba1e8d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get nodes -o wide
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIME
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ocplab-k7zds-master-0 Ready control-plane,master 34m v1.29.6+aba1e8d 172.16.90.158 &amp;lt;none&amp;gt; Red Hat Enterprise Linux CoreOS 416.94.202407081958-0 5.14.0-427.26.1.el9_4.x86_64 cri-o://1.29.6-3.rhaos4.16.gitfd433b7.el9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ocplab-k7zds-master-1 Ready control-plane,master 34m v1.29.6+aba1e8d 172.16.90.175 &amp;lt;none&amp;gt; Red Hat Enterprise Linux CoreOS 416.94.202407081958-0 5.14.0-427.26.1.el9_4.x86_64 cri-o://1.29.6-3.rhaos4.16.gitfd433b7.el9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ocplab-k7zds-master-2 Ready control-plane,master 34m v1.29.6+aba1e8d 172.16.90.151 &amp;lt;none&amp;gt; Red Hat Enterprise Linux CoreOS 416.94.202407081958-0 5.14.0-427.26.1.el9_4.x86_64 cri-o://1.29.6-3.rhaos4.16.gitfd433b7.el9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ocplab-k7zds-worker-27snp Ready worker 19m v1.29.6+aba1e8d 172.16.90.154 &amp;lt;none&amp;gt; Red Hat Enterprise Linux CoreOS 416.94.202407081958-0 5.14.0-427.26.1.el9_4.x86_64 cri-o://1.29.6-3.rhaos4.16.gitfd433b7.el9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ocplab-k7zds-worker-29wr6 Ready worker 20m v1.29.6+aba1e8d 172.16.90.167 &amp;lt;none&amp;gt; Red Hat Enterprise Linux CoreOS 416.94.202407081958-0 5.14.0-427.26.1.el9_4.x86_64 cri-o://1.29.6-3.rhaos4.16.gitfd433b7.el9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ocplab-k7zds-worker-bdgmd Ready worker 20m v1.29.6+aba1e8d 172.16.90.160 &amp;lt;none&amp;gt; Red Hat Enterprise Linux CoreOS 416.94.202407081958-0 5.14.0-427.26.1.el9_4.x86_64 cri-o://1.29.6-3.rhaos4.16.gitfd433b7.el9
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="安裝-nutanix-csi-cosi">安裝 Nutanix CSI 、COSI
&lt;/h2>&lt;h3 id="nutanix-csi-30">Nutanix CSI 3.0
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>先安裝Helm Chart 在Bastion上面&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ sudo curl -L https://mirror.openshift.com/pub/openshift-v4/clients/helm/latest/helm-linux-amd64 -o /usr/local/bin/helm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo chmod +x /usr/local/bin/helm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ helm version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/nutanix/.kube/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">version.BuildInfo{Version:&amp;#34;v3.13.2+35.el9&amp;#34;, GitCommit:&amp;#34;fa6e939d7984e1be0d6fbc2dc920b6bbcf395932&amp;#34;, GitTreeState:&amp;#34;clean&amp;#34;, GoVersion:&amp;#34;go1.20.12&amp;#34;}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ helm repo add nutanix https://nutanix.github.io/helm/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>建立 Nutanix Secret 在 ntnx-system 內&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># Create Namespace ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc create ns ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">namespace/ntnx-system created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Edit Secret for PE,PC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ vi ntnx-secret.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: Secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: ntnx-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespace: ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stringData:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # prism-element-ip:prism-port:admin:password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: pe-ip:9440:admin:password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ vi ntnx-pc-secret.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: Secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: ntnx-pc-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespace: ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stringData:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # prism-pc-ip:prism-port:admin:password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: pc-ip:9440:admin:password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Create secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc apply -f ntnx-pc-secret.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc apply -f ntnx-secret.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get secret -n ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME TYPE DATA AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ntnx-pc-secret Opaque 1 13s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ntnx-secret Opaque 1 9s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>下載 Nutanix CSI 3.0 beta&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">wget&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">github&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">helm&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">releases&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">releases&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">download&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">3.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">beta&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1912.&lt;/span>&lt;span class="n">tgz&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">tar&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">xvf&lt;/span> &lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">3.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">beta&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1912.&lt;/span>&lt;span class="n">tgz&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Chart&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">values&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">NOTES&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">txt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">_helpers&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tpl&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">driver&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">machine&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">controller&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">deployment&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">init&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">configmap&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ds&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">rbac&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">secret&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">service&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">prometheus&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/.&lt;/span>&lt;span class="n">helmignore&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Nutanix&lt;/span> &lt;span class="n">core_k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi_beta1&lt;/span> &lt;span class="n">Notice&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">txt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">README&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">md&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">questions&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yml&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>Edit value.yaml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ cd nutanix-csi-storage
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ vim values.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># all namespace
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">namespace: ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">createPrismCentralSecret: false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># prismCentralEndPoint: 00.00.00.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># pcUsername: username
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># pcPassword: password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pcSecretName: ntnx-pc-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">createSecret: false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># prismEndPoint: 00.00.000.000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># username: username
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># password: password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">peSecretName: ntnx-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#supportedPCVersions: &amp;#34;fraser-2023.4-stable-pc-0&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">supportedPCVersions: &amp;#34;fraser-2024.1-stable-pc-0.1&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>Install CSI Driver using Helm&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">helm&lt;/span> &lt;span class="n">install&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">system&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">f&lt;/span> &lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">values&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span> &lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">get&lt;/span> &lt;span class="n">all&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Warning&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">apps&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">v1&lt;/span> &lt;span class="n">DeploymentConfig&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">deprecated&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">v4&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">unavailable&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">v4&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">10000&lt;/span>&lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">NAME&lt;/span> &lt;span class="n">TYPE&lt;/span> &lt;span class="n">CLUSTER&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="ne">IP&lt;/span> &lt;span class="n">EXTERNAL&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="ne">IP&lt;/span> &lt;span class="n">PORT&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">S&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">AGE&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">service&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">metrics&lt;/span> &lt;span class="n">ClusterIP&lt;/span> &lt;span class="mf">172.30&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">52.86&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="mi">9809&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">TCP&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">9810&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">TCP&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">9811&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">TCP&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">9812&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">TCP&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="n">m43s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">NAME&lt;/span> &lt;span class="n">DESIRED&lt;/span> &lt;span class="n">CURRENT&lt;/span> &lt;span class="n">READY&lt;/span> &lt;span class="n">UP&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">TO&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">DATE&lt;/span> &lt;span class="n">AVAILABLE&lt;/span> &lt;span class="n">NODE&lt;/span> &lt;span class="n">SELECTOR&lt;/span> &lt;span class="n">AGE&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">daemonset&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apps&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">node&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">kubernetes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">os&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">linux&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="n">m43s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">NAME&lt;/span> &lt;span class="n">READY&lt;/span> &lt;span class="n">UP&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">TO&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">DATE&lt;/span> &lt;span class="n">AVAILABLE&lt;/span> &lt;span class="n">AGE&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">deployment&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apps&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">controller&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="n">m43s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">NAME&lt;/span> &lt;span class="n">DESIRED&lt;/span> &lt;span class="n">CURRENT&lt;/span> &lt;span class="n">READY&lt;/span> &lt;span class="n">AGE&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">replicaset&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apps&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">controller&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">8669&lt;/span>&lt;span class="n">b97dc8&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="n">m43s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">describe&lt;/span> &lt;span class="n">daemonset&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apps&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">node&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">----&lt;/span> &lt;span class="o">-------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Warning&lt;/span> &lt;span class="n">FailedCreate&lt;/span> &lt;span class="mi">12&lt;/span>&lt;span class="n">m&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">x19&lt;/span> &lt;span class="n">over&lt;/span> &lt;span class="mi">23&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">daemonset&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">controller&lt;/span> &lt;span class="n">Error&lt;/span> &lt;span class="n">creating&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">pods&lt;/span> &lt;span class="s2">&amp;#34;nutanix-csi-node-&amp;#34;&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">forbidden&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">unable&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">validate&lt;/span> &lt;span class="n">against&lt;/span> &lt;span class="n">any&lt;/span> &lt;span class="n">security&lt;/span> &lt;span class="n">context&lt;/span> &lt;span class="n">constraint&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">provider&lt;/span> &lt;span class="s2">&amp;#34;anyuid&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Forbidden&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">usable&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="n">user&lt;/span> &lt;span class="ow">or&lt;/span> &lt;span class="n">serviceaccount&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>Apply privilege to ntnx-system namespace&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">adm&lt;/span> &lt;span class="n">policy&lt;/span> &lt;span class="n">add&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="n">privileged&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">z&lt;/span> &lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">controller&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">clusterrole&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rbac&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">authorization&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">system&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">scc&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">privileged&lt;/span> &lt;span class="n">added&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;nutanix-csi-controller&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">adm&lt;/span> &lt;span class="n">policy&lt;/span> &lt;span class="n">add&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="n">privileged&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">z&lt;/span> &lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">node&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">clusterrole&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rbac&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">authorization&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">system&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">scc&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">privileged&lt;/span> &lt;span class="n">added&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;nutanix-csi-node&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">adm&lt;/span> &lt;span class="n">policy&lt;/span> &lt;span class="n">add&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="n">privileged&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">z&lt;/span> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">exporter&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">adm&lt;/span> &lt;span class="n">policy&lt;/span> &lt;span class="n">add&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="n">anyuid&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">z&lt;/span> &lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">controller&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">clusterrole&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rbac&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">authorization&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">system&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">scc&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">anyuid&lt;/span> &lt;span class="n">added&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;nutanix-csi-controller&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">adm&lt;/span> &lt;span class="n">policy&lt;/span> &lt;span class="n">add&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="n">anyuid&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">z&lt;/span> &lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">node&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">clusterrole&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rbac&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">authorization&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">system&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">scc&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">anyuid&lt;/span> &lt;span class="n">added&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;nutanix-csi-node&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">adm&lt;/span> &lt;span class="n">policy&lt;/span> &lt;span class="n">add&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="n">anyuid&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">z&lt;/span> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">exporter&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">clusterrole&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rbac&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">authorization&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">system&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">scc&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">anyuid&lt;/span> &lt;span class="n">added&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;node-exporter&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># reinstall &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">helm&lt;/span> &lt;span class="n">uninstall&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">system&lt;/span> &lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">helm&lt;/span> &lt;span class="n">install&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">system&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">f&lt;/span> &lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">values&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span> &lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>確認安裝完成&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ oc get all -n ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: apps.openshift.io/v1 DeploymentConfig is deprecated in v4.14+, unavailable in v4.10000+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/nutanix-csi-controller-8669b97dc8-pwcq4 7/7 Running 0 9s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/nutanix-csi-controller-8669b97dc8-srkbr 7/7 Running 0 9s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/nutanix-csi-node-gz278 3/3 Running 0 9s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/nutanix-csi-node-p6lrb 3/3 Running 0 9s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/nutanix-csi-node-qdrdp 3/3 Running 0 9s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service/nutanix-csi-metrics ClusterIP 172.30.34.177 &amp;lt;none&amp;gt; 9809/TCP,9810/TCP,9811/TCP,9812/TCP 9s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">daemonset.apps/nutanix-csi-node 3 3 3 3 3 kubernetes.io/os=linux 9s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY UP-TO-DATE AVAILABLE AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deployment.apps/nutanix-csi-controller 2/2 2 2 9s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME DESIRED CURRENT READY AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">replicaset.apps/nutanix-csi-controller-8669b97dc8 2 2 2 9s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/07/image-20240716172840878.png"
loading="lazy"
alt="image-20240716172840878"
>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 id="連線-nutanix-volume">連線 Nutanix Volume
&lt;/h4>&lt;ol>
&lt;li>
&lt;p>Create nutanix-volume.yaml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ vim nutanix-volume.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: StorageClass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: storage.k8s.io/v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> annotations:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> storageclass.kubernetes.io/is-default-class: &amp;#34;true&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: nutanixvolume
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">provisioner: csi.nutanix.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">parameters:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/provisioner-secret-name: ntnx-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/provisioner-secret-namespace: ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/node-publish-secret-name: ntnx-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/node-publish-secret-namespace: ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/controller-expand-secret-name: ntnx-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/controller-expand-secret-namespace: ntnx-systems
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/fstype: ext4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dataServiceEndPoint: 172.16.90.76:3260 # Prism data service ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> storageContainer: NX_1365_AHV_cr # Prism 上建立的Storage Container
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> storageType: NutanixVolumes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #whitelistIPMode: ENABLED
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #chapAuth: ENABLED
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">allowVolumeExpansion: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">reclaimPolicy: Delete
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>apply nutanix-volume.yaml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ oc apply -f nutanix-volume.yaml -n ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">storageclass.storage.k8s.io/nutanix-volume created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get storageclass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME PROVISIONER RECLAIMPOLICY VOLUMEBINDINGMODE ALLOWVOLUMEEXPANSION AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nutanix-volume (default) csi.nutanix.com Delete Immediate true 45s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>測試VG&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ oc get pv,pvc -n ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS VOLUMEATTRIBUTESCLASS REASON AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolume/pvc-49b7f489-05a1-479a-ada3-a1cd2ae76bfa 1Gi RWO Delete Bound ntnx-system/test-vg nutanix-volume &amp;lt;unset&amp;gt; 77s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS VOLUMEATTRIBUTESCLASS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolumeclaim/test-vg Bound pvc-49b7f489-05a1-479a-ada3-a1cd2ae76bfa 1Gi RWO nutanix-volume &amp;lt;unset&amp;gt; 110s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/07/image-20240716174552557.png"
loading="lazy"
alt="image-20240716174552557"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/07/image-20240716174543937.png"
loading="lazy"
alt="image-20240716174543937"
>
&lt;img src="https://kenkenny.synology.me:5543/images/2024/07/image-20240716174532000.png"
loading="lazy"
alt="image-20240716174532000"
>&lt;/p>
&lt;/li>
&lt;/ol></description></item><item><title>Nutanix_NDK-v1.0.0_On_OCP-4.13</title><link>https://wangken0129.github.io/p/nutanix_ndk-v1.0.0_on_ocp-4.13/</link><pubDate>Thu, 23 May 2024 08:00:46 +0800</pubDate><guid>https://wangken0129.github.io/p/nutanix_ndk-v1.0.0_on_ocp-4.13/</guid><description>&lt;h1 id="ndk-v100-on-ocp-v413">NDK v1.0.0 on OCP v4.13
&lt;/h1>&lt;p>NDK ( Nutanix Data Service for Kubernetes ) ：針對Kubernetes 的容器備份還原&lt;/p>
&lt;p>目前備援功能只支援在同一個供應商提供的 Kubernetes 叢集，且目前只有Volume 的PVC才可快照&lt;/p>
&lt;p>排程備份只支援Async ，此測試僅有針對 Namespace 內全部的項目做手動快照還原&lt;/p>
&lt;p>OCP IPI 安裝此篇不贅述，請參考其他篇&lt;/p>
&lt;p>2024.05.23&lt;/p>
&lt;h2 id="reference">Reference
&lt;/h2>&lt;p>&lt;a class="link" href="https://portal.nutanix.com/page/documents/solutions/details?targetId=TN-2030-Red-Hat-OpenShift-on-Nutanix:TN-2030-Red-Hat-OpenShift-on-Nutanix" target="_blank" rel="noopener"
>https://portal.nutanix.com/page/documents/solutions/details?targetId=TN-2030-Red-Hat-OpenShift-on-Nutanix:TN-2030-Red-Hat-OpenShift-on-Nutanix&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://portal.nutanix.com/page/documents/details?targetId=Nutanix-Data-Services-for-Kubernetes-v1_0:Nutanix-Data-Services-for-Kubernetes-v1_0" target="_blank" rel="noopener"
>https://portal.nutanix.com/page/documents/details?targetId=Nutanix-Data-Services-for-Kubernetes-v1_0:Nutanix-Data-Services-for-Kubernetes-v1_0&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://portal.nutanix.com/page/documents/details?targetId=Release-Notes-Nutanix-Data-Services-for-Kubernetes-v1_0:Release-Notes-Nutanix-Data-Services-for-Kubernetes-v1_0" target="_blank" rel="noopener"
>https://portal.nutanix.com/page/documents/details?targetId=Release-Notes-Nutanix-Data-Services-for-Kubernetes-v1_0:Release-Notes-Nutanix-Data-Services-for-Kubernetes-v1_0&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/nutanix/helm/tree/nutanix-csi-snapshot-6.3.2/charts/nutanix-csi-snapshot#install" target="_blank" rel="noopener"
>https://github.com/nutanix/helm/tree/nutanix-csi-snapshot-6.3.2/charts/nutanix-csi-snapshot#install&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/nutanix/helm/tree/csi-v3.0.0-beta-beta1/charts/nutanix-csi-storage" target="_blank" rel="noopener"
>https://github.com/nutanix/helm/tree/csi-v3.0.0-beta-beta1/charts/nutanix-csi-storage&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://access.redhat.com/documentation/zh-tw/openshift_container_platform/4.13/html/building_applications/working-with-helm-charts" target="_blank" rel="noopener"
>https://access.redhat.com/documentation/zh-tw/openshift_container_platform/4.13/html/building_applications/working-with-helm-charts&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://blog.csdn.net/u010918487/article/details/115509935" target="_blank" rel="noopener"
>https://blog.csdn.net/u010918487/article/details/115509935&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://portal.nutanix.com/page/documents/kbs/details?targetId=kA0VO00000008Qb0AI" target="_blank" rel="noopener"
>https://portal.nutanix.com/page/documents/kbs/details?targetId=kA0VO00000008Qb0AI&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://quay.io/repository/karbon/k8s-agent?tab=tags" target="_blank" rel="noopener"
>https://quay.io/repository/karbon/k8s-agent?tab=tags&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/nutanix/helm-releases/releases" target="_blank" rel="noopener"
>https://github.com/nutanix/helm-releases/releases&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/orgs/nutanix-cloud-native/repositories?type=all" target="_blank" rel="noopener"
>https://github.com/orgs/nutanix-cloud-native/repositories?type=all&lt;/a>&lt;/p>
&lt;h2 id="requirements">Requirements
&lt;/h2>&lt;p>NKE v2.9 以上&lt;/p>
&lt;p>Prism Central 2023.4 以上&lt;/p>
&lt;p>Kubernetes version v1.26 以上&lt;/p>
&lt;p>Nutanix CSI Driver v3.0 (beta) 以上&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/05/image-20240523120449110.png"
loading="lazy"
alt="image-20240523120449110"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/05/image-20240515115102568.png"
loading="lazy"
alt="image-20240515115102568"
>&lt;/p>
&lt;h2 id="lab-enviroments">Lab Enviroments
&lt;/h2>&lt;p>Prism Central : 2024.1&lt;/p>
&lt;p>AOS: 6.7.1&lt;/p>
&lt;p>NKE: 2.9&lt;/p>
&lt;p>OpenShift : 4.13&lt;/p>
&lt;p>Openshift IPI on Nutanix AHV&lt;/p>
&lt;h2 id="ndk-install-lab">NDK install Lab
&lt;/h2>&lt;h3 id="install-helm-chart-on-bastion">install helm chart on bastion
&lt;/h3>&lt;p>&lt;a class="link" href="https://access.redhat.com/documentation/zh-tw/openshift_container_platform/4.13/html/building_applications/working-with-helm-charts" target="_blank" rel="noopener"
>https://access.redhat.com/documentation/zh-tw/openshift_container_platform/4.13/html/building_applications/working-with-helm-charts&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ sudo curl -L https://mirror.openshift.com/pub/openshift-v4/clients/helm/latest/helm-linux-amd64 -o /usr/local/bin/helm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo chmod +x /usr/local/bin/helm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ helm version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/nutanix/.kube/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">version.BuildInfo{Version:&amp;#34;v3.13.2+35.el9&amp;#34;, GitCommit:&amp;#34;fa6e939d7984e1be0d6fbc2dc920b6bbcf395932&amp;#34;, GitTreeState:&amp;#34;clean&amp;#34;, GoVersion:&amp;#34;go1.20.12&amp;#34;}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ helm repo add nutanix https://nutanix.github.io/helm/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="nutanix--csi-30-beta">Nutanix CSI 3.0 (beta)
&lt;/h3>&lt;h4 id="create-ocp-secret">Create OCP Secret
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Create Secret pc and pe
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ vi ntnx-secret.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: Secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: ntnx-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespace: ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stringData:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # prism-element-ip:prism-port:admin:password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: pe-ip:9440:admin:password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ vi ntnx-pc-secret.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: Secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: ntnx-pc-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespace: ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stringData:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # prism-pc-ip:prism-port:admin:password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: pc-ip:9440:admin:password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc apply -f ntnx-pc-secret.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc apply -f ntnx-secret.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="install-csi-driver">Install CSI Driver
&lt;/h4>&lt;ol>
&lt;li>Download CSI Driver and Edit value.yaml&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">wget&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">github&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">helm&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">releases&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">releases&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">download&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">3.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">beta&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1912.&lt;/span>&lt;span class="n">tgz&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">tar&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">xvf&lt;/span> &lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">3.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">beta&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1912.&lt;/span>&lt;span class="n">tgz&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Chart&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">values&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">NOTES&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">txt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">_helpers&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tpl&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">driver&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">machine&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">controller&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">deployment&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">init&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">configmap&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ds&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">rbac&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">secret&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">service&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">prometheus&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/.&lt;/span>&lt;span class="n">helmignore&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Nutanix&lt;/span> &lt;span class="n">core_k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi_beta1&lt;/span> &lt;span class="n">Notice&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">txt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">README&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">md&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">questions&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yml&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>
&lt;p>Edit values.yaml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ cd nutanix-csi-storage
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ vim values.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># all namespace
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">namespace: ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">createPrismCentralSecret: false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># prismCentralEndPoint: 00.00.00.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># pcUsername: username
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># pcPassword: password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pcSecretName: ntnx-pc-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">createSecret: false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># prismEndPoint: 00.00.000.000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># username: username
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># password: password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">peSecretName: ntnx-secret
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>Install CSI Driver using helm&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">helm&lt;/span> &lt;span class="n">install&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">system&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">f&lt;/span> &lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">values&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span> &lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">storage&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">WARNING&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Kubernetes&lt;/span> &lt;span class="n">configuration&lt;/span> &lt;span class="n">file&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">group&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">readable&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">This&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">insecure&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Location&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">/.&lt;/span>&lt;span class="n">kube&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">config&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">NAME&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">LAST&lt;/span> &lt;span class="n">DEPLOYED&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Mon&lt;/span> &lt;span class="n">May&lt;/span> &lt;span class="mi">20&lt;/span> &lt;span class="mi">16&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">38&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">01&lt;/span> &lt;span class="mi">2024&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">NAMESPACE&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">STATUS&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">deployed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">REVISION&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">TEST&lt;/span> &lt;span class="n">SUITE&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">None&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">NOTES&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Driver&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">csi&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Nutanix&lt;/span> &lt;span class="n">CSI&lt;/span> &lt;span class="n">provider&lt;/span> &lt;span class="n">was&lt;/span> &lt;span class="n">deployed&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">namespace&lt;/span> &lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">system&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Check&lt;/span> &lt;span class="n">it&lt;/span>&lt;span class="s1">&amp;#39;s status by running:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">kubectl&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">system&lt;/span> &lt;span class="n">get&lt;/span> &lt;span class="n">pods&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">grep&lt;/span> &lt;span class="s1">&amp;#39;nutanix-csi&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">describe&lt;/span> &lt;span class="n">daemonset&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apps&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">node&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">----&lt;/span> &lt;span class="o">-------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Warning&lt;/span> &lt;span class="n">FailedCreate&lt;/span> &lt;span class="mi">12&lt;/span>&lt;span class="n">m&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">x19&lt;/span> &lt;span class="n">over&lt;/span> &lt;span class="mi">23&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">daemonset&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">controller&lt;/span> &lt;span class="n">Error&lt;/span> &lt;span class="n">creating&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">pods&lt;/span> &lt;span class="s2">&amp;#34;nutanix-csi-node-&amp;#34;&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">forbidden&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">unable&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">validate&lt;/span> &lt;span class="n">against&lt;/span> &lt;span class="n">any&lt;/span> &lt;span class="n">security&lt;/span> &lt;span class="n">context&lt;/span> &lt;span class="n">constraint&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">provider&lt;/span> &lt;span class="s2">&amp;#34;anyuid&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Forbidden&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">usable&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="n">user&lt;/span> &lt;span class="ow">or&lt;/span> &lt;span class="n">serviceaccount&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>Apply privilege to openshift-cluster-csi-drivers namespace&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">project&lt;/span> &lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Now&lt;/span> &lt;span class="n">using&lt;/span> &lt;span class="n">project&lt;/span> &lt;span class="s2">&amp;#34;ntnx-system&amp;#34;&lt;/span> &lt;span class="n">on&lt;/span> &lt;span class="n">server&lt;/span> &lt;span class="s2">&amp;#34;https://api.ocplab.nutanixlab.local:6443&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">adm&lt;/span> &lt;span class="n">policy&lt;/span> &lt;span class="n">add&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="n">privileged&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">z&lt;/span> &lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">controller&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">clusterrole&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rbac&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">authorization&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">system&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">scc&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">privileged&lt;/span> &lt;span class="n">added&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;nutanix-csi-controller&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">adm&lt;/span> &lt;span class="n">policy&lt;/span> &lt;span class="n">add&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="n">privileged&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">z&lt;/span> &lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">node&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">clusterrole&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rbac&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">authorization&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">system&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">scc&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">privileged&lt;/span> &lt;span class="n">added&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;nutanix-csi-node&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">adm&lt;/span> &lt;span class="n">policy&lt;/span> &lt;span class="n">add&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="n">privileged&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">z&lt;/span> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">exporter&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">adm&lt;/span> &lt;span class="n">policy&lt;/span> &lt;span class="n">add&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="n">anyuid&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">z&lt;/span> &lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">controller&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">clusterrole&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rbac&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">authorization&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">system&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">scc&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">anyuid&lt;/span> &lt;span class="n">added&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;nutanix-csi-controller&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">adm&lt;/span> &lt;span class="n">policy&lt;/span> &lt;span class="n">add&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="n">anyuid&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">z&lt;/span> &lt;span class="n">nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">node&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">clusterrole&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rbac&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">authorization&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">system&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">scc&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">anyuid&lt;/span> &lt;span class="n">added&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;nutanix-csi-node&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>Check CSI installed&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ oc get all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/nutanix-csi-controller-844589fc9f-4jr5m 7/7 Running 3 (16h ago) 16h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/nutanix-csi-controller-844589fc9f-wwq7m 7/7 Running 4 (16h ago) 16h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/nutanix-csi-node-fkmdd 3/3 Running 0 16h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/nutanix-csi-node-hjnwg 3/3 Running 0 16h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/nutanix-csi-node-pwqwl 3/3 Running 0 16h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service/nutanix-csi-metrics ClusterIP 172.30.168.77 &amp;lt;none&amp;gt; 9809/TCP,9810/TCP,9811/TCP,9812/TCP 17h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">daemonset.apps/nutanix-csi-node 3 3 3 3 3 kubernetes.io/os=linux 17h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY UP-TO-DATE AVAILABLE AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deployment.apps/nutanix-csi-controller 2/2 2 2 17h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME DESIRED CURRENT READY AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">replicaset.apps/nutanix-csi-controller-844589fc9f 2 2 2 17h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc describe daemonset.apps/nutanix-csi-node
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal SuccessfulCreate 40s daemonset-controller Created pod: nutanix-csi-node-cgdvs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal SuccessfulCreate 40s daemonset-controller Created pod: nutanix-csi-node-c49f5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal SuccessfulCreate 40s daemonset-controller Created pod: nutanix-csi-node-4j69r
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>OCP Console&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/05/image-20240509134700168.png"
loading="lazy"
alt="image-20240509134700168"
>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 id="create-storageclass">Create StorageClass
&lt;/h4>&lt;ol>
&lt;li>
&lt;p>create nutanix-volume.yaml&lt;/p>
&lt;/li>
&lt;li>
&lt;p>oc apply -f nutanix-volume.yaml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ vim nutanix-volume.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: StorageClass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: storage.k8s.io/v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> annotations:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> storageclass.kubernetes.io/is-default-class: &amp;#34;true&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: nutanixvolume
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">provisioner: csi.nutanix.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">parameters:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/provisioner-secret-name: ntnx-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/provisioner-secret-namespace: ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/node-publish-secret-name: ntnx-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/node-publish-secret-namespace: ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/controller-expand-secret-name: ntnx-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/controller-expand-secret-namespace: ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/fstype: ext4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dataServiceEndPoint: IP:3260 # Prism data service ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> storageContainer: NX_1365_AHV_cr # Prism 上建立的Storage Container
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> storageType: NutanixVolumes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #whitelistIPMode: ENABLED
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #chapAuth: ENABLED
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">allowVolumeExpansion: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">reclaimPolicy: Delete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc apply -f nutanix-volume.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>Check StorageClass&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ oc get storageclass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME PROVISIONER RECLAIMPOLICY VOLUMEBINDINGMODE ALLOWVOLUMEEXPANSION AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nutanixvolume csi.nutanix.com Delete Immediate true 121m
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/05/image-20240509140930382.png"
loading="lazy"
alt="image-20240509140930382"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Create test-pvc&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/05/image-20240509140956018.png"
loading="lazy"
alt="image-20240509140956018"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/05/image-20240509141008518.png"
loading="lazy"
alt="image-20240509141008518"
>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="cert-manager">Cert-manager
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>Install cert-manager tools&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="err">路徑&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">github&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cert&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cert&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">releases&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tag&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">14.5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">github&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cert&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cert&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">releases&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">download&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">14.5&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cert&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">new&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">project&lt;/span> &lt;span class="n">cert&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">apply&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">f&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">github&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cert&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cert&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">releases&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">download&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">14.5&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cert&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">get&lt;/span> &lt;span class="n">pods&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">cert&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">NAME&lt;/span> &lt;span class="n">READY&lt;/span> &lt;span class="n">STATUS&lt;/span> &lt;span class="n">RESTARTS&lt;/span> &lt;span class="n">AGE&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cert&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">5658&lt;/span>&lt;span class="n">d944df&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="n">tqqp&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="n">Running&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">34&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cert&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cainjector&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cb99ff845&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">24&lt;/span>&lt;span class="n">r6d&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="n">Running&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">34&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cert&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">webhook&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="n">fd74b8dc7&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ts6pk&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="n">Running&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">34&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="onboard-ocp-to-pc">Onboard OCP to PC
&lt;/h3>&lt;p>建立Project 把 ocp相關的VM放進去 (ocp-lab)&lt;/p>
&lt;p>用Support Portal 上下載的k8s-agent.tar 需要自行上傳到Dokcer Hub或是其他私倉，並且修改value.yaml 內的image路徑&lt;/p>
&lt;ol>
&lt;li>
&lt;p>get cluster uid and name&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">kubectl&lt;/span> &lt;span class="n">get&lt;/span> &lt;span class="n">ns&lt;/span> &lt;span class="n">kube&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">system&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">json&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">grep&lt;/span> &lt;span class="n">uid&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;openshift.io/sa.scc.uid-range&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;1000020000/10000&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;uid&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;25c8543a-3df0-442a-83eb-5af1ab1b7be3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">kubectl&lt;/span> &lt;span class="n">get&lt;/span> &lt;span class="n">infrastructure&lt;/span> &lt;span class="n">cluster&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">yaml&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">grep&lt;/span> &lt;span class="n">infrastructureName&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">infrastructureName&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">ocplab&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">qx6t5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">get&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">jsonpath&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;{.status.infrastructureName}{&amp;#34;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#34;}&amp;#39;&lt;/span> &lt;span class="n">infrastructure&lt;/span> &lt;span class="n">cluster&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ocplab&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">qx6t5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="n">CLUSTER_UUID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">25&lt;/span>&lt;span class="n">c8543a&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="n">df0&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">442&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">83&lt;/span>&lt;span class="n">eb&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="n">af1ab1b7be3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="n">CLUSTER_INFRA_NAME&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">ocplab&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">qx6t5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">PC上的VG會多k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="err">的&lt;/span>&lt;span class="n">prefix&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">25&lt;/span>&lt;span class="n">c8543a&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="n">df0&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">442&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">83&lt;/span>&lt;span class="n">eb&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="n">af1ab1b7be3&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>Download k8s-agent.tar and ndk-1.0.0.tar&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 下載連結要重新產生&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">curl&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.&lt;/span>&lt;span class="n">tar&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">O&lt;/span> &lt;span class="s2">&amp;#34;https://download.nutanix.com/downloads/ndk/1.0.0/k8s-agent-1.0.0.tar?Expires=1715275315306&amp;amp;Key-Pair-Id=APKAJTTNCWPEI42QKMSA&amp;amp;Signature=exuDWlLvpFIhLfN6YpDd9SyAz1a8o0CudJabSf8j~FEAVpwd6CjFe2WgCae2Jp5gZjNwwIEvHq4lXbvRMqDWm~LEVxO9E84ribrxu2uDNbkbAuG7I0OeWEDROsdpM1-qN~g9fp16-X~Y8lG-sh1cOLz-N8hjgq83vDMeusfTUrRMQOjlrGV7h44QL0-LlIs8GkkoIJbh3rxhZO~vavCvs4EJ9uec9qH6BrQLMfstVZr7j6uLu4juf6hnEsWJzalJXZ04YaA8onpgm-jhNBj2m5fxjXlJ-iCsu6u6BSLmm2ffpzSkUUlFpoSJZX~QODiHHiQi9V9xe9R8wdkQPfo-1g__&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%&lt;/span> &lt;span class="n">Total&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">Received&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">Xferd&lt;/span> &lt;span class="n">Average&lt;/span> &lt;span class="n">Speed&lt;/span> &lt;span class="n">Time&lt;/span> &lt;span class="n">Time&lt;/span> &lt;span class="n">Time&lt;/span> &lt;span class="n">Current&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Dload&lt;/span> &lt;span class="n">Upload&lt;/span> &lt;span class="n">Total&lt;/span> &lt;span class="n">Spent&lt;/span> &lt;span class="n">Left&lt;/span> &lt;span class="n">Speed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">100&lt;/span> &lt;span class="mf">59.2&lt;/span>&lt;span class="n">M&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="mf">59.2&lt;/span>&lt;span class="n">M&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mf">10.4&lt;/span>&lt;span class="n">M&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">05&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">05&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">--&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">--&lt;/span> &lt;span class="mf">13.2&lt;/span>&lt;span class="n">M&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">curl&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.&lt;/span>&lt;span class="n">tar&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">O&lt;/span> &lt;span class="s2">&amp;#34;https://download.nutanix.com/downloads/ndk/1.0.0/ndk-1.0.0.tar?Expires=1715276310943&amp;amp;Key-Pair-Id=APKAJTTNCWPEI42QKMSA&amp;amp;Signature=A8y8JoJupVvWedB~jSHTysEZK18eyITvdT6DFw9C9JpVOhKc9jnZraaDir2DZDeRVpnPaOraMF2lR5lFqlSaikGj274ETgetuz33R0jcJ-fB44~xfXL~eK5cpqNhuuG3Yufs0biq1b8CC-frrVeupzKzOdmJyBEWXPe4GSCLWwqPubPjhUAHMKyoOgcxSd-A6kS9f~c0eEikartUrgtCjyZP-iZwPxn6gg3jGoZuHK3f2Nf~HjmyrJqwBmLQA0ibVdRTN0YkYVfplpkr5ucp8MLMPFbhdmAJZIAot8vc2-qMPoidczgU1Msd1w8NsXWMUFQBnO-Y73VZ31d4yxI31A__&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">mkdir&lt;/span> &lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">cd&lt;/span> &lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">ls&lt;/span> &lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.&lt;/span>&lt;span class="n">tar&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.&lt;/span>&lt;span class="n">tar&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">mv&lt;/span> &lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.&lt;/span>&lt;span class="n">tar&lt;/span> &lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">tar&lt;/span> &lt;span class="n">xvf&lt;/span> &lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.&lt;/span>&lt;span class="n">tar&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">./&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">./&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Chart&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">./&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/.&lt;/span>&lt;span class="n">helmignore&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">./&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.&lt;/span>&lt;span class="n">tar&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">./&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">./&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">hook&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">predelete&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">./&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">hook&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">preinstall&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">./&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">hook&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">postdelete&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">./&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">hook&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">postupgrade&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">./&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">hook&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">postinstall&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">./&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nutanix_agent_deployment&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">./&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">values&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">schema&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">json&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">./&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">README&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">md&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">./&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">values&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">./&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">core_k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Notice&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">txt&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>push image to docker hub&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">echo&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="s1">&amp;#39;kenxxxxxxxx:xuxxxxxxxx&amp;#39;&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">base64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dockerconfigVubnxxxxxxxxxxxxxxxx2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;auths&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;https://index.docker.io/v1/&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;auth&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;a2Vua2Vubnxxxxxxxxxxxxxxxx2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">vim&lt;/span> &lt;span class="n">dockerconfig&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">json&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">cat&lt;/span> &lt;span class="n">dockerconfig&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">json&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">base64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dockerconfigVubnxxxxxxxxxxxxxxxx2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">podman&lt;/span> &lt;span class="nb">load&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.&lt;/span>&lt;span class="n">tar&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">podman&lt;/span> &lt;span class="n">tag&lt;/span> &lt;span class="n">localhost&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="n">kenkennyinfo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nke&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">podman&lt;/span> &lt;span class="n">push&lt;/span> &lt;span class="n">kenkennyinfo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nke&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">podman&lt;/span> &lt;span class="n">tag&lt;/span> &lt;span class="n">localhost&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="n">kenkennyinfo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nke&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">668&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">podman&lt;/span> &lt;span class="n">push&lt;/span> &lt;span class="n">kenkennyinfo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nke&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">668&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/05/image-20240510154840948.png"
loading="lazy"
alt="image-20240510154840948"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Install k8s-agent&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;span class="lnt">173
&lt;/span>&lt;span class="lnt">174
&lt;/span>&lt;span class="lnt">175
&lt;/span>&lt;span class="lnt">176
&lt;/span>&lt;span class="lnt">177
&lt;/span>&lt;span class="lnt">178
&lt;/span>&lt;span class="lnt">179
&lt;/span>&lt;span class="lnt">180
&lt;/span>&lt;span class="lnt">181
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">安裝失敗時可用刪除指令
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc delete clusterroles.rbac.authorization.k8s.io &amp;#34;nke-k8s-agent-preinstall&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc delete ClusterRoleBinding nke-k8s-agent-preinstall
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc delete project ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc new-project ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!用最新版本的需要自行上傳!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## Docker Hub (版本較新 v668)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ vim values.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">agent:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespaceOverride: ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: nutanix-agent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port: 8080
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> repository: docker.io/kenkennyinfo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: nke-k8s-agent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pullPolicy: IfNotPresent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tag: 668
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> privateRegistry: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> imageCredentials:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dockerconfig: &amp;#34;dockerconfigVubnxxxxxxxxxxxxxxxx2&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> updateConfigInMin: 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> updateMetricsInMin: 360
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port: 9440
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> insecure: false #set this to true if PC does not have https enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> endpoint: &amp;#34;&amp;#34; # eg: ip or fqdn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> username: &amp;#34;&amp;#34; # eg: admin or any other user with Kubernetes Infrastructure provision role
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> password: &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8sClusterName: &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8sClusterUUID: &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8sDistribution: &amp;#34;OCP&amp;#34; # eg: CAPX or NKE or OCP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">categoryMappings: &amp;#34;&amp;#34; # &amp;#34;one or more comma separated key=value&amp;#34; eg: &amp;#34;key1=value1&amp;#34; or &amp;#34;key1=value1,key2=value2&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## 官方quay.io (版本較舊 v594)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ vim values.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">agent:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespaceOverride: ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: nutanix-agent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port: 8080
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> repository: quay.io/karbon
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: k8s-agent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pullPolicy: IfNotPresent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tag: 594
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> privateRegistry: false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> updateConfigInMin: 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> updateMetricsInMin: 360
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pc:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port: 9440
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> insecure: false #set this to true if PC does not have https enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> endpoint: &amp;#34;&amp;#34; # eg: ip or fqdn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> username: &amp;#34;&amp;#34; # eg: admin or any other user with Kubernetes Infrastructure provision role
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> password: &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8sClusterName: &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8sClusterUUID: &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8sDistribution: &amp;#34;OCP&amp;#34; # eg: CAPX or NKE or OCP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">categoryMappings: &amp;#34;&amp;#34; # &amp;#34;one or more comma separated key=value&amp;#34; eg: &amp;#34;key1=value1&amp;#34; or &amp;#34;key1=value1,key2=value2&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Helm 安裝
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ helm install k8s-agent-1.0.0 /home/nutanix/k8s-agent-1.0.0 --set pc.endpoint=172.16.90.75,pc.username=ocpadmin,pc.password=password,pc.insecure=true,k8sClusterName=ocplab-qx6t5,k8sClusterUUID=25c8543a-3df0-442a-83eb-5af1ab1b7be3,k8sDistribution=OCP -n ntnx-system --create-namespace
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/nutanix/.kube/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME: k8s-agent-594
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LAST DEPLOYED: Wed May 15 14:09:01 2024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAMESPACE: ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">STATUS: deployed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">REVISION: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TEST SUITE: None
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## 安裝新版本或是更改密碼可以使用helm upgrade (修改values.yaml)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ helm upgrade k8s-agent-594 /home/nutanix/k8s-agent-1.0.0 --set pc.endpoint=172.16.90.75,pc.username=ocpadmin,pc.password=password,pc.insecure=true,k8sClusterName=ocplab-qx6t5,k8sClusterUUID=25c8543a-3df0-442a-83eb-5af1ab1b7be3 -n ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/nutanix/.kube/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Release &amp;#34;k8s-agent-594&amp;#34; has been upgraded. Happy Helming!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME: k8s-agent-594
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LAST DEPLOYED: Wed May 15 14:13:56 2024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAMESPACE: ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">STATUS: deployed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">REVISION: 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TEST SUITE: None
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ helm upgrade k8s-agent-594 /home/nutanix/k8s-agent-1.0.0 --set pc.endpoint=172.16.90.75,pc.username=ocpadmin,pc.password=password,pc.insecure=true,k8sClusterName=ocplab-qx6t5,k8sClusterUUID=25c8543a-3df0-442a-83eb-5af1ab1b7be3 -n ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/nutanix/.kube/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Release &amp;#34;k8s-agent-594&amp;#34; has been upgraded. Happy Helming!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME: k8s-agent-594
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LAST DEPLOYED: Wed May 15 15:18:35 2024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAMESPACE: ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">STATUS: deployed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">REVISION: 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TEST SUITE: None
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## Check pods and deployments
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get all -n ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/nutanix-agent-75df9d879b-98smz 1/1 Running 0 80s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY UP-TO-DATE AVAILABLE AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deployment.apps/nutanix-agent 1/1 1 1 70m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME DESIRED CURRENT READY AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">replicaset.apps/nutanix-agent-75df9d879b 1 1 1 80s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">replicaset.apps/nutanix-agent-7c4b644996 0 0 0 70m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc describe deployment.apps/nutanix-agent -n ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name: nutanix-agent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Namespace: ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CreationTimestamp: Wed, 15 May 2024 14:09:31 +0800
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Labels: app.kubernetes.io/managed-by=Helm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Annotations: deployment.kubernetes.io/revision: 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> meta.helm.sh/release-name: k8s-agent-594
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> meta.helm.sh/release-namespace: ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Selector: app=nutanix-agent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Replicas: 1 desired | 1 updated | 1 total | 1 available | 0 unavailable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">StrategyType: RollingUpdate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">MinReadySeconds: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RollingUpdateStrategy: 25% max unavailable, 25% max surge
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Pod Template:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Labels: app=nutanix-agent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Service Account: nutanix-agent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Containers:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nutanix-agent:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Image: docker.io/kenkennyinfo/nke-k8s-agent:668
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Port: 8080/TCP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Host Port: 0/TCP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Command:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> /k8s-agent/k8s-agent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Args:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -pc-endpoint=172.16.90.75
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -pc-port=9440
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -insecure=true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -k8s-cluster-name=ocplab-qx6t5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -k8s-cluster-uuid=25c8543a-3df0-442a-83eb-5af1ab1b7be3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -k8s-distribution=OCP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -k8s-cluster-category=
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -update-config-in-min=10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -update-metrics-in-min=360
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Limits:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cpu: 500m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> memory: 128Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Requests:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cpu: 250m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> memory: 64Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Liveness: http-get http://:8080/health delay=5s timeout=5s period=15s #success=1 #failure=3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Readiness: http-get http://:8080/readiness delay=5s timeout=1s period=10s #success=1 #failure=3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Environment: &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Mounts:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> /certs from pc-creds-volume (ro)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Volumes:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pc-creds-volume:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type: Secret (a volume populated by a Secret)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SecretName: nutanix-agent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Optional: false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Conditions:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type Status Reason
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ---- ------ ------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Available True MinimumReplicasAvailable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Progressing True NewReplicaSetAvailable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OldReplicaSets: &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NewReplicaSet: nutanix-agent-75df9d879b (1/1 replicas created)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Events:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type Reason Age From Message
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ---- ------ ---- ---- -------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal ScalingReplicaSet 70m deployment-controller Scaled up replica set nutanix-agent-7c4b644996 to 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal ScalingReplicaSet 84s deployment-controller Scaled up replica set nutanix-agent-75df9d879b to 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal ScalingReplicaSet 73s deployment-controller Scaled down replica set nutanix-agent-7c4b644996 to 0 from 1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安裝後進入Prism Central 確認已 Onboard 完成&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/05/image-20240515150336316.png"
loading="lazy"
alt="image-20240515150336316"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/05/image-20240515150407687.png"
loading="lazy"
alt="image-20240515150407687"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/05/image-20240515142010187.png"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/05/image-20240515142031619.png"
loading="lazy"
alt="image-20240515142031619"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/05/image-20240515142042758.png"
loading="lazy"
alt="image-20240515142042758"
>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="ndk-install-without-tls">NDK Install without TLS
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>下載 ndk-1.0.0.tar 並解壓縮&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">wget&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">download&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">downloads&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.&lt;/span>&lt;span class="n">tar&lt;/span>&lt;span class="err">?&lt;/span>&lt;span class="n">Expires&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1715793783203&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">Key&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Pair&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">APKAJTTNCWPEI42QKMSA&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">Signature&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">bT&lt;/span>&lt;span class="o">~&lt;/span>&lt;span class="n">JG3wJjEQ3dvNO85khPiJq1yVxAH6YPV7PGtJvKaf4iJVRDfQIockkqSyH3ZubXpSvF2loZAXqvueSef41SZa9vSzEC1zrc&lt;/span>&lt;span class="o">~&lt;/span>&lt;span class="n">IzwcCjAcXnAbXC1LGy566yIBvwNaFm1qSr0jONb3zwzckNHidS8QmTRRyscaiHdF8xQ&lt;/span>&lt;span class="o">~&lt;/span>&lt;span class="n">gD0MQfKBlrl4hej3Pnae0ckMZoT5yCPzAv8vQU5XhvL0YECmy2T6LhBH13mxHpijM70aACCjdE5KdlCHFrSZhsDYYy5FWRYT02q70mM4SAUNYYcBnW4FNmmKuPWPyq0r2lcJRktIOgfQOHvUv&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">qw0vyrEdRj7QmgWpiCAAoSfqWl&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">lKA__&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">tar&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">xvf&lt;/span> &lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.&lt;/span>&lt;span class="n">tar&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">tree&lt;/span> &lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">├──&lt;/span> &lt;span class="n">chart&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">Chart&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">crds&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">dataservices&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com_applicationsnapshotcontents&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">dataservices&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com_applicationsnapshotreplications&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">dataservices&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com_applicationsnapshotrestores&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">dataservices&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com_applicationsnapshots&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">dataservices&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com_applications&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">dataservices&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com_appprotectionplans&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">dataservices&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com_protectionplans&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">dataservices&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com_remotes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">dataservices&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com_replicationtargets&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">dataservices&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com_storageclusters&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">└──&lt;/span> &lt;span class="n">scheduler&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com_jobschedulers&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">Nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">core&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">job&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scheduler&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Disclosure&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">txt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">Nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">core&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">juno&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">aos&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">pc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Disclosure&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">txt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">Nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">core&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">juno&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Disclosure&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">txt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">Nutanix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">kube&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">rbac&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">proxy&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Disclosure&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">txt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">templates&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">cert&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">controller&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">metrics&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitor&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">csi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">precheck&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">deployment&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">_helpers&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tpl&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">intercom&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">service&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">leader&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">election&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">rbac&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">manager&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">manager&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">rbac&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">metrics&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">reader&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">rbac&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">metrics&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">service&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">logs&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">pvc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">ntnx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">proxy&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">rbac&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">registry&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">secret&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">scheduler&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">webhook&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">service&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">├──&lt;/span> &lt;span class="n">webhook&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">certificate&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">│&lt;/span>   &lt;span class="err">└──&lt;/span> &lt;span class="n">webhook&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">service&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">│&lt;/span>   &lt;span class="err">└──&lt;/span> &lt;span class="n">values&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">└──&lt;/span> &lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.&lt;/span>&lt;span class="n">tar&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">3&lt;/span> &lt;span class="n">directories&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">36&lt;/span> &lt;span class="n">files&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>儲存Container image 並上傳至Docker hub or 私倉&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Load Images&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">podman&lt;/span> &lt;span class="nb">load&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.&lt;/span>&lt;span class="n">tar&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Writing&lt;/span> &lt;span class="n">manifest&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">image&lt;/span> &lt;span class="n">destination&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Storing&lt;/span> &lt;span class="n">signatures&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Loaded&lt;/span> &lt;span class="n">image&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">localhost&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Loaded&lt;/span> &lt;span class="n">image&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">localhost&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">job&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scheduler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Loaded&lt;/span> &lt;span class="n">image&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">localhost&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">kube&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">rbac&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">proxy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">v0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Loaded&lt;/span> &lt;span class="n">image&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">localhost&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Tag Images&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">podman&lt;/span> &lt;span class="n">tag&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">image&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">tag&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">image&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">registry&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="o">&amp;gt;/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">/&amp;lt;&lt;/span>&lt;span class="n">conatiner&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">tag&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">podman&lt;/span> &lt;span class="n">tag&lt;/span> &lt;span class="n">ndk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="n">kenkennyinfo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">podman&lt;/span> &lt;span class="n">tag&lt;/span> &lt;span class="n">ndk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">job&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scheduler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="n">kenkennyinfo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">job&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scheduler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">podman&lt;/span> &lt;span class="n">tag&lt;/span> &lt;span class="n">ndk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">kube&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">rbac&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">proxy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">v0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.0&lt;/span> &lt;span class="n">kenkennyinfo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">kube&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">rbac&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">proxy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">v0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">podman&lt;/span> &lt;span class="n">tag&lt;/span> &lt;span class="n">ndk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="n">kenkennyinfo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># batch tag images&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">img&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">ndk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="n">ndk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="n">ndk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">job&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scheduler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="n">ndk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">kube&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">rbac&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">proxy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">v0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="n">docker&lt;/span> &lt;span class="n">tag&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">img&lt;/span> &lt;span class="n">kenkennyinfo&lt;/span>&lt;span class="o">/$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">img&lt;/span>&lt;span class="p">};&lt;/span> &lt;span class="n">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Emulate&lt;/span> &lt;span class="n">Docker&lt;/span> &lt;span class="n">CLI&lt;/span> &lt;span class="n">using&lt;/span> &lt;span class="n">podman&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Create&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">containers&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nodocker&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">quiet&lt;/span> &lt;span class="n">msg&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Emulate&lt;/span> &lt;span class="n">Docker&lt;/span> &lt;span class="n">CLI&lt;/span> &lt;span class="n">using&lt;/span> &lt;span class="n">podman&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Create&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">containers&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nodocker&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">quiet&lt;/span> &lt;span class="n">msg&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Error&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">ndk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">image&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">known&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Emulate&lt;/span> &lt;span class="n">Docker&lt;/span> &lt;span class="n">CLI&lt;/span> &lt;span class="n">using&lt;/span> &lt;span class="n">podman&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Create&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">containers&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nodocker&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">quiet&lt;/span> &lt;span class="n">msg&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Emulate&lt;/span> &lt;span class="n">Docker&lt;/span> &lt;span class="n">CLI&lt;/span> &lt;span class="n">using&lt;/span> &lt;span class="n">podman&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Create&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">containers&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nodocker&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">quiet&lt;/span> &lt;span class="n">msg&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">podman&lt;/span> &lt;span class="n">images&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">nutanix&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">rhel9&lt;/span> &lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">podman&lt;/span> &lt;span class="n">images&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">REPOSITORY&lt;/span> &lt;span class="n">TAG&lt;/span> &lt;span class="n">IMAGE&lt;/span> &lt;span class="n">ID&lt;/span> &lt;span class="n">CREATED&lt;/span> &lt;span class="n">SIZE&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">localhost&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">kenkennyinfo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span> &lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="n">ebffd7549ea5&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">months&lt;/span> &lt;span class="n">ago&lt;/span> &lt;span class="mf">69.2&lt;/span> &lt;span class="n">MB&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">localhost&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">manager&lt;/span> &lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="n">ebffd7549ea5&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">months&lt;/span> &lt;span class="n">ago&lt;/span> &lt;span class="mf">69.2&lt;/span> &lt;span class="n">MB&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">localhost&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">kenkennyinfo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span> &lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="mi">2982&lt;/span>&lt;span class="n">ed521b0e&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">months&lt;/span> &lt;span class="n">ago&lt;/span> &lt;span class="mi">60&lt;/span> &lt;span class="n">MB&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">localhost&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span> &lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="mi">2982&lt;/span>&lt;span class="n">ed521b0e&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">months&lt;/span> &lt;span class="n">ago&lt;/span> &lt;span class="mi">60&lt;/span> &lt;span class="n">MB&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">localhost&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">kenkennyinfo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nke&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span> &lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="mi">9&lt;/span>&lt;span class="n">bda464636b6&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">months&lt;/span> &lt;span class="n">ago&lt;/span> &lt;span class="mf">61.7&lt;/span> &lt;span class="n">MB&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">localhost&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">kenkennyinfo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nke&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span> &lt;span class="mi">668&lt;/span> &lt;span class="mi">9&lt;/span>&lt;span class="n">bda464636b6&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">months&lt;/span> &lt;span class="n">ago&lt;/span> &lt;span class="mf">61.7&lt;/span> &lt;span class="n">MB&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">localhost&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span> &lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="mi">9&lt;/span>&lt;span class="n">bda464636b6&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">months&lt;/span> &lt;span class="n">ago&lt;/span> &lt;span class="mf">61.7&lt;/span> &lt;span class="n">MB&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">kenkennyinfo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nke&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span> &lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="mi">9&lt;/span>&lt;span class="n">bda464636b6&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">months&lt;/span> &lt;span class="n">ago&lt;/span> &lt;span class="mf">61.7&lt;/span> &lt;span class="n">MB&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">quay&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">karbon&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">agent&lt;/span> &lt;span class="mi">594&lt;/span> &lt;span class="mi">171&lt;/span>&lt;span class="n">ea3376596&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="n">months&lt;/span> &lt;span class="n">ago&lt;/span> &lt;span class="mf">58.4&lt;/span> &lt;span class="n">MB&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">localhost&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">job&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scheduler&lt;/span> &lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="n">d594a3e567b7&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="n">months&lt;/span> &lt;span class="n">ago&lt;/span> &lt;span class="mf">59.1&lt;/span> &lt;span class="n">MB&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">localhost&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">kenkennyinfo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">job&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scheduler&lt;/span> &lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="n">d594a3e567b7&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="n">months&lt;/span> &lt;span class="n">ago&lt;/span> &lt;span class="mf">59.1&lt;/span> &lt;span class="n">MB&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">localhost&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">kenkennyinfo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">kube&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">rbac&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">proxy&lt;/span> &lt;span class="n">v0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.0&lt;/span> &lt;span class="n">ad393d6a4d1b&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="n">years&lt;/span> &lt;span class="n">ago&lt;/span> &lt;span class="mf">50.2&lt;/span> &lt;span class="n">MB&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">localhost&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">kube&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">rbac&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">proxy&lt;/span> &lt;span class="n">v0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.0&lt;/span> &lt;span class="n">ad393d6a4d1b&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="n">years&lt;/span> &lt;span class="n">ago&lt;/span> &lt;span class="mf">50.2&lt;/span> &lt;span class="n">MB&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Push Images&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">podman&lt;/span> &lt;span class="n">push&lt;/span> &lt;span class="n">kenkennyinfo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">kube&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">rbac&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">proxy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">v0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">podman&lt;/span> &lt;span class="n">push&lt;/span> &lt;span class="n">kenkennyinfo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">job&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scheduler&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">podman&lt;/span> &lt;span class="n">push&lt;/span> &lt;span class="n">kenkennyinfo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">podman&lt;/span> &lt;span class="n">push&lt;/span> &lt;span class="n">kenkennyinfo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ndk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">manager&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>建立Secret，修改 chart/values.yaml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;span class="lnt">84
&lt;/span>&lt;span class="lnt">85
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 建立Docker hub secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ vim nutanix-k8s-agent-pull-secret.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: Secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: nutanix-k8s-agent-pull-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">type: kubernetes.io/dockerconfigjson
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">data:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> .dockerconfigjson: &amp;#34;dockerconfigVubnxxxxxxxxxxxxxxxx2&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ vim ntnx-pc-secret2.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: Secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: ntnx-pc-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespace: ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stringData:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # prism-pc-ip:prism-port:admin:password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: 172.16.90.75:9440:ocpadmin:password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc apply -f nutanix-k8s-agent-pull-secret.yaml -n ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc apply -f ntnx-pc-secret2.yaml -n ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get secret -n ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME TYPE DATA AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nutanix-k8s-agent-pull-secret kubernetes.io/dockerconfigjson 1 12s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ vim /home/nutanix/ndk-1.0.0/chart/values.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">manager:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # -- Image Repository
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> repository: kenkennyinfo/ndk-manager
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # -- Image tag
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # @default -- .Chart.AppVersion
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tag: 1.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # -- Image pull policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pullPolicy: Always
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infraManager:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # -- Image Repository
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> repository: kenkennyinfo/ndk-infra-manager
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # -- Image tag
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # @default -- .Chart.AppVersion
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tag: 1.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # -- Image pull policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pullPolicy: Always
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubeRbacProxy:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # -- Image Repository
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> repository: kenkennyinfo/ndk-kube-rbac-proxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # -- Image tag
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # @default -- .Chart.AppVersion
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tag: v0.8.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">jobScheduler:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # -- Image Repository
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> repository: kenkennyinfo/ndk-job-scheduler
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # -- Image tag
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # @default -- .Chart.AppVersion
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tag: 1.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # -- Image pull policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pullPolicy: Always
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">imageCredentials:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # Name of the secret containing the credentials to pull image from the container registry.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> imagePullSecretName: nutanix-k8s-agent-pull-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> clusterName: ocplab.nutanixlab.local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> intercomService:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ports:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - port: 2021
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> protocol: TCP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> targetPort: 2021
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type: NodePort
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ---end
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>安裝NDK&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> helm install ndk -n ntnx-system &amp;lt;chart-location&amp;gt; --set tls.server.enable=false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ helm install ndk -n ntnx-system /home/nutanix/ndk-1.0.0/chart/ --set tls.server.enable=false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/nutanix/.kube/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME: ndk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LAST DEPLOYED: Wed May 15 17:14:37 2024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAMESPACE: ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">STATUS: deployed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">REVISION: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TEST SUITE: None
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get pods -n ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ndk-controller-manager-55bf75f64b-blnfc 4/4 Running 0 3m57s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nutanix-agent-75df9d879b-98smz 1/1 Running 0 120m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc adm policy add-scc-to-user anyuid -z ndk-controller-manager
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrole.rbac.authorization.k8s.io/system:openshift:scc:anyuid added: &amp;#34;ndk-controller-manager&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ helm upgrade ndk -n ntnx-system /home/nutanix/ndk-1.0.0/chart/ --set tls.server.enable=false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/nutanix/.kube/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Release &amp;#34;ndk&amp;#34; has been upgraded. Happy Helming!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME: ndk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LAST DEPLOYED: Mon May 20 17:57:43 2024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAMESPACE: ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">STATUS: deployed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">REVISION: 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TEST SUITE: None
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>安裝完成&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ oc get all -n ntnx-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/ndk-controller-manager-55bf75f64b-blnfc 4/4 Running 0 17h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/nutanix-agent-75df9d879b-98smz 1/1 Running 0 19h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service/ndk-controller-manager-metrics-service ClusterIP 172.30.186.204 &amp;lt;none&amp;gt; 8443/TCP 17h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service/ndk-intercom-service NodePort 172.30.237.126 &amp;lt;none&amp;gt; 2021:30998/TCP 17h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service/ndk-scheduler-webhook-service ClusterIP 172.30.64.110 &amp;lt;none&amp;gt; 9444/TCP 17h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service/ndk-webhook-service ClusterIP 172.30.66.56 &amp;lt;none&amp;gt; 443/TCP 17h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY UP-TO-DATE AVAILABLE AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deployment.apps/ndk-controller-manager 1/1 1 1 17h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deployment.apps/nutanix-agent 1/1 1 1 20h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME DESIRED CURRENT READY AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">replicaset.apps/ndk-controller-manager-55bf75f64b 1 1 1 17h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">replicaset.apps/nutanix-agent-75df9d879b 1 1 1 19h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">replicaset.apps/nutanix-agent-7c4b644996 0 0 0 20h
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/05/image-20240516110205960.png"
loading="lazy"
alt="image-20240516110205960"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>測試NDK 連線 grpcurl&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ podman pull fullstorydev/grpcurl:latest
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ podman run fullstorydev/grpcurl -plaintext 172.16.90.180:30998 list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">grpc.reflection.v1.ServerReflection
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">grpc.reflection.v1alpha.ServerReflection
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">juno_interface.Juno
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="storage-cluster">Storage Cluster
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>取得PC、PE的Cluster UUID&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">on Prism Central CVM
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ncli cluster info
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Cluster Id : 8c52e6be-697b-42a4-bacd-8e6ada7994f2::4237199414008583410
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Cluster Uuid : 8c52e6be-697b-42a4-bacd-8e6ada7994f2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Cluster Name : NTNXSELABPC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Cluster Version : pc.2023.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Cluster Full Version : el7.3-release-fraser-2023.4-stable-e10760423ef518a91beb02b784c7ff2e0cf3a45c
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Cluster FQDN : NTNXSELABPC.nutanixlab.local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Is LTS : false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> External Data Services... :
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Support Verbosity Level : BASIC_COREDUMP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Lock Down Status : Disabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Password Remote Login ... : Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Timezone : America/Los_Angeles
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> NCC Version : ncc-4.6.6.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Degraded Node Monitoring : Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">on Prism Element CVM
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ncli cluster info
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Cluster Id : 00060f36-1379-a8ba-0000-000000028e95::167573
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Cluster Uuid : 00060f36-1379-a8ba-0000-000000028e95
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Cluster Name : NX1365G6PE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Cluster Version : 6.7.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Cluster Full Version : el7.3-release-fraser-6.7.1-stable-104e6662e8b936a9225379d2d68efd93b5448289
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> External IP address : 172.16.90.74
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Node Count : 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Block Count : 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Shadow Clones Status : Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Has Self Encrypting Disk : no
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Cluster Masquerading I... :
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Cluster Masquerading PORT :
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Is registered to PC : true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Rf1 Container Support : Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Rebuild Reservation : Disabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Encryption In Transit : Disabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Is LTS : false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> External Data Services... : 172.16.90.76
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Support Verbosity Level : BASIC_COREDUMP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Lock Down Status : Disabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Password Remote Login ... : Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Timezone : Asia/Taipei
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> NCC Version : ncc-4.6.6.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Degraded Node Monitoring : Enabled
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>建立StorageCluster.yaml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ vim storagecluster-1365g6.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: dataservices.nutanix.com/v1alpha1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: StorageCluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: nx1365g6pe
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> storageServerUuid: 00060f36-1379-a8ba-0000-000000028e95
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> managementServerUuid: 8c52e6be-697b-42a4-bacd-8e6ada7994f2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc apply -f storagecluster-1365g6.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get storagecluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME AVAILABLE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">storagecluster-1365g6 true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get storagecluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME AVAILABLE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nx1365g6pe false
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="create-sample-app">Create Sample App
&lt;/h3>&lt;h4 id="mysql">MySQL
&lt;/h4>&lt;ol>
&lt;li>
&lt;p>Mysql 測試，建立mysql.yaml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">vim&lt;/span> &lt;span class="n">mysql&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">deploy&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">apiVersion&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">v1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">kind&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Secret&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">metadata&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">mysql&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">password&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">opaque&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">stringData&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MYSQL_ROOT_PASSWORD&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">password&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">---&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">apiVersion&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">apps&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">v1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">kind&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">StatefulSet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">metadata&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">mysql&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">spec&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">selector&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">app&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">mysql&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">serviceName&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;mysql&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">replicas&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">template&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">metadata&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">labels&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">app&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">mysql&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">spec&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">terminationGracePeriodSeconds&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">containers&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">mysql&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">image&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">mysql&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">8.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ports&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">containerPort&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">3306&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">volumeMounts&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">mysql&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">store&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mountPath&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mysql&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">mysql&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mountPath&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">data1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">env&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">MYSQL_ROOT_PASSWORD&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">valueFrom&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">secretKeyRef&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">mysql&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">password&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">key&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">MYSQL_ROOT_PASSWORD&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">volumeClaimTemplates&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">metadata&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">mysql&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">store&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">spec&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">accessModes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;ReadWriteOnce&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">storageClassName&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">nutanixvolume&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resources&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">requests&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">storage&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="n">Gi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">metadata&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">mysql&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">spec&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">accessModes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;ReadWriteOnce&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">storageClassName&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">nutanixvolume&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resources&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">requests&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">storage&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="n">Gi&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>建立Mysql app&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ oc new-project ndk-mysql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc apply -f mysql-deploy.yaml -n ndk-mysql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">secret/mysql-password created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">statefulset.apps/mysql-set created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get pods
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql-set-0 0/1 ContainerCreating 0 42s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get pods
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql-set-0 1/1 Running 0 3m18s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql-set-1 1/1 Running 0 2m22s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql-set-2 1/1 Running 0 72s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get pvc,pv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolumeclaim/mysql-data-1-mysql-set-0 Bound pvc-276ea905-a815-4635-98c0-3a4fade1bc44 3Gi RWO nutanixvolume 6m24s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolumeclaim/mysql-data-1-mysql-set-1 Bound pvc-5638dc79-8271-4a49-94b9-d22c6212e232 3Gi RWO nutanixvolume 5m28s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolumeclaim/mysql-data-1-mysql-set-2 Bound pvc-a4e832f4-e99b-4bdc-bc5b-253731447ce4 3Gi RWO nutanixvolume 4m18s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolumeclaim/mysql-store-mysql-set-0 Bound pvc-262a52dc-1861-4992-b2aa-e41f448a6db5 5Gi RWO nutanixvolume 6m24s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolumeclaim/mysql-store-mysql-set-1 Bound pvc-1e809e1d-2190-4220-80ba-35712900d3a6 5Gi RWO nutanixvolume 5m28s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolumeclaim/mysql-store-mysql-set-2 Bound pvc-fafd94af-11be-4b02-aef1-4d959607c0cf 5Gi RWO nutanixvolume 4m18s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolume/pvc-127de2ed-452d-4fc2-a08e-f320cc4c85e0 1Gi RWO Delete Bound default/my-pvc nutanixvolume 6d23h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolume/pvc-1e809e1d-2190-4220-80ba-35712900d3a6 5Gi RWO Delete Bound ndk-mysql/mysql-store-mysql-set-1 nutanixvolume 5m22s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolume/pvc-262a52dc-1861-4992-b2aa-e41f448a6db5 5Gi RWO Delete Bound ndk-mysql/mysql-store-mysql-set-0 nutanixvolume 6m15s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolume/pvc-276ea905-a815-4635-98c0-3a4fade1bc44 3Gi RWO Delete Bound ndk-mysql/mysql-data-1-mysql-set-0 nutanixvolume 6m14s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolume/pvc-5638dc79-8271-4a49-94b9-d22c6212e232 3Gi RWO Delete Bound ndk-mysql/mysql-data-1-mysql-set-1 nutanixvolume 5m21s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolume/pvc-8468392e-a564-4d05-81f1-175820eceba2 1Gi RWO Delete Bound default/test-pvc nutanixvolume 20h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolume/pvc-a4e832f4-e99b-4bdc-bc5b-253731447ce4 3Gi RWO Delete Bound ndk-mysql/mysql-data-1-mysql-set-2 nutanixvolume 4m9s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolume/pvc-fafd94af-11be-4b02-aef1-4d959607c0cf 5Gi RWO Delete Bound ndk-mysql/mysql-store-mysql-set-2 nutanixvolume 4m9s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/05/image-20240521094917993.png"
loading="lazy"
alt="image-20240521094917993"
>
&lt;img src="https://kenkenny.synology.me:5543/images/2024/05/image-20240521094932643.png"
loading="lazy"
alt="image-20240521094932643"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>建立Application CR&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ vim mysql-cr.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: dataservices.nutanix.com/v1alpha1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: Application
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: mysql-cr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespace: ndk-mysql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> applicationSelector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc apply -f mysql-cr.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get application
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME AGE LAST-STATUS-UPDATE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql-cr 31s 31s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="ndk-snapshot">NDK Snapshot
&lt;/h3>&lt;h4 id="manual-local-snapshot">Manual Local Snapshot
&lt;/h4>&lt;ol>
&lt;li>
&lt;p>Create Application Snapshot CR&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ vim mysql-snap.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: dataservices.nutanix.com/v1alpha1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: ApplicationSnapshot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: mysql-snap-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespace: ndk-mysql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> applicationRef:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: mysql-cr
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>Apply Snapshot&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ oc apply -f mysql-snap.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">applicationsnapshot.dataservices.nutanix.com/mysql-snap-1 created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get applicationsnapshot -n ndk-mysql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME AGE READY-TO-USE BOUND-SNAPSHOTCONTENT SNAPSHOT-AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql-snap-1 8s false asc-8889156a-43f2-4d95-9075-11ccd52c9457
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get applicationsnapshot -n ndk-mysql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME AGE READY-TO-USE BOUND-SNAPSHOTCONTENT SNAPSHOT-AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql-snap-1 58s true asc-8889156a-43f2-4d95-9075-11ccd52c9457 30s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc describe applicationsnapshot -n ndk-mysql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name: mysql-snap-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Namespace: ndk-mysql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Labels: &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Annotations: &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">API Version: dataservices.nutanix.com/v1alpha1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Kind: ApplicationSnapshot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Creation Timestamp: 2024-05-22T10:10:24Z
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Finalizers:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dataservices.nutanix.com/app-snap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Generation: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Managed Fields:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> API Version: dataservices.nutanix.com/v1alpha1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Fields Type: FieldsV1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fieldsV1:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:annotations:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> .:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:kubectl.kubernetes.io/last-applied-configuration:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> .:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:source:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> .:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:applicationRef:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> .:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:name:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Manager: kubectl-client-side-apply
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Operation: Update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Time: 2024-05-22T10:10:24Z
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> API Version: dataservices.nutanix.com/v1alpha1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Fields Type: FieldsV1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fieldsV1:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:finalizers:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> .:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> v:&amp;#34;dataservices.nutanix.com/app-snap&amp;#34;:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Manager: manager
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Operation: Update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Time: 2024-05-22T10:10:24Z
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> API Version: dataservices.nutanix.com/v1alpha1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Fields Type: FieldsV1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fieldsV1:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:status:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> .:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:boundApplicationSnapshotContentName:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:creationTime:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:readyToUse:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:summary:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> .:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:snapshotArtifacts:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> .:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:apps/v1/StatefulSet:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:authorization.openshift.io/v1/RoleBinding:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:rbac.authorization.k8s.io/v1/RoleBinding:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:v1/ConfigMap:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:v1/PersistentVolumeClaim:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:v1/Secret:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:v1/ServiceAccount:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Manager: manager
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Operation: Update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Subresource: status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Time: 2024-05-22T10:10:52Z
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Resource Version: 48052327
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UID: 8889156a-43f2-4d95-9075-11ccd52c9457
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Source:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Application Ref:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: mysql-cr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Bound Application Snapshot Content Name: asc-8889156a-43f2-4d95-9075-11ccd52c9457
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Creation Time: 2024-05-22T10:10:52Z
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Ready To Use: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Summary:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Snapshot Artifacts:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> apps/v1/StatefulSet:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: mysql-set
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> authorization.openshift.io/v1/RoleBinding:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: system:image-builders
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: system:deployers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: system:image-pullers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rbac.authorization.k8s.io/v1/RoleBinding:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: system:image-builders
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: system:image-pullers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: system:deployers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> v1/ConfigMap:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: openshift-service-ca.crt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: kube-root-ca.crt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> v1/PersistentVolumeClaim:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: mysql-store-mysql-set-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: mysql-store-mysql-set-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: mysql-data-1-mysql-set-0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: mysql-data-1-mysql-set-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: mysql-data-1-mysql-set-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: mysql-store-mysql-set-0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> v1/Secret:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: default-token-rpqq4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: mysql-password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: deployer-token-cc92m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: builder-token-xk5g4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> v1/ServiceAccount:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: deployer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: builder
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Events: &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>OCP 上的 Volume Snapshot&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/05/image-20240523091131334.png"
loading="lazy"
alt="image-20240523091131334"
>&lt;/p>
&lt;p>OCP Volume SnapshotContents&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/05/image-20240523091201873.png"
loading="lazy"
alt="image-20240523091201873"
>&lt;/p>
&lt;p>Nutanix Prism Central - VG Recovery Point&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/05/image-20240523091508568.png"
loading="lazy"
alt="image-20240523091508568"
>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="ndk-restore">NDK Restore
&lt;/h3>&lt;h4 id="restore--local-snapshot">Restore Local Snapshot
&lt;/h4>&lt;ol>
&lt;li>
&lt;p>Delete mysql.yaml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total 12
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r--. 1 nutanix nutanix 393 May 16 13:45 mysql-cr.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r--. 1 nutanix nutanix 1213 May 16 11:18 mysql-deploy.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r--. 1 nutanix nutanix 183 May 20 15:45 mysql-snap.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get pvc -n ndk-mysql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql-data-1-mysql-set-0 Bound pvc-276ea905-a815-4635-98c0-3a4fade1bc44 3Gi RWO nutanixvolume 4d4h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql-data-1-mysql-set-1 Bound pvc-5638dc79-8271-4a49-94b9-d22c6212e232 3Gi RWO nutanixvolume 4d4h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql-data-1-mysql-set-2 Bound pvc-a4e832f4-e99b-4bdc-bc5b-253731447ce4 3Gi RWO nutanixvolume 4d4h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql-store-mysql-set-0 Bound pvc-262a52dc-1861-4992-b2aa-e41f448a6db5 5Gi RWO nutanixvolume 4d4h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql-store-mysql-set-1 Bound pvc-1e809e1d-2190-4220-80ba-35712900d3a6 5Gi RWO nutanixvolume 4d4h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql-store-mysql-set-2 Bound pvc-fafd94af-11be-4b02-aef1-4d959607c0cf 5Gi RWO nutanixvolume 4d4h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/mysql-set-0 1/1 Running 0 4d4h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/mysql-set-1 1/1 Running 0 4d4h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/mysql-set-2 1/1 Running 0 4d4h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">statefulset.apps/mysql-set 3/3 4d4h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc delete app mysql-cr -n ndk-mysql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">application.dataservices.nutanix.com &amp;#34;mysql-cr&amp;#34; deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc delete -f mysql-deploy.yaml -n ndk-mysql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">secret &amp;#34;mysql-password&amp;#34; deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">statefulset.apps &amp;#34;mysql-set&amp;#34; deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc delete pvc --all -n ndk-mysql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolumeclaim &amp;#34;mysql-data-1-mysql-set-0&amp;#34; deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolumeclaim &amp;#34;mysql-data-1-mysql-set-1&amp;#34; deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolumeclaim &amp;#34;mysql-data-1-mysql-set-2&amp;#34; deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolumeclaim &amp;#34;mysql-store-mysql-set-0&amp;#34; deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolumeclaim &amp;#34;mysql-store-mysql-set-1&amp;#34; deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolumeclaim &amp;#34;mysql-store-mysql-set-2&amp;#34; deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get pvc -n ndk-mysql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">No resources found in ndk-mysql namespace.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get all -n ndk-mysql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">No resources found in ndk-mysql namespace.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;img src="https://kenkenny.synology.me:5543/images/2024/05/image-20240520160111632.png" alt="image-20240520160111632" style="zoom:50%;" />
&lt;/li>
&lt;li>
&lt;p>Create Application Restore CR&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ vim mysql-restore.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: dataservices.nutanix.com/v1alpha1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: ApplicationSnapshotRestore
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: restore-mysql-snap-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespace: ndk-mysql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> applicationSnapshotName: mysql-snap-1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>oc apply restore CR&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;span class="lnt">84
&lt;/span>&lt;span class="lnt">85
&lt;/span>&lt;span class="lnt">86
&lt;/span>&lt;span class="lnt">87
&lt;/span>&lt;span class="lnt">88
&lt;/span>&lt;span class="lnt">89
&lt;/span>&lt;span class="lnt">90
&lt;/span>&lt;span class="lnt">91
&lt;/span>&lt;span class="lnt">92
&lt;/span>&lt;span class="lnt">93
&lt;/span>&lt;span class="lnt">94
&lt;/span>&lt;span class="lnt">95
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ oc apply -f mysql-restore.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">applicationsnapshotrestore.dataservices.nutanix.com/restore-mysql-snap-1 created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get applicationsnapshotrestore -n ndk-mysql -o yaml -o wide
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME SNAPSHOT-NAME COMPLETED
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">restore-mysql-snap-1 mysql-snap-1 true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc describe applicationsnapshotrestore restore-mysql-snap-1 -n ndk-mysql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name: restore-mysql-snap-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Namespace: ndk-mysql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Labels: &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Annotations: &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">API Version: dataservices.nutanix.com/v1alpha1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Kind: ApplicationSnapshotRestore
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Creation Timestamp: 2024-05-22T10:14:26Z
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Finalizers:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dataservices.nutanix.com/application-restore
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Generation: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Managed Fields:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> API Version: dataservices.nutanix.com/v1alpha1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Fields Type: FieldsV1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fieldsV1:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:annotations:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> .:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:kubectl.kubernetes.io/last-applied-configuration:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> .:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:applicationSnapshotName:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Manager: kubectl-client-side-apply
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Operation: Update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Time: 2024-05-22T10:14:26Z
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> API Version: dataservices.nutanix.com/v1alpha1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Fields Type: FieldsV1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fieldsV1:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:finalizers:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> .:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> v:&amp;#34;dataservices.nutanix.com/application-restore&amp;#34;:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Manager: manager
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Operation: Update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Time: 2024-05-22T10:14:26Z
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> API Version: dataservices.nutanix.com/v1alpha1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Fields Type: FieldsV1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fieldsV1:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:status:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> .:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:completed:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> f:conditions:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Manager: manager
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Operation: Update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Subresource: status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Time: 2024-05-22T10:14:43Z
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Resource Version: 48054533
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UID: 7a10fa58-3aaa-4592-8bdf-f6db2e9c4a0d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Application Snapshot Name: mysql-snap-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Completed: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Conditions:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Last Transition Time: 2024-05-22T10:14:26Z
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Message:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Observed Generation: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Reason: RequestCompleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Status: False
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type: Progressing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Last Transition Time: 2024-05-22T10:14:27Z
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Message: All prechecks passed and finalizers on dependent resources set. Skipped restoring resources since they already exist: [&amp;#34;/v1, Kind=ConfigMap, ndk-mysql/openshift-service-ca.crt&amp;#34;,&amp;#34;/v1, Kind=ServiceAccount, ndk-mysql/default&amp;#34;,&amp;#34;/v1, Kind=Secret, ndk-mysql/builder-token-xk5g4&amp;#34;,&amp;#34;/v1, Kind=ServiceAccount, ndk-mysql/deployer&amp;#34;,&amp;#34;rbac.authorization.k8s.io/v1, Kind=RoleBinding, ndk-mysql/admin&amp;#34;,&amp;#34;rbac.authorization.k8s.io/v1, Kind=RoleBinding, ndk-mysql/admin&amp;#34;,&amp;#34;/v1, Kind=Secret, ndk-mysql/default-token-rpqq4&amp;#34;,&amp;#34;rbac.authorization.k8s.io/v1, Kind=RoleBinding, ndk-mysql/system:image-pullers&amp;#34;,&amp;#34;rbac.authorization.k8s.io/v1, Kind=RoleBinding, ndk-mysql/system:image-pullers&amp;#34;,&amp;#34;/v1, Kind=Secret, ndk-mysql/deployer-token-cc92m&amp;#34;,&amp;#34;/v1, Kind=ServiceAccount, ndk-mysql/builder&amp;#34;,&amp;#34;rbac.authorization.k8s.io/v1, Kind=RoleBinding, ndk-mysql/system:image-builders&amp;#34;,&amp;#34;rbac.authorization.k8s.io/v1, Kind=RoleBinding, ndk-mysql/system:image-builders&amp;#34;,&amp;#34;/v1, Kind=ConfigMap, ndk-mysql/kube-root-ca.crt&amp;#34;,&amp;#34;rbac.authorization.k8s.io/v1, Kind=RoleBinding, ndk-mysql/system:deployers&amp;#34;,&amp;#34;rbac.authorization.k8s.io/v1, Kind=RoleBinding, ndk-mysql/system:deployers&amp;#34;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Observed Generation: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Reason: PrechecksPassed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Status: True
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type: PrechecksPassed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Last Transition Time: 2024-05-22T10:14:27Z
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Message: All eligible volumes restored
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Observed Generation: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Reason: VolumesRestored
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Status: True
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type: VolumesRestored
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Last Transition Time: 2024-05-22T10:14:28Z
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Message: All eligible application configs restored
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Observed Generation: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Reason: ApplicationConfigRestored
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Status: True
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type: ApplicationConfigRestored
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Last Transition Time: 2024-05-22T10:14:43Z
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Message: Application restore successfully finalised
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Observed Generation: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Reason: ApplicationRestoreFinalised
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Status: True
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type: ApplicationRestoreFinalised
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Events:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type Reason Age From Message
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ---- ------ ---- ---- -------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal WaitingForVolumeBound 55s (x2 over 55s) NDK Waiting for PVCs to get Bound. Unbound PVCs: [mysql-store-mysql-set-2 mysql-data-1-mysql-set-0 mysql-store-mysql-set-1 mysql-data-1-mysql-set-2 mysql-data-1-mysql-set-1 mysql-store-mysql-set-0]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>確認Application 、PVC、PV 復原完成&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ oc get all -n ndk-mysql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/mysql-set-0 1/1 Running 0 2m9s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/mysql-set-1 1/1 Running 0 106s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/mysql-set-2 1/1 Running 0 92s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">statefulset.apps/mysql-set 3/3 2m10s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get pv,pvc -n ndk-mysql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolume/pvc-06e3f4c4-c4f1-415f-8194-2e4d356570d0 5Gi RWO Delete Bound ndk-mysql/mysql-store-mysql-set-1 nutanixvolume 3m35s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolume/pvc-094bda7b-6a4d-44f1-a275-288d73b5545a 3Gi RWO Delete Bound ndk-mysql/mysql-data-1-mysql-set-2 nutanixvolume 3m35s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolume/pvc-5cc840da-2fc9-431f-8c99-9948fe8b70f1 5Gi RWO Delete Bound ndk-mysql/mysql-store-mysql-set-2 nutanixvolume 3m39s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolume/pvc-928e91ad-87db-41b6-96bd-e12d86608cbf 5Gi RWO Delete Bound ndk-mysql/mysql-store-mysql-set-0 nutanixvolume 3m35s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolume/pvc-9b9aba57-c449-419f-9a09-5e4960604321 3Gi RWO Delete Bound ndk-mysql/mysql-data-1-mysql-set-1 nutanixvolume 3m40s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolume/pvc-dccfcf6d-c9fd-45c0-9a93-53d94e96fdf6 3Gi RWO Delete Bound ndk-mysql/mysql-data-1-mysql-set-0 nutanixvolume 3m40s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolumeclaim/mysql-data-1-mysql-set-0 Bound pvc-dccfcf6d-c9fd-45c0-9a93-53d94e96fdf6 3Gi RWO nutanixvolume 3m48s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolumeclaim/mysql-data-1-mysql-set-1 Bound pvc-9b9aba57-c449-419f-9a09-5e4960604321 3Gi RWO nutanixvolume 3m48s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolumeclaim/mysql-data-1-mysql-set-2 Bound pvc-094bda7b-6a4d-44f1-a275-288d73b5545a 3Gi RWO nutanixvolume 3m48s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolumeclaim/mysql-store-mysql-set-0 Bound pvc-928e91ad-87db-41b6-96bd-e12d86608cbf 5Gi RWO nutanixvolume 3m48s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolumeclaim/mysql-store-mysql-set-1 Bound pvc-06e3f4c4-c4f1-415f-8194-2e4d356570d0 5Gi RWO nutanixvolume 3m48s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persistentvolumeclaim/mysql-store-mysql-set-2 Bound pvc-5cc840da-2fc9-431f-8c99-9948fe8b70f1 5Gi RWO nutanixvolume 3m48s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/05/image-20240523091940333.png"
loading="lazy"
alt="image-20240523091940333"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/05/image-20240523092014313.png"
loading="lazy"
alt="image-20240523092014313"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/05/image-20240523092030321.png"
loading="lazy"
alt="image-20240523092030321"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Prism Central - Kubernetes Clusters&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/05/image-20240523091852050.png"
loading="lazy"
alt="image-20240523091852050"
>&lt;/p>
&lt;/li>
&lt;/ol></description></item><item><title>OCP-4.12.45_on_Nutanix(IPI)</title><link>https://wangken0129.github.io/p/ocp-4.12.45_on_nutanixipi/</link><pubDate>Mon, 04 Mar 2024 08:15:21 +0800</pubDate><guid>https://wangken0129.github.io/p/ocp-4.12.45_on_nutanixipi/</guid><description>&lt;h1 id="ocp41245-on-nutanix---ipi">OCP4.12.45 on Nutanix - IPI
&lt;/h1>&lt;p>Using IPI method install ocp 4.12.45 ( Stable )&lt;/p>
&lt;p>大致步驟&lt;/p>
&lt;ol>
&lt;li>建立Bastion&lt;/li>
&lt;li>建立Nutanix Prism Central CA&lt;/li>
&lt;li>建立Install-config.yaml&lt;/li>
&lt;li>建立OCP Cluster&lt;/li>
&lt;li>Nutanix CSI Operator&lt;/li>
&lt;li>Worker node autoscale&lt;/li>
&lt;/ol>
&lt;h2 id="reference">Reference
&lt;/h2>&lt;p>Disk Resize:&lt;/p>
&lt;p>&lt;a class="link" href="https://www.geekersdigest.com/how-to-extend-grow-linux-file-systems-without-downtime/#using-disk-partitions-vm" target="_blank" rel="noopener"
>https://www.geekersdigest.com/how-to-extend-grow-linux-file-systems-without-downtime/#using-disk-partitions-vm&lt;/a>&lt;/p>
&lt;p>CA:&lt;/p>
&lt;p>&lt;a class="link" href="https://www.nutanix.dev/2023/09/26/generating-a-self-signed-san-certificate-to-use-red-hat-openshift-in-nutanix-marketplace/" target="_blank" rel="noopener"
>https://www.nutanix.dev/2023/09/26/generating-a-self-signed-san-certificate-to-use-red-hat-openshift-in-nutanix-marketplace/&lt;/a>&lt;/p>
&lt;p>Installation:&lt;/p>
&lt;p>&lt;a class="link" href="https://www.youtube.com/watch?v=G8fFB6EUiOA" target="_blank" rel="noopener"
>https://www.youtube.com/watch?v=G8fFB6EUiOA&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://docs.openshift.com/container-platform/4.12/installing/installing_nutanix/installing-restricted-networks-nutanix-installer-provisioned.html" target="_blank" rel="noopener"
>https://docs.openshift.com/container-platform/4.12/installing/installing_nutanix/installing-restricted-networks-nutanix-installer-provisioned.html&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.nutanix.dev/2022/08/16/red-hat-openshift-ipi-on-nutanix-cloud-platform/" target="_blank" rel="noopener"
>https://www.nutanix.dev/2022/08/16/red-hat-openshift-ipi-on-nutanix-cloud-platform/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://docs.openshift.com/container-platform/4.12/installing/disconnected_install/installing-mirroring-disconnected.html" target="_blank" rel="noopener"
>https://docs.openshift.com/container-platform/4.12/installing/disconnected_install/installing-mirroring-disconnected.html&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://blog.csdn.net/weixin_43902588/article/details/107727804" target="_blank" rel="noopener"
>https://blog.csdn.net/weixin_43902588/article/details/107727804&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://mirror.openshift.com/pub/openshift-v4/clients/ocp/4.12.45/" target="_blank" rel="noopener"
>https://mirror.openshift.com/pub/openshift-v4/clients/ocp/4.12.45/&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/12/image-20231214105046158.png"
loading="lazy"
alt="image-20231214105046158"
>&lt;/p>
&lt;h2 id="cluster-information">Cluster Information
&lt;/h2>&lt;p>Prism Central: IP + DNS FQDN&lt;/p>
&lt;p>Prism Element: IP + DNS FQDN&lt;/p>
&lt;p>iSCSI Data Service: IP&lt;/p>
&lt;p>DNS Server: IP&lt;/p>
&lt;p>NTP: IP&lt;/p>
&lt;p>Network Subnet: Name
VM Network IPAM: IP Range&lt;/p>
&lt;hr>
&lt;p>bastion: IP&lt;/p>
&lt;p>OCP Cluster Name: poc&lt;/p>
&lt;p>OCP Cluster Base Domain: Domain Name&lt;/p>
&lt;p>OCP API VIP: IP + DNS FQDN&lt;/p>
&lt;p>OCP Ingress VIP: IP + DNS FQDN&lt;/p>
&lt;h2 id="create-bastion-vm-rhel93">Create Bastion VM rhel9.3
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>從Prism建立rhel 9.3 VM，配置vCPU, Memory, Disk, Network，掛rhel 9.3 的 iso檔案並開機&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/12/image-20231228092100302.png"
loading="lazy"
alt="image-20231228092100302"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/12/image-20231228092139601.png"
loading="lazy"
alt="image-20231228092139601"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>開機後點選Console, 設定基本的帳號密碼、網路、硬碟等&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/12/image-20231214143007168.png"
loading="lazy"
alt="image-20231214143007168"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>安裝完成ssh 進入bastion&lt;/p>
&lt;/li>
&lt;li>
&lt;p>下載ccoctl、openshift-install、oc client&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ wget https://mirror.openshift.com/pub/openshift-v4/clients/ocp/4.12.45/ccoctl-linux-4.12.45.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ wget https://mirror.openshift.com/pub/openshift-v4/clients/ocp/4.12.45/openshift-client-linux-4.12.45.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ wget https://mirror.openshift.com/pub/openshift-v4/clients/ocp/4.12.45/openshift-install-linux-4.12.45.tar.gz
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/12/image-20231221102507731.png"
loading="lazy"
alt="image-20231221102507731"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>解壓縮下載的bin檔，並放到/usr/local/bin、建立ocp-install資料夾&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ tar xvf ccoctl-linux-4.12.45.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ tar xvf openshift-client-linux-4.12.45.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ tar xvf openshift-install-linux-4.12.45.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ chmod 775 ccoctl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo cp ccoctl oc kubectl openshift-install /usr/local/bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ mkdir ocp-install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ cp openshift-install ocp-install/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Client Version: 4.12.45
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Kustomize Version: v4.5.7
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/12/image-20231221102521345.png"
loading="lazy"
alt="image-20231221102521345"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/12/image-20231221102532790.png"
loading="lazy"
alt="image-20231221102532790"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>下載pull-secret from registry.redhat.io&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">{&amp;#34;auths&amp;#34;:{&amp;#34;cloud.openshift.com&amp;#34;:{&amp;#34;auth&amp;#34;:.....}}}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>Create SSH Key&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ssh-keygen
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/12/image-20231221102325288.png"
loading="lazy"
alt="image-20231221102325288"
>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="prism-central-ca">Prism Central CA
&lt;/h2>&lt;ol>
&lt;li>產生CA&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="n">PC_IP&lt;/span>&lt;span class="o">=&lt;/span> &lt;span class="n">PC_IP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="n">PC_FQDN&lt;/span>&lt;span class="o">=&lt;/span> &lt;span class="n">PC_FQDN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">openssl&lt;/span> &lt;span class="n">req&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">x509&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">nodes&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">days&lt;/span> &lt;span class="mi">3650&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>&lt;span class="n">newkey&lt;/span> &lt;span class="n">rsa&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">2048&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">keyout&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">PC_IP&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">key&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">out&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">PC_IP&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">crt&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>&lt;span class="n">subj&lt;/span> &lt;span class="s2">&amp;#34;/C=US/ST=CA/L=San Jose/O=Nutanix Inc./OU=Manageability/CN=*.nutanix.local&amp;#34;&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>&lt;span class="n">addext&lt;/span> &lt;span class="s2">&amp;#34;subjectAltName=IP:${PC_IP},DNS:${PC_FQDN}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231221102352813.png"
loading="lazy"
alt="image-20231221102352813"
>&lt;/p>
&lt;ol start="2">
&lt;li>
&lt;p>置換Prism Central CA&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231221102428912.png"
loading="lazy"
alt="image-20231221102428912"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231221102436959.png"
loading="lazy"
alt="image-20231221102436959"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231221102446241_.png"
loading="lazy"
alt="image-20231221102446241"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231221102454156.png"
loading="lazy"
alt="image-20231221102454156"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>加入CA至Bastion&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ sudo cp xxx.crt /etc/pki/ca-trust/source/anchors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo cp xxx.key /etc/pki/ca-trust/source/anchors
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo update-ca-trust extract
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="install-ocp">Install OCP
&lt;/h2>&lt;h3 id="requirements">Requirements
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>Storage Space: 800GB&lt;/p>
&lt;/li>
&lt;li>
&lt;p>1 Cluster VIP for load balancer on control plane&lt;/p>
&lt;/li>
&lt;li>
&lt;p>1 Ingress VIP for load balancer on worker node&lt;/p>
&lt;/li>
&lt;li>
&lt;p>DNS record :
vip.(cluster name).(base domain)
*.apps.(cluster name).(base domain)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>IPAM with 7 ip addresses.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Virtual machines:&lt;/p>
&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>1 temporary bootstrap node&lt;/li>
&lt;li>3 control plane nodes&lt;/li>
&lt;li>3 compute machines&lt;/li>
&lt;li>1 installation bastion machines&lt;/li>
&lt;/ul>
&lt;ol start="7">
&lt;li>SSH Key&lt;/li>
&lt;li>download oc , ccoctl, openshift-install,&lt;/li>
&lt;li>CoreOS image on web server or Nutanix Object&lt;/li>
&lt;li>Prism Central CA&lt;/li>
&lt;/ol>
&lt;h3 id="create-install-configyaml">Create Install-config.yaml
&lt;/h3>&lt;p>利用openshift-install建立install-config.yaml檔案，依序輸入ssh key、Nutanix資訊、OCP Cluster資訊&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ ./openshift-install create install-config --dir &amp;lt;installation_directory&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231221102751103.png"
loading="lazy"
alt="image-20231221102751103"
>&lt;/p>
&lt;h4 id="修改-install-configyaml">修改 install-config.yaml
&lt;/h4>&lt;p>additionalTrustBundle: 加入 Prism Central 的 root CA&lt;/p>
&lt;p>additionalTrustBundlePolicy: 改為 Always&lt;/p>
&lt;p>machineNetwork: 改為與VM相同網段 xxx.xxx.xxx.xxx/24&lt;/p>
&lt;p>platform 自定義cpu、memory、disk&lt;/p>
&lt;p>完成後如下，建議備份此檔案以利部署到其他地方或是重新部署&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">baseDomain: XXX.XXX
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">additionalTrustBundle: |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----BEGIN CERTIFICATE-----
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> MIID8zCCAtugAwIBAgIUPE0LteDWc8JLjEm5LlqJF0s17n0wDQYJKoZIhvcNAQEL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> XXX
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----END CERTIFICATE-----
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">additionalTrustBundlePolicy: Always
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">compute:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- architecture: amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hyperthreading: Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> platform:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nutanix:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cpus: 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> coresPerSocket: 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> memoryMiB: 16384
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> osDisk:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> diskSizeGiB: 120
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">controlPlane:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> architecture: amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hyperthreading: Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> platform:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nutanix:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cpus: 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> coresPerSocket: 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> memoryMiB: 16384
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> osDisk:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> diskSizeGiB: 120
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">credentialsMode: Manual
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> creationTimestamp: null
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: poc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">networking:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> clusterNetwork:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - cidr: 10.128.0.0/14
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hostPrefix: 23
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machineNetwork:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - cidr: xxx.xxx.xxx.xxx/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> networkType: OVNKubernetes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> serviceNetwork:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 172.30.0.0/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">platform:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nutanix:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> apiVIPs:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - xxx.xxx.xxx.xxx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ingressVIPs:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - xxx.xxx.xxx.xxx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> prismCentral:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> endpoint:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> address: xxx.xxx.xxx.xxx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port: 9440
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> password: password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> username: admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> prismElements:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - endpoint:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> address: xxx.xxx.xxx.xxx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port: 9440
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> uuid: xxxxxxx-cd36-0cc8-0f4a-xxxxxxxxxx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> subnetUUIDs:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - xxxxxxxx-27ab-46ab-a0b1-xxxxxxxxxx3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">publish: External
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pullSecret: &amp;#39;{&amp;#34;auths&amp;#34;:.....}}}&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sshKey: |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssh-rsa AAAAxxxxxxxxxxxxxxxxxxxxxxx nutanix@ocp-bastion
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="設定cco">設定CCO
&lt;/h3>&lt;p>安裝Cluster需要Cloud Credential Operator (CCO)，讓OCP能與Prism溝通&lt;/p>
&lt;p>大致作法為&lt;/p>
&lt;ol>
&lt;li>
&lt;p>建立帳號密碼檔案&lt;/p>
&lt;/li>
&lt;li>
&lt;p>建立要求帳密的目錄及檔案&lt;/p>
&lt;/li>
&lt;li>
&lt;p>利用上述檔案建立OCP Shared Secret&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在 ocp-install 資料夾內建立 credentials.yaml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ vim credentials.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">credentials:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- type: basic_auth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> data:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> prismCentral:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> username: admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> password: P@ssw0rd123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> prismElements:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: AHV-Cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> username: admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> password: P@ssw0rd123
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>設定Image環境變數&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ RELEASE_IMAGE=$(./openshift-install version | awk &amp;#39;/release image/ {print $3}&amp;#39;)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>建立credrequests資料夾&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ mkdir credrequests
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>建立0000_30_machine-api-operator_00_credentials-request.yaml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ oc adm release extract --credentials-requests --cloud=nutanix --to=./credrequests $RELEASE_IMAGE
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>建立 CCO Secret&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ ccoctl nutanix create-shared-secrets --credentials-requests-dir=/home/nutanix/ocp_install/credrequests --output-dir=/home/nutanix/ocp-install --credentials-source-filepath=/home/nutanix/ocp_install/credentials.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231221103631965.png"
loading="lazy"
alt="image-20231221103631965"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/12/image-20231221103640795.png"
loading="lazy"
alt="image-20231221103640795"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/12/image-20231221103812824.png"
loading="lazy"
alt="image-20231221103812824"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/12/image-20231221103830445.png"
loading="lazy"
alt="image-20231221103830445"
>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="create-cluster">Create Cluster
&lt;/h3>&lt;h4 id="create-manifests">Create Manifests
&lt;/h4>&lt;p>建立 manifests資料夾，確認openshift-machine-api-nutanix-credentials-credentials.yaml有在裡面&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ ./openshift-install create manifests --dir /home/nutanix/ocp-install/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/12/image-20231221103956961.png"
loading="lazy"
alt="image-20231221103956961"
>&lt;/p>
&lt;h4 id="create-cluster-1">Create Cluster
&lt;/h4>&lt;ol>
&lt;li>
&lt;p>ocp-install&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ ./openshift-install create cluster --dir /home/nutanix/ocp-install/ --log-level=debug
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/12/image-20231221104222075.png"
loading="lazy"
alt="image-20231221104222075"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>安裝過程，會先建立OS image&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/12/image-20231221104256996.png"
loading="lazy"
alt="image-20231221104256996"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231221104311871.png"
loading="lazy"
alt="image-20231221104311871"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>install completed&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231228101028495.png"
loading="lazy"
alt="image-20231228101028495"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>安裝完後在安裝目錄底下會有auth的資料夾，裡面含有kubeadmin的帳密、kubeconfig檔案&lt;/p>
&lt;p>建議將kubeconfig檔案複製到~/.kube/config ，這樣就可以直接使用 oc 指令連線到該叢集&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">in /home/nutanix/ocp-install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ mkdir ~/.kube
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ cp auth/kubeconfig ~/.kube/config
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>oc get nodes&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231228101001702.png"
loading="lazy"
alt="image-20231228101001702"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>get console url&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231228101053013.png"
loading="lazy"
alt="image-20231228101053013"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>login page，密碼在/home/nutanix/ocp-install/auth/&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231228101115835.png"
loading="lazy"
alt="image-20231228101115835"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>login&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231228101128534.png"
loading="lazy"
alt="image-20231228101128534"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231228101140167.png"
loading="lazy"
alt="image-20231228101140167"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>安裝完有遇到預設ntp無法連通，需改為內部的ntp server
修改MachineConfig方法為撰寫bu設定檔，再透過bu去轉成yaml檔案，最後部署上去OCP&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229120824457.png"
loading="lazy"
alt="image-20231229120824457"
>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="nutanix-csi">Nutanix CSI
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>在OCP Console上點選OperatorHub，搜尋Nutanix&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229112011014.png"
loading="lazy"
alt="image-20231229112011014"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>點進去點選Install，描述內容比較重要的像支援Nutanix Volumes (rwo)、Nutanix FIles (rwx)&lt;/p>
&lt;p>以及下方有部署yaml範例，可以先複製下來&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229112814864.png"
loading="lazy"
alt="image-20231229112814864"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>選安裝版本、Namespace、更新方式&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229113026621.png"
loading="lazy"
alt="image-20231229113026621"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>安裝完成&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229113056589.png"
loading="lazy"
alt="image-20231229113056589"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>點選Nutanix CSI Storage，點Create NutanixCsiStorage&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229113122565.png"
loading="lazy"
alt="image-20231229113122565"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>建立NutanixCsiStorage，點選Create即可&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229113155776.png"
loading="lazy"
alt="image-20231229113155776"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229113229946.png"
loading="lazy"
alt="image-20231229113229946"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>建立一個 Secret 讓OCP可以透過該Secret與Prism做溝通&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ vi ntnx-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: Secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: ntnx-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespace: openshift-cluster-csi-drivers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stringData:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # prism-element-ip:prism-port:admin:password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: PE-IP:9440:admin:P@ssw0rd123
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229113317508.png"
loading="lazy"
alt="image-20231229113317508"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>建立Volume的Storage Class ，需修改dataServiceEndPoint、storageContainer&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ vi nutanix-volume.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: StorageClass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: storage.k8s.io/v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: nutanix-volume
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">provisioner: csi.nutanix.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">parameters:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/provisioner-secret-name: ntnx-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/provisioner-secret-namespace: openshift-cluster-csi-drivers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/node-publish-secret-name: ntnx-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/node-publish-secret-namespace: openshift-cluster-csi-drivers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/controller-expand-secret-name: ntnx-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/controller-expand-secret-namespace: openshift-cluster-csi-drivers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/fstype: ext4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dataServiceEndPoint: IP:3260 # Prism data service ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> storageContainer: default-container # Prism 上建立的Storage Container
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> storageType: NutanixVolumes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #whitelistIPMode: ENABLED
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #chapAuth: ENABLED
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">allowVolumeExpansion: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">reclaimPolicy: Delete
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229113507440.png"
loading="lazy"
alt="image-20231229113507440"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>建立Nutanix Files的Storage Class&lt;/p>
&lt;p>有分為兩種：NFS Servers、Dynamic NFS Shares (Valid Design)&lt;/p>
&lt;p>NFS Share Server：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ vi ntnx-files.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: StorageClass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: storage.k8s.io/v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: nutanix-files
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> annotations:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> storageclass.kubernetes.io/is-default-class: &amp;#34;false&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">provisioner: csi.nutanix.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">parameters:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nfsServer: files.poc.xxx.xxx.xxx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nfsPath: /ocp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> storageType: NutanixFiles
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> squashType: &amp;#34;root-squash&amp;#34; # 若沒有資安疑慮可以用none，比較簡單
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">reclaimPolicy: Delete or Retain
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229114237696.png"
loading="lazy"
alt="image-20231229114237696"
>&lt;/p>
&lt;p>Dynamic NFS Shares&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ vi ntnx-dynamic-files.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: StorageClass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: storage.k8s.io/v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: nutanix-dynfiles
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">provisioner: csi.nutanix.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">parameters:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dynamicProv: ENABLED
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/provisioner-secret-name: ntnx-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/provisioner-secret-namespace: openshift-cluster-csi-drivers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/node-publish-secret-name: ntnx-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/node-publish-secret-namespace: openshift-cluster-csi-drivers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/controller-expand-secret-name: ntnx-secret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> csi.storage.k8s.io/controller-expand-secret-namespace: openshift-cluster-csi-drivers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> storageType: NutanixFiles
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> squashType: &amp;#34;root-squash&amp;#34; # 若沒有資安疑慮可以用none，比較簡單
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nfsServerName: files # 對應Nutanix Files Server的名稱
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">allowVolumeExpansion: true
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229114932023.png"
loading="lazy"
alt="image-20231229114932023"
>&lt;/p>
&lt;p>兩者建PVC在Nutanix Files Console上的差異如下：&lt;/p>
&lt;p>選擇第一種會建立在ocp這個share內，選擇第二種會建立各個PVC對應的share&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229120003104.png"
loading="lazy"
alt="image-20231229120003104"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>建立PVC去確認Status為Bound即可，Volume測試&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229120126695.png"
loading="lazy"
alt="image-20231229120126695"
>&lt;/p>
&lt;p>在Nutanix Prism上的Volume Group&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229120205001.png"
loading="lazy"
alt="image-20231229120205001"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>擴充PVC&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229120324056.png"
loading="lazy"
alt="image-20231229120324056"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229120337732.png"
loading="lazy"
alt="image-20231229120337732"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229120352157.png"
loading="lazy"
alt="image-20231229120352157"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229120408383.png"
loading="lazy"
alt="image-20231229120408383"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>建立Files PVC測試&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229120613807.png"
loading="lazy"
alt="image-20231229120613807"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229120634249.png"
loading="lazy"
alt="image-20231229120634249"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>檢視PV確認都為Bound&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229120448778.png"
loading="lazy"
alt="image-20231229120448778"
>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="autoscaler">Autoscaler
&lt;/h2>&lt;p>Nutanix 結合Openshift的Autoscaler做到Worker Node的自動擴展&lt;/p>
&lt;p>名詞解釋：&lt;/p>
&lt;p>Machine：為透過Openshift部署的機器&lt;/p>
&lt;p>Nodes：為部署完加入OCP Cluster內的節點&lt;/p>
&lt;p>scale up：對於Openshift 來說是整體的Resource增加，以實際看到的意思就是worker node新增，因為master node不能被使用&lt;/p>
&lt;p>scale down：相對scale up 就是整體的Resource減少，意思就是減少worker node的數量&lt;/p>
&lt;p>Clusterautoscaler：針對整個Cluster做Resource管控的設定，例如整體CPU、Memory、整體最大節點等&lt;/p>
&lt;p>Machinesets：machine的設定值，包含有多種不同的環境例如 AWS、GCP、Nutanix，就會有多個Machinesets&lt;/p>
&lt;p>Machineautoscaler：針對Machinesets去做scale的設定，例如最大12個節點、最小2個節點等&lt;/p>
&lt;h3 id="config">Config
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>確認現有的Machinesets、Machine數量&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">在Bastion上
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get machinesets -n openshift-machine-api
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get machine -n openshift-machine-api
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/12/image-20231229132903201.png"
loading="lazy"
alt="image-20231229132903201"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>新增ClusterAutoscaler設定檔，這邊還可自定義Cluster的Resource資源總共多少、Woker Node使用量到多少時需要擴展
預設是單一Work Node 使用量達50%時會自動擴展，詳情見Redhat 官方連結
&lt;a class="link" href="https://docs.openshift.com/container-platform/4.12/machine_management/applying-autoscaling.html" target="_blank" rel="noopener"
>https://docs.openshift.com/container-platform/4.12/machine_management/applying-autoscaling.html&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ vi clusterautoscaler.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: &amp;#34;autoscaling.openshift.io/v1&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: &amp;#34;ClusterAutoscaler&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &amp;#34;default&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resourceLimits:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> maxNodesTotal: 10 # 最大的worker node數量
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> scaleDown: # scaleDown 參數
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> enabled: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> delayAfterAdd: 10s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> delayAfterDelete: 10s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> delayAfterFailure: 10s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229133058122.png"
loading="lazy"
alt="image-20231229133058122"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>新增MachineAutoscaler設定檔&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ vi machineautoscaler.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: &amp;#34;autoscaling.openshift.io/v1beta1&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: &amp;#34;MachineAutoscaler&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &amp;#34;poc-gqwvb-worker&amp;#34; # 這裡請對應machineset的名稱
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespace: &amp;#34;openshift-machine-api&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> minReplicas: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> maxReplicas: 12
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> scaleTargetRef:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> apiVersion: machine.openshift.io/v1beta1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kind: MachineSet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: poc-gqwvb-worker # 這裡請對應machineset的名稱
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229133331596.png"
loading="lazy"
alt="image-20231229133331596"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>部署兩個設定檔案到ocp cluster內，即可看到MachineAutoscalers內有該設定檔&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ oc create -f clusterautoscaler.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterautoscaler.autoscaling.openshift.io/default created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc create -f machineautoscaler.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">machineautoscaler.autoscaling.openshift.io/ocp-demo-t82dn-worker created
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229133835454.png"
loading="lazy"
alt="image-20231229133835454"
>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="test">Test
&lt;/h3>&lt;p>現有Machine及Nodes&lt;/p>
&lt;p>Machine&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229134502956.png"
loading="lazy"
alt="image-20231229134502956"
>&lt;/p>
&lt;p>Nodes&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229134439968.png"
loading="lazy"
alt="image-20231229134439968"
>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>建立測試用的Project (namespace)&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ oc adm new-project autoscale-example &amp;amp;&amp;amp; oc project autoscale-example
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>建立測試的Pod，50個pod、480秒後自動關閉&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ vi demo-job.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: batch/v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: Job
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> generateName: demo-job-
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> template:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> containers:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: work
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image: busybox
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> command: [&amp;#34;sleep&amp;#34;, &amp;#34;480&amp;#34;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resources:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> requests:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> memory: 1000Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cpu: 1000m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> restartPolicy: Never
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> backoffLimit: 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> completions: 50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> parallelism: 50
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>部署到OCP Cluster內&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ oc apply -f demo-job.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229134951317.png"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229135114899.png"
loading="lazy"
alt="image-20231229135114899"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>當OCP的autoscaler偵測到時，即會自動開始新增worker node (scale up 約10分鐘)
可在Machines的頁面查看&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229135203313.png"
loading="lazy"
alt="image-20231229135203313"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Prism Central上也可以看到VM在建立中&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229135249675.png"
loading="lazy"
alt="image-20231229135249675"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Machinesets 會看到應該有的machines要有4個現在只有3個&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229135323816.png"
loading="lazy"
alt="image-20231229135323816"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Machine Provision完成後，會自動加入OCP Cluster，自動安裝叢集所需的Pod、CSI Driver等&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229135432143.png"
loading="lazy"
alt="image-20231229135432143"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Node加入完成&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229135533396.png"
loading="lazy"
alt="image-20231229135533396"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229135557129.png"
loading="lazy"
alt="image-20231229135557129"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229135618865.png"
loading="lazy"
alt="image-20231229135618865"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229135634076.png"
loading="lazy"
alt="image-20231229135634076"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>當Pod的時間到了自動關閉之後，即會開始做縮減的動作 (scale down 約3分鐘完成 )&lt;/p>
&lt;p>OCP會自動選擇其中一個Worker Node做刪除，會排除該節點上有local PV、使用量低於50%的Worker Node&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229140147396.png"
loading="lazy"
alt="image-20231229140147396"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229135806745.png"
loading="lazy"
alt="image-20231229135806745"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>最後回歸為原本的狀態&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229140933239.png"
loading="lazy"
alt="image-20231229140933239"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2024/03/image-20231229140947045.png"
loading="lazy"
alt="image-20231229140947045"
>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>以上為使用Nutanix 透過 IPI Online的方式安裝Red Hat Openshift 叢集的測試過程。&lt;/p></description></item><item><title>OCP-4.11.9_on_vSphere(UPI)</title><link>https://wangken0129.github.io/p/ocp-4.11.9_on_vsphereupi/</link><pubDate>Sat, 23 Sep 2023 08:19:11 +0800</pubDate><guid>https://wangken0129.github.io/p/ocp-4.11.9_on_vsphereupi/</guid><description>&lt;h1 id="install-openshift-4119-on-vsphereupi">Install Openshift 4.11.9 on vSphere(UPI)
&lt;/h1>&lt;h3 id="說明">說明
&lt;/h3>&lt;p>&lt;a class="link" href="https://docs.openshift.com/container-platform/4.11/installing/installing_vsphere/installing-vsphere.html" target="_blank" rel="noopener"
>https://docs.openshift.com/container-platform/4.11/installing/installing_vsphere/installing-vsphere.html&lt;/a>
&lt;a class="link" href="https://cloud.redhat.com/blog/deploying-openshift-4.4-to-vmware-vsphere-7?hsLang=en-us" target="_blank" rel="noopener"
>https://cloud.redhat.com/blog/deploying-openshift-4.4-to-vmware-vsphere-7?hsLang=en-us&lt;/a>&lt;/p>
&lt;ol>
&lt;li>用Mac 當作Client&lt;/li>
&lt;li>需要事先安裝好Bastion&lt;/li>
&lt;li>Bastion安裝設定Named、HAProxy、Web Server (這裡用Nginx)&lt;/li>
&lt;li>用rhcos-4.11.9.ova 來ESXi 部署ovf 範本&lt;/li>
&lt;/ol>
&lt;h3 id="下載oc-client">下載OC Client
&lt;/h3>&lt;p>&lt;a class="link" href="https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.11.9/openshift-client-mac-4.11.9.tar.gz" target="_blank" rel="noopener"
>https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.11.9/openshift-client-mac-4.11.9.tar.gz&lt;/a>&lt;/p>
&lt;h3 id="下載ocp-installer">下載OCP Installer
&lt;/h3>&lt;p>&lt;a class="link" href="https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.11.9/openshift-install-mac-4.11.9.tar.gz" target="_blank" rel="noopener"
>https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.11.9/openshift-install-mac-4.11.9.tar.gz&lt;/a>&lt;/p>
&lt;h3 id="下載coreos-4119ova">下載CoreOS-4.11.9.ova
&lt;/h3>&lt;p>&lt;a class="link" href="https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.11/4.11.9/rhcos-4.11.9-x86_64-vmware.x86_64.ova" target="_blank" rel="noopener"
>https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.11/4.11.9/rhcos-4.11.9-x86_64-vmware.x86_64.ova&lt;/a>&lt;/p>
&lt;h3 id="下載pull-secret">下載Pull-Secret
&lt;/h3>&lt;p>&lt;a class="link" href="https://console.redhat.com/openshift/downloads#tool-pull-secret" target="_blank" rel="noopener"
>https://console.redhat.com/openshift/downloads#tool-pull-secret&lt;/a>&lt;/p>
&lt;h3 id="named">Named
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-dns" data-lang="dns">&lt;span class="line">&lt;span class="cl">&lt;span class="nc">Named&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">設定檔&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">[root@bastion&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">~]#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">cat&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">/etc/&lt;/span>&lt;span class="nc">named.conf&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">//&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">//&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nc">named.conf&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">//&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">//&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">Provided&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">Red&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">Hat&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">bind&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">package&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">to&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">configure&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">the&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">ISC&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">BIND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">named&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sc">8&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">DNS&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">//&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">server&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">caching&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">only&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">nameserver&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="err">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">localhost&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">DNS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">resolver&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">only&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="err">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">//&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">//&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">See&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">/usr/share/doc/bind*/sample/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">example&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">named&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">configuration&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">files.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">//&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">options&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">listen-on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">port&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">53&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">any&lt;/span>&lt;span class="c">; };&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">listen-on-v6&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">port&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">53&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">::&lt;/span>&lt;span class="sc">1&lt;/span>&lt;span class="c">; };&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">directory&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/var/named&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">dump-file&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/var/named/data/&lt;/span>&lt;span class="nc">cache_dump.db&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">statistics-file&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/var/named/data/&lt;/span>&lt;span class="nc">named_stats.txt&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">memstatistics-file&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/var/named/data/&lt;/span>&lt;span class="nc">named_mem_stats.txt&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">secroots-file&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/var/named/data/&lt;/span>&lt;span class="nc">named.secroots&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">recursing-file&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/var/named/data/&lt;/span>&lt;span class="nc">named.recursing&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">allow-query&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">any&lt;/span>&lt;span class="c">; };&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">##&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">設定轉寄站&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">forwarders&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.2.12&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.2.11&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">}&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">/*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">If&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">you&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">are&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">building&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">an&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">AUTHORITATIVE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">DNS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">server,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">do&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">enable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">recursion.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">If&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">you&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">are&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">building&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">RECURSIVE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="err">caching&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">DNS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">server,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">you&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">need&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">to&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">enable&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="py">recursion. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">If&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">your&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">recursive&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">DNS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">server&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">has&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">IP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">address,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">you&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">MUST&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">enable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">access&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">control&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">to&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">limit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">queries&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">to&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">your&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">legitimate&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">users. &lt;/span>&lt;span class="err">Failing&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">to&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">do&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">so&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">will&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">cause&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">your&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">server&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">to&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">become&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">part&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">of&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">large&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">scale&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">DNS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">amplification&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="py">attacks. &lt;/span>&lt;span class="err">Implementing&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">BCP38&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">within&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">your&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">network&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">would&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">greatly&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">reduce&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">such&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">attack&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">surface&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">*/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">recursion&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">yes&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">dnssec-enable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">yes&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">dnssec-validation&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">yes&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">managed-keys-directory&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/var/named/dynamic&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">pid-file&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/run/named/&lt;/span>&lt;span class="nc">named.pid&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">session-keyfile&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/run/named/&lt;/span>&lt;span class="nc">session.key&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">/*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">https://&lt;/span>&lt;span class="nc">fedoraproject.org&lt;/span>&lt;span class="err">/wiki/Changes/CryptoPolicy&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">*/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">include&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/etc/crypto-policies/back-ends/&lt;/span>&lt;span class="nc">bind.config&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">}&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">logging&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">channel&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">default_debug&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">file&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;data/&lt;/span>&lt;span class="nc">named.run&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">severity&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">dynamic&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">}&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">}&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">zone&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;.&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">hint&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">file&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="nc">named.ca&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">}&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">zone&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="nc">ocp.infotech.com.tw&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">master&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">file&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/var/named/&lt;/span>&lt;span class="nc">forward.bastion.ocp&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">allow-update&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">none&lt;/span>&lt;span class="c">; };&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">allow-query&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">any&lt;/span>&lt;span class="c">; };&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">allow-transfer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">none&lt;/span>&lt;span class="c">; };&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">}&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">zone&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="sc">3&lt;/span>&lt;span class="nc">.168.192.in-addr.arpa&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">master&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">file&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/var/named/&lt;/span>&lt;span class="nc">reverse.bastion.ocp&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">allow-update&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">none&lt;/span>&lt;span class="c">; };&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">allow-query&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">any&lt;/span>&lt;span class="c">; };&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">allow-transfer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">none&lt;/span>&lt;span class="c">; };&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">}&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">include&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/etc/&lt;/span>&lt;span class="nc">named.rfc1912.zones&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">include&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/etc/&lt;/span>&lt;span class="nc">named.root.key&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">------&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">正向解析&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">[root@bastion&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">~]#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">cat&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">/var/named/&lt;/span>&lt;span class="nc">forward.bastion.ocp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="na">$TTL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">1&lt;/span>&lt;span class="err">W&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">@&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SOA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">ns1.infotech.com.tw. &lt;/span>&lt;span class="err">root&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">2019070700&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; serial&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">3&lt;/span>&lt;span class="err">H&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; refresh (3 hours)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">30&lt;/span>&lt;span class="err">M&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; retry (30 minutes)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">2&lt;/span>&lt;span class="err">W&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; expiry (2 weeks)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">1&lt;/span>&lt;span class="err">W&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; minimum (1 week)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">ns1.infotech.com.tw.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">MX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">10&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">smtp.infotech.com.tw.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">ns1.infotech.com.tw. &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.37&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">smtp.infotech.com.tw. &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.37&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">helper.infotech.com.tw. &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.37&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">helper.ocp.infotech.com.tw. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.37&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">api.ocp.infotech.com.tw. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.37&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">api-int.ocp.infotech.com.tw. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.37&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">*&lt;/span>&lt;span class="nc">.apps.ocp.infotech.com.tw.&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.37&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">bootstrap.ocp.infotech.com.tw. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.36&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">master1.ocp.infotech.com.tw. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.31&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">master2.ocp.infotech.com.tw. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.32&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">master3.ocp.infotech.com.tw. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.33&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">worker1.ocp.infotech.com.tw. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.34&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">worker2.ocp.infotech.com.tw. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.35&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;EOF&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">-------&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">反向解析&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">[root@bastion&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">~]#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">cat&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">/var/named/&lt;/span>&lt;span class="nc">reverse.bastion.ocp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="na">$TTL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">1&lt;/span>&lt;span class="err">W&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">@&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SOA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">ns1.infotech.com.tw. &lt;/span>&lt;span class="err">root&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">2019070700&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; serial&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">3&lt;/span>&lt;span class="err">H&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; refresh (3 hours)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">30&lt;/span>&lt;span class="err">M&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; retry (30 minutes)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">2&lt;/span>&lt;span class="err">W&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; expiry (2 weeks)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">1&lt;/span>&lt;span class="err">W&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; minimum (1 week)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">ns1.infotech.com.tw.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">37.3.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">api.ocp.infotech.com.tw. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">37.3.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">api-int.ocp.infotech.com.tw. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">36.3.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">bootstrap.ocp.infotech.com.tw. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">31.3.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">master1.ocp.infotech.com.tw. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">32.3.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">master2.ocp.infotech.com.tw. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">33.3.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">master3.ocp.infotech.com.tw. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">34.3.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">worker1.ocp.infotech.com.tw. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">35.3.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">worker2.ocp.infotech.com.tw. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;EOF&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="haproxy">HAProxy
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># cat /etc/haproxy/haproxy.cfg&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">global&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">log&lt;/span> &lt;span class="mf">127.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.1&lt;/span> &lt;span class="n">local2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pidfile&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">haproxy&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pid&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">maxconn&lt;/span> &lt;span class="mi">4000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">daemon&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">defaults&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">http&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">log&lt;/span> &lt;span class="n">global&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">dontlognull&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">close&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">redispatch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">retries&lt;/span> &lt;span class="mi">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">request&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">queue&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">m&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">connect&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">client&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">m&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">server&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">m&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">keep&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">alive&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">maxconn&lt;/span> &lt;span class="mi">3000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">frontend&lt;/span> &lt;span class="n">stats&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bind&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">1936&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">http&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">log&lt;/span> &lt;span class="n">global&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">maxconn&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">hide&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">version&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">refresh&lt;/span> &lt;span class="mi">30&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">show&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">node&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">show&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">desc&lt;/span> &lt;span class="n">Stats&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">ocp&lt;/span> &lt;span class="n">cluster&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">auth&lt;/span> &lt;span class="n">admin&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">ocp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">uri&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">stats&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">listen&lt;/span> &lt;span class="n">api&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">6443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bind&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">tcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">bootstrap&lt;/span> &lt;span class="n">bootstrap&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span> &lt;span class="n">backup&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master1&lt;/span> &lt;span class="n">master1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master2&lt;/span> &lt;span class="n">master2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master3&lt;/span> &lt;span class="n">master3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">listen&lt;/span> &lt;span class="n">machine&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">22623&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bind&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22623&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">tcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">bootstrap&lt;/span> &lt;span class="n">bootstrap&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22623&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span> &lt;span class="n">backup&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master1&lt;/span> &lt;span class="n">master1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22623&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master2&lt;/span> &lt;span class="n">master2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22623&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master3&lt;/span> &lt;span class="n">master3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22623&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">listen&lt;/span> &lt;span class="n">ingress&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">router&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bind&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">tcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">balance&lt;/span> &lt;span class="n">source&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">worker1&lt;/span> &lt;span class="n">worker1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">worker2&lt;/span> &lt;span class="n">worker2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">listen&lt;/span> &lt;span class="n">ingress&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">router&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">80&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bind&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">80&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">tcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">balance&lt;/span> &lt;span class="n">source&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">worker1&lt;/span> &lt;span class="n">worker1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">80&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">worker2&lt;/span> &lt;span class="n">worker2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">80&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="nginx">Nginx
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;span class="lnt">84
&lt;/span>&lt;span class="lnt">85
&lt;/span>&lt;span class="lnt">86
&lt;/span>&lt;span class="lnt">87
&lt;/span>&lt;span class="lnt">88
&lt;/span>&lt;span class="lnt">89
&lt;/span>&lt;span class="lnt">90
&lt;/span>&lt;span class="lnt">91
&lt;/span>&lt;span class="lnt">92
&lt;/span>&lt;span class="lnt">93
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="err">根目錄&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginx&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">html&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Port&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">8000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">html&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># cat /etc/nginx/nginx.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># For more information on configuration, see:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * Official English Documentation: http://nginx.org/en/docs/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * Official Russian Documentation: http://nginx.org/ru/docs/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">user&lt;/span> &lt;span class="n">nginx&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">worker_processes&lt;/span> &lt;span class="n">auto&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">error_log&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginx&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">error&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">log&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pid&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginx&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pid&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">include&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginx&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="o">/*.&lt;/span>&lt;span class="n">conf&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">events&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">worker_connections&lt;/span> &lt;span class="mi">1024&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">http&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log_format&lt;/span> &lt;span class="n">main&lt;/span> &lt;span class="s1">&amp;#39;$remote_addr - $remote_user [$time_local] &amp;#34;$request&amp;#34; &amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;$status $body_bytes_sent &amp;#34;$http_referer&amp;#34; &amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#34;$http_user_agent&amp;#34; &amp;#34;$http_x_forwarded_for&amp;#34;&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">access_log&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginx&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">access&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">log&lt;/span> &lt;span class="n">main&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sendfile&lt;/span> &lt;span class="n">on&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tcp_nopush&lt;/span> &lt;span class="n">on&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tcp_nodelay&lt;/span> &lt;span class="n">on&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">keepalive_timeout&lt;/span> &lt;span class="mi">65&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">types_hash_max_size&lt;/span> &lt;span class="mi">2048&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">include&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginx&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">types&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default_type&lt;/span> &lt;span class="n">application&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">octet&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">stream&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Load modular configuration files from the /etc/nginx/conf.d directory.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># See http://nginx.org/en/docs/ngx_core_module.html#include&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># for more information.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">include&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginx&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">conf&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="o">/*.&lt;/span>&lt;span class="n">conf&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">listen&lt;/span> &lt;span class="mi">8000&lt;/span> &lt;span class="n">default_server&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">listen&lt;/span> &lt;span class="p">[::]:&lt;/span>&lt;span class="mi">8000&lt;/span> &lt;span class="n">default_server&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server_name&lt;/span> &lt;span class="n">_&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">root&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginx&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">html&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Load configuration files for the default server block.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">include&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginx&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="o">/*.&lt;/span>&lt;span class="n">conf&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">location&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">error_page&lt;/span> &lt;span class="mi">404&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="mf">404.&lt;/span>&lt;span class="n">html&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">location&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="mi">40&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">html&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">error_page&lt;/span> &lt;span class="mi">500&lt;/span> &lt;span class="mi">502&lt;/span> &lt;span class="mi">503&lt;/span> &lt;span class="mi">504&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="mi">50&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">html&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">location&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="mi">50&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">html&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Settings for a TLS enabled server.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># server {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># listen 443 ssl http2 default_server;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># listen [::]:443 ssl http2 default_server;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># server_name _;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># root /usr/share/nginx/html;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ssl_certificate &amp;#34;/etc/pki/nginx/server.crt&amp;#34;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ssl_certificate_key &amp;#34;/etc/pki/nginx/private/server.key&amp;#34;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ssl_session_cache shared:SSL:1m;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ssl_session_timeout 10m;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ssl_ciphers PROFILE=SYSTEM;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ssl_prefer_server_ciphers on;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># # Load configuration files for the default server block.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># include /etc/nginx/default.d/*.conf;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># location / {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># }&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># error_page 404 /404.html;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># location = /40x.html {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># }&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># error_page 500 502 503 504 /50x.html;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># location = /50x.html {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># }&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># }&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="產生安裝檔案">產生安裝檔案
&lt;/h2>&lt;h3 id="確認-cli-tool">確認 cli tool
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ ls -l
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total 2232728
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x 8 wangken staff 256 12 13 15:36 .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-x---+ 41 wangken staff 1312 12 13 15:35 ..
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r--@ 1 wangken staff 706 10 8 18:41 README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rwxr-xr-x@ 2 wangken staff 98436592 10 6 20:06 kubectl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rwxr-xr-x@ 2 wangken staff 98436592 10 6 20:06 oc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r--@ 1 wangken staff 44116650 12 13 15:06 openshift-client-mac-4.11.9.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rwxr-xr-x@ 1 wangken staff 528956912 10 8 18:41 openshift-install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r--@ 1 wangken staff 363543317 12 13 15:07 openshift-install-mac-4.11.9.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ./oc version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Client Version: 4.11.9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Kustomize Version: v4.5.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ./openshift-install version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./openshift-install 4.11.9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">built from commit 01a6869a6f1208fb4d112060c5971432fdd619cf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">release image quay.io/openshift-release-dev/ocp-release@sha256:94b611f00f51c9acc44ca3f4634e46bd79d7d28b46047c7e3389d250698f0c99
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">release architecture amd64
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="產生ssh-key-bastion">產生SSH key (Bastion)
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@bastion .ssh]# cat id_rsa
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----BEGIN OPENSSH PRIVATE KEY-----
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">QyNTUxOQAAACDF/jswkiYiL+jXDMMUpwga7CGV79kXtcMnOpbzO5xOwQAAAKjY1yrT2Ncq
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">0wAAAAtzc2gtZWQyNTUxOQAAACDF/jswkiYiL+jXDMMUpwga7CGV79kXtcMnOpbzO5xOwQ
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">AAAEBIWOmAtlitDdZXhb+1vtMnSbNBRQfyANPR/eHUPuisK8X+OzCSJiIv6NcMwxSnCBrs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IZXv2Re1wyc6lvM7nE7BAAAAIWRldm9wQGJhc3Rpb24ub2NwLmluZm90ZWNoLmNvbS50dw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ECAwQ=
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----END OPENSSH PRIVATE KEY-----
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion .ssh]# cat id_rsa.pub
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIMX+OzCSJiIv6NcMwxSnCBrsIZXv2Re1wyc6lvM7nE7B devop@bastion.ocp.infotech.com.tw
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="建立install-configyaml">建立Install-config.yaml
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">baseDomain: infotech.com.tw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">compute:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- hyperthreading: Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">controlPlane:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hyperthreading: Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: ocp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">networking:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> clusterNetwork:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - cidr: 10.128.0.0/14
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hostPrefix: 23
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> networkType: OpenShiftSDN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> serviceNetwork:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 172.30.0.0/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">platform:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vsphere:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vcenter: tpeinfovcsa7p.infotech.com.tw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> username: cisadmin@vsphere.local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> password: P@55w.rd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> datacenter: TPECIS_Datacenter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> defaultDatastore: v7000_CIS01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> diskType: thin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">fips: false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pullSecret: &amp;#39;{&amp;#34;auths&amp;#34;:{&amp;#34;cloud.openshift.com&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K29jbV9hY2Nlc3NfMzEwNjVjNmVmMTk5NDZmNWEwNmUzZmI4MTVmNzk2OTE6NEJRVk1FVk9CTDRZQVRBT0pONEhQVkIyUExFQTdKNDE3WExFU1IzVDk3NU1YUTJXWE9FSjBNTVk0MzFQQk9RUA==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;},&amp;#34;quay.io&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K29jbV9hY2Nlc3NfMzEwNjVjNmVmMTk5NDZmNWEwNmUzZmI4MTVmNzk2OTE6NEJRVk1FVk9CTDRZQVRBT0pONEhQVkIyUExFQTdKNDE3WExFU1IzVDk3NU1YUTJXWE9FSjBNTVk0MzFQQk9RUA==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;},&amp;#34;registry.connect.redhat.com&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;fHVoYy1wb29sLTc5MzgwY2YyLTUxNTEtNGRiNi04YjA3LTRiNzQ4NDcxNWE2NDpleUpoYkdjaU9pSlNVelV4TWlKOS5leUp6ZFdJaU9pSmxOak5rWVdWbU1tSXlaRFEwTVdKaVlUTXpObVUwTkdGbVl6WmtPVEUwWVNKOS5RMlp6Q1JaWWltVDIxM2dpYU9CRWtNWEVkYUtjbnc4WHN1bTY3VEVOdjEyRjBjQUgyNWNZMVdWTjZNUEY2R21CNjh3TmF4TnoxRHVpVnBtY0ZKM2JZTW0yNVVzZGJxeFc4cEd1dGszSzF5NlNUWk9VejlkU0V4UGg4aUxha05qSEQ4Tml6emNmM1lUQjRNUXdhYTVFSG1PMXVTUERUZFRBTXFYS3FFa2gwRXpHOUpKZTlUMnM4bVJXWkVIbndoZW84cktncVZuV1VCeGhqTldFNElfWG1JZnBPRl91akpFNHdXNzRJWjd5UmdoUGExQVVwS3BsY0NJQ2ZGdGtaS29WUTFwNTBzUzNabkxWYjd6ZHdXR21WcXVsNUFoZUNiSHNoNEtpSjFnYXRSbkwtMG92THZoNGdseUZqd0c0Z3lMMEdyS1ItbU5WMFZYc01mVzJDNXNVaXBzVmhKcmhmY01vQjRNSDRDbjZKcjJXS2plbEdqSVdHQzBUV1BBNlZQZDBmc0lyLTRCY2RBdUFmcm5SaWpGM3d0Mng3RFdXQ1RScFVPbUVMY3U5bDR6Wm5uZkVSejNMd01rNmhCWTFyYXV1TGhCWXJraFlzQURqWEl3bGxPTkwyc01GMUU2OVNIVG1vV0tvNU5fdHdoWE5fX1BtT1ozMzc5ZVNDVGdnTFNZd3hyR1VwS3FXRDFva3JWZlRIWmNlcTk4WHQ2QjFtZHIxcmxLV2RiRmhsRDQ3Q1pldEhrNW1xQUlianp1UzlONENJWllhd0lIZE5LWVotN2tRNFQyUFg4QWdadHFNdHdjY2c0bWx3ME40c09LbWVZN2Q2bGw0bXpXV201bVo0aktTeHdpYmJ3STEwOFcxWVFlSlQ4QW9WZFlkc09YWkdWc3ZxZVVZOU9qbzR2RQ==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;},&amp;#34;registry.redhat.io&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;fHVoYy1wb29sLTc5MzgwY2YyLTUxNTEtNGRiNi04YjA3LTRiNzQ4NDcxNWE2NDpleUpoYkdjaU9pSlNVelV4TWlKOS5leUp6ZFdJaU9pSmxOak5rWVdWbU1tSXlaRFEwTVdKaVlUTXpObVUwTkdGbVl6WmtPVEUwWVNKOS5RMlp6Q1JaWWltVDIxM2dpYU9CRWtNWEVkYUtjbnc4WHN1bTY3VEVOdjEyRjBjQUgyNWNZMVdWTjZNUEY2R21CNjh3TmF4TnoxRHVpVnBtY0ZKM2JZTW0yNVVzZGJxeFc4cEd1dGszSzF5NlNUWk9VejlkU0V4UGg4aUxha05qSEQ4Tml6emNmM1lUQjRNUXdhYTVFSG1PMXVTUERUZFRBTXFYS3FFa2gwRXpHOUpKZTlUMnM4bVJXWkVIbndoZW84cktncVZuV1VCeGhqTldFNElfWG1JZnBPRl91akpFNHdXNzRJWjd5UmdoUGExQVVwS3BsY0NJQ2ZGdGtaS29WUTFwNTBzUzNabkxWYjd6ZHdXR21WcXVsNUFoZUNiSHNoNEtpSjFnYXRSbkwtMG92THZoNGdseUZqd0c0Z3lMMEdyS1ItbU5WMFZYc01mVzJDNXNVaXBzVmhKcmhmY01vQjRNSDRDbjZKcjJXS2plbEdqSVdHQzBUV1BBNlZQZDBmc0lyLTRCY2RBdUFmcm5SaWpGM3d0Mng3RFdXQ1RScFVPbUVMY3U5bDR6Wm5uZkVSejNMd01rNmhCWTFyYXV1TGhCWXJraFlzQURqWEl3bGxPTkwyc01GMUU2OVNIVG1vV0tvNU5fdHdoWE5fX1BtT1ozMzc5ZVNDVGdnTFNZd3hyR1VwS3FXRDFva3JWZlRIWmNlcTk4WHQ2QjFtZHIxcmxLV2RiRmhsRDQ3Q1pldEhrNW1xQUlianp1UzlONENJWllhd0lIZE5LWVotN2tRNFQyUFg4QWdadHFNdHdjY2c0bWx3ME40c09LbWVZN2Q2bGw0bXpXV201bVo0aktTeHdpYmJ3STEwOFcxWVFlSlQ4QW9WZFlkc09YWkdWc3ZxZVVZOU9qbzR2RQ==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;}}}&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sshKey: &amp;#39;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIMX+OzCSJiIv6NcMwxSnCBrsIZXv2Re1wyc6lvM7nE7B devop@bastion.ocp.infotech.com.tw&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">capabilities:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> baselineCapabilitySet: vCurrent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> platform:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vsphere:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vcenter: tpeinfovcsa7p.infotech.com.tw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> username: cisadmin@vsphere.local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> password: P@55w.rd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> datacenter: TPECIS_Datacenter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> defaultDatastore: v7000_CIS01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> diskType: thin
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="產生ignition-file">產生Ignition file
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">./openshift-install create manifests --dir install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./openshift-install create ignition-configs --dir install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Consuming Openshift Manifests from target directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Consuming Common Manifests from target directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Consuming Worker Machines from target directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Consuming Master Machines from target directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Consuming OpenShift Install (Manifests) from target directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Ignition-Configs created in: install and install/auth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cd install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total 2960
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x 9 wangken staff 288 12 13 16:27 .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x 11 wangken staff 352 12 13 15:56 ..
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- 1 wangken staff 67239 12 13 16:27 .openshift_install.log
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r----- 1 wangken staff 1154395 12 13 16:27 .openshift_install_state.json
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-x--- 4 wangken staff 128 12 13 16:27 auth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r----- 1 wangken staff 275583 12 13 16:27 bootstrap.ign
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r----- 1 wangken staff 1721 12 13 16:27 master.ign
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r----- 1 wangken staff 94 12 13 16:27 metadata.json
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r----- 1 wangken staff 1721 12 13 16:27 worker.ign
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="複製ignition-file-到web">複製Ignition File 到Web
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">scp *.ign root@192.168.3.37:/usr/share/nginx/html/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@192.168.3.37&amp;#39;s password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bootstrap.ign 100% 269KB 3.5MB/s 00:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master.ign 100% 1721 86.9KB/s 00:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker.ign 100% 1721 188.5KB/s 00:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat merge-bootstrap.ign
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;ignition&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;config&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;merge&amp;#34;: [
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;source&amp;#34;: &amp;#34;http://192.168.3.37:8000/bootstrap.ign&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;verification&amp;#34;: {}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;timeouts&amp;#34;: {},
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;version&amp;#34;: &amp;#34;3.2.0&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;networkd&amp;#34;: {},
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;passwd&amp;#34;: {},
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;storage&amp;#34;: {},
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;systemd&amp;#34;: {}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----轉檔為Base64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod 644 *.ign
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion html]# base64 -w0 merge-bootstrap.ign &amp;gt; merge-bootstrap.64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ewogICJpZ25pdGlvbiI6IHsKICAgICJjb25maWciOiB7CiAgICAgICJtZXJnZSI6IFsKICAgICAgICB7CiAgICAgICAgICAic291cmNlIjogImh0dHA6Ly8xOTIuMTY4LjMuMzc6ODAwMC9ib290c3RyYXAuaWduIiwKICAgICAgICAgICJ2ZXJpZmljYXRpb24iOiB7fQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgICJ0aW1lb3V0cyI6IHt9LAogICAgInZlcnNpb24iOiAiMy4yLjAiCiAgfSwKICAibmV0d29ya2QiOiB7fSwKICAicGFzc3dkIjoge30sCiAgInN0b3JhZ2UiOiB7fSwKICAic3lzdGVtZCI6IHt9Cn0K
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion html]# base64 -w0 master.ign &amp;gt; master.64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion html]# base64 -w0 worker.ign &amp;gt; worker.64
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="複製ovf至vm">複製OVF至VM
&lt;/h2>&lt;h3 id="調整參數">調整參數
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">vApp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1. base64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bootstrap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ewogICJpZ25pdGlvbiI6IHsKICAgICJjb25maWciOiB7CiAgICAgICJtZXJnZSI6IFsKICAgICAgICB7CiAgICAgICAgICAic291cmNlIjogImh0dHA6Ly8xOTIuMTY4LjMuMzc6ODAwMC9ib290c3RyYXAuaWduIiwKICAgICAgICAgICJ2ZXJpZmljYXRpb24iOiB7fQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgICJ0aW1lb3V0cyI6IHt9LAogICAgInZlcnNpb24iOiAiMy4yLjAiCiAgfSwKICAibmV0d29ya2QiOiB7fSwKICAicGFzc3dkIjoge30sCiAgInN0b3JhZ2UiOiB7fSwKICAic3lzdGVtZCI6IHt9Cn0K
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">eyJpZ25pdGlvbiI6eyJjb25maWciOnsibWVyZ2UiOlt7InNvdXJjZSI6Imh0dHBzOi8vYXBpLWludC5vY3AuaW5mb3RlY2guY29tLnR3OjIyNjIzL2NvbmZpZy9tYXN0ZXIifV19LCJzZWN1cml0eSI6eyJ0bHMiOnsiY2VydGlmaWNhdGVBdXRob3JpdGllcyI6W3sic291cmNlIjoiZGF0YTp0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTg7YmFzZTY0LExTMHRMUzFDUlVkSlRpQkRSVkpVU1VaSlEwRlVSUzB0TFMwdENrMUpTVVJGUkVORFFXWnBaMEYzU1VKQlowbEpXV1JoZUZwMFZXVkVha2wzUkZGWlNrdHZXa2xvZG1OT1FWRkZURUpSUVhkS2FrVlRUVUpCUjBFeFZVVUtRM2hOU21JelFteGliazV2WVZkYU1FMVNRWGRFWjFsRVZsRlJSRVYzWkhsaU1qa3dURmRPYUUxQ05GaEVWRWw1VFZSSmVFMTZRVFJPUkZVeFRteHZXQXBFVkUxNVRWUkplRTFFUVRST1JGVXhUbXh2ZDBwcVJWTk5Ra0ZIUVRGVlJVTjRUVXBpTTBKc1ltNU9iMkZYV2pCTlVrRjNSR2RaUkZaUlVVUkZkMlI1Q21JeU9UQk1WMDVvVFVsSlFrbHFRVTVDWjJ0eGFHdHBSemwzTUVKQlVVVkdRVUZQUTBGUk9FRk5TVWxDUTJkTFEwRlJSVUV6U0hWcVNHc3haaTlCWWxNS2FHcEdhemxtV0hOelZqZFJNVzlJUVRkVFNqQnVlVkpqTDJNMmR6aERPV1ZUV1dkTWNIWnJjSEZEY3pCdFR5dE9NMHRGTW5Kb2VTdDVVVUZyUVN0eEt3cE5TVkJXVURWRU9HRjFkM3BwWTFOUFZERm5WR2xTTmpreWFFVTFVVEUwYmtaS1N6bE5UMGRaWkdJeFJFTklNazlJYkZkMWRqRktlVlJvUW5admJuRXhDamw2VG01SldreG5iMWRUUm5SWGNtMVFhR05vY3pJeE5sVTVhREpDY0U1QmIwbzJXbU01TjBZM09UWnRLMFpLVlVKeGRFSnhVMVU1UW0xMmEwbHZSa3dLVFd0dE5HczVORk50UzFCRVpURnpPSEZGY0ZGM2FDdDVhbGRPV214aFkyeHRaMGRTTVdkRFptbGxPRGt3UjJ4dWRUazFSbWMwWjBORVFXMHpNRkZ4V2dvdk1tVkNXVEJ2ZW5kMFkyOTZVakZVVkU1cVpUSnpXaTlPZEhBMUwyRTBiR3RMYjNweGJXSnpURE13U25aaFNtbzVlVmh4T1VRelZtRnZVV2xIWkhWbENsQkpMMlJ6WkZsTWEzZEpSRUZSUVVKdk1FbDNVVVJCVDBKblRsWklVVGhDUVdZNFJVSkJUVU5CY1ZGM1JIZFpSRlpTTUZSQlVVZ3ZRa0ZWZDBGM1JVSUtMM3BCWkVKblRsWklVVFJGUm1kUlZXdEljR1IyVG5sUlVuZzFkVWhoTjJoWmJ6Tm9RM0Y2ZDJ4M1VYZEVVVmxLUzI5YVNXaDJZMDVCVVVWTVFsRkJSQXBuWjBWQ1FVbzVlRnBRTlRNeVZqWjBaa3RVVGxSVGFGTllWbEZVTlRCdmF6VkRUR3h1ZVVaNWRtRkNjV2huZEhwVlZsZGpPR2xGVTFocWFYbHJSRlZxQ2twallXcFZOSEZaU1ZkSmVGWlJNVmR3Um5GcFNqQlpkbTV4TXpOa2JFMUdORTg1U1VWT1owTXdkRGx3UjI1R1NGSlpLMUV6YjA5WVkzUXdWRlF2UkhVS1JuSnpXbFpoTTJsVE1rZDRaSGc1ZDFsV1pFbHVUVzV2V0VscFFrRlliMDlaTTBaNVYwRlROakJOV1RkMmVXTkhObXRLVFZWdVpUbDRVbGRyWjBsRFJBcDZOVXBXU0RSUE1FZ3pZVGxaTVhsSFowODBTVVpSVVN0c1JsZENiMmhOU2xrelpXaEpXR05oVDJORGJsWTNZV1pvUXpKcVVHbFpPRTFrZFdsWU9HRkRDblExUkdVM1psQjRUMmsxVWpSclZWQmtWRFYwYkhGeldHdEliWEJFU3lzM1ZVaFZLMk13ZFdGd1FVTjVObVUzU1U1U1dGbHViVkpMTlVadFJUSkZPVVFLUmxoc2NXdEtTM1JITVVoVU5rSXdZbnB5UzBsU05ucDVPVVJyUFFvdExTMHRMVVZPUkNCRFJWSlVTVVpKUTBGVVJTMHRMUzB0Q2c9PSJ9XX19LCJ2ZXJzaW9uIjoiMy4yLjAifX0=
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">eyJpZ25pdGlvbiI6eyJjb25maWciOnsibWVyZ2UiOlt7InNvdXJjZSI6Imh0dHBzOi8vYXBpLWludC5vY3AuaW5mb3RlY2guY29tLnR3OjIyNjIzL2NvbmZpZy93b3JrZXIifV19LCJzZWN1cml0eSI6eyJ0bHMiOnsiY2VydGlmaWNhdGVBdXRob3JpdGllcyI6W3sic291cmNlIjoiZGF0YTp0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTg7YmFzZTY0LExTMHRMUzFDUlVkSlRpQkRSVkpVU1VaSlEwRlVSUzB0TFMwdENrMUpTVVJGUkVORFFXWnBaMEYzU1VKQlowbEpXV1JoZUZwMFZXVkVha2wzUkZGWlNrdHZXa2xvZG1OT1FWRkZURUpSUVhkS2FrVlRUVUpCUjBFeFZVVUtRM2hOU21JelFteGliazV2WVZkYU1FMVNRWGRFWjFsRVZsRlJSRVYzWkhsaU1qa3dURmRPYUUxQ05GaEVWRWw1VFZSSmVFMTZRVFJPUkZVeFRteHZXQXBFVkUxNVRWUkplRTFFUVRST1JGVXhUbXh2ZDBwcVJWTk5Ra0ZIUVRGVlJVTjRUVXBpTTBKc1ltNU9iMkZYV2pCTlVrRjNSR2RaUkZaUlVVUkZkMlI1Q21JeU9UQk1WMDVvVFVsSlFrbHFRVTVDWjJ0eGFHdHBSemwzTUVKQlVVVkdRVUZQUTBGUk9FRk5TVWxDUTJkTFEwRlJSVUV6U0hWcVNHc3haaTlCWWxNS2FHcEdhemxtV0hOelZqZFJNVzlJUVRkVFNqQnVlVkpqTDJNMmR6aERPV1ZUV1dkTWNIWnJjSEZEY3pCdFR5dE9NMHRGTW5Kb2VTdDVVVUZyUVN0eEt3cE5TVkJXVURWRU9HRjFkM3BwWTFOUFZERm5WR2xTTmpreWFFVTFVVEUwYmtaS1N6bE5UMGRaWkdJeFJFTklNazlJYkZkMWRqRktlVlJvUW5admJuRXhDamw2VG01SldreG5iMWRUUm5SWGNtMVFhR05vY3pJeE5sVTVhREpDY0U1QmIwbzJXbU01TjBZM09UWnRLMFpLVlVKeGRFSnhVMVU1UW0xMmEwbHZSa3dLVFd0dE5HczVORk50UzFCRVpURnpPSEZGY0ZGM2FDdDVhbGRPV214aFkyeHRaMGRTTVdkRFptbGxPRGt3UjJ4dWRUazFSbWMwWjBORVFXMHpNRkZ4V2dvdk1tVkNXVEJ2ZW5kMFkyOTZVakZVVkU1cVpUSnpXaTlPZEhBMUwyRTBiR3RMYjNweGJXSnpURE13U25aaFNtbzVlVmh4T1VRelZtRnZVV2xIWkhWbENsQkpMMlJ6WkZsTWEzZEpSRUZSUVVKdk1FbDNVVVJCVDBKblRsWklVVGhDUVdZNFJVSkJUVU5CY1ZGM1JIZFpSRlpTTUZSQlVVZ3ZRa0ZWZDBGM1JVSUtMM3BCWkVKblRsWklVVFJGUm1kUlZXdEljR1IyVG5sUlVuZzFkVWhoTjJoWmJ6Tm9RM0Y2ZDJ4M1VYZEVVVmxLUzI5YVNXaDJZMDVCVVVWTVFsRkJSQXBuWjBWQ1FVbzVlRnBRTlRNeVZqWjBaa3RVVGxSVGFGTllWbEZVTlRCdmF6VkRUR3h1ZVVaNWRtRkNjV2huZEhwVlZsZGpPR2xGVTFocWFYbHJSRlZxQ2twallXcFZOSEZaU1ZkSmVGWlJNVmR3Um5GcFNqQlpkbTV4TXpOa2JFMUdORTg1U1VWT1owTXdkRGx3UjI1R1NGSlpLMUV6YjA5WVkzUXdWRlF2UkhVS1JuSnpXbFpoTTJsVE1rZDRaSGc1ZDFsV1pFbHVUVzV2V0VscFFrRlliMDlaTTBaNVYwRlROakJOV1RkMmVXTkhObXRLVFZWdVpUbDRVbGRyWjBsRFJBcDZOVXBXU0RSUE1FZ3pZVGxaTVhsSFowODBTVVpSVVN0c1JsZENiMmhOU2xrelpXaEpXR05oVDJORGJsWTNZV1pvUXpKcVVHbFpPRTFrZFdsWU9HRkRDblExUkdVM1psQjRUMmsxVWpSclZWQmtWRFYwYkhGeldHdEliWEJFU3lzM1ZVaFZLMk13ZFdGd1FVTjVObVUzU1U1U1dGbHViVkpMTlVadFJUSkZPVVFLUmxoc2NXdEtTM1JITVVoVU5rSXdZbnB5UzBsU05ucDVPVVJyUFFvdExTMHRMVVZPUkNCRFJWSlVTVVpKUTBGVVJTMHRMUzB0Q2c9PSJ9XX19LCJ2ZXJzaW9uIjoiMy4yLjAifX0=
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="設定ip">設定IP
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">guestinfo.afterburn.initrd.network-kargs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip=192.168.3.36::192.168.3.251:255.255.255.0:::none nameserver=192.168.3.37
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip=192.168.3.31::192.168.3.251:255.255.255.0:::none nameserver=192.168.3.37
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip=192.168.3.32::192.168.3.251:255.255.255.0:::none nameserver=192.168.3.37
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip=192.168.3.33::192.168.3.251:255.255.255.0:::none nameserver=192.168.3.37
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip=192.168.3.34::192.168.3.251:255.255.255.0:::none nameserver=192.168.3.37
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip=192.168.3.35::192.168.3.251:255.255.255.0:::none nameserver=192.168.3.37
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="先啟動bootstrap">先啟動bootstrap
&lt;/h2>&lt;h2 id="再啟動master">再啟動Master
&lt;/h2>&lt;h2 id="啟動worker後-approve-csr">啟動Worker後 Approve CSR
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$oc adm certificate approve &amp;lt;csr_name&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$oc get csr -o go-template=&amp;#39;{{range .items}}{{if not .status}}{{.metadata.name}}{{&amp;#34;\n&amp;#34;}}{{end}}{{end}}&amp;#39; | xargs --no-run-if-empty oc adm certificate approve
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="storage-class">Storage Class
&lt;/h2>&lt;p>&lt;a class="link" href="https://access.redhat.com/solutions/4618011" target="_blank" rel="noopener"
>https://access.redhat.com/solutions/4618011&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://access.redhat.com/solutions/5900501" target="_blank" rel="noopener"
>https://access.redhat.com/solutions/5900501&lt;/a>
&lt;a class="link" href="https://www.ibm.com/support/pages/creating-persistent-volume-claim-fails-not-found-openshift" target="_blank" rel="noopener"
>https://www.ibm.com/support/pages/creating-persistent-volume-claim-fails-not-found-openshift&lt;/a>
&lt;a class="link" href="https://docs.openshift.com/container-platform/4.9/storage/persistent_storage/persistent-storage-vsphere.html" target="_blank" rel="noopener"
>https://docs.openshift.com/container-platform/4.9/storage/persistent_storage/persistent-storage-vsphere.html&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/rancher/rancher/issues/24258" target="_blank" rel="noopener"
>https://github.com/rancher/rancher/issues/24258&lt;/a>&lt;/p>
&lt;p>on vmware vsphere&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221214141836955.png"
loading="lazy"
alt="image-20221214141836955"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc get machineset ocp-7hb6g-worker -n openshift-machine-api -o yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: machine.openshift.io/v1beta1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: MachineSet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> annotations:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machine.openshift.io/memoryMb: &amp;#34;16384&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machine.openshift.io/vCPU: &amp;#34;4&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> creationTimestamp: &amp;#34;2022-12-13T09:05:14Z&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> generation: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> labels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machine.openshift.io/cluster-api-cluster: ocp-7hb6g
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: ocp-7hb6g-worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespace: openshift-machine-api
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resourceVersion: &amp;#34;12244&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> uid: e52a023d-bc9f-4fb5-a66a-776768e1aa7c
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> selector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> matchLabels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machine.openshift.io/cluster-api-cluster: ocp-7hb6g
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machine.openshift.io/cluster-api-machineset: ocp-7hb6g-worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> template:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> labels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machine.openshift.io/cluster-api-cluster: ocp-7hb6g
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machine.openshift.io/cluster-api-machine-role: worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machine.openshift.io/cluster-api-machine-type: worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machine.openshift.io/cluster-api-machineset: ocp-7hb6g-worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> lifecycleHooks: {}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> metadata: {}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> providerSpec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> apiVersion: machine.openshift.io/v1beta1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> credentialsSecret:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: vsphere-cloud-credentials
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> diskGiB: 120
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kind: VSphereMachineProviderSpec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> memoryMiB: 16384
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> creationTimestamp: null
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> devices:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - networkName: &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> numCPUs: 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> numCoresPerSocket: 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> snapshot: &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> template: ocp-7hb6g-rhcos
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> userDataSecret:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: worker-user-data
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> workspace:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> datacenter: TPECIS_Datacenter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> datastore: v7000_CIS01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> folder: /TPECIS_Datacenter/vm/ocp-7hb6g
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resourcePool: /TPECIS_Datacenter/host//Resources
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server: tpeinfovcsa7p.infotech.com.tw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">status:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> observedGeneration: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc get cm cloud-provider-config -n openshift-config -o yaml | grep folder
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> folder = &amp;#34;/TPECIS_Datacenter/vm/ocp-7hb6g&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221214151017424.png"
loading="lazy"
alt="image-20221214151017424"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221214151029390.png"
loading="lazy"
alt="image-20221214151029390"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221214151038817.png"
loading="lazy"
alt="image-20221214151038817"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221214151215733.png"
loading="lazy"
alt="image-20221214151215733"
>&lt;/p></description></item><item><title>OCP-4.11.7_on_Bare-metal</title><link>https://wangken0129.github.io/p/ocp-4.11.7_on_bare-metal/</link><pubDate>Sat, 23 Sep 2023 08:18:45 +0800</pubDate><guid>https://wangken0129.github.io/p/ocp-4.11.7_on_bare-metal/</guid><description>&lt;h1 id="install-openshift-v4117-on-bare-metal">Install Openshift v4.11.7 on Bare-metal
&lt;/h1>&lt;p>Ken Wang 2022/10/03&lt;/p>
&lt;p>Ken Wang 2022/11/23 v4.11.9&lt;/p>
&lt;h2 id="參考連結">參考連結
&lt;/h2>&lt;p>&lt;a class="link" href="https://docs.openshift.com/container-platform/4.11/welcome/index.html" target="_blank" rel="noopener"
>https://docs.openshift.com/container-platform/4.11/welcome/index.html&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.11/html/installing/installing-on-bare-metal#installing-bare-metal" target="_blank" rel="noopener"
>https://access.redhat.com/documentation/en-us/openshift_container_platform/4.11/html/installing/installing-on-bare-metal#installing-bare-metal&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://docs.openshift.com/container-platform/4.11/installing/installing_bare_metal/installing-bare-metal.html#installing-bare-metal" target="_blank" rel="noopener"
>https://docs.openshift.com/container-platform/4.11/installing/installing_bare_metal/installing-bare-metal.html#installing-bare-metal&lt;/a>&lt;/p>
&lt;p>CoreOS:
&lt;a class="link" href="https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.11/4.11.2/" target="_blank" rel="noopener"
>https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.11/4.11.2/&lt;/a>
&lt;a class="link" href="https://mirror.openshift.com/pub/openshift-v4/x86_64/dependencies/rhcos/4.11/4.11.9/rhcos-4.11.9-x86_64-live.x86_64.iso" target="_blank" rel="noopener"
>https://mirror.openshift.com/pub/openshift-v4/x86_64/dependencies/rhcos/4.11/4.11.9/rhcos-4.11.9-x86_64-live.x86_64.iso&lt;/a>&lt;/p>
&lt;p>OC Client:
&lt;a class="link" href="https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.11.9/openshift-client-linux.tar.gz" target="_blank" rel="noopener"
>https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.11.9/openshift-client-linux.tar.gz&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://docs.openshift.com/container-platform/4.11/post_installation_configuration/index.html" target="_blank" rel="noopener"
>https://docs.openshift.com/container-platform/4.11/post_installation_configuration/index.html&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/I8C/installing-openshift-on-single-vmware-esxi-host/blob/master/installBastion.sh" target="_blank" rel="noopener"
>https://github.com/I8C/installing-openshift-on-single-vmware-esxi-host/blob/master/installBastion.sh&lt;/a>&lt;/p>
&lt;p>僅供參考 &lt;a class="link" href="https://github.com/alanadiprastyo/openshift-4.6" target="_blank" rel="noopener"
>https://github.com/alanadiprastyo/openshift-4.6&lt;/a>&lt;/p>
&lt;p>automated&lt;/p>
&lt;p>&lt;a class="link" href="https://cloud.redhat.com/blog/fully-automated-openshift-deployments-with-vmware-vsphere" target="_blank" rel="noopener"
>https://cloud.redhat.com/blog/fully-automated-openshift-deployments-with-vmware-vsphere&lt;/a>&lt;/p>
&lt;h2 id="架構">架構
&lt;/h2>&lt;p>針對各版本的coreOS、Openshift-install 都要更新&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: left">主機名稱&lt;/th>
&lt;th>IP&lt;/th>
&lt;th>Mac&lt;/th>
&lt;th>版本&lt;/th>
&lt;th>功能&lt;/th>
&lt;th>磁碟空間&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: left">bastion.ken.lab&lt;/td>
&lt;td>192.168.33.21&lt;/td>
&lt;td>00:50:56:91:7c:24&lt;/td>
&lt;td>RHEL 9.0&lt;/td>
&lt;td>management&lt;/td>
&lt;td>100G、200G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">bootstrap.ocp.ken.lab&lt;/td>
&lt;td>192.168.33.22&lt;/td>
&lt;td>00:50:56:91:47:e9&lt;/td>
&lt;td>core 4.11-2&lt;/td>
&lt;td>bootstrap&lt;/td>
&lt;td>100G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">master1.ocp.ken.lab&lt;/td>
&lt;td>192.168.33.23&lt;/td>
&lt;td>00:50:56:91:88:f4&lt;/td>
&lt;td>core 4.11-2&lt;/td>
&lt;td>master&lt;/td>
&lt;td>100G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">master2.ocp.ken.lab&lt;/td>
&lt;td>192.168.33.24&lt;/td>
&lt;td>00:50:56:91:27:ed&lt;/td>
&lt;td>core 4.11-2&lt;/td>
&lt;td>master&lt;/td>
&lt;td>100G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">master3.ocp.ken.lab&lt;/td>
&lt;td>192.168.33.25&lt;/td>
&lt;td>00:50:56:91:08:33&lt;/td>
&lt;td>core 4.11-2&lt;/td>
&lt;td>master&lt;/td>
&lt;td>100G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">worker1.ocp.ken.lab&lt;/td>
&lt;td>192.168.33.26&lt;/td>
&lt;td>00:50:56:91:c6:29&lt;/td>
&lt;td>core 4.11-2&lt;/td>
&lt;td>worker&lt;/td>
&lt;td>100G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">worker2.ocp.ken.lab&lt;/td>
&lt;td>192.168.33.27&lt;/td>
&lt;td>00:50:56:91:d7:b4&lt;/td>
&lt;td>core 4.11-2&lt;/td>
&lt;td>worker&lt;/td>
&lt;td>100G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">infra1.ocp.ken.lab&lt;/td>
&lt;td>192.168.33.31&lt;/td>
&lt;td>00:50:56:91:14:ab&lt;/td>
&lt;td>core 4.11-2&lt;/td>
&lt;td>infra node&lt;/td>
&lt;td>100G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">infra2.ocp.ken.lab&lt;/td>
&lt;td>192.168.33.32&lt;/td>
&lt;td>00:50:56:91:0a:53&lt;/td>
&lt;td>core 4.11-2&lt;/td>
&lt;td>infra node&lt;/td>
&lt;td>100G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">infra3.ocp.ken.lab&lt;/td>
&lt;td>192.168.33.33&lt;/td>
&lt;td>00:50:56:91:78:05&lt;/td>
&lt;td>core 4.11-2&lt;/td>
&lt;td>infra node&lt;/td>
&lt;td>100G&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>主機名稱&lt;/th>
&lt;th>使用者帳密&lt;/th>
&lt;th>安裝目錄&lt;/th>
&lt;th>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>bastion.ken.lab&lt;/td>
&lt;td>devop / redhat&lt;/td>
&lt;td>/home/devop/ocp&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="安裝bastion">安裝Bastion
&lt;/h2>&lt;h3 id="安裝rhel-90--on-esxi">安裝RHEL 9.0 on ESXi
&lt;/h3>&lt;p>&lt;a class="link" href="https://kb.vmware.com/s/article/57122" target="_blank" rel="noopener"
>https://kb.vmware.com/s/article/57122&lt;/a>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>用iso 檔開機進入安裝引導畫面
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221003152533576.png"
loading="lazy"
alt="image-20221003152533576"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>設定磁碟、註冊、安裝軟體&lt;/p>
&lt;ul>
&lt;li>磁碟配置
/ &amp;raquo; 65GiB
/home &amp;raquo; 29GiB
/boot &amp;raquo; 500MiB
/boot/efi &amp;raquo; 1GiB&lt;/li>
&lt;li>軟體安裝 使用GUI畫面
Server With GUI&lt;/li>
&lt;li>註冊
&lt;a class="link" href="mailto:ken.wang@infotech.com.tw" >ken.wang@infotech.com.tw&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>開始安裝，安裝完畢後進入OS
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221003153827189.png"
loading="lazy"
alt="image-20221003153827189"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>設定sudo&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@bastion ~]# echo &amp;#34;devop ALL=(ALL) ALL&amp;#34; &amp;gt;&amp;gt; /etc/sudoers.d/devop
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="設定-ssh-key">設定 SSH Key
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>產生ssh keygen &amp;ndash; devop user
用來登入各節點使用&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ ssh-keygen -t ed25519 -N &amp;#39;&amp;#39; -f ~/.ssh/id_ed25519
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Generating public/private ed25519 key pair.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Created directory &amp;#39;/home/devop/.ssh&amp;#39;.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Your identification has been saved in /home/devop/.ssh/id_ed25519
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Your public key has been saved in /home/devop/.ssh/id_ed25519.pub
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The key fingerprint is:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SHA256:G91wVoISB5qA881zCUi71a2hHj2Y+3zPD6RJQW5+edM devop@bastion.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The key&amp;#39;s randomart image is:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+--[ED25519 256]--+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| oo. ooo.. . |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| o .o.+.=. o |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| o.o+.oo* o |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| .o+=o* * . . |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| . =oS + = o E|
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| . o = = . . |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| o . o . |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| o .. . |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| o. .o.. |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+----[SHA256]-----+
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>查看public key &amp;raquo; 之後會寫入install-config.yaml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ cat .ssh/id_ed25519.pub
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIN1Z2jXmGnPWGAVrtltN9A2q5D8QtJlRvhvdB2QXoZG devop@bastion.ocp.ken.lab
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>加入私密金鑰到ssh agent&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ ssh-add .ssh/id_ed25519
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Identity added: .ssh/id_ed25519 (devop@bastion.ocp.ken.lab)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;hr>
&lt;/li>
&lt;/ol>
&lt;h3 id="安裝oc-cli">安裝OC CLI
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>從此處下載OC Client
&lt;a class="link" href="https://access.redhat.com/downloads/content/290/ver=4.11/rhel---8/4.11.7/x86_64/product-software" target="_blank" rel="noopener"
>https://access.redhat.com/downloads/content/290/ver=4.11/rhel---8/4.11.7/x86_64/product-software&lt;/a>
&lt;a class="link" href="https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.11.9/openshift-client-linux.tar.gz" target="_blank" rel="noopener"
>https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.11.9/openshift-client-linux.tar.gz&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>安裝OC Client&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion oc]$ pwd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/home/devop/oc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion oc]$ tar xvzf oc-4.11.7-linux.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">oc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion oc]$ sudo cp oc kubectl /usr/local/bin/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[sudo] password for devop:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion oc]$ oc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OpenShift Client
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">This client helps you develop, build, deploy, and run your applications on any
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OpenShift or Kubernetes cluster. It also includes the administrative
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>啟用 tab 自動完成功能&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc completion bash &amp;gt; oc_bash_completion
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ sudo cp oc_bash_completion /etc/bash_completion.d/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[sudo] password for devop:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## 重新啟動terminal
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;hr>
&lt;/li>
&lt;/ol>
&lt;h3 id="安裝dhcp-server-optional">安裝DHCP Server (optional)
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>安裝dhcpd&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@bastion ~]# yum install dhcp-server
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>修改dhcpd設定檔 /etc/dhcp/dhcpd.conf&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@bastion dhcp]# cat dhcpd.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># DHCP Server Configuration file.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># see /usr/share/doc/dhcp-server/dhcpd.conf.example
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># see dhcpd.conf(5) man page
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># dhcpd.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 2022.10.11 ken wang
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">default-lease-time 600;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">max-lease-time 7200;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">option broadcast-address 192.168.33.255;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">subnet 192.168.33.0 netmask 255.255.255.0 {}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## gateway
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">option routers 192.168.33.251;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">option domain-name &amp;#34;ocp.ken.lab&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">option domain-name-servers 192.168.33.21, 168.95.1.1;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Use this to send dhcp log messages to a different log file (you also
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># have to hack syslog.conf to complete the redirection).
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">log-facility local7;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># range 192.168.33.22 192.168.33.40;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host bootstrap {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hardware ethernet 00:50:56:91:47:e9;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fixed-address 192.168.33.22;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host master1 {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hardware ethernet 00:50:56:91:88:f4;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fixed-address 192.168.33.23;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host master2 {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hardware ethernet 00:50:56:91:27:ed;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fixed-address 192.168.33.24;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host master3 {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hardware ethernet 00:50:56:91:08:33;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fixed-address 192.168.33.25;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host worker1 {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hardware ethernet 00:50:56:91:c6:29;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fixed-address 192.168.33.26;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host worker2 {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hardware ethernet 00:50:56:91:d7:b4;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fixed-address 192.168.33.27;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host infra1 {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hardware ethernet 00:50:56:91:14:ab;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fixed-address 192.168.33.31;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host infra2 {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hardware ethernet 00:50:56:91:0a:53;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fixed-address 192.168.33.32;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host infra3 {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hardware ethernet 00:50:56:91:78:05;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fixed-address 192.168.33.33;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>啟動dhcp-server測試&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">dhcp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># systemctl status dhcpd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">●&lt;/span> &lt;span class="n">dhcpd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">DHCPv4&lt;/span> &lt;span class="n">Server&lt;/span> &lt;span class="n">Daemon&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Loaded&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">loaded&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">systemd&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">system&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dhcpd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">disabled&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">vendor&lt;/span> &lt;span class="n">preset&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">disabled&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Active&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">active&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">running&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">since&lt;/span> &lt;span class="n">Tue&lt;/span> &lt;span class="mi">2022&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">11&lt;/span> &lt;span class="mi">11&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">07&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">02&lt;/span> &lt;span class="n">CST&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="n">s&lt;/span> &lt;span class="n">ago&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="安裝dns-server-named">安裝DNS Server (named)
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>安裝named&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@bastion dhcp]# yum install bind bind-libs bind-chroot bind-utils
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>修改named 設定檔 /etc/named.conf&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># cat /etc/named.conf &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span> &lt;span class="n">named&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span> &lt;span class="n">Provided&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="n">Red&lt;/span> &lt;span class="n">Hat&lt;/span> &lt;span class="n">bind&lt;/span> &lt;span class="n">package&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">configure&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">ISC&lt;/span> &lt;span class="n">BIND&lt;/span> &lt;span class="n">named&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">DNS&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span> &lt;span class="n">server&lt;/span> &lt;span class="n">as&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">caching&lt;/span> &lt;span class="n">only&lt;/span> &lt;span class="n">nameserver&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">as&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">localhost&lt;/span> &lt;span class="n">DNS&lt;/span> &lt;span class="n">resolver&lt;/span> &lt;span class="n">only&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span> &lt;span class="n">See&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">doc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bind&lt;/span>&lt;span class="o">*/&lt;/span>&lt;span class="n">sample&lt;/span>&lt;span class="o">/&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">example&lt;/span> &lt;span class="n">named&lt;/span> &lt;span class="n">configuration&lt;/span> &lt;span class="n">files&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">options&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">listen&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">on&lt;/span> &lt;span class="n">port&lt;/span> &lt;span class="mi">53&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">33.21&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span>&lt;span class="n">listen&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">on&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">v6&lt;/span> &lt;span class="n">port&lt;/span> &lt;span class="mi">53&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="p">::&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">directory&lt;/span> &lt;span class="s2">&amp;#34;/var/named&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dump&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">file&lt;/span> &lt;span class="s2">&amp;#34;/var/named/data/cache_dump.db&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">statistics&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">file&lt;/span> &lt;span class="s2">&amp;#34;/var/named/data/named_stats.txt&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">memstatistics&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">file&lt;/span> &lt;span class="s2">&amp;#34;/var/named/data/named_mem_stats.txt&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">secroots&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">file&lt;/span> &lt;span class="s2">&amp;#34;/var/named/data/named.secroots&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">recursing&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">file&lt;/span> &lt;span class="s2">&amp;#34;/var/named/data/named.recursing&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">allow&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">query&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">any&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">## 設定轉寄站&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">forwarders&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.12&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.11&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">/*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">If&lt;/span> &lt;span class="n">you&lt;/span> &lt;span class="n">are&lt;/span> &lt;span class="n">building&lt;/span> &lt;span class="n">an&lt;/span> &lt;span class="n">AUTHORITATIVE&lt;/span> &lt;span class="n">DNS&lt;/span> &lt;span class="n">server&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="n">NOT&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">recursion&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">If&lt;/span> &lt;span class="n">you&lt;/span> &lt;span class="n">are&lt;/span> &lt;span class="n">building&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">RECURSIVE&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">caching&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">DNS&lt;/span> &lt;span class="n">server&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">you&lt;/span> &lt;span class="n">need&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">recursion&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">If&lt;/span> &lt;span class="n">your&lt;/span> &lt;span class="n">recursive&lt;/span> &lt;span class="n">DNS&lt;/span> &lt;span class="n">server&lt;/span> &lt;span class="n">has&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">public&lt;/span> &lt;span class="ne">IP&lt;/span> &lt;span class="n">address&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">you&lt;/span> &lt;span class="n">MUST&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">access&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">control&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">limit&lt;/span> &lt;span class="n">queries&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">your&lt;/span> &lt;span class="n">legitimate&lt;/span> &lt;span class="n">users&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Failing&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="n">so&lt;/span> &lt;span class="n">will&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cause&lt;/span> &lt;span class="n">your&lt;/span> &lt;span class="n">server&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">become&lt;/span> &lt;span class="n">part&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">large&lt;/span> &lt;span class="n">scale&lt;/span> &lt;span class="n">DNS&lt;/span> &lt;span class="n">amplification&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">attacks&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Implementing&lt;/span> &lt;span class="n">BCP38&lt;/span> &lt;span class="n">within&lt;/span> &lt;span class="n">your&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="n">would&lt;/span> &lt;span class="n">greatly&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reduce&lt;/span> &lt;span class="n">such&lt;/span> &lt;span class="n">attack&lt;/span> &lt;span class="n">surface&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">recursion&lt;/span> &lt;span class="n">yes&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dnssec&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">validation&lt;/span> &lt;span class="n">yes&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dnssec&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">enable&lt;/span> &lt;span class="n">yes&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">managed&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">keys&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">directory&lt;/span> &lt;span class="s2">&amp;#34;/var/named/dynamic&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">geoip&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">directory&lt;/span> &lt;span class="s2">&amp;#34;/usr/share/GeoIP&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pid&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">file&lt;/span> &lt;span class="s2">&amp;#34;/run/named/named.pid&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">session&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">keyfile&lt;/span> &lt;span class="s2">&amp;#34;/run/named/session.key&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">/*&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">fedoraproject&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">wiki&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Changes&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">CryptoPolicy&lt;/span> &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">include&lt;/span> &lt;span class="s2">&amp;#34;/etc/crypto-policies/back-ends/bind.config&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">logging&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">channel&lt;/span> &lt;span class="n">default_debug&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span> &lt;span class="s2">&amp;#34;data/named.run&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">severity&lt;/span> &lt;span class="n">dynamic&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">zone&lt;/span> &lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span> &lt;span class="n">IN&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span> &lt;span class="n">hint&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span> &lt;span class="s2">&amp;#34;named.ca&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">include&lt;/span> &lt;span class="s2">&amp;#34;/etc/named.rfc1912.zones&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">include&lt;/span> &lt;span class="s2">&amp;#34;/etc/named.root.key&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">zone&lt;/span> &lt;span class="s2">&amp;#34;ocp.ken.lab.&amp;#34;&lt;/span> &lt;span class="n">IN&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span> &lt;span class="n">master&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span> &lt;span class="s2">&amp;#34;ken.zone&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">allow&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">update&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">none&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">allow&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">query&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">any&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">allow&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">transfer&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">none&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">zone&lt;/span> &lt;span class="s2">&amp;#34;33.168.192.in-addr.arpa&amp;#34;&lt;/span> &lt;span class="n">IN&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span> &lt;span class="n">master&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span> &lt;span class="s2">&amp;#34;ken.reverse&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">allow&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">update&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">none&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">allow&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">query&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">any&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">allow&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">transfer&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">none&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>修改正向解析 /var/named/ken.zone&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-dns" data-lang="dns">&lt;span class="line">&lt;span class="cl">&lt;span class="err">[root@bastion&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">named]#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">cat&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nc">ken.zone&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="na">$TTL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">1&lt;/span>&lt;span class="err">W&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">@&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SOA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">bastion.ken.lab. &lt;/span>&lt;span class="err">root&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">2019070700&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; serial&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">3&lt;/span>&lt;span class="err">H&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; refresh (3 hours)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">30&lt;/span>&lt;span class="err">M&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; retry (30 minutes)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">2&lt;/span>&lt;span class="err">W&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; expiry (2 weeks)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">1&lt;/span>&lt;span class="err">W&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; minimum (1 week)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">bastion.ken.lab.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">bastion.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.21&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">helper.ken.lab. &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.21&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">helper.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.21&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">api.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.21&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">api-int.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.21&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">*&lt;/span>&lt;span class="nc">.apps.ocp.ken.lab.&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.21&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">bootstrap.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.22&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">master1.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.23&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">master2.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.24&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">master3.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.25&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">worker1.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.26&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">worker2.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.27&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">infra1.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.31&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">infra2.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.32&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">infra3.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.33&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;EOF&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>修改反解析 /var/named/ken.reverse&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-dns" data-lang="dns">&lt;span class="line">&lt;span class="cl">&lt;span class="err">[root@bastion&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">named]#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">cat&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nc">ken.reverse&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="na">$TTL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">10&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">@&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SOA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">bastion.ken.lab. &lt;/span>&lt;span class="err">root&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">2019070700&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; serial&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">3&lt;/span>&lt;span class="err">H&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; refresh (3 hours)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">30&lt;/span>&lt;span class="err">M&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; retry (30 minutes)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">2&lt;/span>&lt;span class="err">W&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; expiry (2 weeks)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">1&lt;/span>&lt;span class="err">W&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; minimum (1 week)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">bastion.ken.lab.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">21.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">bastion.ocp.ken.lab. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">21.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">api.ocp.ken.lab. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">21.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">api-int.ocp.ken.lab. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">22.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">bootstrap.ocp.ken.lab. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">23.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">master1.ocp.ken.lab. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">24.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">master2.ocp.ken.lab. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">25.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">master3.ocp.ken.lab. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">26.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">worker1.ocp.ken.lab. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">27.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">worker2.ocp.ken.lab. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">31.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">infra1.ocp.ken.lab. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">32.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">infra2.ocp.ken.lab.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">33.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">infra3.ocp.ken.lab.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;EOF&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>調整防火牆&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-service=dns --permanent&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --reload&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>啟動服務&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@bastion ~]# systemctl enable named --now
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>驗證DNS&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">##測試api
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion ~]# dig +noall +answer @192.168.33.21 api.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">api.ocp.ken.lab. 604800 IN A 192.168.33.21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion ~]# nslookup 192.168.33.21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">21.33.168.192.in-addr.arpa name = api.ocp.ken.lab.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">21.33.168.192.in-addr.arpa name = bastion.ocp.ken.lab.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">21.33.168.192.in-addr.arpa name = api-int.ocp.ken.lab.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## 測試 wild card
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion ~]# dig +noall +answer @192.168.33.21 random.apps.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">random.apps.ocp.ken.lab. 604800 IN A 192.168.33.21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">##測試反解析
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion ~]# dig +noall +answer @192.168.33.21 -x 192.168.33.21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">21.33.168.192.in-addr.arpa. 10 IN PTR api.ocp.ken.lab.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">21.33.168.192.in-addr.arpa. 10 IN PTR api-int.ocp.ken.lab.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">21.33.168.192.in-addr.arpa. 10 IN PTR bastion.ocp.ken.lab.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="安裝ha-proxy">安裝HA Proxy
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>安裝haproxy&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@bastion ~]# yum install haproxy -y
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>設定HAProxy&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="err">將文件上的設定檔複製貼上，再用&lt;/span>&lt;span class="n">sed&lt;/span> &lt;span class="err">指令修改&lt;/span>&lt;span class="n">domain&lt;/span> &lt;span class="n">name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">haproxy&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># sed -i &amp;#34;s/ocp4.example.com/ocp.ken.lab/g&amp;#34; /etc/haproxy/haproxy.cfg&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># cat /etc/haproxy/haproxy.cfg&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">global&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">log&lt;/span> &lt;span class="mf">127.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.1&lt;/span> &lt;span class="n">local2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pidfile&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">haproxy&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pid&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">maxconn&lt;/span> &lt;span class="mi">4000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">daemon&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">defaults&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">http&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">log&lt;/span> &lt;span class="n">global&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">dontlognull&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">close&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">redispatch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">retries&lt;/span> &lt;span class="mi">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">request&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">queue&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">m&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">connect&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">client&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">m&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">server&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">m&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">keep&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">alive&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">maxconn&lt;/span> &lt;span class="mi">3000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">frontend&lt;/span> &lt;span class="n">stats&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bind&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">1936&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">http&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">log&lt;/span> &lt;span class="n">global&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">maxconn&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">hide&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">version&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">refresh&lt;/span> &lt;span class="mi">30&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">show&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">node&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">show&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">desc&lt;/span> &lt;span class="n">Stats&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">ocp4&lt;/span> &lt;span class="n">cluster&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">auth&lt;/span> &lt;span class="n">admin&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">ocp4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">uri&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">stats&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">listen&lt;/span> &lt;span class="n">api&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">6443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bind&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">tcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">bootstrap&lt;/span> &lt;span class="n">bootstrap&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span> &lt;span class="n">backup&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master1&lt;/span> &lt;span class="n">master1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master2&lt;/span> &lt;span class="n">master3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master3&lt;/span> &lt;span class="n">master3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">listen&lt;/span> &lt;span class="n">machine&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">22623&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bind&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22623&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">tcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">bootstrap&lt;/span> &lt;span class="n">bootstrap&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22623&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span> &lt;span class="n">backup&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master1&lt;/span> &lt;span class="n">master1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22623&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master2&lt;/span> &lt;span class="n">master2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22623&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master3&lt;/span> &lt;span class="n">master3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22623&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">listen&lt;/span> &lt;span class="n">ingress&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">router&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bind&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">tcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">balance&lt;/span> &lt;span class="n">source&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">worker1&lt;/span> &lt;span class="n">worker1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">worker2&lt;/span> &lt;span class="n">worker2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">infra1&lt;/span> &lt;span class="n">infra1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">infra2&lt;/span> &lt;span class="n">infra2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">infra3&lt;/span> &lt;span class="n">infra3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">listen&lt;/span> &lt;span class="n">ingress&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">router&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">80&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bind&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">80&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">tcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">balance&lt;/span> &lt;span class="n">source&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">worker1&lt;/span> &lt;span class="n">worker1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">80&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">worker2&lt;/span> &lt;span class="n">worker2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">80&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">infra1&lt;/span> &lt;span class="n">infra1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">80&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">infra2&lt;/span> &lt;span class="n">infra2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">80&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">infra3&lt;/span> &lt;span class="n">infra3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">80&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>防火牆開通、SELinux設定&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=80/tcp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=443/tcp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=6443/tcp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=1936/tcp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=22623/tcp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=9000-9999/tcp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=10250-10259/tcp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=4789/udp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=6081/udp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=9000-9999/udp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=500/udp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=4500/udp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=30000-32767/udp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=30000-32767/tcp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --reload&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --list-all&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">public&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">active&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">target&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">default&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">icmp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">block&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">inversion&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">interfaces&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">ens192&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sources&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">services&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">cockpit&lt;/span> &lt;span class="n">dhcpv6&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">client&lt;/span> &lt;span class="n">dns&lt;/span> &lt;span class="n">ssh&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ports&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">53&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">udp&lt;/span> &lt;span class="mi">53&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tcp&lt;/span> &lt;span class="mi">80&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tcp&lt;/span> &lt;span class="mi">443&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tcp&lt;/span> &lt;span class="mi">6443&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tcp&lt;/span> &lt;span class="mi">1936&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tcp&lt;/span> &lt;span class="mi">22623&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tcp&lt;/span> &lt;span class="mi">9000&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">9999&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tcp&lt;/span> &lt;span class="mi">10250&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">10259&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tcp&lt;/span> &lt;span class="mi">4789&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">udp&lt;/span> &lt;span class="mi">6081&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">udp&lt;/span> &lt;span class="mi">9000&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">9999&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">udp&lt;/span> &lt;span class="mi">500&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">udp&lt;/span> &lt;span class="mi">4500&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">udp&lt;/span> &lt;span class="mi">30000&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">32767&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">udp&lt;/span> &lt;span class="mi">30000&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">32767&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">protocols&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">forward&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">masquerade&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">forward&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ports&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">source&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ports&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">icmp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">blocks&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rich&lt;/span> &lt;span class="n">rules&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## SELinux&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># semanage port --add --type http_port_t --proto tcp 1936&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># semanage port --add --type http_port_t --proto tcp 6443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># semanage port --add --type http_port_t --proto tcp 22623&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="ow">or&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># setsebool -P haproxy_connect_any=on&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>啟動服務&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@bastion ~]# systemctl enable haproxy --now
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="下載pull-secret-token">下載Pull Secret Token
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>網頁連線至https://console.redhat.com/openshift/downloads&lt;/p>
&lt;/li>
&lt;li>
&lt;p>下載 Pull Secret Token
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221011144551465.png"
loading="lazy"
alt="image-20221011144551465"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>將 pull-secret放到安裝目錄下&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ cp ../pull-secret .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r--. 1 devop devop 2795 Oct 11 15:07 pull-secret
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;hr>
&lt;/li>
&lt;/ol>
&lt;h3 id="下載安裝openshift-installer">下載安裝openshift installer
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>網頁連線至 &lt;a class="link" href="https://console.redhat.com/openshift/downloads#tool-pull-secret" target="_blank" rel="noopener"
>https://console.redhat.com/openshift/downloads#tool-pull-secret&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>下載 OpenShift for x86_64 Installer
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221011145410398.png"
loading="lazy"
alt="image-20221011145410398"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>創建目錄並解壓縮&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ mkdir ocp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ mv openshift-install-linux.tar.gz ocp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ cd ocp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total 336508
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r--. 1 devop devop 344582118 Oct 11 14:59 openshift-install-linux.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ tar xzvf openshift-install-linux.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openshift-install
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>將openshift installer 放到 /usr/local/bin&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ sudo cp openshift-install /usr/local/bin/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[sudo] password for devop:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ openshift-install --help
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Creates OpenShift clusters
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Usage:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> openshift-install [command]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ..
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="下載-coreos">下載 CoreOS
&lt;/h3>&lt;ol>
&lt;li>連線至 &lt;a class="link" href="https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.11/4.11.2/" target="_blank" rel="noopener"
>https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.11/4.11.2/&lt;/a>&lt;/li>
&lt;li>下載 &lt;a class="link" href="https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.11/4.11.2/rhcos-4.11.2-x86_64-live.x86_64.iso" target="_blank" rel="noopener"
>https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.11/4.11.2/rhcos-4.11.2-x86_64-live.x86_64.iso&lt;/a>&lt;/li>
&lt;li>放到ESXi主機上並掛給各虛擬機
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221011150628575.png"
loading="lazy"
alt="image-20221011150628575"
>&lt;/li>
&lt;li>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221011151238082.png"
loading="lazy"
alt="image-20221011151238082"
>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="準備安裝soruce">準備安裝Soruce
&lt;/h3>&lt;h4 id="創建install-configyaml">創建install-config.yaml
&lt;/h4>&lt;p>在/home/devop/ocp目錄下 新增install-config.yaml
重裝時記得將此目錄清除乾淨&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ vim install-config.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ cat install-config.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">baseDomain: ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">compute:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- hyperthreading: Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">controlPlane:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hyperthreading: Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: ocp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">networking:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> clusterNetwork:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - cidr: 10.128.0.0/14
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hostPrefix: 23
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> networkType: OpenShiftSDN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> serviceNetwork:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 172.30.0.0/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">platform:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> none: {}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">fips: false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pullSecret: &amp;#39;{&amp;#34;auths&amp;#34;:{&amp;#34;cloud.openshift.com&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K29jbV9hY2Nlc3NfMzEwNjVjNmVmMTk5NDZmNWEwNmUzZmI4MTVmNzk2OTE6NEJRVk1FVk9CTDRZQVRBT0pONEhQVkIyUExFQTdKNDE3WExFU1IzVDk3NU1YUTJXWE9FSjBNTVk0MzFQQk9RUA==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;},&amp;#34;quay.io&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K29jbV9hY2Nlc3NfMzEwNjVjNmVmMTk5NDZmNWEwNmUzZmI4MTVmNzk2OTE6NEJRVk1FVk9CTDRZQVRBT0pONEhQVkIyUExFQTdKNDE3WExFU1IzVDk3NU1YUTJXWE9FSjBNTVk0MzFQQk9RUA==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;},&amp;#34;registry.connect.redhat.com&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;fHVoYy1wb29sLTc5MzgwY2YyLTUxNTEtNGRiNi04YjA3LTRiNzQ4NDcxNWE2NDpleUpoYkdjaU9pSlNVelV4TWlKOS5leUp6ZFdJaU9pSmxOak5rWVdWbU1tSXlaRFEwTVdKaVlUTXpObVUwTkdGbVl6WmtPVEUwWVNKOS5RMlp6Q1JaWWltVDIxM2dpYU9CRWtNWEVkYUtjbnc4WHN1bTY3VEVOdjEyRjBjQUgyNWNZMVdWTjZNUEY2R21CNjh3TmF4TnoxRHVpVnBtY0ZKM2JZTW0yNVVzZGJxeFc4cEd1dGszSzF5NlNUWk9VejlkU0V4UGg4aUxha05qSEQ4Tml6emNmM1lUQjRNUXdhYTVFSG1PMXVTUERUZFRBTXFYS3FFa2gwRXpHOUpKZTlUMnM4bVJXWkVIbndoZW84cktncVZuV1VCeGhqTldFNElfWG1JZnBPRl91akpFNHdXNzRJWjd5UmdoUGExQVVwS3BsY0NJQ2ZGdGtaS29WUTFwNTBzUzNabkxWYjd6ZHdXR21WcXVsNUFoZUNiSHNoNEtpSjFnYXRSbkwtMG92THZoNGdseUZqd0c0Z3lMMEdyS1ItbU5WMFZYc01mVzJDNXNVaXBzVmhKcmhmY01vQjRNSDRDbjZKcjJXS2plbEdqSVdHQzBUV1BBNlZQZDBmc0lyLTRCY2RBdUFmcm5SaWpGM3d0Mng3RFdXQ1RScFVPbUVMY3U5bDR6Wm5uZkVSejNMd01rNmhCWTFyYXV1TGhCWXJraFlzQURqWEl3bGxPTkwyc01GMUU2OVNIVG1vV0tvNU5fdHdoWE5fX1BtT1ozMzc5ZVNDVGdnTFNZd3hyR1VwS3FXRDFva3JWZlRIWmNlcTk4WHQ2QjFtZHIxcmxLV2RiRmhsRDQ3Q1pldEhrNW1xQUlianp1UzlONENJWllhd0lIZE5LWVotN2tRNFQyUFg4QWdadHFNdHdjY2c0bWx3ME40c09LbWVZN2Q2bGw0bXpXV201bVo0aktTeHdpYmJ3STEwOFcxWVFlSlQ4QW9WZFlkc09YWkdWc3ZxZVVZOU9qbzR2RQ==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;},&amp;#34;registry.redhat.io&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;fHVoYy1wb29sLTc5MzgwY2YyLTUxNTEtNGRiNi04YjA3LTRiNzQ4NDcxNWE2NDpleUpoYkdjaU9pSlNVelV4TWlKOS5leUp6ZFdJaU9pSmxOak5rWVdWbU1tSXlaRFEwTVdKaVlUTXpObVUwTkdGbVl6WmtPVEUwWVNKOS5RMlp6Q1JaWWltVDIxM2dpYU9CRWtNWEVkYUtjbnc4WHN1bTY3VEVOdjEyRjBjQUgyNWNZMVdWTjZNUEY2R21CNjh3TmF4TnoxRHVpVnBtY0ZKM2JZTW0yNVVzZGJxeFc4cEd1dGszSzF5NlNUWk9VejlkU0V4UGg4aUxha05qSEQ4Tml6emNmM1lUQjRNUXdhYTVFSG1PMXVTUERUZFRBTXFYS3FFa2gwRXpHOUpKZTlUMnM4bVJXWkVIbndoZW84cktncVZuV1VCeGhqTldFNElfWG1JZnBPRl91akpFNHdXNzRJWjd5UmdoUGExQVVwS3BsY0NJQ2ZGdGtaS29WUTFwNTBzUzNabkxWYjd6ZHdXR21WcXVsNUFoZUNiSHNoNEtpSjFnYXRSbkwtMG92THZoNGdseUZqd0c0Z3lMMEdyS1ItbU5WMFZYc01mVzJDNXNVaXBzVmhKcmhmY01vQjRNSDRDbjZKcjJXS2plbEdqSVdHQzBUV1BBNlZQZDBmc0lyLTRCY2RBdUFmcm5SaWpGM3d0Mng3RFdXQ1RScFVPbUVMY3U5bDR6Wm5uZkVSejNMd01rNmhCWTFyYXV1TGhCWXJraFlzQURqWEl3bGxPTkwyc01GMUU2OVNIVG1vV0tvNU5fdHdoWE5fX1BtT1ozMzc5ZVNDVGdnTFNZd3hyR1VwS3FXRDFva3JWZlRIWmNlcTk4WHQ2QjFtZHIxcmxLV2RiRmhsRDQ3Q1pldEhrNW1xQUlianp1UzlONENJWllhd0lIZE5LWVotN2tRNFQyUFg4QWdadHFNdHdjY2c0bWx3ME40c09LbWVZN2Q2bGw0bXpXV201bVo0aktTeHdpYmJ3STEwOFcxWVFlSlQ4QW9WZFlkc09YWkdWc3ZxZVVZOU9qbzR2RQ==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;}}}&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sshKey: &amp;#39;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIN1Z2jXmGnPWGAVrtltN9A2q5D8QtJlRvhvdB2QXoZG devop@bastion.ocp.ken.lab&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">capabilities:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> baselineCapabilitySet: vCurrent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-------### 只裝Operator Hub ###---------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">capabilities:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> baselineCapabilitySet: None
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> additionalEnabledCapabilities:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - marketplace
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="建立k8s-manifest--files">建立K8S manifest files
&lt;/h4>&lt;p>在相同目錄下執行
重裝時記得將此目錄清除乾淨&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ openshift-install create manifests --dir /home/devop/ocp/install/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Consuming Install Config from target directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WARNING Making control-plane schedulable by setting MastersSchedulable to true for Scheduler cluster settings
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Manifests created in: /home/devop/ocp/install/manifests and /home/devop/ocp/install/openshift
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="ｍastersschedulablefalse">ＭastersSchedulable:false
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ cd manifests/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion manifests]$ cat cluster-scheduler-02-config.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: config.openshift.io/v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: Scheduler
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> creationTimestamp: null
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mastersSchedulable: false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> policy:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">status: {}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="創建ignition-config-file">創建Ignition config file
&lt;/h4>&lt;p>重裝時記得將此目錄清除乾淨&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ openshift-install create ignition-configs --dir /home/devop/ocp/install/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Consuming Worker Machines from target directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Consuming Openshift Manifests from target directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Consuming Common Manifests from target directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Consuming OpenShift Install (Manifests) from target directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Consuming Master Machines from target directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Ignition-Configs created in: /home/devop/ocp/install and /home/devop/ocp/install/auth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ tree install/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">install/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── auth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── kubeadmin-password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   └── kubeconfig
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── bootstrap.ign
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── master.ign
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── metadata.json
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── worker.ign
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1 directory, 6 files
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">##確認 sha512sum
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion ocp]# sha512sum bootstrap.ign
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">460f76f9bc8b1df7095326c6b581b60f1150e477ae416b065c7b18ae040dc530a3086857d649ae04f646ccf9cce16ea9a4c32c8fe48b3630413f8ebe3f924329 bootstrap.ign
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="安裝http-web-server">安裝Http Web Server
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>安裝httpd&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@bastion ~]# yum install httpd -y
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>設定httpd 預設port 8989、修改SELinux&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># vim /etc/httpd/conf/httpd.conf &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Listen&lt;/span> &lt;span class="mi">8989&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=8989/tcp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --reload &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># semanage port -a -t http_port_t -p tcp 8989&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>將ignition檔案複製到 /var/www/html&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># cp /home/devop/ocp/*.ign /var/www/html/ocp/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># cp /var/www/html/ocp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># chmod 644 *.ign&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>啟動httpd並測試連線&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@bastion ocp]# systemctl enable httpd --now
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion ocp]# curl http://192.168.33.21:8989/ocp/bootstrap.ign
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="安裝bootstrap">安裝BootStrap
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>將虛擬機開機，並使用rhel core os 的iso檔開機，
若前面dhcp server、dns server設定成功，即會自動拿到FQDN、IP
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221011155843248.png"
loading="lazy"
alt="image-20221011155843248"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在bootstrap執行安裝指令&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo coreos-installer install --ignition-url=http://192.168.33.21:8989/ocp/bootstrap.ign /dev/sda --insecure-ignition
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(--insecure-ignition can replace using --ignition-hash=sha512-xxxxxxxxxxxxx)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>出現此畫面後 執行重新啟動 reboot
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221011165057146.png"
loading="lazy"
alt="image-20221011165057146"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>開機後確認已寫入硬碟
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221011165808592.png"
loading="lazy"
alt="image-20221011165808592"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在bastion登入bootstrap&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">bastion&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="err">$&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ssh&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">core&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">bootstrap&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">The&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">authenticity&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">of&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;bootstrap (192.168.33.22)&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">can&lt;/span>&lt;span class="s1">&amp;#39;t be established.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">ED25519 key fingerprint is SHA256:pnQoMRtW8f/3EjIQ7qNG4+NIB+ObrTd4E8aEbvRqMQw.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">This key is not known by any other names
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Warning: Permanently added &amp;#39;&lt;/span>&lt;span class="n">bootstrap&lt;/span>&lt;span class="s1">&amp;#39; (ED25519) to the list of known hosts.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">client_global_hostkeys_private_confirm: server gave bad signature for RSA key 0: error in libcrypto
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Red Hat Enterprise Linux CoreOS 411.86.202208112011-0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Part of OpenShift 4.11, RHCOS is a Kubernetes native operating system
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> managed by the Machine Config Operator (`clusteroperator/machine-config`).
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">WARNING: Direct SSH access to machines is not recommended; instead,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">make configuration changes via `machineconfig` objects:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> https://docs.openshift.com/container-platform/4.11/architecture/architecture-rhcos.html
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">---
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">This is the bootstrap node; it will be destroyed when the master is fully up.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">The primary services are release-image.service followed by bootkube.service. To watch their status, run e.g.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> journalctl -b -f -u release-image.service -u bootkube.service
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>查看log，到出現machine api時才可接續安裝&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[core@bootstrap ~]$ journalctl -b -f -u release-image.service -u bootkube.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Create &amp;#34;99_openshift-cluster-api_worker-user-data-secret.yaml&amp;#34; secrets.v1./worker-user-data -n openshift-machine-api
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>此時才可繼續安裝 master01、master02、master03
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221011173412330.png"
loading="lazy"
alt="image-20221011173412330"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>出現此畫面即可關閉bootstrap&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221011172057819.png"
loading="lazy"
alt="image-20221011172057819"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221013110951260.png"
loading="lazy"
alt="image-20221013110951260"
>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="安裝-ｍaster-node">安裝 Ｍaster Node
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>將虛擬機開機，並使用rhel core os 的iso檔開機，
若前面dhcp server、dns server設定成功，即會自動拿到FQDN、IP&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在master執行安裝指令，三台相同 (若設定ＭastersSchedulable:false，則worker需一起安裝）&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo coreos-installer install --ignition-url=http://192.168.33.21:8989/ocp/master.ign /dev/sda --insecure-ignition
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">出現install complete 即可reboot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012012023876.png"
loading="lazy"
alt="image-20221012012023876"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>持續監控bootstrap的 Log&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[core@bootstrap ~]$ journalctl -b -f -u release-image.service -u bootkube.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>Master Node裝完會自動重開機&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在bastion 驗證節點&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master1.ocp.ken.lab Ready master 4m22s v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master2.ocp.ken.lab Ready master 3m37s v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master3.ocp.ken.lab Ready master 3m21s v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>查看bootstrap的 Log,確認安裝完成&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012013436842.png"
loading="lazy"
alt="image-20221012013436842"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012014537780.png"
loading="lazy"
alt="image-20221012014537780"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在Bastion 執行oc 指令確認ocp cluster CSR&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master1.ocp.ken.lab Ready master 18m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master2.ocp.ken.lab Ready master 17m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master3.ocp.ken.lab Ready master 17m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc get csr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME AGE SIGNERNAME REQUESTOR REQUESTEDDURATION CONDITION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-7sgfx 18m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-lphdj 17m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-ndft5 17m kubernetes.io/kubelet-serving system:node:master3.ocp.ken.lab &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-p42p5 17m kubernetes.io/kubelet-serving system:node:master2.ocp.ken.lab &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-vgmd9 17m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-zpfw4 18m kubernetes.io/kubelet-serving system:node:master1.ocp.ken.lab &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">system:openshift:openshift-authenticator-2zxkf 15m kubernetes.io/kube-apiserver-client system:serviceaccount:openshift-authentication-operator:authentication-operator &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">system:openshift:openshift-monitoring-ln69x 15m kubernetes.io/kube-apiserver-client system:serviceaccount:openshift-monitoring:cluster-monitoring-operator &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>確認cluster operator&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion install]$ oc get co -A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME VERSION AVAILABLE PROGRESSING DEGRADED SINCE MESSAGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">authentication 4.11.7 False False False 76s APIServicesAvailable: PreconditionNotReady...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cloud-controller-manager 4.11.7 True False False 2m36s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cloud-credential True False False 13m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster-autoscaler
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">config-operator 4.11.7 True False False 40s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">console
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csi-snapshot-controller 4.11.7 True False False 1s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">etcd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">image-registry
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ingress
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">insights
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-apiserver Unknown False False 112s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-controller-manager False True False 75s StaticPodsAvailable: 0 nodes are active; 3 nodes are at revision 0; 0 nodes have achieved new revision 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-scheduler False True False 35s StaticPodsAvailable: 0 nodes are active; 3 nodes are at revision 0; 0 nodes have achieved new revision 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-storage-version-migrator 4.11.7 True False False 59s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">machine-api
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">machine-approver
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">machine-config True Working towards 4.11.7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">marketplace
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">monitoring
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">network False True False 2m53s The network is starting up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node-tuning
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openshift-apiserver
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openshift-controller-manager False True False 100s Available: no daemon pods available on any node.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openshift-samples
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">operator-lifecycle-manager
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">operator-lifecycle-manager-catalog
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">operator-lifecycle-manager-packageserver
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service-ca 4.11.7 True False False 33s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">storage 4.11.7 True False False 49s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>關閉bootstrap，安裝worker node&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="安裝-workerinfra-node">安裝 Worker＆Infra Node
&lt;/h2>&lt;p>&lt;a class="link" href="https://docs.openshift.com/container-platform/4.11/machine_management/user_infra/adding-bare-metal-compute-user-infra.html" target="_blank" rel="noopener"
>https://docs.openshift.com/container-platform/4.11/machine_management/user_infra/adding-bare-metal-compute-user-infra.html&lt;/a>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>將虛擬機開機，並使用rhel core os 的iso檔開機，
若前面dhcp server、dns server設定成功，即會自動拿到FQDN、IP&lt;/p>
&lt;/li>
&lt;li>
&lt;p>執行安裝指令 (worker1、worker2、infra1、infra2、infra3)&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo coreos-installer install --ignition-url=http://192.168.33.21:8989/ocp/worker.ign /dev/sda --insecure-ignition
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">出現install complete 即可reboot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>在bastion 確認nodes、csr (會有很多需approve的 csr，後續加node後還會有)&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master1.ocp.ken.lab Ready master 36m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master2.ocp.ken.lab Ready master 35m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master3.ocp.ken.lab Ready master 35m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc get csr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME AGE SIGNERNAME REQUESTOR REQUESTEDDURATION CONDITION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-7sgfx 37m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-lphdj 37m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-ndft5 36m kubernetes.io/kubelet-serving system:node:master3.ocp.ken.lab &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-nwplh 0s kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Pending
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-p42p5 36m kubernetes.io/kubelet-serving system:node:master2.ocp.ken.lab &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-pcsl2 115s kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Pending
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-vgmd9 36m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-zpfw4 37m kubernetes.io/kubelet-serving system:node:master1.ocp.ken.lab &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">system:openshift:openshift-authenticator-2zxkf 35m kubernetes.io/kube-apiserver-client system:serviceaccount:openshift-authentication-operator:authentication-operator &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">system:openshift:openshift-monitoring-ln69x 34m kubernetes.io/kube-apiserver-client system:serviceaccount:openshift-monitoring:cluster-monitoring-operator &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>Approve All CSR&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$oc adm certificate approve &amp;lt;csr_name&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$oc get csr -o go-template=&amp;#39;{{range .items}}{{if not .status}}{{.metadata.name}}{{&amp;#34;\n&amp;#34;}}{{end}}{{end}}&amp;#39; | xargs --no-run-if-empty oc adm certificate approve
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion auth]$ oc get csr -A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME AGE SIGNERNAME REQUESTOR REQUESTEDDURATION CONDITION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-2trmm 18m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-9xhq4 16m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-b4jns 2m45s kubernetes.io/kubelet-serving system:node:infra1.ocp.ken.lab &amp;lt;none&amp;gt; Pending
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-b55jd 3m57s kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-bdtnw 16m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-bngbr 2m40s kubernetes.io/kubelet-serving system:node:infra2.ocp.ken.lab &amp;lt;none&amp;gt; Pending
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-kd66h 2m51s kubernetes.io/kubelet-serving system:node:infra2.ocp.ken.lab &amp;lt;none&amp;gt; Pending
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-lzk6w 2m46s kubernetes.io/kubelet-serving system:node:worker1.ocp.ken.lab &amp;lt;none&amp;gt; Pending
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-rtkr6 2m46s kubernetes.io/kubelet-serving system:node:worker2.ocp.ken.lab &amp;lt;none&amp;gt; Pending
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-swwhm 18m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-v67v6 16m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-vhlqb 3m56s kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion auth]$ oc get csr -o go-template=&amp;#39;{{range .items}}{{if not .status}}{{.metadata.name}}{{&amp;#34;\n&amp;#34;}}{{end}}{{end}}&amp;#39; | xargs --no-run-if-empty oc adm certificate approve
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-2trmm approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-9xhq4 approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-b55jd approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-bdtnw approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-swwhm approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-v67v6 approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-vhlqb approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion auth]$ oc get csr -o go-template=&amp;#39;{{range .items}}{{if not .status}}{{.metadata.name}}{{&amp;#34;\n&amp;#34;}}{{end}}{{end}}&amp;#39; | xargs --no-run-if-empty oc adm certificate approve
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-b4jns approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-bngbr approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-cq46l approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-kd66h approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-lzk6w approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-rtkr6 approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-t6l2b approved
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>再次確認node狀態&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion auth]$ oc get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra1.ocp.ken.lab Ready worker 2m32s v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra2.ocp.ken.lab Ready,SchedulingDisabled worker 2m38s v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master1.ocp.ken.lab NotReady master 78m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master2.ocp.ken.lab NotReady master 78m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master3.ocp.ken.lab NotReady master 78m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker1.ocp.ken.lab Ready worker 2m33s v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker2.ocp.ken.lab Ready worker 2m34s v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master1.ocp.ken.lab Ready master 39m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master2.ocp.ken.lab Ready master 39m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master3.ocp.ken.lab Ready master 38m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker1.ocp.ken.lab Ready worker 95s v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker2.ocp.ken.lab Ready worker 90s v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc get po -A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="安裝後的設定">安裝後的設定
&lt;/h2>&lt;h4 id="設定nfs">設定NFS
&lt;/h4>&lt;p>&lt;a class="link" href="https://access.redhat.com/solutions/4618011" target="_blank" rel="noopener"
>https://access.redhat.com/solutions/4618011&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://access.redhat.com/solutions/5900501" target="_blank" rel="noopener"
>https://access.redhat.com/solutions/5900501&lt;/a>&lt;/p>
&lt;p>on vmware vsphere&lt;/p>
&lt;p>&lt;a class="link" href="https://vergiehadiana.medium.com/guide-deploy-nfs-storage-for-dynamic-provisioning-and-image-registry-for-red-hat-openshift-b15e16f357b4" target="_blank" rel="noopener"
>https://vergiehadiana.medium.com/guide-deploy-nfs-storage-for-dynamic-provisioning-and-image-registry-for-red-hat-openshift-b15e16f357b4&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://hackmd.io/@kd-ocp/S1EIu6V25" target="_blank" rel="noopener"
>https://hackmd.io/@kd-ocp/S1EIu6V25&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">image:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">image:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">groundhog2k/nfs-subdir-external-provisioner:v3.2.0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="設定外部image-registry">設定外部Image Registry
&lt;/h4>&lt;p>&lt;a class="link" href="https://access.redhat.com/documentation/zh-cn/openshift_container_platform/4.6/html/images/images-configuration-file_image-configuration" target="_blank" rel="noopener"
>https://access.redhat.com/documentation/zh-cn/openshift_container_platform/4.6/html/images/images-configuration-file_image-configuration&lt;/a>&lt;/p>
&lt;h4 id="設定htpasswd-provider">設定Htpasswd Provider
&lt;/h4>&lt;p>&lt;a class="link" href="https://docs.openshift.com/container-platform/4.11/authentication/identity_providers/configuring-htpasswd-identity-provider.html" target="_blank" rel="noopener"
>https://docs.openshift.com/container-platform/4.11/authentication/identity_providers/configuring-htpasswd-identity-provider.html&lt;/a>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>利用htpasswd 產生htpasswd檔案&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ htpasswd -c -B -b users.htpasswd admin redhat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Adding password for user admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ htpasswd -B -b users.htpasswd ken xxxxxxxx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Adding password for user ken
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ htpasswd -B -b users.htpasswd view redhat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Adding password for user view
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>產生secret 將 htpasswd 放入secret&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc whoami
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">system:admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc create secret generic users-htpasswd --from-file htpasswd=users.htpasswd -n openshift-config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">secret/users-htpasswd created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc get secret -n openshift-config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME TYPE DATA AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">builder-dockercfg-r46z8 kubernetes.io/dockercfg 1 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">builder-token-cgvp8 kubernetes.io/service-account-token 4 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">default-dockercfg-8mhbj kubernetes.io/dockercfg 1 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">default-token-nfc27 kubernetes.io/service-account-token 4 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deployer-dockercfg-qdwcq kubernetes.io/dockercfg 1 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deployer-token-bfplj kubernetes.io/service-account-token 4 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">etcd-client kubernetes.io/tls 2 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">etcd-metric-client kubernetes.io/tls 2 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">etcd-metric-signer kubernetes.io/tls 2 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">etcd-signer kubernetes.io/tls 2 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">initial-service-account-private-key Opaque 1 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pull-secret kubernetes.io/dockerconfigjson 1 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">users-htpasswd Opaque 1 10s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">webhook-authentication-integrated-oauth Opaque 1 8h
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>新增 htpasswd provider&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc get oauth cluster -o yaml &amp;gt; oauth.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ vim oauth.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ cat oauth.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: config.openshift.io/v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: OAuth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> annotations:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> include.release.openshift.io/ibm-cloud-managed: &amp;#34;true&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> include.release.openshift.io/self-managed-high-availability: &amp;#34;true&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> include.release.openshift.io/single-node-developer: &amp;#34;true&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> release.openshift.io/create-only: &amp;#34;true&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> creationTimestamp: &amp;#34;2022-10-11T17:14:37Z&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> generation: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ownerReferences:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - apiVersion: config.openshift.io/v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kind: ClusterVersion
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> uid: d1c0dbf6-000f-4b1e-aa27-1bd8a667afac
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resourceVersion: &amp;#34;1533&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> uid: 3e95cfe7-7c02-47eb-8b4e-7f0d61766461
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> identityProviders:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: htpasswd_provider
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mappingMethod: claim
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type: HTPasswd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> htpasswd:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fileData:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: users-htpasswd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc apply -f oauth.yaml -n openshift-config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: resource oauths/cluster is missing the kubectl.kubernetes.io/last-applied-configuration annotation which is required by oc apply. oc apply should only be used on resources created declaratively by either oc create --save-config or oc apply. The missing annotation will be patched automatically.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">oauth.config.openshift.io/cluster configured
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ watch oc get po -n openshift-authentication
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012094929634.png"
loading="lazy"
alt="image-20221012094929634"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>調整角色權限&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## 將cluster-admin role 加給 admin、ken
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc adm policy add-cluster-role-to-user cluster-admin admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrole.rbac.authorization.k8s.io/cluster-admin added: &amp;#34;admin&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc adm policy add-cluster-role-to-user cluster-admin ken
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: User &amp;#39;ken&amp;#39; not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrole.rbac.authorization.k8s.io/cluster-admin added: &amp;#34;ken&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## 將cluster-view role 加給 view
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc get clusterroles | grep view
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">view 2022-10-11T17:13:19Z
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc adm policy add-cluster-role-to-user view view
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: User &amp;#39;view&amp;#39; not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrole.rbac.authorization.k8s.io/view added: &amp;#34;view&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>將預設可建立project的權限刪除，只給admin、ken&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## 取得 self-provisioner的role
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc get clusterrolebindings | grep self-provisioner
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">self-provisioners ClusterRole/self-provisioner 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## 取得 self-provisioners role binding的group
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc describe clusterrolebindings self-provisioners
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name: self-provisioners
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Labels: &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Annotations: rbac.authorization.kubernetes.io/autoupdate: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Role:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Kind: ClusterRole
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: self-provisioner
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Subjects:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Kind Name Namespace
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ---- ---- ---------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Group system:authenticated:oauth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">##移除 self-provisioner的rolebinding
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc adm policy remove-cluster-role-from-group self-provisioner system:authenticated:oauth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: Your changes may get lost whenever a master is restarted, unless you prevent reconciliation of this rolebinding using the following command: oc annotate clusterrolebinding.rbac self-provisioners &amp;#39;rbac.authorization.kubernetes.io/autoupdate=false&amp;#39; --overwrite
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrole.rbac.authorization.k8s.io/self-provisioner removed: &amp;#34;system:authenticated:oauth&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">##新增可以建立project的group
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc adm groups new new-project-group admin ken
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">group.user.openshift.io/new-project-group created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">##將new-project-group再bind上self-provisioner
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc adm policy add-cluster-role-to-group self-provisioner new-project-group
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrole.rbac.authorization.k8s.io/self-provisioner added: &amp;#34;new-project-group&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>取得console url&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">get&lt;/span> &lt;span class="n">route&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">console&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">NAME&lt;/span> &lt;span class="n">HOST&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">PORT&lt;/span> &lt;span class="n">PATH&lt;/span> &lt;span class="n">SERVICES&lt;/span> &lt;span class="n">PORT&lt;/span> &lt;span class="n">TERMINATION&lt;/span> &lt;span class="n">WILDCARD&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">console&lt;/span> &lt;span class="n">console&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">console&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apps&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span> &lt;span class="n">console&lt;/span> &lt;span class="n">https&lt;/span> &lt;span class="n">reencrypt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Redirect&lt;/span> &lt;span class="n">None&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">downloads&lt;/span> &lt;span class="n">downloads&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">console&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apps&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span> &lt;span class="n">downloads&lt;/span> &lt;span class="n">http&lt;/span> &lt;span class="n">edge&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Redirect&lt;/span> &lt;span class="n">None&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### 刪除 kubeadmin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">delete&lt;/span> &lt;span class="n">secret&lt;/span> &lt;span class="n">kubeadmin&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">kube&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">system&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>連線至console &lt;a class="link" href="https://console-openshift-console.apps.ocp.ken.lab" target="_blank" rel="noopener"
>https://console-openshift-console.apps.ocp.ken.lab&lt;/a> 並測試登入&lt;/p>
&lt;p>admin / redhat (cluster-admin)、view / redhat (view only)
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012095225994.png"
loading="lazy"
alt="image-20221012095225994"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012095300179.png"
loading="lazy"
alt="image-20221012095300179"
>
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012095339064.png"
loading="lazy"
alt="image-20221012095339064"
>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 id="註冊openshift-cluster">註冊openshift cluster
&lt;/h4>&lt;ol>
&lt;li>
&lt;p>從console 點到 Administration &amp;gt; Cluster Settings &amp;gt; Manage subscription settings
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012101701215.png"
loading="lazy"
alt="image-20221012101701215"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>點選Edit subscription settings&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012101731793.png"
loading="lazy"
alt="image-20221012101731793"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>選擇 Self-Support 即可
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012101910450.png"
loading="lazy"
alt="image-20221012101910450"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>約 3~5 分鐘即可更新License&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012102253203.png"
loading="lazy"
alt="image-20221012102253203"
>12&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 id="設定oc-cli-ca">設定OC CLI CA
&lt;/h4>&lt;p>在openshift-authentication project內取得CA並將CA複製到bastion內&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc project openshift-authentication
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Now using project &amp;#34;openshift-authentication&amp;#34; on server &amp;#34;https://api.ocp.ken.lab:6443&amp;#34;.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc get po
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">oauth-openshift-7885f5bd5b-4m5sh 1/1 Running 0 46m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">oauth-openshift-7885f5bd5b-q6vbk 1/1 Running 0 46m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">oauth-openshift-7885f5bd5b-vh4pz 1/1 Running 0 47m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc rsh oauth-openshift-7885f5bd5b-4m5sh cat /run/secrets/kubernetes.io/serviceaccount/ca.crt &amp;gt; ca.crt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">＃＃切換root
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion ocp]# cp /home/devop/ocp/ca.crt /etc/pki/ca-trust/source/anchors/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion ocp]# update-ca-trust extract
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## 切換為devop測試登入
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc login -u admin -p redhat https://api.ocp.ken.lab:6443
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Login successful.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">You have access to 66 projects, the list has been suppressed. You can list all projects with &amp;#39;oc projects&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Using project &amp;#34;openshift-authentication&amp;#34;.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="拆分infra-node">拆分Infra Node
&lt;/h4>&lt;p>&lt;a class="link" href="https://docs.openshift.com/container-platform/4.11/post_installation_configuration/cluster-tasks.html#post-install-cluster-tasks" target="_blank" rel="noopener"
>https://docs.openshift.com/container-platform/4.11/post_installation_configuration/cluster-tasks.html#post-install-cluster-tasks&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://access.redhat.com/solutions/4601131" target="_blank" rel="noopener"
>https://access.redhat.com/solutions/4601131&lt;/a>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>針對infra node 建立label&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc label node infra1.ocp.ken.lab node-role.kubernetes.io/infra=&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/infra1.ocp.ken.lab labeled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc label node infra2.ocp.ken.lab node-role.kubernetes.io/infra=&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/infra2.ocp.ken.lab labeled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc label node infra3.ocp.ken.lab node-role.kubernetes.io/infra=&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/infra3.ocp.ken.lab labeled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra1.ocp.ken.lab Ready infra,worker 4h1m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra2.ocp.ken.lab Ready infra,worker 4h1m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra3.ocp.ken.lab Ready infra,worker 3h19m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master1.ocp.ken.lab Ready master 4h43m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master2.ocp.ken.lab Ready master 4h42m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master3.ocp.ken.lab Ready master 4h41m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker1.ocp.ken.lab Ready worker 4h17m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker2.ocp.ken.lab Ready worker 4h17m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>建立machine config pool &amp;raquo; infra.mcp.yaml 並apply到 cluster&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ vim infra.mcp.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: machineconfiguration.openshift.io/v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: MachineConfigPool
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: infra
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machineConfigSelector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> matchExpressions:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - {key: machineconfiguration.openshift.io/role, operator: In, values: [worker,infra]}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nodeSelector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> matchLabels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/infra: &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc apply -f infra.mcp.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">machineconfigpool.machineconfiguration.openshift.io/infra created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc get machineconfig
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME GENERATEDBYCONTROLLER IGNITIONVERSION AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">00-master b7aa1d499f15ce7d211d30a823acf83f47aabbe3 3.2.0 5h12m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">00-worker b7aa1d499f15ce7d211d30a823acf83f47aabbe3 3.2.0 5h12m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">01-master-container-runtime b7aa1d499f15ce7d211d30a823acf83f47aabbe3 3.2.0 5h12m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">01-master-kubelet b7aa1d499f15ce7d211d30a823acf83f47aabbe3 3.2.0 5h12m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">01-worker-container-runtime b7aa1d499f15ce7d211d30a823acf83f47aabbe3 3.2.0 5h12m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">01-worker-kubelet b7aa1d499f15ce7d211d30a823acf83f47aabbe3 3.2.0 5h12m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">99-master-generated-registries b7aa1d499f15ce7d211d30a823acf83f47aabbe3 3.2.0 5h12m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">99-master-ssh 3.2.0 5h29m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">99-worker-generated-registries b7aa1d499f15ce7d211d30a823acf83f47aabbe3 3.2.0 5h12m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">99-worker-ssh 3.2.0 5h29m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rendered-infra-407eaba9df9f726f52f84b938fce9025 b7aa1d499f15ce7d211d30a823acf83f47aabbe3 3.2.0 3s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rendered-master-720c11fac56674c6fc876ab6161295aa b7aa1d499f15ce7d211d30a823acf83f47aabbe3 3.2.0 5h12m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rendered-worker-407eaba9df9f726f52f84b938fce9025 b7aa1d499f15ce7d211d30a823acf83f47aabbe3 3.2.0 5h12m
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>建立 machine config &amp;raquo; infra.mc.yaml 並apply到cluster&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ vim infra.mc.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: machineconfiguration.openshift.io/v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: MachineConfig
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: 51-infra
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> labels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machineconfiguration.openshift.io/role: infra
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> config:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ignition:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> version: 3.2.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> storage:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> files:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - path: /etc/infratest
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mode: 0644
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> contents:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source: data:,infra
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc create -f infra.mc.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">machineconfig.machineconfiguration.openshift.io/51-infra created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc get mcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME CONFIG UPDATED UPDATING DEGRADED MACHINECOUNT READYMACHINECOUNT UPDATEDMACHINECOUNT DEGRADEDMACHINECOUNT AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra rendered-infra-407eaba9df9f726f52f84b938fce9025 False True False 3 0 0 0 3m17s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master rendered-master-720c11fac56674c6fc876ab6161295aa True False False 3 3 3 0 5h25m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker rendered-worker-407eaba9df9f726f52f84b938fce9025 True False False 2 2 2 0 5h25m
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>Add a Taint To Infra Node ，使Infra Node不會被app部署到
#此動作可搬完operator後再做&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">oc adm taint nodes node1 node-role.kubernetes.io/infra:NoSchedule
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc adm taint nodes infra3.ocp.ken.lab node-role.kubernetes.io/infra:NoSchedule
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/infra3.ocp.ken.lab tainted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc adm taint nodes infra2.ocp.ken.lab node-role.kubernetes.io/infra:NoSchedule
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/infra2.ocp.ken.lab tainted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc adm taint nodes infra1.ocp.ken.lab node-role.kubernetes.io/infra:NoSchedule
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/infra1.ocp.ken.lab tainted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc describe nodes infra1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name: infra1.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Roles: infra,worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Labels: beta.kubernetes.io/arch=amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> beta.kubernetes.io/os=linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubernetes.io/arch=amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubernetes.io/hostname=infra1.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubernetes.io/os=linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/infra=
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/worker=
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node.openshift.io/os_id=rhcos
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Annotations: machineconfiguration.openshift.io/controlPlaneTopology: HighlyAvailable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machineconfiguration.openshift.io/currentConfig: rendered-infra-c36859c83539d92df71208a425c004df
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machineconfiguration.openshift.io/desiredConfig: rendered-infra-c36859c83539d92df71208a425c004df
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machineconfiguration.openshift.io/desiredDrain: uncordon-rendered-infra-c36859c83539d92df71208a425c004df
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machineconfiguration.openshift.io/lastAppliedDrain: uncordon-rendered-infra-c36859c83539d92df71208a425c004df
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machineconfiguration.openshift.io/reason:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machineconfiguration.openshift.io/state: Done
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> volumes.kubernetes.io/controller-managed-attach-detach: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CreationTimestamp: Thu, 13 Oct 2022 11:26:50 +0800
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Taints: node-role.kubernetes.io/infra:NoSchedule
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Unschedulable: false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Lease:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> HolderIdentity: infra1.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> AcquireTime: &amp;lt;unset&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RenewTime: Thu, 13 Oct 2022 16:23:54 +0800
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>刪除infra node的 worker label&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc edit nodes infra1.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/infra1.ocp.ken.lab edited
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> labels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> beta.kubernetes.io/arch: amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> beta.kubernetes.io/os: linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubernetes.io/arch: amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubernetes.io/hostname: infra2.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubernetes.io/os: linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/infra: &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/worker: &amp;#34;&amp;#34; &amp;gt;&amp;gt;&amp;gt;&amp;gt; 刪除此行
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node.openshift.io/os_id: rhcos
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra1.ocp.ken.lab Ready infra 22h v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra2.ocp.ken.lab Ready infra 22h v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra3.ocp.ken.lab Ready infra 22h v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master1.ocp.ken.lab Ready master 23h v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master2.ocp.ken.lab Ready master 23h v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master3.ocp.ken.lab Ready master 23h v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker1.ocp.ken.lab Ready worker 22h v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker2.ocp.ken.lab Ready worker 22h v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h4 id="operator移動到infra-node">Operator移動到Infra Node
&lt;/h4>&lt;h5 id="router">Router
&lt;/h5>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="err">方法一&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">get&lt;/span> &lt;span class="n">ingresscontroller&lt;/span> &lt;span class="n">default&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ingress&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">yaml&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">router&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">vim&lt;/span> &lt;span class="n">router&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">cat&lt;/span> &lt;span class="n">router&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">apiVersion&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">operator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">v1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">kind&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">IngressController&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">metadata&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">creationTimestamp&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T02:54:05Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">finalizers&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">ingresscontroller&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">operator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">finalizer&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ingresscontroller&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">generation&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">default&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">namespace&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ingress&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resourceVersion&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;26400&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">uid&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">d5c3f18&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="n">f53&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">4140&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">be74&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">35&lt;/span>&lt;span class="n">df5edf4c8b&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">spec&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">clientTLS&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">clientCA&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">clientCertificatePolicy&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">httpCompression&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">httpEmptyRequestsPolicy&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Respond&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">httpErrorCodePages&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">replicas&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tuningOptions&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">unsupportedConfigOverrides&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">null&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodePlacement&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodeSelector&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">availableReplicas&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conditions&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T02:54:13Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reason&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Valid&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;True&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Admitted&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T03:12:03Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;True&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">PodsScheduled&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T03:11:54Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">message&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">The&lt;/span> &lt;span class="n">deployment&lt;/span> &lt;span class="n">has&lt;/span> &lt;span class="n">Available&lt;/span> &lt;span class="n">status&lt;/span> &lt;span class="n">condition&lt;/span> &lt;span class="n">set&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">True&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reason&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">DeploymentAvailable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;True&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">DeploymentAvailable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T03:11:54Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">message&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Minimum&lt;/span> &lt;span class="n">replicas&lt;/span> &lt;span class="n">requirement&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">met&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reason&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">DeploymentMinimumReplicasMet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;True&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">DeploymentReplicasMinAvailable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T03:12:36Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">message&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">All&lt;/span> &lt;span class="n">replicas&lt;/span> &lt;span class="n">are&lt;/span> &lt;span class="n">available&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reason&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">DeploymentReplicasAvailable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;True&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">DeploymentReplicasAllAvailable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T02:54:13Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">message&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">The&lt;/span> &lt;span class="n">configured&lt;/span> &lt;span class="n">endpoint&lt;/span> &lt;span class="n">publishing&lt;/span> &lt;span class="n">strategy&lt;/span> &lt;span class="n">does&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">include&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">managed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">load&lt;/span> &lt;span class="n">balancer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reason&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">EndpointPublishingStrategyExcludesManagedLoadBalancer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;False&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">LoadBalancerManaged&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T02:54:13Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">message&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">No&lt;/span> &lt;span class="n">DNS&lt;/span> &lt;span class="n">zones&lt;/span> &lt;span class="n">are&lt;/span> &lt;span class="n">defined&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">cluster&lt;/span> &lt;span class="n">dns&lt;/span> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reason&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">NoDNSZones&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;False&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">DNSManaged&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T03:11:54Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;True&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Available&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T02:54:13Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;False&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Progressing&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T03:12:03Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;False&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Degraded&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T02:54:13Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">message&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">IngressController&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">upgradeable&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reason&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Upgradeable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;True&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Upgradeable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T03:12:02Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">message&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Canary&lt;/span> &lt;span class="n">route&lt;/span> &lt;span class="n">checks&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">default&lt;/span> &lt;span class="n">ingress&lt;/span> &lt;span class="n">controller&lt;/span> &lt;span class="n">are&lt;/span> &lt;span class="n">successful&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reason&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">CanaryChecksSucceeding&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;True&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">CanaryChecksSucceeding&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">domain&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">apps&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">endpointPublishingStrategy&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hostNetwork&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">httpPort&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">80&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">httpsPort&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">protocol&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">TCP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">statsPort&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1936&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">HostNetwork&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">observedGeneration&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">selector&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">ingresscontroller&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">operator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">deployment&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ingresscontroller&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">default&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tlsProfile&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ciphers&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">ECDHE&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ECDSA&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">AES128&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">GCM&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">SHA256&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">ECDHE&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">RSA&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">AES128&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">GCM&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">SHA256&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">ECDHE&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ECDSA&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">AES256&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">GCM&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">SHA384&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">ECDHE&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">RSA&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">AES256&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">GCM&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">SHA384&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">ECDHE&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ECDSA&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">CHACHA20&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">POLY1305&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">ECDHE&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">RSA&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">CHACHA20&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">POLY1305&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">DHE&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">RSA&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">AES128&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">GCM&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">SHA256&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">DHE&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">RSA&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">AES256&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">GCM&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">SHA384&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">TLS_AES_128_GCM_SHA256&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">TLS_AES_256_GCM_SHA384&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">TLS_CHACHA20_POLY1305_SHA256&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">minTLSVersion&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">VersionTLS12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">apply&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">f&lt;/span> &lt;span class="n">router&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ingress&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Warning&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">resource&lt;/span> &lt;span class="n">ingresscontrollers&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">default&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">missing&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">kubectl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">last&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">applied&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">configuration&lt;/span> &lt;span class="n">annotation&lt;/span> &lt;span class="n">which&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">required&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">apply&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">apply&lt;/span> &lt;span class="n">should&lt;/span> &lt;span class="n">only&lt;/span> &lt;span class="n">be&lt;/span> &lt;span class="n">used&lt;/span> &lt;span class="n">on&lt;/span> &lt;span class="n">resources&lt;/span> &lt;span class="n">created&lt;/span> &lt;span class="n">declaratively&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="n">either&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">create&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">save&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">config&lt;/span> &lt;span class="ow">or&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">apply&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">The&lt;/span> &lt;span class="n">missing&lt;/span> &lt;span class="n">annotation&lt;/span> &lt;span class="n">will&lt;/span> &lt;span class="n">be&lt;/span> &lt;span class="n">patched&lt;/span> &lt;span class="n">automatically&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ingresscontroller&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">operator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">default&lt;/span> &lt;span class="n">configured&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">方法二&lt;/span> &lt;span class="err">（官方建議）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">edit&lt;/span> &lt;span class="n">ingresscontroller&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ingress&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">####加入下方 matchLabels&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">spec&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodePlacement&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodeSelector&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#### 確認ingress-operator已分配到Infra Node &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">get&lt;/span> &lt;span class="n">pod&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ingress&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">wide&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">NAME&lt;/span> &lt;span class="n">READY&lt;/span> &lt;span class="n">STATUS&lt;/span> &lt;span class="n">RESTARTS&lt;/span> &lt;span class="n">AGE&lt;/span> &lt;span class="ne">IP&lt;/span> &lt;span class="n">NODE&lt;/span> &lt;span class="n">NOMINATED&lt;/span> &lt;span class="n">NODE&lt;/span> &lt;span class="n">READINESS&lt;/span> &lt;span class="n">GATES&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">router&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="n">c67b4db8b&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">75&lt;/span>&lt;span class="n">pjr&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="n">Running&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="n">h44m&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">33.26&lt;/span> &lt;span class="n">worker1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">router&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="n">c67b4db8b&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">glwcq&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="n">Terminating&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="n">h44m&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">33.27&lt;/span> &lt;span class="n">worker2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">router&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="n">c4cc569cc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">85&lt;/span>&lt;span class="n">sbm&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="n">Pending&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">28&lt;/span>&lt;span class="n">s&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">get&lt;/span> &lt;span class="n">pod&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ingress&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">wide&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">NAME&lt;/span> &lt;span class="n">READY&lt;/span> &lt;span class="n">STATUS&lt;/span> &lt;span class="n">RESTARTS&lt;/span> &lt;span class="n">AGE&lt;/span> &lt;span class="ne">IP&lt;/span> &lt;span class="n">NODE&lt;/span> &lt;span class="n">NOMINATED&lt;/span> &lt;span class="n">NODE&lt;/span> &lt;span class="n">READINESS&lt;/span> &lt;span class="n">GATES&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">router&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="n">c4cc569cc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">86&lt;/span>&lt;span class="n">ggk&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="n">Running&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">18&lt;/span>&lt;span class="n">m&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">33.32&lt;/span> &lt;span class="n">infra2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">router&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="n">c4cc569cc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">97&lt;/span>&lt;span class="n">mlv&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="n">Running&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">49&lt;/span>&lt;span class="n">m&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">33.31&lt;/span> &lt;span class="n">infra1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="registry">Registry
&lt;/h5>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc get configs.imageregistry.operator.openshift.io/cluster -o yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc edit configs.imageregistry.operator.openshift.io/cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> logLevel: Normal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> managementState: Removed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> observedConfig: null
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> operatorLogLevel: Normal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy: {}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> requests:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> read:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> maxWaitInQueue: 0s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> write:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> maxWaitInQueue: 0s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rolloutStrategy: RollingUpdate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> storage: {}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> unsupportedConfigOverrides: null
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nodeSelector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/infra: &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc get pods -o wide -n openshift-image-registry
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster-image-registry-operator-598c5664bd-qz8cs 1/1 Running 0 23h 10.128.0.34 master1.ocp.ken.lab &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">image-pruner-27761760-jh4fz 0/1 Completed 0 101m 10.131.2.8 infra3.ocp.ken.lab &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node-ca-cdt8j 1/1 Running 0 22h 192.168.33.23 master1.ocp.ken.lab &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node-ca-dpzzb 1/1 Running 1 22h 192.168.33.32 infra2.ocp.ken.lab &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node-ca-hfv8c 1/1 Running 1 21h 192.168.33.33 infra3.ocp.ken.lab &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node-ca-hjptk 1/1 Running 1 22h 192.168.33.31 infra1.ocp.ken.lab &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node-ca-k2qhs 1/1 Running 0 22h 192.168.33.24 master2.ocp.ken.lab &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node-ca-lgkg8 1/1 Running 0 22h 192.168.33.27 worker2.ocp.ken.lab &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node-ca-wqpn8 1/1 Running 0 22h 192.168.33.25 master3.ocp.ken.lab &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node-ca-xt8dg 1/1 Running 0 22h 192.168.33.26 worker1.ocp.ken.lab &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="monitoring">Monitoring
&lt;/h5>&lt;p>Include: Prometheus, Thanos Querier, and Alertmanager
先建立ConfigMap cluster-monitor-config.yaml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">get&lt;/span> &lt;span class="n">pod&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitoring&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">wide&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">vim&lt;/span> &lt;span class="n">cluster&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitoring&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">apiVersion&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">v1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">kind&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">ConfigMap&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">metadata&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">cluster&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitoring&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">config&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">namespace&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitoring&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">data&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">|+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">alertmanagerMain&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodeSelector&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">prometheusK8s&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodeSelector&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">prometheusOperator&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodeSelector&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">k8sPrometheusAdapter&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodeSelector&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">kubeStateMetrics&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodeSelector&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">telemeterClient&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodeSelector&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">openshiftStateMetrics&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodeSelector&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">thanosQuerier&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodeSelector&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">---&lt;/span> &lt;span class="err">建立此&lt;/span>&lt;span class="n">ConfigMap&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">create&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">f&lt;/span> &lt;span class="n">cluster&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitoring&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">configmap&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cluster&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitoring&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">config&lt;/span> &lt;span class="n">created&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">---&lt;/span> &lt;span class="err">查看&lt;/span>&lt;span class="n">pod&lt;/span> &lt;span class="err">是否都移轉至&lt;/span>&lt;span class="n">infra&lt;/span> &lt;span class="n">node&lt;/span>&lt;span class="err">，若未移轉則&lt;/span>&lt;span class="n">delete該pod&lt;/span>&lt;span class="err">，使其重新部署&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">exporter&lt;/span>&lt;span class="err">、&lt;/span>&lt;span class="n">cluster&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitoring&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator不用刪除&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">watch&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">get&lt;/span> &lt;span class="n">pod&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitoring&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">wide&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">get&lt;/span> &lt;span class="n">pod&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitoring&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">wide&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">grep&lt;/span> &lt;span class="n">worker&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">get&lt;/span> &lt;span class="n">pod&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitoring&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">wide&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">grep&lt;/span> &lt;span class="n">master&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cluster&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitoring&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">574&lt;/span>&lt;span class="n">c5f5b7b&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sg6nh&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="n">Running&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">23&lt;/span>&lt;span class="n">h&lt;/span> &lt;span class="mf">10.128&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.33&lt;/span> &lt;span class="n">master1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">exporter&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">hr22c&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="n">Running&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">22&lt;/span>&lt;span class="n">h&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">33.23&lt;/span> &lt;span class="n">master1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">exporter&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">jnqkc&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="n">Running&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">22&lt;/span>&lt;span class="n">h&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">33.25&lt;/span> &lt;span class="n">master3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">exporter&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">lzk6n&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="n">Running&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">22&lt;/span>&lt;span class="n">h&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">33.24&lt;/span> &lt;span class="n">master2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="問題排除">問題排除
&lt;/h2>&lt;h3 id="調整">調整
&lt;/h3>&lt;h5 id="operatorhub-blank">OperatorHub Blank
&lt;/h5>&lt;h6 id="畫面空白">畫面空白
&lt;/h6>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012115352528.png"
loading="lazy"
alt="image-20221012115352528"
>&lt;/p>
&lt;h6 id="在install-configyaml">在install-config.yaml
&lt;/h6>&lt;p>裡面就要加入 marketplace的參數，sample是用來起template、image stream的operator
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012133723224.png"
loading="lazy"
alt="image-20221012133723224"
>&lt;/p>
&lt;h6 id="install-configyaml">install-config.yaml
&lt;/h6>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ vim install-config.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ cat install-config.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">baseDomain: ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">compute:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- hyperthreading: Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">controlPlane:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hyperthreading: Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: ocp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">networking:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> clusterNetwork:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - cidr: 10.128.0.0/14
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hostPrefix: 23
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> networkType: OpenShiftSDN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> serviceNetwork:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 172.30.0.0/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">platform:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> none: {}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">fips: false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pullSecret: &amp;#39;{&amp;#34;auths&amp;#34;:{&amp;#34;cloud.openshift.com&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K29jbV9hY2Nlc3NfMzEwNjVjNmVmMTk5NDZmNWEwNmUzZmI4MTVmNzk2OTE6NEJRVk1FVk9CTDRZQVRBT0pONEhQVkIyUExFQTdKNDE3WExFU1IzVDk3NU1YUTJXWE9FSjBNTVk0MzFQQk9RUA==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;},&amp;#34;quay.io&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K29jbV9hY2Nlc3NfMzEwNjVjNmVmMTk5NDZmNWEwNmUzZmI4MTVmNzk2OTE6NEJRVk1FVk9CTDRZQVRBT0pONEhQVkIyUExFQTdKNDE3WExFU1IzVDk3NU1YUTJXWE9FSjBNTVk0MzFQQk9RUA==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;},&amp;#34;registry.connect.redhat.com&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;fHVoYy1wb29sLTc5MzgwY2YyLTUxNTEtNGRiNi04YjA3LTRiNzQ4NDcxNWE2NDpleUpoYkdjaU9pSlNVelV4TWlKOS5leUp6ZFdJaU9pSmxOak5rWVdWbU1tSXlaRFEwTVdKaVlUTXpObVUwTkdGbVl6WmtPVEUwWVNKOS5RMlp6Q1JaWWltVDIxM2dpYU9CRWtNWEVkYUtjbnc4WHN1bTY3VEVOdjEyRjBjQUgyNWNZMVdWTjZNUEY2R21CNjh3TmF4TnoxRHVpVnBtY0ZKM2JZTW0yNVVzZGJxeFc4cEd1dGszSzF5NlNUWk9VejlkU0V4UGg4aUxha05qSEQ4Tml6emNmM1lUQjRNUXdhYTVFSG1PMXVTUERUZFRBTXFYS3FFa2gwRXpHOUpKZTlUMnM4bVJXWkVIbndoZW84cktncVZuV1VCeGhqTldFNElfWG1JZnBPRl91akpFNHdXNzRJWjd5UmdoUGExQVVwS3BsY0NJQ2ZGdGtaS29WUTFwNTBzUzNabkxWYjd6ZHdXR21WcXVsNUFoZUNiSHNoNEtpSjFnYXRSbkwtMG92THZoNGdseUZqd0c0Z3lMMEdyS1ItbU5WMFZYc01mVzJDNXNVaXBzVmhKcmhmY01vQjRNSDRDbjZKcjJXS2plbEdqSVdHQzBUV1BBNlZQZDBmc0lyLTRCY2RBdUFmcm5SaWpGM3d0Mng3RFdXQ1RScFVPbUVMY3U5bDR6Wm5uZkVSejNMd01rNmhCWTFyYXV1TGhCWXJraFlzQURqWEl3bGxPTkwyc01GMUU2OVNIVG1vV0tvNU5fdHdoWE5fX1BtT1ozMzc5ZVNDVGdnTFNZd3hyR1VwS3FXRDFva3JWZlRIWmNlcTk4WHQ2QjFtZHIxcmxLV2RiRmhsRDQ3Q1pldEhrNW1xQUlianp1UzlONENJWllhd0lIZE5LWVotN2tRNFQyUFg4QWdadHFNdHdjY2c0bWx3ME40c09LbWVZN2Q2bGw0bXpXV201bVo0aktTeHdpYmJ3STEwOFcxWVFlSlQ4QW9WZFlkc09YWkdWc3ZxZVVZOU9qbzR2RQ==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;},&amp;#34;registry.redhat.io&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;fHVoYy1wb29sLTc5MzgwY2YyLTUxNTEtNGRiNi04YjA3LTRiNzQ4NDcxNWE2NDpleUpoYkdjaU9pSlNVelV4TWlKOS5leUp6ZFdJaU9pSmxOak5rWVdWbU1tSXlaRFEwTVdKaVlUTXpObVUwTkdGbVl6WmtPVEUwWVNKOS5RMlp6Q1JaWWltVDIxM2dpYU9CRWtNWEVkYUtjbnc4WHN1bTY3VEVOdjEyRjBjQUgyNWNZMVdWTjZNUEY2R21CNjh3TmF4TnoxRHVpVnBtY0ZKM2JZTW0yNVVzZGJxeFc4cEd1dGszSzF5NlNUWk9VejlkU0V4UGg4aUxha05qSEQ4Tml6emNmM1lUQjRNUXdhYTVFSG1PMXVTUERUZFRBTXFYS3FFa2gwRXpHOUpKZTlUMnM4bVJXWkVIbndoZW84cktncVZuV1VCeGhqTldFNElfWG1JZnBPRl91akpFNHdXNzRJWjd5UmdoUGExQVVwS3BsY0NJQ2ZGdGtaS29WUTFwNTBzUzNabkxWYjd6ZHdXR21WcXVsNUFoZUNiSHNoNEtpSjFnYXRSbkwtMG92THZoNGdseUZqd0c0Z3lMMEdyS1ItbU5WMFZYc01mVzJDNXNVaXBzVmhKcmhmY01vQjRNSDRDbjZKcjJXS2plbEdqSVdHQzBUV1BBNlZQZDBmc0lyLTRCY2RBdUFmcm5SaWpGM3d0Mng3RFdXQ1RScFVPbUVMY3U5bDR6Wm5uZkVSejNMd01rNmhCWTFyYXV1TGhCWXJraFlzQURqWEl3bGxPTkwyc01GMUU2OVNIVG1vV0tvNU5fdHdoWE5fX1BtT1ozMzc5ZVNDVGdnTFNZd3hyR1VwS3FXRDFva3JWZlRIWmNlcTk4WHQ2QjFtZHIxcmxLV2RiRmhsRDQ3Q1pldEhrNW1xQUlianp1UzlONENJWllhd0lIZE5LWVotN2tRNFQyUFg4QWdadHFNdHdjY2c0bWx3ME40c09LbWVZN2Q2bGw0bXpXV201bVo0aktTeHdpYmJ3STEwOFcxWVFlSlQ4QW9WZFlkc09YWkdWc3ZxZVVZOU9qbzR2RQ==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;}}}&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sshKey: &amp;#39;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIN1Z2jXmGnPWGAVrtltN9A2q5D8QtJlRvhvdB2QXoZG devop@bastion.ocp.ken.lab&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">capabilities:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> baselineCapabilitySet: None
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> additionalEnabledCapabilities:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - marketplace
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Gigamon_on_OCP</title><link>https://wangken0129.github.io/p/gigamon_on_ocp/</link><pubDate>Sat, 23 Sep 2023 03:50:05 +0800</pubDate><guid>https://wangken0129.github.io/p/gigamon_on_ocp/</guid><description>&lt;h1 id="gigamon-uct-on-ocp">Gigamon UCT on OCP
&lt;/h1>&lt;p>&lt;a class="link" href="https://docs.gigamon.com/pdfs/Content/Resources/PDF%20Library/GV-6000-Doc/Universal-Container-Tap-Guide-v60.pdf#page18" target="_blank" rel="noopener"
>https://docs.gigamon.com/pdfs/Content/Resources/PDF%20Library/GV-6000-Doc/Universal-Container-Tap-Guide-v60.pdf#page18&lt;/a>&lt;/p>
&lt;p>安裝Gigamon UCT 在RedHat Openshift上，讓Gigamon可以監看Openshift的流量，&lt;/p>
&lt;p>UCT會透過daemon set的方式安裝在每個Node上面，所以需要修改Project的權限。&lt;/p>
&lt;h2 id="安裝步驟">安裝步驟
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>create new project , 並加ssc給此project&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">oc new-project
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">oc adm policy add-scc-to-user anyuid -z default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">oc adm policy add-scc-to-user privileged -n gigamon -z default
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>Gigamon UTC-Controller,修改FM IP、Port (default 443)、External DNS、API等等
以及image版本,要注意第一個執行目錄會有所不同,可以的話用podman run起來看看&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[ocpadmin@Bastion gigamon]$ cat uct-controller.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Copyright 2020 Gigamon Inc.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">##################################################################################################
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># UCT service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">##################################################################################################
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: Service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: gigamon-uct-cntlr-service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> labels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app: uct-cntlr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service: gigamon-uct-cntlr-service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # change the namespace tp match your namespace
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespace: gigamon
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ports:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - port: 8443
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> protocol: TCP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: uct-rest
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> targetPort: 8443
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - port: 42042
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> protocol: TCP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: uct-stats
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> targetPort: 42042
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> selector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app: uct-cntlr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: apps/v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: Deployment
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: uct-cntlr-v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # change the namespace tp match your namespace
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespace: gigamon
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> labels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app: uct-cntlr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> version: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> selector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> matchLabels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app: uct-cntlr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> version: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> template:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> labels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app: uct-cntlr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> version: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # this below serviceAccountName should match with the ServiceAccount
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # name under ClusterRoleBinding section.It is recommended to use
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # a non default name as customers may use name of their choice.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # non default serviceAccountName should be created using the kubectl.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # kubectl create serviceaccount &amp;lt;non default name&amp;gt; -n &amp;lt;namespace&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> serviceAccountName: default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> containers:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: uct-cntlr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image: gigamon/uct-controller:6.2.00-374893
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # Usage:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # /uct-cntlr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;lt;FM IP&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;lt;FM REST Svc Port&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;lt;UCT-Cntlr REST SVC Port&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;lt;mTLS Mode: 1(ON)|0(OFF))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;lt;Cert Path&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;lt;Cert file&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;lt;Pvt Key&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;lt;CA-Root&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> command:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - /uct-controller
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &amp;#34;192.168.85.197&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &amp;#39;443&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &amp;#39;8443&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &amp;#39;0&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &amp;#34;/etc/gcbcerts&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &amp;#34;gcb-cert.pem&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &amp;#34;gcb-pvt-key.pem&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &amp;#34;gcb-ca-root-cert.pem&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #command: [/giga_setup_init]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> imagePullPolicy: Always
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ports:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - containerPort: 8443
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - containerPort: 42042
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> env:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # Service name.Shoudl match name specified in metadata section above.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: UCT_CNTLR_SERVICE_NAME
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &amp;#34;gigamon-uct-cntlr-service&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # External LB balancer IP, for controller (FM) to connect to uct-cntlr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: UCT_CNTLR_EXT_IP_DNS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &amp;#34;gigamon-uct.ocp.dynasafelab.local&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # K8S cluster end-point (typically, master nodes with default port of 6443)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # example: kubectl cluster-info cmd should give this value
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: K8S_CLUSTER_ENDPOINT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &amp;#34;https://api.ocp.dynasafelab.local:6443&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # This value is upto user to specify. Will accept any value
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: FM_FQDN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &amp;#34;fm.dynasafelab.local&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # Namespace of pod - gets from metadata
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: UCT_CNTLR_POD_NAMESPACE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valueFrom:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fieldRef:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fieldPath: metadata.namespace
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # This value is to enable inventory collection through yaml file.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # true means enable, false or any other value means disable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: UCT_CNTLR_INVENTORY_COLLECTION_ENABLE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &amp;#34;false&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # We are specifying HOME dir as /pod-data to work with SCC restrictions
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: HOME
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &amp;#34;/pod-data&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # For No mTLS Case, Volume Mount is Optional.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> volumeMounts:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - mountPath: /etc/gcbcerts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: pki-path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - mountPath: /pod-data
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: shared-data
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> volumes:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - emptyDir: {}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: shared-data
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - emptyDir: {}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: pki-path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> imagePullSecrets:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: gig-dock-regkey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: ClusterRole
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: rbac.authorization.k8s.io/v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: pods-list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rules:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- apiGroups: [&amp;#34;&amp;#34;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resources: [&amp;#34;pods&amp;#34;,&amp;#34;services&amp;#34;, &amp;#34;nodes&amp;#34;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> verbs: [&amp;#34;get&amp;#34;,&amp;#34;watch&amp;#34;,&amp;#34;list&amp;#34;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- apiGroups: [&amp;#34;apps&amp;#34;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resources: [&amp;#34;deployments&amp;#34;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> verbs: [&amp;#34;list&amp;#34;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: ClusterRoleBinding
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: rbac.authorization.k8s.io/v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: pods-list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">subjects:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- kind: ServiceAccount
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #change the below namespace as per the requirement
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespace: gigamon
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">roleRef:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kind: ClusterRole
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: pods-list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> apiGroup: rbac.authorization.k8s.io
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>Gigamon UTC-Tap , 注意此為Daemonset 所以一定要加scc不然會過不了
我把原文件的SecurityContext刪除,改用scc
修改service的名稱 、image版本&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;span class="lnt">84
&lt;/span>&lt;span class="lnt">85
&lt;/span>&lt;span class="lnt">86
&lt;/span>&lt;span class="lnt">87
&lt;/span>&lt;span class="lnt">88
&lt;/span>&lt;span class="lnt">89
&lt;/span>&lt;span class="lnt">90
&lt;/span>&lt;span class="lnt">91
&lt;/span>&lt;span class="lnt">92
&lt;/span>&lt;span class="lnt">93
&lt;/span>&lt;span class="lnt">94
&lt;/span>&lt;span class="lnt">95
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">ocpadmin&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">Bastion&lt;/span> &lt;span class="n">gigamon&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">cat&lt;/span> &lt;span class="n">uct&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">tap&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">apiVersion&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">apps&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">v1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">kind&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">DaemonSet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">metadata&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">gigamon&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">uct&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">labels&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">app&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">gigamon&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">uct&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">version&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">v1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">spec&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">selector&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">app&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">gigamon&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">uct&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">version&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">v1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">template&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">metadata&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">labels&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">app&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">gigamon&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">uct&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">version&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">v1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">spec&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">restartPolicy&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Always&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hostPID&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hostNetwork&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">terminationGracePeriodSeconds&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">30&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">securityContext&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">containers&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">resources&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">limits&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cpu&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">memory&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">512&lt;/span>&lt;span class="n">Mi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">requests&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cpu&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">memory&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">512&lt;/span>&lt;span class="n">Mi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">gigamon&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">uct&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">command&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">uctapp&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">uct&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="s1">&amp;#39;3&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="s1">&amp;#39;55&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">env&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">LD_LIBRARY_PATH&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">value&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">UCT_DEBUG_MODE&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">value&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;0x0A000004&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">UCT_SERVICE_NAME&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">value&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">UCT_HTTP_SERVICE&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">UCT_CNTLR_SVC_DNS&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">value&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">gigamon&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">uct&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cntlr&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">UCT_CNTLR_REST_SVC_PORT&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">value&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;8443&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">UCT_WORKERNODE_NAME&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">valueFrom&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fieldRef&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">apiVersion&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">v1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fieldPath&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">spec&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nodeName&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">UCT_POD_NAMESPACE&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">valueFrom&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fieldRef&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">apiVersion&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">v1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fieldPath&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">metadata&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">namespace&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">UCT_POD_IP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">valueFrom&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fieldRef&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">apiVersion&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">v1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fieldPath&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">status&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">podIP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">UCT_NOKIA_SCP_VTAP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">value&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ports&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">hostPort&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">9443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">containerPort&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">9443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">protocol&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">TCP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">imagePullPolicy&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">IfNotPresent&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">volumeMounts&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">socket&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mountPath&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">containerd&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">containerd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sock&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">shared&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mountPath&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">pod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mountPropagation&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">None&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">map&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mountPath&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">sys&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">fs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bpf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">terminationMessagePolicy&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="ne">File&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">image&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;gigamon/uct-tap:6.2.00-374893&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">volumes&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">socket&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hostPath&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">containerd&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">containerd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sock&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">map&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hostPath&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">sys&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">fs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bpf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">shared&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">emptyDir&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dnsPolicy&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">ClusterFirstWithHostNet&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>UTC-Controller Routes , 此處因爲service endpoint走的是 8443, 所以加上edge的tls方式&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[ocpadmin@Bastion gigamon]$ cat cntrl-route.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: route.openshift.io/v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: Route
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: gigamon-uct-cntlr-service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespace: gigamon
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> host: gigamon-uct.apps.ocp.dynasafelab.local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> targetPort: 8443
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> to:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kind: Service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: gigamon-uct-cntlr-service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tls:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> termination: edge
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>最後oc apply -f 上述的yaml檔案&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[ocpadmin@Bastion gigamon]$ oc apply -f uct-controller.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[ocpadmin@Bastion gigamon]$ oc apply -f cntrl-route.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[ocpadmin@Bastion gigamon]$ oc apply -f uct-tap.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol></description></item><item><title>Hello World</title><link>https://wangken0129.github.io/p/hello-world/</link><pubDate>Tue, 19 Sep 2023 05:10:00 +0800</pubDate><guid>https://wangken0129.github.io/p/hello-world/</guid><description>&lt;h1 id="hello-world">Hello World
&lt;/h1>&lt;h2 id="description">Description
&lt;/h2>&lt;p>This is a blog for my labs and knowledge bases.&lt;/p>
&lt;p>Happy engineering.&lt;/p>
&lt;p>這是Ken的部落格，用來放我的Lab跟知識庫。&lt;/p>
&lt;p>當個快樂的工程師。&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/0*ngAthWxOvKZHvsw9.jpeg"
loading="lazy"
alt="The Dangers of Hacking and What a Hacker Can Do to Your Computer? | by Sravan Cynixit | Quick Code | Medium"
>&lt;/p>
&lt;h2 id="this-is-a-test-shell-script">This is a test shell script
&lt;/h2>&lt;p>Generate certificate script&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="c1"># Create certificate given a specific url name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="nv">$#&lt;/span> -ne &lt;span class="m">1&lt;/span> &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;No arguments supplied or too many arguments&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Usage: &lt;/span>&lt;span class="nv">$0&lt;/span>&lt;span class="s2"> domain_name&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">MYNAME&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Generating a private key...for &lt;/span>&lt;span class="nv">$MYNAME&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openssl genrsa -out &lt;span class="nv">$MYNAME&lt;/span>.key &lt;span class="m">2048&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Generating a CSR...for &lt;/span>&lt;span class="nv">$MYNAME&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openssl req -new -key &lt;span class="nv">$MYNAME&lt;/span>.key &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>-out &lt;span class="nv">$MYNAME&lt;/span>.csr &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>-subj &lt;span class="s2">&amp;#34;/C=US/ST=NC/L=Raleigh/O=RedHat/OU=RHT/CN=&lt;/span>&lt;span class="nv">$MYNAME&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Generating a certificate...for &lt;/span>&lt;span class="nv">$MYNAME&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openssl x509 -req -days &lt;span class="m">366&lt;/span> -in &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>&lt;span class="nv">$MYNAME&lt;/span>.csr -signkey &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>&lt;span class="nv">$MYNAME&lt;/span>.key &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>-out &lt;span class="nv">$MYNAME&lt;/span>.crt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item></channel></rss>