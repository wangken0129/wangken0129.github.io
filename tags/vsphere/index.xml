<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>VSphere on Ken's blog</title><link>https://wangken0129.github.io/tags/vsphere/</link><description>Recent content in VSphere on Ken's blog</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Mon, 03 Mar 2025 07:39:16 +0800</lastBuildDate><atom:link href="https://wangken0129.github.io/tags/vsphere/index.xml" rel="self" type="application/rss+xml"/><item><title>vSphere_on_Nutanix</title><link>https://wangken0129.github.io/p/vsphere_on_nutanix/</link><pubDate>Mon, 03 Mar 2025 07:39:16 +0800</pubDate><guid>https://wangken0129.github.io/p/vsphere_on_nutanix/</guid><description>&lt;h1 id="vsphere-on-nutanix">vSphere on Nutanix
&lt;/h1>&lt;p>透過Nutanix Foundation安裝vSphere ESXi，並執行後續的設定，&lt;/p>
&lt;p>Foundation步驟因為很簡單此處就不多加贅述，&lt;/p>
&lt;p>原則上會建議先把Nutanix Node加入vCenter，再將Nutanix Cluster建立好，&lt;/p>
&lt;p>因為加入vCenter時Node會需要進入維護模式，如有Nutanix Cluster運作時，&lt;/p>
&lt;p>變成要一台一台加入vCenter，執行速度上會比較慢。&lt;/p>
&lt;h2 id="參考文件">參考文件
&lt;/h2>&lt;p>&lt;a class="link" href="https://portal.nutanix.com/page/documents/details?targetId=vSphere-Admin6-AOS-v6_5:vsp-cluster-introduction-vsphere-c.html" target="_blank" rel="noopener"
>https://portal.nutanix.com/page/documents/details?targetId=vSphere-Admin6-AOS-v6_5:vsp-cluster-introduction-vsphere-c.html&lt;/a>&lt;/p>
&lt;h2 id="foundation">Foundation
&lt;/h2>&lt;ol>
&lt;li>準備vSphere ESXi、vCenter的iso檔&lt;/li>
&lt;li>利用mac的foundation安裝nutanix&lt;/li>
&lt;li>安裝時改用vSphere的iso檔&lt;/li>
&lt;li>如不是使用官方Support的版本,要提供md5 check sum&lt;/li>
&lt;li>目前支援到vSphere ESXi 7.0u3c , 實測7.0u3g也可以安裝&lt;/li>
&lt;li>安裝時間約50~60min&lt;/li>
&lt;/ol>
&lt;h2 id="安裝後的設定">安裝後的設定
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>設定DNS Server&lt;/p>
&lt;/li>
&lt;li>
&lt;p>設定NTP Server&lt;/p>
&lt;/li>
&lt;li>
&lt;p>刪除Default Container,再新增一個 (因名稱太長)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>設定Virtual IP、Data Service IP&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Deploy vCenter or Registry to vCenter
&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117115309394.png"
loading="lazy"
alt="image-20230117115309394"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117115414091.png"
loading="lazy"
alt="image-20230117115414091"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117115559389.png"
loading="lazy"
alt="image-20230117115559389"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117120202663.png"
loading="lazy"
alt="image-20230117120202663"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117120702169.png"
loading="lazy"
alt="image-20230117120702169"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117121452623.png"
loading="lazy"
alt="image-20230117121452623"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117121557920.png"
loading="lazy"
alt="image-20230117121557920"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>vCenter Setting&lt;/p>
&lt;ul>
&lt;li>先在vCenter Create Datacenter並新增Nutanix Cluster
Cluster &lt;strong>開啟DRS、HA&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117122218272.png"
loading="lazy"
alt="image-20230117122218272"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117131129201.png"
loading="lazy"
alt="image-20230117131129201"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>確認Checklist都有設定完畢才能加入Nutanix Node&lt;/strong>
HA&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Enable Host Monitoring&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Set the Host Isolation Response of the cluster to &lt;strong>Power Off &amp;amp; Restart VMs&lt;/strong>.
&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117143553864.png"
loading="lazy"
alt="image-20230117143553864"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Enable admission control (%)&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117142443552.png"
loading="lazy"
alt="image-20230117142443552"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Set the VM Restart Priority of all CVMs to &lt;strong>Disabled&lt;/strong>. &amp;ndash; After register
&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117142551006.png"
loading="lazy"
alt="image-20230117142551006"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117142719050.png"
loading="lazy"
alt="image-20230117142719050"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Set the VM Monitoring for all CVMs to &lt;strong>Disabled&lt;/strong>. &amp;ndash; After register&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117142810049.png"
loading="lazy"
alt="image-20230117142810049"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Datastore heartbeats &amp;ndash; After register&lt;/p>
&lt;p>(只有一個Datastore時,增加此設定)
&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117134844420.png"
loading="lazy"
alt="image-20230117134844420"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117142910096.png"
loading="lazy"
alt="image-20230117142910096"
>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>DRS&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Set the Automation Level on all CVMs to &lt;strong>Disabled&lt;/strong>. &amp;ndash;After register
&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117142728280.png"
loading="lazy"
alt="image-20230117142728280"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Select Automation Level to accept level 3 recommendations.&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117135654108.png"
loading="lazy"
alt="image-20230117135654108"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Leave power management &lt;strong>disabled&lt;/strong>.
&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117135332448.png"
loading="lazy"
alt="image-20230117135332448"
>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Others&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Configure advertised capacity for the Nutanix storage container (RF2)
&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117140918527.png"
loading="lazy"
alt="image-20230117140918527"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Store VM swapfiles in the same directory as the VM.&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117143410180.png"
loading="lazy"
alt="image-20230117143410180"
>
&lt;a class="link" href="https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.resmgmt.doc/GUID-12B8E0FB-CD43-4972-AC2C-4B4E2955A5DA.html" target="_blank" rel="noopener"
>https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.resmgmt.doc/GUID-12B8E0FB-CD43-4972-AC2C-4B4E2955A5DA.html&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Enable&lt;/strong> enhanced vMotion compatibility (EVC) in the cluster.
&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117140459645.png"
loading="lazy"
alt="image-20230117140459645"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Configure Nutanix CVMs with the appropriate VM overrides. &amp;ndash;After register
(HA、DRS、Monitoring &lt;strong>Disabled&lt;/strong>)&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>vCenter Adding Nutanix nodes&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117141404460.png"
loading="lazy"
alt="image-20230117141404460"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117141430544.png"
loading="lazy"
alt="image-20230117141430544"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117141503268.png"
loading="lazy"
alt="image-20230117141503268"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117141525157.png"
loading="lazy"
alt="image-20230117141525157"
>&lt;/p>
&lt;p>實測第一台Node會被順利加到Cluster內,其他兩台需手動移入
&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117142411214.png"
loading="lazy"
alt="image-20230117142411214"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>補齊Checklist的設定&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Register Nutanix Cluster to vCenter
&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117143835885.png"
loading="lazy"
alt="image-20230117143835885"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117143908067.png"
loading="lazy"
alt="image-20230117143908067"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117144024141.png"
loading="lazy"
alt="image-20230117144024141"
>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="安裝後的設定-pc">安裝後的設定-PC
&lt;/h2>&lt;p>&lt;a class="link" href="https://portal.nutanix.com/page/documents/details?targetId=Acropolis-Upgrade-Guide:upg-vm-install-wc-r.html" target="_blank" rel="noopener"
>https://portal.nutanix.com/page/documents/details?targetId=Acropolis-Upgrade-Guide:upg-vm-install-wc-r.html&lt;/a>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>create PC (可用Online下載或是部署時上傳PC的檔案)
&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117144856189.png" alt="image-20230117144856189" style="zoom:50%;" />&lt;/p>
&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117144919733.png" alt="image-20230117144919733" style="zoom:50%;" />
&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117145119576.png" alt="image-20230117145119576" style="zoom:50%;" />
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117160527103.png"
loading="lazy"
alt="image-20230117160527103"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>PC建立好後即可用web連線
預設帳密 admin , Nutanix/4u
若無法登入web,可以在PE開PCVM的console,用nutanix / nutanix/4u的帳密登入
登入後切換身份為root 執行以下指令來重設admin密碼&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ncli user reset-password user-name=admin password=password
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117162037651.png"
loading="lazy"
alt="image-20230117162037651"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>註冊Nutanix Cluster至Prism Central (PC)
&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117162121479.png"
loading="lazy"
alt="image-20230117162121479"
>
&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117162141769.png"
loading="lazy"
alt="image-20230117162141769"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117162216948.png"
loading="lazy"
alt="image-20230117162216948"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>註冊完成即可在PC上看到Nutanix Cluster
&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117162314773.png"
loading="lazy"
alt="image-20230117162314773"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Prism Central 設定NTP、DNS Server&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Enable Microserivces Infrastructure (可使用更多功能)
&lt;a class="link" href="https://portal.nutanix.com/page/documents/details?targetId=Prism-Central-Guide-vpc_2022_6:mul-cmsp-overview-pc-c.html" target="_blank" rel="noopener"
>https://portal.nutanix.com/page/documents/details?targetId=Prism-Central-Guide-vpc_2022_6:mul-cmsp-overview-pc-c.html&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2025/03/image-20230117162822002.png"
loading="lazy"
alt="image-20230117162822002"
>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h1 id="vsphere-settings-checklist">vSphere Settings Checklist
&lt;/h1>&lt;p>&lt;a class="link" href="https://portal.nutanix.com/page/documents/details?targetId=vSphere-Admin6-AOS-v6_5:vsp-vcenter-settings-r.html" target="_blank" rel="noopener"
>https://portal.nutanix.com/page/documents/details?targetId=vSphere-Admin6-AOS-v6_5:vsp-vcenter-settings-r.html&lt;/a>&lt;/p>
&lt;p>Review the following checklist of the settings that you have to configure to successfully deploy vSphere virtual environment running Nutanix Enterprise cloud.&lt;/p>
&lt;h2 id="vsphere-availability-settings">vSphere Availability Settings
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>&lt;strong>Enable&lt;/strong> host monitoring.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Enable&lt;/strong> admission control and use the percentage-based policy with a value based on the number of nodes in the cluster.&lt;/p>
&lt;p>For more information about settings of percentage of cluster resources reserved as failover spare capacity, &lt;a class="link" href="https://portal.nutanix.com/page/documents/details?targetId=vSphere-Admin6-AOS-v6_5:vsp-cluster-settings-admissioncontrol-vcenter-vsphere-r.html" target="_blank" rel="noopener"
>vSphere HA Admission Control Settings for Nutanix Environment&lt;/a>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Set the VM Restart Priority of all CVMs to &lt;strong>Disabled&lt;/strong>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Set the Host Isolation Response of the cluster to &lt;strong>Power Off &amp;amp; Restart VMs&lt;/strong>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Set the VM Monitoring for all CVMs to &lt;strong>Disabled&lt;/strong>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Enable datastore heartbeats by clicking &lt;strong>Use datastores only from the specified list&lt;/strong> and choosing the Nutanix NFS datastore.&lt;/p>
&lt;p>If the cluster has only one datastore, click &lt;strong>Advanced Options&lt;/strong> tab and add das.ignoreInsufficientHbDatastore with &lt;strong>Value&lt;/strong> of true.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="vsphere-drs-settings">vSphere DRS Settings
&lt;/h2>&lt;ul>
&lt;li>Set the Automation Level on all CVMs to &lt;strong>Disabled&lt;/strong>.&lt;/li>
&lt;li>Select Automation Level to accept level 3 recommendations.&lt;/li>
&lt;li>Leave power management &lt;strong>disabled&lt;/strong>.&lt;/li>
&lt;/ul>
&lt;h2 id="other-cluster-settings">Other Cluster Settings
&lt;/h2>&lt;ul>
&lt;li>Configure advertised capacity for the Nutanix storage container
(total usable capacity minus the capacity of one node for replication factor 2 or two nodes for replication factor 3).&lt;/li>
&lt;li>Store VM swapfiles in the same directory as the VM.&lt;/li>
&lt;li>&lt;strong>Enable&lt;/strong> enhanced vMotion compatibility (EVC) in the cluster. For more information, see &lt;a class="link" href="https://portal.nutanix.com/page/documents/details?targetId=vSphere-Admin6-AOS-v6_5:vsp-cluster-settings-evc-vcenter-vsphere-t.html" target="_blank" rel="noopener"
>vSphere EVC Settings&lt;/a>.&lt;/li>
&lt;li>Configure Nutanix CVMs with the appropriate VM overrides. For more information, see &lt;a class="link" href="https://portal.nutanix.com/page/documents/details?targetId=vSphere-Admin6-AOS-v6_5:vsp-cluster-settings-override-vcenter-vsphere-t.html" target="_blank" rel="noopener"
>VM Override Settings&lt;/a>.&lt;/li>
&lt;li>Check &lt;a class="link" href="https://portal.nutanix.com/page/documents/details?targetId=vSphere-Admin6-AOS-v6_5:vsp-node-components-unconfigurable-vsphere-r.html" target="_blank" rel="noopener"
>Nonconfigurable ESXi Components&lt;/a>. Modifying the nonconfigurable components may inadvertently constrain performance of your Nutanix cluster or render the Nutanix cluster inoperable.&lt;/li>
&lt;/ul></description></item></channel></rss>