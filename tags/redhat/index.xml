<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Redhat on Ken's blog</title><link>https://wangken0129.github.io/tags/redhat/</link><description>Recent content in Redhat on Ken's blog</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Sat, 23 Sep 2023 08:19:11 +0800</lastBuildDate><atom:link href="https://wangken0129.github.io/tags/redhat/index.xml" rel="self" type="application/rss+xml"/><item><title>OCP-4.11.9_on_vSphere(UPI)</title><link>https://wangken0129.github.io/p/ocp-4.11.9_on_vsphereupi/</link><pubDate>Sat, 23 Sep 2023 08:19:11 +0800</pubDate><guid>https://wangken0129.github.io/p/ocp-4.11.9_on_vsphereupi/</guid><description>&lt;h1 id="install-openshift-4119-on-vsphereupi">Install Openshift 4.11.9 on vSphere(UPI)
&lt;/h1>&lt;h3 id="說明">說明
&lt;/h3>&lt;p>&lt;a class="link" href="https://docs.openshift.com/container-platform/4.11/installing/installing_vsphere/installing-vsphere.html" target="_blank" rel="noopener"
>https://docs.openshift.com/container-platform/4.11/installing/installing_vsphere/installing-vsphere.html&lt;/a>
&lt;a class="link" href="https://cloud.redhat.com/blog/deploying-openshift-4.4-to-vmware-vsphere-7?hsLang=en-us" target="_blank" rel="noopener"
>https://cloud.redhat.com/blog/deploying-openshift-4.4-to-vmware-vsphere-7?hsLang=en-us&lt;/a>&lt;/p>
&lt;ol>
&lt;li>用Mac 當作Client&lt;/li>
&lt;li>需要事先安裝好Bastion&lt;/li>
&lt;li>Bastion安裝設定Named、HAProxy、Web Server (這裡用Nginx)&lt;/li>
&lt;li>用rhcos-4.11.9.ova 來ESXi 部署ovf 範本&lt;/li>
&lt;/ol>
&lt;h3 id="下載oc-client">下載OC Client
&lt;/h3>&lt;p>&lt;a class="link" href="https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.11.9/openshift-client-mac-4.11.9.tar.gz" target="_blank" rel="noopener"
>https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.11.9/openshift-client-mac-4.11.9.tar.gz&lt;/a>&lt;/p>
&lt;h3 id="下載ocp-installer">下載OCP Installer
&lt;/h3>&lt;p>&lt;a class="link" href="https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.11.9/openshift-install-mac-4.11.9.tar.gz" target="_blank" rel="noopener"
>https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.11.9/openshift-install-mac-4.11.9.tar.gz&lt;/a>&lt;/p>
&lt;h3 id="下載coreos-4119ova">下載CoreOS-4.11.9.ova
&lt;/h3>&lt;p>&lt;a class="link" href="https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.11/4.11.9/rhcos-4.11.9-x86_64-vmware.x86_64.ova" target="_blank" rel="noopener"
>https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.11/4.11.9/rhcos-4.11.9-x86_64-vmware.x86_64.ova&lt;/a>&lt;/p>
&lt;h3 id="下載pull-secret">下載Pull-Secret
&lt;/h3>&lt;p>&lt;a class="link" href="https://console.redhat.com/openshift/downloads#tool-pull-secret" target="_blank" rel="noopener"
>https://console.redhat.com/openshift/downloads#tool-pull-secret&lt;/a>&lt;/p>
&lt;h3 id="named">Named
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-dns" data-lang="dns">&lt;span class="line">&lt;span class="cl">&lt;span class="nc">Named&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">設定檔&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">[root@bastion&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">~]#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">cat&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">/etc/&lt;/span>&lt;span class="nc">named.conf&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">//&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">//&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nc">named.conf&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">//&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">//&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">Provided&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">Red&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">Hat&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">bind&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">package&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">to&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">configure&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">the&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">ISC&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">BIND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">named&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sc">8&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">DNS&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">//&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">server&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">caching&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">only&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">nameserver&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="err">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">localhost&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">DNS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">resolver&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">only&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="err">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">//&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">//&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">See&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">/usr/share/doc/bind*/sample/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">example&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">named&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">configuration&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">files.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">//&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">options&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">listen-on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">port&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">53&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">any&lt;/span>&lt;span class="c">; };&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">listen-on-v6&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">port&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">53&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">::&lt;/span>&lt;span class="sc">1&lt;/span>&lt;span class="c">; };&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">directory&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/var/named&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">dump-file&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/var/named/data/&lt;/span>&lt;span class="nc">cache_dump.db&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">statistics-file&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/var/named/data/&lt;/span>&lt;span class="nc">named_stats.txt&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">memstatistics-file&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/var/named/data/&lt;/span>&lt;span class="nc">named_mem_stats.txt&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">secroots-file&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/var/named/data/&lt;/span>&lt;span class="nc">named.secroots&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">recursing-file&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/var/named/data/&lt;/span>&lt;span class="nc">named.recursing&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">allow-query&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">any&lt;/span>&lt;span class="c">; };&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">##&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">設定轉寄站&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">forwarders&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.2.12&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.2.11&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">}&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">/*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">If&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">you&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">are&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">building&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">an&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">AUTHORITATIVE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">DNS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">server,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">do&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">enable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">recursion.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">If&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">you&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">are&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">building&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">RECURSIVE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="err">caching&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">DNS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">server,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">you&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">need&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">to&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">enable&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="py">recursion. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">If&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">your&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">recursive&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">DNS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">server&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">has&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">IP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">address,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">you&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">MUST&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">enable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">access&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">control&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">to&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">limit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">queries&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">to&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">your&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">legitimate&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">users. &lt;/span>&lt;span class="err">Failing&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">to&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">do&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">so&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">will&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">cause&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">your&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">server&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">to&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">become&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">part&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">of&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">large&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">scale&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">DNS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">amplification&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="py">attacks. &lt;/span>&lt;span class="err">Implementing&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">BCP38&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">within&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">your&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">network&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">would&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">greatly&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">reduce&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">such&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">attack&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">surface&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">*/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">recursion&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">yes&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">dnssec-enable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">yes&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">dnssec-validation&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">yes&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">managed-keys-directory&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/var/named/dynamic&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">pid-file&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/run/named/&lt;/span>&lt;span class="nc">named.pid&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">session-keyfile&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/run/named/&lt;/span>&lt;span class="nc">session.key&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">/*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">https://&lt;/span>&lt;span class="nc">fedoraproject.org&lt;/span>&lt;span class="err">/wiki/Changes/CryptoPolicy&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">*/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">include&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/etc/crypto-policies/back-ends/&lt;/span>&lt;span class="nc">bind.config&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">}&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">logging&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">channel&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">default_debug&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">file&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;data/&lt;/span>&lt;span class="nc">named.run&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">severity&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">dynamic&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">}&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">}&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">zone&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;.&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">hint&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">file&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="nc">named.ca&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">}&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">zone&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="nc">ocp.infotech.com.tw&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">master&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">file&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/var/named/&lt;/span>&lt;span class="nc">forward.bastion.ocp&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">allow-update&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">none&lt;/span>&lt;span class="c">; };&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">allow-query&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">any&lt;/span>&lt;span class="c">; };&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">allow-transfer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">none&lt;/span>&lt;span class="c">; };&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">}&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">zone&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="sc">3&lt;/span>&lt;span class="nc">.168.192.in-addr.arpa&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">master&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">file&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/var/named/&lt;/span>&lt;span class="nc">reverse.bastion.ocp&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">allow-update&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">none&lt;/span>&lt;span class="c">; };&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">allow-query&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">any&lt;/span>&lt;span class="c">; };&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">allow-transfer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">none&lt;/span>&lt;span class="c">; };&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">}&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">include&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/etc/&lt;/span>&lt;span class="nc">named.rfc1912.zones&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">include&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;/etc/&lt;/span>&lt;span class="nc">named.root.key&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">------&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">正向解析&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">[root@bastion&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">~]#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">cat&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">/var/named/&lt;/span>&lt;span class="nc">forward.bastion.ocp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="na">$TTL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">1&lt;/span>&lt;span class="err">W&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">@&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SOA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">ns1.infotech.com.tw. &lt;/span>&lt;span class="err">root&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">2019070700&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; serial&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">3&lt;/span>&lt;span class="err">H&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; refresh (3 hours)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">30&lt;/span>&lt;span class="err">M&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; retry (30 minutes)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">2&lt;/span>&lt;span class="err">W&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; expiry (2 weeks)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">1&lt;/span>&lt;span class="err">W&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; minimum (1 week)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">ns1.infotech.com.tw.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">MX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">10&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">smtp.infotech.com.tw.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">ns1.infotech.com.tw. &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.37&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">smtp.infotech.com.tw. &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.37&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">helper.infotech.com.tw. &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.37&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">helper.ocp.infotech.com.tw. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.37&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">api.ocp.infotech.com.tw. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.37&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">api-int.ocp.infotech.com.tw. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.37&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">*&lt;/span>&lt;span class="nc">.apps.ocp.infotech.com.tw.&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.37&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">bootstrap.ocp.infotech.com.tw. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.36&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">master1.ocp.infotech.com.tw. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.31&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">master2.ocp.infotech.com.tw. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.32&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">master3.ocp.infotech.com.tw. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.33&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">worker1.ocp.infotech.com.tw. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.34&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">worker2.ocp.infotech.com.tw. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.3.35&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;EOF&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">-------&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">反向解析&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">[root@bastion&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">~]#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">cat&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">/var/named/&lt;/span>&lt;span class="nc">reverse.bastion.ocp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="na">$TTL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">1&lt;/span>&lt;span class="err">W&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">@&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SOA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">ns1.infotech.com.tw. &lt;/span>&lt;span class="err">root&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">2019070700&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; serial&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">3&lt;/span>&lt;span class="err">H&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; refresh (3 hours)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">30&lt;/span>&lt;span class="err">M&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; retry (30 minutes)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">2&lt;/span>&lt;span class="err">W&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; expiry (2 weeks)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">1&lt;/span>&lt;span class="err">W&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; minimum (1 week)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">ns1.infotech.com.tw.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">37.3.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">api.ocp.infotech.com.tw. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">37.3.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">api-int.ocp.infotech.com.tw. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">36.3.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">bootstrap.ocp.infotech.com.tw. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">31.3.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">master1.ocp.infotech.com.tw. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">32.3.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">master2.ocp.infotech.com.tw. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">33.3.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">master3.ocp.infotech.com.tw. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">34.3.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">worker1.ocp.infotech.com.tw. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">35.3.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">worker2.ocp.infotech.com.tw. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;EOF&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="haproxy">HAProxy
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># cat /etc/haproxy/haproxy.cfg&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">global&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">log&lt;/span> &lt;span class="mf">127.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.1&lt;/span> &lt;span class="n">local2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pidfile&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">haproxy&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pid&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">maxconn&lt;/span> &lt;span class="mi">4000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">daemon&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">defaults&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">http&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">log&lt;/span> &lt;span class="n">global&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">dontlognull&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">close&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">redispatch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">retries&lt;/span> &lt;span class="mi">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">request&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">queue&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">m&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">connect&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">client&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">m&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">server&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">m&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">keep&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">alive&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">maxconn&lt;/span> &lt;span class="mi">3000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">frontend&lt;/span> &lt;span class="n">stats&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bind&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">1936&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">http&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">log&lt;/span> &lt;span class="n">global&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">maxconn&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">hide&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">version&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">refresh&lt;/span> &lt;span class="mi">30&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">show&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">node&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">show&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">desc&lt;/span> &lt;span class="n">Stats&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">ocp&lt;/span> &lt;span class="n">cluster&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">auth&lt;/span> &lt;span class="n">admin&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">ocp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">uri&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">stats&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">listen&lt;/span> &lt;span class="n">api&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">6443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bind&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">tcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">bootstrap&lt;/span> &lt;span class="n">bootstrap&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span> &lt;span class="n">backup&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master1&lt;/span> &lt;span class="n">master1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master2&lt;/span> &lt;span class="n">master2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master3&lt;/span> &lt;span class="n">master3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">listen&lt;/span> &lt;span class="n">machine&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">22623&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bind&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22623&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">tcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">bootstrap&lt;/span> &lt;span class="n">bootstrap&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22623&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span> &lt;span class="n">backup&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master1&lt;/span> &lt;span class="n">master1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22623&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master2&lt;/span> &lt;span class="n">master2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22623&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master3&lt;/span> &lt;span class="n">master3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22623&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">listen&lt;/span> &lt;span class="n">ingress&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">router&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bind&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">tcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">balance&lt;/span> &lt;span class="n">source&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">worker1&lt;/span> &lt;span class="n">worker1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">worker2&lt;/span> &lt;span class="n">worker2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">listen&lt;/span> &lt;span class="n">ingress&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">router&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">80&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bind&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">80&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">tcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">balance&lt;/span> &lt;span class="n">source&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">worker1&lt;/span> &lt;span class="n">worker1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">80&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">worker2&lt;/span> &lt;span class="n">worker2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">infotech&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">80&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="nginx">Nginx
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;span class="lnt">84
&lt;/span>&lt;span class="lnt">85
&lt;/span>&lt;span class="lnt">86
&lt;/span>&lt;span class="lnt">87
&lt;/span>&lt;span class="lnt">88
&lt;/span>&lt;span class="lnt">89
&lt;/span>&lt;span class="lnt">90
&lt;/span>&lt;span class="lnt">91
&lt;/span>&lt;span class="lnt">92
&lt;/span>&lt;span class="lnt">93
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="err">根目錄&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginx&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">html&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Port&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">8000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">html&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># cat /etc/nginx/nginx.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># For more information on configuration, see:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * Official English Documentation: http://nginx.org/en/docs/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * Official Russian Documentation: http://nginx.org/ru/docs/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">user&lt;/span> &lt;span class="n">nginx&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">worker_processes&lt;/span> &lt;span class="n">auto&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">error_log&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginx&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">error&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">log&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pid&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginx&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pid&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">include&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginx&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="o">/*.&lt;/span>&lt;span class="n">conf&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">events&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">worker_connections&lt;/span> &lt;span class="mi">1024&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">http&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log_format&lt;/span> &lt;span class="n">main&lt;/span> &lt;span class="s1">&amp;#39;$remote_addr - $remote_user [$time_local] &amp;#34;$request&amp;#34; &amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;$status $body_bytes_sent &amp;#34;$http_referer&amp;#34; &amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#34;$http_user_agent&amp;#34; &amp;#34;$http_x_forwarded_for&amp;#34;&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">access_log&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginx&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">access&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">log&lt;/span> &lt;span class="n">main&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sendfile&lt;/span> &lt;span class="n">on&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tcp_nopush&lt;/span> &lt;span class="n">on&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tcp_nodelay&lt;/span> &lt;span class="n">on&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">keepalive_timeout&lt;/span> &lt;span class="mi">65&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">types_hash_max_size&lt;/span> &lt;span class="mi">2048&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">include&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginx&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">types&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default_type&lt;/span> &lt;span class="n">application&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">octet&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">stream&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Load modular configuration files from the /etc/nginx/conf.d directory.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># See http://nginx.org/en/docs/ngx_core_module.html#include&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># for more information.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">include&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginx&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">conf&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="o">/*.&lt;/span>&lt;span class="n">conf&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">listen&lt;/span> &lt;span class="mi">8000&lt;/span> &lt;span class="n">default_server&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">listen&lt;/span> &lt;span class="p">[::]:&lt;/span>&lt;span class="mi">8000&lt;/span> &lt;span class="n">default_server&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server_name&lt;/span> &lt;span class="n">_&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">root&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginx&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">html&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Load configuration files for the default server block.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">include&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginx&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="o">/*.&lt;/span>&lt;span class="n">conf&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">location&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">error_page&lt;/span> &lt;span class="mi">404&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="mf">404.&lt;/span>&lt;span class="n">html&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">location&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="mi">40&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">html&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">error_page&lt;/span> &lt;span class="mi">500&lt;/span> &lt;span class="mi">502&lt;/span> &lt;span class="mi">503&lt;/span> &lt;span class="mi">504&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="mi">50&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">html&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">location&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="mi">50&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">html&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Settings for a TLS enabled server.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># server {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># listen 443 ssl http2 default_server;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># listen [::]:443 ssl http2 default_server;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># server_name _;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># root /usr/share/nginx/html;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ssl_certificate &amp;#34;/etc/pki/nginx/server.crt&amp;#34;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ssl_certificate_key &amp;#34;/etc/pki/nginx/private/server.key&amp;#34;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ssl_session_cache shared:SSL:1m;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ssl_session_timeout 10m;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ssl_ciphers PROFILE=SYSTEM;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ssl_prefer_server_ciphers on;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># # Load configuration files for the default server block.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># include /etc/nginx/default.d/*.conf;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># location / {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># }&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># error_page 404 /404.html;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># location = /40x.html {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># }&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># error_page 500 502 503 504 /50x.html;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># location = /50x.html {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># }&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># }&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="產生安裝檔案">產生安裝檔案
&lt;/h2>&lt;h3 id="確認-cli-tool">確認 cli tool
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ ls -l
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total 2232728
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x 8 wangken staff 256 12 13 15:36 .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-x---+ 41 wangken staff 1312 12 13 15:35 ..
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r--@ 1 wangken staff 706 10 8 18:41 README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rwxr-xr-x@ 2 wangken staff 98436592 10 6 20:06 kubectl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rwxr-xr-x@ 2 wangken staff 98436592 10 6 20:06 oc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r--@ 1 wangken staff 44116650 12 13 15:06 openshift-client-mac-4.11.9.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rwxr-xr-x@ 1 wangken staff 528956912 10 8 18:41 openshift-install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r--@ 1 wangken staff 363543317 12 13 15:07 openshift-install-mac-4.11.9.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ./oc version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Client Version: 4.11.9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Kustomize Version: v4.5.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ./openshift-install version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./openshift-install 4.11.9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">built from commit 01a6869a6f1208fb4d112060c5971432fdd619cf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">release image quay.io/openshift-release-dev/ocp-release@sha256:94b611f00f51c9acc44ca3f4634e46bd79d7d28b46047c7e3389d250698f0c99
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">release architecture amd64
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="產生ssh-key-bastion">產生SSH key (Bastion)
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@bastion .ssh]# cat id_rsa
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----BEGIN OPENSSH PRIVATE KEY-----
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">QyNTUxOQAAACDF/jswkiYiL+jXDMMUpwga7CGV79kXtcMnOpbzO5xOwQAAAKjY1yrT2Ncq
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">0wAAAAtzc2gtZWQyNTUxOQAAACDF/jswkiYiL+jXDMMUpwga7CGV79kXtcMnOpbzO5xOwQ
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">AAAEBIWOmAtlitDdZXhb+1vtMnSbNBRQfyANPR/eHUPuisK8X+OzCSJiIv6NcMwxSnCBrs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IZXv2Re1wyc6lvM7nE7BAAAAIWRldm9wQGJhc3Rpb24ub2NwLmluZm90ZWNoLmNvbS50dw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ECAwQ=
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----END OPENSSH PRIVATE KEY-----
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion .ssh]# cat id_rsa.pub
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIMX+OzCSJiIv6NcMwxSnCBrsIZXv2Re1wyc6lvM7nE7B devop@bastion.ocp.infotech.com.tw
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="建立install-configyaml">建立Install-config.yaml
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">baseDomain: infotech.com.tw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">compute:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- hyperthreading: Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">controlPlane:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hyperthreading: Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: ocp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">networking:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> clusterNetwork:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - cidr: 10.128.0.0/14
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hostPrefix: 23
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> networkType: OpenShiftSDN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> serviceNetwork:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 172.30.0.0/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">platform:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vsphere:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vcenter: tpeinfovcsa7p.infotech.com.tw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> username: cisadmin@vsphere.local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> password: P@55w.rd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> datacenter: TPECIS_Datacenter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> defaultDatastore: v7000_CIS01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> diskType: thin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">fips: false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pullSecret: &amp;#39;{&amp;#34;auths&amp;#34;:{&amp;#34;cloud.openshift.com&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K29jbV9hY2Nlc3NfMzEwNjVjNmVmMTk5NDZmNWEwNmUzZmI4MTVmNzk2OTE6NEJRVk1FVk9CTDRZQVRBT0pONEhQVkIyUExFQTdKNDE3WExFU1IzVDk3NU1YUTJXWE9FSjBNTVk0MzFQQk9RUA==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;},&amp;#34;quay.io&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K29jbV9hY2Nlc3NfMzEwNjVjNmVmMTk5NDZmNWEwNmUzZmI4MTVmNzk2OTE6NEJRVk1FVk9CTDRZQVRBT0pONEhQVkIyUExFQTdKNDE3WExFU1IzVDk3NU1YUTJXWE9FSjBNTVk0MzFQQk9RUA==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;},&amp;#34;registry.connect.redhat.com&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;fHVoYy1wb29sLTc5MzgwY2YyLTUxNTEtNGRiNi04YjA3LTRiNzQ4NDcxNWE2NDpleUpoYkdjaU9pSlNVelV4TWlKOS5leUp6ZFdJaU9pSmxOak5rWVdWbU1tSXlaRFEwTVdKaVlUTXpObVUwTkdGbVl6WmtPVEUwWVNKOS5RMlp6Q1JaWWltVDIxM2dpYU9CRWtNWEVkYUtjbnc4WHN1bTY3VEVOdjEyRjBjQUgyNWNZMVdWTjZNUEY2R21CNjh3TmF4TnoxRHVpVnBtY0ZKM2JZTW0yNVVzZGJxeFc4cEd1dGszSzF5NlNUWk9VejlkU0V4UGg4aUxha05qSEQ4Tml6emNmM1lUQjRNUXdhYTVFSG1PMXVTUERUZFRBTXFYS3FFa2gwRXpHOUpKZTlUMnM4bVJXWkVIbndoZW84cktncVZuV1VCeGhqTldFNElfWG1JZnBPRl91akpFNHdXNzRJWjd5UmdoUGExQVVwS3BsY0NJQ2ZGdGtaS29WUTFwNTBzUzNabkxWYjd6ZHdXR21WcXVsNUFoZUNiSHNoNEtpSjFnYXRSbkwtMG92THZoNGdseUZqd0c0Z3lMMEdyS1ItbU5WMFZYc01mVzJDNXNVaXBzVmhKcmhmY01vQjRNSDRDbjZKcjJXS2plbEdqSVdHQzBUV1BBNlZQZDBmc0lyLTRCY2RBdUFmcm5SaWpGM3d0Mng3RFdXQ1RScFVPbUVMY3U5bDR6Wm5uZkVSejNMd01rNmhCWTFyYXV1TGhCWXJraFlzQURqWEl3bGxPTkwyc01GMUU2OVNIVG1vV0tvNU5fdHdoWE5fX1BtT1ozMzc5ZVNDVGdnTFNZd3hyR1VwS3FXRDFva3JWZlRIWmNlcTk4WHQ2QjFtZHIxcmxLV2RiRmhsRDQ3Q1pldEhrNW1xQUlianp1UzlONENJWllhd0lIZE5LWVotN2tRNFQyUFg4QWdadHFNdHdjY2c0bWx3ME40c09LbWVZN2Q2bGw0bXpXV201bVo0aktTeHdpYmJ3STEwOFcxWVFlSlQ4QW9WZFlkc09YWkdWc3ZxZVVZOU9qbzR2RQ==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;},&amp;#34;registry.redhat.io&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;fHVoYy1wb29sLTc5MzgwY2YyLTUxNTEtNGRiNi04YjA3LTRiNzQ4NDcxNWE2NDpleUpoYkdjaU9pSlNVelV4TWlKOS5leUp6ZFdJaU9pSmxOak5rWVdWbU1tSXlaRFEwTVdKaVlUTXpObVUwTkdGbVl6WmtPVEUwWVNKOS5RMlp6Q1JaWWltVDIxM2dpYU9CRWtNWEVkYUtjbnc4WHN1bTY3VEVOdjEyRjBjQUgyNWNZMVdWTjZNUEY2R21CNjh3TmF4TnoxRHVpVnBtY0ZKM2JZTW0yNVVzZGJxeFc4cEd1dGszSzF5NlNUWk9VejlkU0V4UGg4aUxha05qSEQ4Tml6emNmM1lUQjRNUXdhYTVFSG1PMXVTUERUZFRBTXFYS3FFa2gwRXpHOUpKZTlUMnM4bVJXWkVIbndoZW84cktncVZuV1VCeGhqTldFNElfWG1JZnBPRl91akpFNHdXNzRJWjd5UmdoUGExQVVwS3BsY0NJQ2ZGdGtaS29WUTFwNTBzUzNabkxWYjd6ZHdXR21WcXVsNUFoZUNiSHNoNEtpSjFnYXRSbkwtMG92THZoNGdseUZqd0c0Z3lMMEdyS1ItbU5WMFZYc01mVzJDNXNVaXBzVmhKcmhmY01vQjRNSDRDbjZKcjJXS2plbEdqSVdHQzBUV1BBNlZQZDBmc0lyLTRCY2RBdUFmcm5SaWpGM3d0Mng3RFdXQ1RScFVPbUVMY3U5bDR6Wm5uZkVSejNMd01rNmhCWTFyYXV1TGhCWXJraFlzQURqWEl3bGxPTkwyc01GMUU2OVNIVG1vV0tvNU5fdHdoWE5fX1BtT1ozMzc5ZVNDVGdnTFNZd3hyR1VwS3FXRDFva3JWZlRIWmNlcTk4WHQ2QjFtZHIxcmxLV2RiRmhsRDQ3Q1pldEhrNW1xQUlianp1UzlONENJWllhd0lIZE5LWVotN2tRNFQyUFg4QWdadHFNdHdjY2c0bWx3ME40c09LbWVZN2Q2bGw0bXpXV201bVo0aktTeHdpYmJ3STEwOFcxWVFlSlQ4QW9WZFlkc09YWkdWc3ZxZVVZOU9qbzR2RQ==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;}}}&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sshKey: &amp;#39;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIMX+OzCSJiIv6NcMwxSnCBrsIZXv2Re1wyc6lvM7nE7B devop@bastion.ocp.infotech.com.tw&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">capabilities:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> baselineCapabilitySet: vCurrent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> platform:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vsphere:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vcenter: tpeinfovcsa7p.infotech.com.tw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> username: cisadmin@vsphere.local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> password: P@55w.rd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> datacenter: TPECIS_Datacenter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> defaultDatastore: v7000_CIS01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> diskType: thin
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="產生ignition-file">產生Ignition file
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">./openshift-install create manifests --dir install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./openshift-install create ignition-configs --dir install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Consuming Openshift Manifests from target directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Consuming Common Manifests from target directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Consuming Worker Machines from target directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Consuming Master Machines from target directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Consuming OpenShift Install (Manifests) from target directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Ignition-Configs created in: install and install/auth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cd install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total 2960
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x 9 wangken staff 288 12 13 16:27 .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x 11 wangken staff 352 12 13 15:56 ..
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- 1 wangken staff 67239 12 13 16:27 .openshift_install.log
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r----- 1 wangken staff 1154395 12 13 16:27 .openshift_install_state.json
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-x--- 4 wangken staff 128 12 13 16:27 auth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r----- 1 wangken staff 275583 12 13 16:27 bootstrap.ign
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r----- 1 wangken staff 1721 12 13 16:27 master.ign
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r----- 1 wangken staff 94 12 13 16:27 metadata.json
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r----- 1 wangken staff 1721 12 13 16:27 worker.ign
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="複製ignition-file-到web">複製Ignition File 到Web
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">scp *.ign root@192.168.3.37:/usr/share/nginx/html/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@192.168.3.37&amp;#39;s password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bootstrap.ign 100% 269KB 3.5MB/s 00:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master.ign 100% 1721 86.9KB/s 00:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker.ign 100% 1721 188.5KB/s 00:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat merge-bootstrap.ign
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;ignition&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;config&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;merge&amp;#34;: [
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;source&amp;#34;: &amp;#34;http://192.168.3.37:8000/bootstrap.ign&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;verification&amp;#34;: {}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;timeouts&amp;#34;: {},
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;version&amp;#34;: &amp;#34;3.2.0&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;networkd&amp;#34;: {},
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;passwd&amp;#34;: {},
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;storage&amp;#34;: {},
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;systemd&amp;#34;: {}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----轉檔為Base64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod 644 *.ign
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion html]# base64 -w0 merge-bootstrap.ign &amp;gt; merge-bootstrap.64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ewogICJpZ25pdGlvbiI6IHsKICAgICJjb25maWciOiB7CiAgICAgICJtZXJnZSI6IFsKICAgICAgICB7CiAgICAgICAgICAic291cmNlIjogImh0dHA6Ly8xOTIuMTY4LjMuMzc6ODAwMC9ib290c3RyYXAuaWduIiwKICAgICAgICAgICJ2ZXJpZmljYXRpb24iOiB7fQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgICJ0aW1lb3V0cyI6IHt9LAogICAgInZlcnNpb24iOiAiMy4yLjAiCiAgfSwKICAibmV0d29ya2QiOiB7fSwKICAicGFzc3dkIjoge30sCiAgInN0b3JhZ2UiOiB7fSwKICAic3lzdGVtZCI6IHt9Cn0K
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion html]# base64 -w0 master.ign &amp;gt; master.64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion html]# base64 -w0 worker.ign &amp;gt; worker.64
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="複製ovf至vm">複製OVF至VM
&lt;/h2>&lt;h3 id="調整參數">調整參數
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">vApp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1. base64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bootstrap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ewogICJpZ25pdGlvbiI6IHsKICAgICJjb25maWciOiB7CiAgICAgICJtZXJnZSI6IFsKICAgICAgICB7CiAgICAgICAgICAic291cmNlIjogImh0dHA6Ly8xOTIuMTY4LjMuMzc6ODAwMC9ib290c3RyYXAuaWduIiwKICAgICAgICAgICJ2ZXJpZmljYXRpb24iOiB7fQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgICJ0aW1lb3V0cyI6IHt9LAogICAgInZlcnNpb24iOiAiMy4yLjAiCiAgfSwKICAibmV0d29ya2QiOiB7fSwKICAicGFzc3dkIjoge30sCiAgInN0b3JhZ2UiOiB7fSwKICAic3lzdGVtZCI6IHt9Cn0K
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">eyJpZ25pdGlvbiI6eyJjb25maWciOnsibWVyZ2UiOlt7InNvdXJjZSI6Imh0dHBzOi8vYXBpLWludC5vY3AuaW5mb3RlY2guY29tLnR3OjIyNjIzL2NvbmZpZy9tYXN0ZXIifV19LCJzZWN1cml0eSI6eyJ0bHMiOnsiY2VydGlmaWNhdGVBdXRob3JpdGllcyI6W3sic291cmNlIjoiZGF0YTp0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTg7YmFzZTY0LExTMHRMUzFDUlVkSlRpQkRSVkpVU1VaSlEwRlVSUzB0TFMwdENrMUpTVVJGUkVORFFXWnBaMEYzU1VKQlowbEpXV1JoZUZwMFZXVkVha2wzUkZGWlNrdHZXa2xvZG1OT1FWRkZURUpSUVhkS2FrVlRUVUpCUjBFeFZVVUtRM2hOU21JelFteGliazV2WVZkYU1FMVNRWGRFWjFsRVZsRlJSRVYzWkhsaU1qa3dURmRPYUUxQ05GaEVWRWw1VFZSSmVFMTZRVFJPUkZVeFRteHZXQXBFVkUxNVRWUkplRTFFUVRST1JGVXhUbXh2ZDBwcVJWTk5Ra0ZIUVRGVlJVTjRUVXBpTTBKc1ltNU9iMkZYV2pCTlVrRjNSR2RaUkZaUlVVUkZkMlI1Q21JeU9UQk1WMDVvVFVsSlFrbHFRVTVDWjJ0eGFHdHBSemwzTUVKQlVVVkdRVUZQUTBGUk9FRk5TVWxDUTJkTFEwRlJSVUV6U0hWcVNHc3haaTlCWWxNS2FHcEdhemxtV0hOelZqZFJNVzlJUVRkVFNqQnVlVkpqTDJNMmR6aERPV1ZUV1dkTWNIWnJjSEZEY3pCdFR5dE9NMHRGTW5Kb2VTdDVVVUZyUVN0eEt3cE5TVkJXVURWRU9HRjFkM3BwWTFOUFZERm5WR2xTTmpreWFFVTFVVEUwYmtaS1N6bE5UMGRaWkdJeFJFTklNazlJYkZkMWRqRktlVlJvUW5admJuRXhDamw2VG01SldreG5iMWRUUm5SWGNtMVFhR05vY3pJeE5sVTVhREpDY0U1QmIwbzJXbU01TjBZM09UWnRLMFpLVlVKeGRFSnhVMVU1UW0xMmEwbHZSa3dLVFd0dE5HczVORk50UzFCRVpURnpPSEZGY0ZGM2FDdDVhbGRPV214aFkyeHRaMGRTTVdkRFptbGxPRGt3UjJ4dWRUazFSbWMwWjBORVFXMHpNRkZ4V2dvdk1tVkNXVEJ2ZW5kMFkyOTZVakZVVkU1cVpUSnpXaTlPZEhBMUwyRTBiR3RMYjNweGJXSnpURE13U25aaFNtbzVlVmh4T1VRelZtRnZVV2xIWkhWbENsQkpMMlJ6WkZsTWEzZEpSRUZSUVVKdk1FbDNVVVJCVDBKblRsWklVVGhDUVdZNFJVSkJUVU5CY1ZGM1JIZFpSRlpTTUZSQlVVZ3ZRa0ZWZDBGM1JVSUtMM3BCWkVKblRsWklVVFJGUm1kUlZXdEljR1IyVG5sUlVuZzFkVWhoTjJoWmJ6Tm9RM0Y2ZDJ4M1VYZEVVVmxLUzI5YVNXaDJZMDVCVVVWTVFsRkJSQXBuWjBWQ1FVbzVlRnBRTlRNeVZqWjBaa3RVVGxSVGFGTllWbEZVTlRCdmF6VkRUR3h1ZVVaNWRtRkNjV2huZEhwVlZsZGpPR2xGVTFocWFYbHJSRlZxQ2twallXcFZOSEZaU1ZkSmVGWlJNVmR3Um5GcFNqQlpkbTV4TXpOa2JFMUdORTg1U1VWT1owTXdkRGx3UjI1R1NGSlpLMUV6YjA5WVkzUXdWRlF2UkhVS1JuSnpXbFpoTTJsVE1rZDRaSGc1ZDFsV1pFbHVUVzV2V0VscFFrRlliMDlaTTBaNVYwRlROakJOV1RkMmVXTkhObXRLVFZWdVpUbDRVbGRyWjBsRFJBcDZOVXBXU0RSUE1FZ3pZVGxaTVhsSFowODBTVVpSVVN0c1JsZENiMmhOU2xrelpXaEpXR05oVDJORGJsWTNZV1pvUXpKcVVHbFpPRTFrZFdsWU9HRkRDblExUkdVM1psQjRUMmsxVWpSclZWQmtWRFYwYkhGeldHdEliWEJFU3lzM1ZVaFZLMk13ZFdGd1FVTjVObVUzU1U1U1dGbHViVkpMTlVadFJUSkZPVVFLUmxoc2NXdEtTM1JITVVoVU5rSXdZbnB5UzBsU05ucDVPVVJyUFFvdExTMHRMVVZPUkNCRFJWSlVTVVpKUTBGVVJTMHRMUzB0Q2c9PSJ9XX19LCJ2ZXJzaW9uIjoiMy4yLjAifX0=
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">eyJpZ25pdGlvbiI6eyJjb25maWciOnsibWVyZ2UiOlt7InNvdXJjZSI6Imh0dHBzOi8vYXBpLWludC5vY3AuaW5mb3RlY2guY29tLnR3OjIyNjIzL2NvbmZpZy93b3JrZXIifV19LCJzZWN1cml0eSI6eyJ0bHMiOnsiY2VydGlmaWNhdGVBdXRob3JpdGllcyI6W3sic291cmNlIjoiZGF0YTp0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTg7YmFzZTY0LExTMHRMUzFDUlVkSlRpQkRSVkpVU1VaSlEwRlVSUzB0TFMwdENrMUpTVVJGUkVORFFXWnBaMEYzU1VKQlowbEpXV1JoZUZwMFZXVkVha2wzUkZGWlNrdHZXa2xvZG1OT1FWRkZURUpSUVhkS2FrVlRUVUpCUjBFeFZVVUtRM2hOU21JelFteGliazV2WVZkYU1FMVNRWGRFWjFsRVZsRlJSRVYzWkhsaU1qa3dURmRPYUUxQ05GaEVWRWw1VFZSSmVFMTZRVFJPUkZVeFRteHZXQXBFVkUxNVRWUkplRTFFUVRST1JGVXhUbXh2ZDBwcVJWTk5Ra0ZIUVRGVlJVTjRUVXBpTTBKc1ltNU9iMkZYV2pCTlVrRjNSR2RaUkZaUlVVUkZkMlI1Q21JeU9UQk1WMDVvVFVsSlFrbHFRVTVDWjJ0eGFHdHBSemwzTUVKQlVVVkdRVUZQUTBGUk9FRk5TVWxDUTJkTFEwRlJSVUV6U0hWcVNHc3haaTlCWWxNS2FHcEdhemxtV0hOelZqZFJNVzlJUVRkVFNqQnVlVkpqTDJNMmR6aERPV1ZUV1dkTWNIWnJjSEZEY3pCdFR5dE9NMHRGTW5Kb2VTdDVVVUZyUVN0eEt3cE5TVkJXVURWRU9HRjFkM3BwWTFOUFZERm5WR2xTTmpreWFFVTFVVEUwYmtaS1N6bE5UMGRaWkdJeFJFTklNazlJYkZkMWRqRktlVlJvUW5admJuRXhDamw2VG01SldreG5iMWRUUm5SWGNtMVFhR05vY3pJeE5sVTVhREpDY0U1QmIwbzJXbU01TjBZM09UWnRLMFpLVlVKeGRFSnhVMVU1UW0xMmEwbHZSa3dLVFd0dE5HczVORk50UzFCRVpURnpPSEZGY0ZGM2FDdDVhbGRPV214aFkyeHRaMGRTTVdkRFptbGxPRGt3UjJ4dWRUazFSbWMwWjBORVFXMHpNRkZ4V2dvdk1tVkNXVEJ2ZW5kMFkyOTZVakZVVkU1cVpUSnpXaTlPZEhBMUwyRTBiR3RMYjNweGJXSnpURE13U25aaFNtbzVlVmh4T1VRelZtRnZVV2xIWkhWbENsQkpMMlJ6WkZsTWEzZEpSRUZSUVVKdk1FbDNVVVJCVDBKblRsWklVVGhDUVdZNFJVSkJUVU5CY1ZGM1JIZFpSRlpTTUZSQlVVZ3ZRa0ZWZDBGM1JVSUtMM3BCWkVKblRsWklVVFJGUm1kUlZXdEljR1IyVG5sUlVuZzFkVWhoTjJoWmJ6Tm9RM0Y2ZDJ4M1VYZEVVVmxLUzI5YVNXaDJZMDVCVVVWTVFsRkJSQXBuWjBWQ1FVbzVlRnBRTlRNeVZqWjBaa3RVVGxSVGFGTllWbEZVTlRCdmF6VkRUR3h1ZVVaNWRtRkNjV2huZEhwVlZsZGpPR2xGVTFocWFYbHJSRlZxQ2twallXcFZOSEZaU1ZkSmVGWlJNVmR3Um5GcFNqQlpkbTV4TXpOa2JFMUdORTg1U1VWT1owTXdkRGx3UjI1R1NGSlpLMUV6YjA5WVkzUXdWRlF2UkhVS1JuSnpXbFpoTTJsVE1rZDRaSGc1ZDFsV1pFbHVUVzV2V0VscFFrRlliMDlaTTBaNVYwRlROakJOV1RkMmVXTkhObXRLVFZWdVpUbDRVbGRyWjBsRFJBcDZOVXBXU0RSUE1FZ3pZVGxaTVhsSFowODBTVVpSVVN0c1JsZENiMmhOU2xrelpXaEpXR05oVDJORGJsWTNZV1pvUXpKcVVHbFpPRTFrZFdsWU9HRkRDblExUkdVM1psQjRUMmsxVWpSclZWQmtWRFYwYkhGeldHdEliWEJFU3lzM1ZVaFZLMk13ZFdGd1FVTjVObVUzU1U1U1dGbHViVkpMTlVadFJUSkZPVVFLUmxoc2NXdEtTM1JITVVoVU5rSXdZbnB5UzBsU05ucDVPVVJyUFFvdExTMHRMVVZPUkNCRFJWSlVTVVpKUTBGVVJTMHRMUzB0Q2c9PSJ9XX19LCJ2ZXJzaW9uIjoiMy4yLjAifX0=
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="設定ip">設定IP
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">guestinfo.afterburn.initrd.network-kargs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip=192.168.3.36::192.168.3.251:255.255.255.0:::none nameserver=192.168.3.37
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip=192.168.3.31::192.168.3.251:255.255.255.0:::none nameserver=192.168.3.37
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip=192.168.3.32::192.168.3.251:255.255.255.0:::none nameserver=192.168.3.37
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip=192.168.3.33::192.168.3.251:255.255.255.0:::none nameserver=192.168.3.37
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip=192.168.3.34::192.168.3.251:255.255.255.0:::none nameserver=192.168.3.37
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip=192.168.3.35::192.168.3.251:255.255.255.0:::none nameserver=192.168.3.37
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="先啟動bootstrap">先啟動bootstrap
&lt;/h2>&lt;h2 id="再啟動master">再啟動Master
&lt;/h2>&lt;h2 id="啟動worker後-approve-csr">啟動Worker後 Approve CSR
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$oc adm certificate approve &amp;lt;csr_name&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$oc get csr -o go-template=&amp;#39;{{range .items}}{{if not .status}}{{.metadata.name}}{{&amp;#34;\n&amp;#34;}}{{end}}{{end}}&amp;#39; | xargs --no-run-if-empty oc adm certificate approve
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="storage-class">Storage Class
&lt;/h2>&lt;p>&lt;a class="link" href="https://access.redhat.com/solutions/4618011" target="_blank" rel="noopener"
>https://access.redhat.com/solutions/4618011&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://access.redhat.com/solutions/5900501" target="_blank" rel="noopener"
>https://access.redhat.com/solutions/5900501&lt;/a>
&lt;a class="link" href="https://www.ibm.com/support/pages/creating-persistent-volume-claim-fails-not-found-openshift" target="_blank" rel="noopener"
>https://www.ibm.com/support/pages/creating-persistent-volume-claim-fails-not-found-openshift&lt;/a>
&lt;a class="link" href="https://docs.openshift.com/container-platform/4.9/storage/persistent_storage/persistent-storage-vsphere.html" target="_blank" rel="noopener"
>https://docs.openshift.com/container-platform/4.9/storage/persistent_storage/persistent-storage-vsphere.html&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/rancher/rancher/issues/24258" target="_blank" rel="noopener"
>https://github.com/rancher/rancher/issues/24258&lt;/a>&lt;/p>
&lt;p>on vmware vsphere&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221214141836955.png"
loading="lazy"
alt="image-20221214141836955"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc get machineset ocp-7hb6g-worker -n openshift-machine-api -o yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: machine.openshift.io/v1beta1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: MachineSet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> annotations:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machine.openshift.io/memoryMb: &amp;#34;16384&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machine.openshift.io/vCPU: &amp;#34;4&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> creationTimestamp: &amp;#34;2022-12-13T09:05:14Z&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> generation: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> labels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machine.openshift.io/cluster-api-cluster: ocp-7hb6g
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: ocp-7hb6g-worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespace: openshift-machine-api
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resourceVersion: &amp;#34;12244&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> uid: e52a023d-bc9f-4fb5-a66a-776768e1aa7c
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> selector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> matchLabels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machine.openshift.io/cluster-api-cluster: ocp-7hb6g
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machine.openshift.io/cluster-api-machineset: ocp-7hb6g-worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> template:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> labels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machine.openshift.io/cluster-api-cluster: ocp-7hb6g
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machine.openshift.io/cluster-api-machine-role: worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machine.openshift.io/cluster-api-machine-type: worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machine.openshift.io/cluster-api-machineset: ocp-7hb6g-worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> lifecycleHooks: {}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> metadata: {}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> providerSpec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> apiVersion: machine.openshift.io/v1beta1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> credentialsSecret:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: vsphere-cloud-credentials
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> diskGiB: 120
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kind: VSphereMachineProviderSpec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> memoryMiB: 16384
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> creationTimestamp: null
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> devices:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - networkName: &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> numCPUs: 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> numCoresPerSocket: 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> snapshot: &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> template: ocp-7hb6g-rhcos
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> userDataSecret:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: worker-user-data
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> workspace:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> datacenter: TPECIS_Datacenter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> datastore: v7000_CIS01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> folder: /TPECIS_Datacenter/vm/ocp-7hb6g
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resourcePool: /TPECIS_Datacenter/host//Resources
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server: tpeinfovcsa7p.infotech.com.tw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">status:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> observedGeneration: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc get cm cloud-provider-config -n openshift-config -o yaml | grep folder
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> folder = &amp;#34;/TPECIS_Datacenter/vm/ocp-7hb6g&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221214151017424.png"
loading="lazy"
alt="image-20221214151017424"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221214151029390.png"
loading="lazy"
alt="image-20221214151029390"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221214151038817.png"
loading="lazy"
alt="image-20221214151038817"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221214151215733.png"
loading="lazy"
alt="image-20221214151215733"
>&lt;/p></description></item><item><title>OCP-4.11.7_on_Bare-metal</title><link>https://wangken0129.github.io/p/ocp-4.11.7_on_bare-metal/</link><pubDate>Sat, 23 Sep 2023 08:18:45 +0800</pubDate><guid>https://wangken0129.github.io/p/ocp-4.11.7_on_bare-metal/</guid><description>&lt;h1 id="install-openshift-v4117-on-bare-metal">Install Openshift v4.11.7 on Bare-metal
&lt;/h1>&lt;p>Ken Wang 2022/10/03&lt;/p>
&lt;p>Ken Wang 2022/11/23 v4.11.9&lt;/p>
&lt;h2 id="參考連結">參考連結
&lt;/h2>&lt;p>&lt;a class="link" href="https://docs.openshift.com/container-platform/4.11/welcome/index.html" target="_blank" rel="noopener"
>https://docs.openshift.com/container-platform/4.11/welcome/index.html&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.11/html/installing/installing-on-bare-metal#installing-bare-metal" target="_blank" rel="noopener"
>https://access.redhat.com/documentation/en-us/openshift_container_platform/4.11/html/installing/installing-on-bare-metal#installing-bare-metal&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://docs.openshift.com/container-platform/4.11/installing/installing_bare_metal/installing-bare-metal.html#installing-bare-metal" target="_blank" rel="noopener"
>https://docs.openshift.com/container-platform/4.11/installing/installing_bare_metal/installing-bare-metal.html#installing-bare-metal&lt;/a>&lt;/p>
&lt;p>CoreOS:
&lt;a class="link" href="https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.11/4.11.2/" target="_blank" rel="noopener"
>https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.11/4.11.2/&lt;/a>
&lt;a class="link" href="https://mirror.openshift.com/pub/openshift-v4/x86_64/dependencies/rhcos/4.11/4.11.9/rhcos-4.11.9-x86_64-live.x86_64.iso" target="_blank" rel="noopener"
>https://mirror.openshift.com/pub/openshift-v4/x86_64/dependencies/rhcos/4.11/4.11.9/rhcos-4.11.9-x86_64-live.x86_64.iso&lt;/a>&lt;/p>
&lt;p>OC Client:
&lt;a class="link" href="https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.11.9/openshift-client-linux.tar.gz" target="_blank" rel="noopener"
>https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.11.9/openshift-client-linux.tar.gz&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://docs.openshift.com/container-platform/4.11/post_installation_configuration/index.html" target="_blank" rel="noopener"
>https://docs.openshift.com/container-platform/4.11/post_installation_configuration/index.html&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/I8C/installing-openshift-on-single-vmware-esxi-host/blob/master/installBastion.sh" target="_blank" rel="noopener"
>https://github.com/I8C/installing-openshift-on-single-vmware-esxi-host/blob/master/installBastion.sh&lt;/a>&lt;/p>
&lt;p>僅供參考 &lt;a class="link" href="https://github.com/alanadiprastyo/openshift-4.6" target="_blank" rel="noopener"
>https://github.com/alanadiprastyo/openshift-4.6&lt;/a>&lt;/p>
&lt;p>automated&lt;/p>
&lt;p>&lt;a class="link" href="https://cloud.redhat.com/blog/fully-automated-openshift-deployments-with-vmware-vsphere" target="_blank" rel="noopener"
>https://cloud.redhat.com/blog/fully-automated-openshift-deployments-with-vmware-vsphere&lt;/a>&lt;/p>
&lt;h2 id="架構">架構
&lt;/h2>&lt;p>針對各版本的coreOS、Openshift-install 都要更新&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: left">主機名稱&lt;/th>
&lt;th>IP&lt;/th>
&lt;th>Mac&lt;/th>
&lt;th>版本&lt;/th>
&lt;th>功能&lt;/th>
&lt;th>磁碟空間&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: left">bastion.ken.lab&lt;/td>
&lt;td>192.168.33.21&lt;/td>
&lt;td>00:50:56:91:7c:24&lt;/td>
&lt;td>RHEL 9.0&lt;/td>
&lt;td>management&lt;/td>
&lt;td>100G、200G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">bootstrap.ocp.ken.lab&lt;/td>
&lt;td>192.168.33.22&lt;/td>
&lt;td>00:50:56:91:47:e9&lt;/td>
&lt;td>core 4.11-2&lt;/td>
&lt;td>bootstrap&lt;/td>
&lt;td>100G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">master1.ocp.ken.lab&lt;/td>
&lt;td>192.168.33.23&lt;/td>
&lt;td>00:50:56:91:88:f4&lt;/td>
&lt;td>core 4.11-2&lt;/td>
&lt;td>master&lt;/td>
&lt;td>100G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">master2.ocp.ken.lab&lt;/td>
&lt;td>192.168.33.24&lt;/td>
&lt;td>00:50:56:91:27:ed&lt;/td>
&lt;td>core 4.11-2&lt;/td>
&lt;td>master&lt;/td>
&lt;td>100G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">master3.ocp.ken.lab&lt;/td>
&lt;td>192.168.33.25&lt;/td>
&lt;td>00:50:56:91:08:33&lt;/td>
&lt;td>core 4.11-2&lt;/td>
&lt;td>master&lt;/td>
&lt;td>100G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">worker1.ocp.ken.lab&lt;/td>
&lt;td>192.168.33.26&lt;/td>
&lt;td>00:50:56:91:c6:29&lt;/td>
&lt;td>core 4.11-2&lt;/td>
&lt;td>worker&lt;/td>
&lt;td>100G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">worker2.ocp.ken.lab&lt;/td>
&lt;td>192.168.33.27&lt;/td>
&lt;td>00:50:56:91:d7:b4&lt;/td>
&lt;td>core 4.11-2&lt;/td>
&lt;td>worker&lt;/td>
&lt;td>100G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">infra1.ocp.ken.lab&lt;/td>
&lt;td>192.168.33.31&lt;/td>
&lt;td>00:50:56:91:14:ab&lt;/td>
&lt;td>core 4.11-2&lt;/td>
&lt;td>infra node&lt;/td>
&lt;td>100G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">infra2.ocp.ken.lab&lt;/td>
&lt;td>192.168.33.32&lt;/td>
&lt;td>00:50:56:91:0a:53&lt;/td>
&lt;td>core 4.11-2&lt;/td>
&lt;td>infra node&lt;/td>
&lt;td>100G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">infra3.ocp.ken.lab&lt;/td>
&lt;td>192.168.33.33&lt;/td>
&lt;td>00:50:56:91:78:05&lt;/td>
&lt;td>core 4.11-2&lt;/td>
&lt;td>infra node&lt;/td>
&lt;td>100G&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>主機名稱&lt;/th>
&lt;th>使用者帳密&lt;/th>
&lt;th>安裝目錄&lt;/th>
&lt;th>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>bastion.ken.lab&lt;/td>
&lt;td>devop / redhat&lt;/td>
&lt;td>/home/devop/ocp&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="安裝bastion">安裝Bastion
&lt;/h2>&lt;h3 id="安裝rhel-90--on-esxi">安裝RHEL 9.0 on ESXi
&lt;/h3>&lt;p>&lt;a class="link" href="https://kb.vmware.com/s/article/57122" target="_blank" rel="noopener"
>https://kb.vmware.com/s/article/57122&lt;/a>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>用iso 檔開機進入安裝引導畫面
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221003152533576.png"
loading="lazy"
alt="image-20221003152533576"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>設定磁碟、註冊、安裝軟體&lt;/p>
&lt;ul>
&lt;li>磁碟配置
/ &amp;raquo; 65GiB
/home &amp;raquo; 29GiB
/boot &amp;raquo; 500MiB
/boot/efi &amp;raquo; 1GiB&lt;/li>
&lt;li>軟體安裝 使用GUI畫面
Server With GUI&lt;/li>
&lt;li>註冊
&lt;a class="link" href="mailto:ken.wang@infotech.com.tw" >ken.wang@infotech.com.tw&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>開始安裝，安裝完畢後進入OS
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221003153827189.png"
loading="lazy"
alt="image-20221003153827189"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>設定sudo&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@bastion ~]# echo &amp;#34;devop ALL=(ALL) ALL&amp;#34; &amp;gt;&amp;gt; /etc/sudoers.d/devop
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="設定-ssh-key">設定 SSH Key
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>產生ssh keygen &amp;ndash; devop user
用來登入各節點使用&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ ssh-keygen -t ed25519 -N &amp;#39;&amp;#39; -f ~/.ssh/id_ed25519
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Generating public/private ed25519 key pair.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Created directory &amp;#39;/home/devop/.ssh&amp;#39;.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Your identification has been saved in /home/devop/.ssh/id_ed25519
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Your public key has been saved in /home/devop/.ssh/id_ed25519.pub
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The key fingerprint is:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SHA256:G91wVoISB5qA881zCUi71a2hHj2Y+3zPD6RJQW5+edM devop@bastion.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The key&amp;#39;s randomart image is:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+--[ED25519 256]--+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| oo. ooo.. . |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| o .o.+.=. o |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| o.o+.oo* o |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| .o+=o* * . . |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| . =oS + = o E|
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| . o = = . . |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| o . o . |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| o .. . |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| o. .o.. |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+----[SHA256]-----+
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>查看public key &amp;raquo; 之後會寫入install-config.yaml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ cat .ssh/id_ed25519.pub
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIN1Z2jXmGnPWGAVrtltN9A2q5D8QtJlRvhvdB2QXoZG devop@bastion.ocp.ken.lab
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>加入私密金鑰到ssh agent&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ ssh-add .ssh/id_ed25519
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Identity added: .ssh/id_ed25519 (devop@bastion.ocp.ken.lab)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;hr>
&lt;/li>
&lt;/ol>
&lt;h3 id="安裝oc-cli">安裝OC CLI
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>從此處下載OC Client
&lt;a class="link" href="https://access.redhat.com/downloads/content/290/ver=4.11/rhel---8/4.11.7/x86_64/product-software" target="_blank" rel="noopener"
>https://access.redhat.com/downloads/content/290/ver=4.11/rhel---8/4.11.7/x86_64/product-software&lt;/a>
&lt;a class="link" href="https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.11.9/openshift-client-linux.tar.gz" target="_blank" rel="noopener"
>https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/4.11.9/openshift-client-linux.tar.gz&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>安裝OC Client&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion oc]$ pwd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/home/devop/oc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion oc]$ tar xvzf oc-4.11.7-linux.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">oc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion oc]$ sudo cp oc kubectl /usr/local/bin/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[sudo] password for devop:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion oc]$ oc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OpenShift Client
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">This client helps you develop, build, deploy, and run your applications on any
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OpenShift or Kubernetes cluster. It also includes the administrative
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>啟用 tab 自動完成功能&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc completion bash &amp;gt; oc_bash_completion
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ sudo cp oc_bash_completion /etc/bash_completion.d/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[sudo] password for devop:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## 重新啟動terminal
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;hr>
&lt;/li>
&lt;/ol>
&lt;h3 id="安裝dhcp-server-optional">安裝DHCP Server (optional)
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>安裝dhcpd&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@bastion ~]# yum install dhcp-server
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>修改dhcpd設定檔 /etc/dhcp/dhcpd.conf&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@bastion dhcp]# cat dhcpd.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># DHCP Server Configuration file.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># see /usr/share/doc/dhcp-server/dhcpd.conf.example
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># see dhcpd.conf(5) man page
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># dhcpd.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 2022.10.11 ken wang
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">default-lease-time 600;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">max-lease-time 7200;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">option broadcast-address 192.168.33.255;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">subnet 192.168.33.0 netmask 255.255.255.0 {}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## gateway
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">option routers 192.168.33.251;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">option domain-name &amp;#34;ocp.ken.lab&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">option domain-name-servers 192.168.33.21, 168.95.1.1;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Use this to send dhcp log messages to a different log file (you also
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># have to hack syslog.conf to complete the redirection).
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">log-facility local7;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># range 192.168.33.22 192.168.33.40;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host bootstrap {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hardware ethernet 00:50:56:91:47:e9;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fixed-address 192.168.33.22;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host master1 {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hardware ethernet 00:50:56:91:88:f4;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fixed-address 192.168.33.23;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host master2 {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hardware ethernet 00:50:56:91:27:ed;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fixed-address 192.168.33.24;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host master3 {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hardware ethernet 00:50:56:91:08:33;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fixed-address 192.168.33.25;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host worker1 {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hardware ethernet 00:50:56:91:c6:29;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fixed-address 192.168.33.26;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host worker2 {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hardware ethernet 00:50:56:91:d7:b4;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fixed-address 192.168.33.27;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host infra1 {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hardware ethernet 00:50:56:91:14:ab;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fixed-address 192.168.33.31;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host infra2 {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hardware ethernet 00:50:56:91:0a:53;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fixed-address 192.168.33.32;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host infra3 {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hardware ethernet 00:50:56:91:78:05;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fixed-address 192.168.33.33;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>啟動dhcp-server測試&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">dhcp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># systemctl status dhcpd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">●&lt;/span> &lt;span class="n">dhcpd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">DHCPv4&lt;/span> &lt;span class="n">Server&lt;/span> &lt;span class="n">Daemon&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Loaded&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">loaded&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">systemd&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">system&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dhcpd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">disabled&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">vendor&lt;/span> &lt;span class="n">preset&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">disabled&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Active&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">active&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">running&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">since&lt;/span> &lt;span class="n">Tue&lt;/span> &lt;span class="mi">2022&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">11&lt;/span> &lt;span class="mi">11&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">07&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">02&lt;/span> &lt;span class="n">CST&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="n">s&lt;/span> &lt;span class="n">ago&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="安裝dns-server-named">安裝DNS Server (named)
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>安裝named&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@bastion dhcp]# yum install bind bind-libs bind-chroot bind-utils
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>修改named 設定檔 /etc/named.conf&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># cat /etc/named.conf &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span> &lt;span class="n">named&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span> &lt;span class="n">Provided&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="n">Red&lt;/span> &lt;span class="n">Hat&lt;/span> &lt;span class="n">bind&lt;/span> &lt;span class="n">package&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">configure&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">ISC&lt;/span> &lt;span class="n">BIND&lt;/span> &lt;span class="n">named&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">DNS&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span> &lt;span class="n">server&lt;/span> &lt;span class="n">as&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">caching&lt;/span> &lt;span class="n">only&lt;/span> &lt;span class="n">nameserver&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">as&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">localhost&lt;/span> &lt;span class="n">DNS&lt;/span> &lt;span class="n">resolver&lt;/span> &lt;span class="n">only&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span> &lt;span class="n">See&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">doc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bind&lt;/span>&lt;span class="o">*/&lt;/span>&lt;span class="n">sample&lt;/span>&lt;span class="o">/&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">example&lt;/span> &lt;span class="n">named&lt;/span> &lt;span class="n">configuration&lt;/span> &lt;span class="n">files&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">options&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">listen&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">on&lt;/span> &lt;span class="n">port&lt;/span> &lt;span class="mi">53&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">33.21&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span>&lt;span class="n">listen&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">on&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">v6&lt;/span> &lt;span class="n">port&lt;/span> &lt;span class="mi">53&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="p">::&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">directory&lt;/span> &lt;span class="s2">&amp;#34;/var/named&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dump&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">file&lt;/span> &lt;span class="s2">&amp;#34;/var/named/data/cache_dump.db&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">statistics&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">file&lt;/span> &lt;span class="s2">&amp;#34;/var/named/data/named_stats.txt&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">memstatistics&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">file&lt;/span> &lt;span class="s2">&amp;#34;/var/named/data/named_mem_stats.txt&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">secroots&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">file&lt;/span> &lt;span class="s2">&amp;#34;/var/named/data/named.secroots&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">recursing&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">file&lt;/span> &lt;span class="s2">&amp;#34;/var/named/data/named.recursing&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">allow&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">query&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">any&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">## 設定轉寄站&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">forwarders&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.12&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.11&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">/*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">If&lt;/span> &lt;span class="n">you&lt;/span> &lt;span class="n">are&lt;/span> &lt;span class="n">building&lt;/span> &lt;span class="n">an&lt;/span> &lt;span class="n">AUTHORITATIVE&lt;/span> &lt;span class="n">DNS&lt;/span> &lt;span class="n">server&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="n">NOT&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">recursion&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">If&lt;/span> &lt;span class="n">you&lt;/span> &lt;span class="n">are&lt;/span> &lt;span class="n">building&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">RECURSIVE&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">caching&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">DNS&lt;/span> &lt;span class="n">server&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">you&lt;/span> &lt;span class="n">need&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">recursion&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">If&lt;/span> &lt;span class="n">your&lt;/span> &lt;span class="n">recursive&lt;/span> &lt;span class="n">DNS&lt;/span> &lt;span class="n">server&lt;/span> &lt;span class="n">has&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">public&lt;/span> &lt;span class="ne">IP&lt;/span> &lt;span class="n">address&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">you&lt;/span> &lt;span class="n">MUST&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">access&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">control&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">limit&lt;/span> &lt;span class="n">queries&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">your&lt;/span> &lt;span class="n">legitimate&lt;/span> &lt;span class="n">users&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Failing&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="n">so&lt;/span> &lt;span class="n">will&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cause&lt;/span> &lt;span class="n">your&lt;/span> &lt;span class="n">server&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">become&lt;/span> &lt;span class="n">part&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">large&lt;/span> &lt;span class="n">scale&lt;/span> &lt;span class="n">DNS&lt;/span> &lt;span class="n">amplification&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">attacks&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Implementing&lt;/span> &lt;span class="n">BCP38&lt;/span> &lt;span class="n">within&lt;/span> &lt;span class="n">your&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="n">would&lt;/span> &lt;span class="n">greatly&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reduce&lt;/span> &lt;span class="n">such&lt;/span> &lt;span class="n">attack&lt;/span> &lt;span class="n">surface&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">recursion&lt;/span> &lt;span class="n">yes&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dnssec&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">validation&lt;/span> &lt;span class="n">yes&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dnssec&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">enable&lt;/span> &lt;span class="n">yes&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">managed&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">keys&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">directory&lt;/span> &lt;span class="s2">&amp;#34;/var/named/dynamic&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">geoip&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">directory&lt;/span> &lt;span class="s2">&amp;#34;/usr/share/GeoIP&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pid&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">file&lt;/span> &lt;span class="s2">&amp;#34;/run/named/named.pid&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">session&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">keyfile&lt;/span> &lt;span class="s2">&amp;#34;/run/named/session.key&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">/*&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">fedoraproject&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">wiki&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Changes&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">CryptoPolicy&lt;/span> &lt;span class="o">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">include&lt;/span> &lt;span class="s2">&amp;#34;/etc/crypto-policies/back-ends/bind.config&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">logging&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">channel&lt;/span> &lt;span class="n">default_debug&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span> &lt;span class="s2">&amp;#34;data/named.run&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">severity&lt;/span> &lt;span class="n">dynamic&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">zone&lt;/span> &lt;span class="s2">&amp;#34;.&amp;#34;&lt;/span> &lt;span class="n">IN&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span> &lt;span class="n">hint&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span> &lt;span class="s2">&amp;#34;named.ca&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">include&lt;/span> &lt;span class="s2">&amp;#34;/etc/named.rfc1912.zones&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">include&lt;/span> &lt;span class="s2">&amp;#34;/etc/named.root.key&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">zone&lt;/span> &lt;span class="s2">&amp;#34;ocp.ken.lab.&amp;#34;&lt;/span> &lt;span class="n">IN&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span> &lt;span class="n">master&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span> &lt;span class="s2">&amp;#34;ken.zone&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">allow&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">update&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">none&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">allow&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">query&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">any&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">allow&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">transfer&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">none&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">zone&lt;/span> &lt;span class="s2">&amp;#34;33.168.192.in-addr.arpa&amp;#34;&lt;/span> &lt;span class="n">IN&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span> &lt;span class="n">master&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span> &lt;span class="s2">&amp;#34;ken.reverse&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">allow&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">update&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">none&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">allow&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">query&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">any&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">allow&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">transfer&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">none&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>修改正向解析 /var/named/ken.zone&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-dns" data-lang="dns">&lt;span class="line">&lt;span class="cl">&lt;span class="err">[root@bastion&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">named]#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">cat&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nc">ken.zone&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="na">$TTL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">1&lt;/span>&lt;span class="err">W&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">@&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SOA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">bastion.ken.lab. &lt;/span>&lt;span class="err">root&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">2019070700&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; serial&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">3&lt;/span>&lt;span class="err">H&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; refresh (3 hours)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">30&lt;/span>&lt;span class="err">M&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; retry (30 minutes)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">2&lt;/span>&lt;span class="err">W&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; expiry (2 weeks)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">1&lt;/span>&lt;span class="err">W&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; minimum (1 week)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">bastion.ken.lab.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">bastion.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.21&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">helper.ken.lab. &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.21&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">helper.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.21&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">api.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.21&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">api-int.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.21&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">*&lt;/span>&lt;span class="nc">.apps.ocp.ken.lab.&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.21&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">bootstrap.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.22&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">master1.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.23&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">master2.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.24&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">master3.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.25&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">worker1.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.26&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">worker2.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.27&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">infra1.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.31&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">infra2.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.32&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="py">infra3.ocp.ken.lab. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">192.168.33.33&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;EOF&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>修改反解析 /var/named/ken.reverse&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-dns" data-lang="dns">&lt;span class="line">&lt;span class="cl">&lt;span class="err">[root@bastion&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">named]#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">cat&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nc">ken.reverse&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="na">$TTL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="sc">10&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nc">@&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SOA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">bastion.ken.lab. &lt;/span>&lt;span class="err">root&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">2019070700&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; serial&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">3&lt;/span>&lt;span class="err">H&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; refresh (3 hours)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">30&lt;/span>&lt;span class="err">M&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; retry (30 minutes)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">2&lt;/span>&lt;span class="err">W&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; expiry (2 weeks)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="sc">1&lt;/span>&lt;span class="err">W&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">; minimum (1 week)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">bastion.ken.lab.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">21.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">bastion.ocp.ken.lab. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">21.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">api.ocp.ken.lab. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">21.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">api-int.ocp.ken.lab. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">22.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">bootstrap.ocp.ken.lab. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">23.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">master1.ocp.ken.lab. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">24.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">master2.ocp.ken.lab. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">25.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">master3.ocp.ken.lab. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">26.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">worker1.ocp.ken.lab. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">27.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">worker2.ocp.ken.lab. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">31.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">infra1.ocp.ken.lab. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">32.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">infra2.ocp.ken.lab.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">33.33.168.192&lt;/span>&lt;span class="py">.in-addr.arpa. &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PTR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="py">infra3.ocp.ken.lab.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">;EOF&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>調整防火牆&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-service=dns --permanent&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --reload&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>啟動服務&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@bastion ~]# systemctl enable named --now
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>驗證DNS&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">##測試api
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion ~]# dig +noall +answer @192.168.33.21 api.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">api.ocp.ken.lab. 604800 IN A 192.168.33.21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion ~]# nslookup 192.168.33.21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">21.33.168.192.in-addr.arpa name = api.ocp.ken.lab.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">21.33.168.192.in-addr.arpa name = bastion.ocp.ken.lab.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">21.33.168.192.in-addr.arpa name = api-int.ocp.ken.lab.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## 測試 wild card
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion ~]# dig +noall +answer @192.168.33.21 random.apps.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">random.apps.ocp.ken.lab. 604800 IN A 192.168.33.21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">##測試反解析
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion ~]# dig +noall +answer @192.168.33.21 -x 192.168.33.21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">21.33.168.192.in-addr.arpa. 10 IN PTR api.ocp.ken.lab.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">21.33.168.192.in-addr.arpa. 10 IN PTR api-int.ocp.ken.lab.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">21.33.168.192.in-addr.arpa. 10 IN PTR bastion.ocp.ken.lab.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="安裝ha-proxy">安裝HA Proxy
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>安裝haproxy&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@bastion ~]# yum install haproxy -y
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>設定HAProxy&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="err">將文件上的設定檔複製貼上，再用&lt;/span>&lt;span class="n">sed&lt;/span> &lt;span class="err">指令修改&lt;/span>&lt;span class="n">domain&lt;/span> &lt;span class="n">name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">haproxy&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># sed -i &amp;#34;s/ocp4.example.com/ocp.ken.lab/g&amp;#34; /etc/haproxy/haproxy.cfg&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># cat /etc/haproxy/haproxy.cfg&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">global&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">log&lt;/span> &lt;span class="mf">127.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.1&lt;/span> &lt;span class="n">local2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pidfile&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">haproxy&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pid&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">maxconn&lt;/span> &lt;span class="mi">4000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">daemon&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">defaults&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">http&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">log&lt;/span> &lt;span class="n">global&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">dontlognull&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">close&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">redispatch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">retries&lt;/span> &lt;span class="mi">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">request&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">queue&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">m&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">connect&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">client&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">m&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">server&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">m&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">keep&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">alive&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">maxconn&lt;/span> &lt;span class="mi">3000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">frontend&lt;/span> &lt;span class="n">stats&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bind&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">1936&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">http&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">log&lt;/span> &lt;span class="n">global&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">maxconn&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">hide&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">version&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">refresh&lt;/span> &lt;span class="mi">30&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">show&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">node&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">show&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">desc&lt;/span> &lt;span class="n">Stats&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">ocp4&lt;/span> &lt;span class="n">cluster&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">auth&lt;/span> &lt;span class="n">admin&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">ocp4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stats&lt;/span> &lt;span class="n">uri&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">stats&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">listen&lt;/span> &lt;span class="n">api&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">6443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bind&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">tcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">bootstrap&lt;/span> &lt;span class="n">bootstrap&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span> &lt;span class="n">backup&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master1&lt;/span> &lt;span class="n">master1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master2&lt;/span> &lt;span class="n">master3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master3&lt;/span> &lt;span class="n">master3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">listen&lt;/span> &lt;span class="n">machine&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">22623&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bind&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22623&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">tcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">bootstrap&lt;/span> &lt;span class="n">bootstrap&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22623&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span> &lt;span class="n">backup&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master1&lt;/span> &lt;span class="n">master1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22623&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master2&lt;/span> &lt;span class="n">master2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22623&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">master3&lt;/span> &lt;span class="n">master3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22623&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">listen&lt;/span> &lt;span class="n">ingress&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">router&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bind&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">tcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">balance&lt;/span> &lt;span class="n">source&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">worker1&lt;/span> &lt;span class="n">worker1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">worker2&lt;/span> &lt;span class="n">worker2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">infra1&lt;/span> &lt;span class="n">infra1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">infra2&lt;/span> &lt;span class="n">infra2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">infra3&lt;/span> &lt;span class="n">infra3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">443&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">listen&lt;/span> &lt;span class="n">ingress&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">router&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">80&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bind&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">80&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">tcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">balance&lt;/span> &lt;span class="n">source&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">worker1&lt;/span> &lt;span class="n">worker1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">80&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">worker2&lt;/span> &lt;span class="n">worker2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">80&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">infra1&lt;/span> &lt;span class="n">infra1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">80&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">infra2&lt;/span> &lt;span class="n">infra2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">80&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="n">infra3&lt;/span> &lt;span class="n">infra3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">80&lt;/span> &lt;span class="n">check&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>防火牆開通、SELinux設定&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=80/tcp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=443/tcp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=6443/tcp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=1936/tcp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=22623/tcp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=9000-9999/tcp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=10250-10259/tcp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=4789/udp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=6081/udp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=9000-9999/udp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=500/udp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=4500/udp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=30000-32767/udp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=30000-32767/tcp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --reload&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --list-all&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">public&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">active&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">target&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">default&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">icmp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">block&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">inversion&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">interfaces&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">ens192&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sources&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">services&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">cockpit&lt;/span> &lt;span class="n">dhcpv6&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">client&lt;/span> &lt;span class="n">dns&lt;/span> &lt;span class="n">ssh&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ports&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">53&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">udp&lt;/span> &lt;span class="mi">53&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tcp&lt;/span> &lt;span class="mi">80&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tcp&lt;/span> &lt;span class="mi">443&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tcp&lt;/span> &lt;span class="mi">6443&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tcp&lt;/span> &lt;span class="mi">1936&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tcp&lt;/span> &lt;span class="mi">22623&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tcp&lt;/span> &lt;span class="mi">9000&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">9999&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tcp&lt;/span> &lt;span class="mi">10250&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">10259&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tcp&lt;/span> &lt;span class="mi">4789&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">udp&lt;/span> &lt;span class="mi">6081&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">udp&lt;/span> &lt;span class="mi">9000&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">9999&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">udp&lt;/span> &lt;span class="mi">500&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">udp&lt;/span> &lt;span class="mi">4500&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">udp&lt;/span> &lt;span class="mi">30000&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">32767&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">udp&lt;/span> &lt;span class="mi">30000&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">32767&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">protocols&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">forward&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">masquerade&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">forward&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ports&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">source&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ports&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">icmp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">blocks&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rich&lt;/span> &lt;span class="n">rules&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## SELinux&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># semanage port --add --type http_port_t --proto tcp 1936&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># semanage port --add --type http_port_t --proto tcp 6443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># semanage port --add --type http_port_t --proto tcp 22623&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="ow">or&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># setsebool -P haproxy_connect_any=on&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>啟動服務&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@bastion ~]# systemctl enable haproxy --now
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="下載pull-secret-token">下載Pull Secret Token
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>網頁連線至https://console.redhat.com/openshift/downloads&lt;/p>
&lt;/li>
&lt;li>
&lt;p>下載 Pull Secret Token
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221011144551465.png"
loading="lazy"
alt="image-20221011144551465"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>將 pull-secret放到安裝目錄下&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ cp ../pull-secret .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r--. 1 devop devop 2795 Oct 11 15:07 pull-secret
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;hr>
&lt;/li>
&lt;/ol>
&lt;h3 id="下載安裝openshift-installer">下載安裝openshift installer
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>網頁連線至 &lt;a class="link" href="https://console.redhat.com/openshift/downloads#tool-pull-secret" target="_blank" rel="noopener"
>https://console.redhat.com/openshift/downloads#tool-pull-secret&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>下載 OpenShift for x86_64 Installer
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221011145410398.png"
loading="lazy"
alt="image-20221011145410398"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>創建目錄並解壓縮&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ mkdir ocp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ mv openshift-install-linux.tar.gz ocp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ cd ocp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total 336508
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r--. 1 devop devop 344582118 Oct 11 14:59 openshift-install-linux.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ tar xzvf openshift-install-linux.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openshift-install
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>將openshift installer 放到 /usr/local/bin&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ sudo cp openshift-install /usr/local/bin/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[sudo] password for devop:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ openshift-install --help
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Creates OpenShift clusters
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Usage:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> openshift-install [command]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ..
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="下載-coreos">下載 CoreOS
&lt;/h3>&lt;ol>
&lt;li>連線至 &lt;a class="link" href="https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.11/4.11.2/" target="_blank" rel="noopener"
>https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.11/4.11.2/&lt;/a>&lt;/li>
&lt;li>下載 &lt;a class="link" href="https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.11/4.11.2/rhcos-4.11.2-x86_64-live.x86_64.iso" target="_blank" rel="noopener"
>https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.11/4.11.2/rhcos-4.11.2-x86_64-live.x86_64.iso&lt;/a>&lt;/li>
&lt;li>放到ESXi主機上並掛給各虛擬機
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221011150628575.png"
loading="lazy"
alt="image-20221011150628575"
>&lt;/li>
&lt;li>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221011151238082.png"
loading="lazy"
alt="image-20221011151238082"
>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="準備安裝soruce">準備安裝Soruce
&lt;/h3>&lt;h4 id="創建install-configyaml">創建install-config.yaml
&lt;/h4>&lt;p>在/home/devop/ocp目錄下 新增install-config.yaml
重裝時記得將此目錄清除乾淨&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ vim install-config.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ cat install-config.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">baseDomain: ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">compute:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- hyperthreading: Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">controlPlane:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hyperthreading: Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: ocp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">networking:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> clusterNetwork:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - cidr: 10.128.0.0/14
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hostPrefix: 23
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> networkType: OpenShiftSDN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> serviceNetwork:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 172.30.0.0/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">platform:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> none: {}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">fips: false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pullSecret: &amp;#39;{&amp;#34;auths&amp;#34;:{&amp;#34;cloud.openshift.com&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K29jbV9hY2Nlc3NfMzEwNjVjNmVmMTk5NDZmNWEwNmUzZmI4MTVmNzk2OTE6NEJRVk1FVk9CTDRZQVRBT0pONEhQVkIyUExFQTdKNDE3WExFU1IzVDk3NU1YUTJXWE9FSjBNTVk0MzFQQk9RUA==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;},&amp;#34;quay.io&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K29jbV9hY2Nlc3NfMzEwNjVjNmVmMTk5NDZmNWEwNmUzZmI4MTVmNzk2OTE6NEJRVk1FVk9CTDRZQVRBT0pONEhQVkIyUExFQTdKNDE3WExFU1IzVDk3NU1YUTJXWE9FSjBNTVk0MzFQQk9RUA==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;},&amp;#34;registry.connect.redhat.com&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;fHVoYy1wb29sLTc5MzgwY2YyLTUxNTEtNGRiNi04YjA3LTRiNzQ4NDcxNWE2NDpleUpoYkdjaU9pSlNVelV4TWlKOS5leUp6ZFdJaU9pSmxOak5rWVdWbU1tSXlaRFEwTVdKaVlUTXpObVUwTkdGbVl6WmtPVEUwWVNKOS5RMlp6Q1JaWWltVDIxM2dpYU9CRWtNWEVkYUtjbnc4WHN1bTY3VEVOdjEyRjBjQUgyNWNZMVdWTjZNUEY2R21CNjh3TmF4TnoxRHVpVnBtY0ZKM2JZTW0yNVVzZGJxeFc4cEd1dGszSzF5NlNUWk9VejlkU0V4UGg4aUxha05qSEQ4Tml6emNmM1lUQjRNUXdhYTVFSG1PMXVTUERUZFRBTXFYS3FFa2gwRXpHOUpKZTlUMnM4bVJXWkVIbndoZW84cktncVZuV1VCeGhqTldFNElfWG1JZnBPRl91akpFNHdXNzRJWjd5UmdoUGExQVVwS3BsY0NJQ2ZGdGtaS29WUTFwNTBzUzNabkxWYjd6ZHdXR21WcXVsNUFoZUNiSHNoNEtpSjFnYXRSbkwtMG92THZoNGdseUZqd0c0Z3lMMEdyS1ItbU5WMFZYc01mVzJDNXNVaXBzVmhKcmhmY01vQjRNSDRDbjZKcjJXS2plbEdqSVdHQzBUV1BBNlZQZDBmc0lyLTRCY2RBdUFmcm5SaWpGM3d0Mng3RFdXQ1RScFVPbUVMY3U5bDR6Wm5uZkVSejNMd01rNmhCWTFyYXV1TGhCWXJraFlzQURqWEl3bGxPTkwyc01GMUU2OVNIVG1vV0tvNU5fdHdoWE5fX1BtT1ozMzc5ZVNDVGdnTFNZd3hyR1VwS3FXRDFva3JWZlRIWmNlcTk4WHQ2QjFtZHIxcmxLV2RiRmhsRDQ3Q1pldEhrNW1xQUlianp1UzlONENJWllhd0lIZE5LWVotN2tRNFQyUFg4QWdadHFNdHdjY2c0bWx3ME40c09LbWVZN2Q2bGw0bXpXV201bVo0aktTeHdpYmJ3STEwOFcxWVFlSlQ4QW9WZFlkc09YWkdWc3ZxZVVZOU9qbzR2RQ==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;},&amp;#34;registry.redhat.io&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;fHVoYy1wb29sLTc5MzgwY2YyLTUxNTEtNGRiNi04YjA3LTRiNzQ4NDcxNWE2NDpleUpoYkdjaU9pSlNVelV4TWlKOS5leUp6ZFdJaU9pSmxOak5rWVdWbU1tSXlaRFEwTVdKaVlUTXpObVUwTkdGbVl6WmtPVEUwWVNKOS5RMlp6Q1JaWWltVDIxM2dpYU9CRWtNWEVkYUtjbnc4WHN1bTY3VEVOdjEyRjBjQUgyNWNZMVdWTjZNUEY2R21CNjh3TmF4TnoxRHVpVnBtY0ZKM2JZTW0yNVVzZGJxeFc4cEd1dGszSzF5NlNUWk9VejlkU0V4UGg4aUxha05qSEQ4Tml6emNmM1lUQjRNUXdhYTVFSG1PMXVTUERUZFRBTXFYS3FFa2gwRXpHOUpKZTlUMnM4bVJXWkVIbndoZW84cktncVZuV1VCeGhqTldFNElfWG1JZnBPRl91akpFNHdXNzRJWjd5UmdoUGExQVVwS3BsY0NJQ2ZGdGtaS29WUTFwNTBzUzNabkxWYjd6ZHdXR21WcXVsNUFoZUNiSHNoNEtpSjFnYXRSbkwtMG92THZoNGdseUZqd0c0Z3lMMEdyS1ItbU5WMFZYc01mVzJDNXNVaXBzVmhKcmhmY01vQjRNSDRDbjZKcjJXS2plbEdqSVdHQzBUV1BBNlZQZDBmc0lyLTRCY2RBdUFmcm5SaWpGM3d0Mng3RFdXQ1RScFVPbUVMY3U5bDR6Wm5uZkVSejNMd01rNmhCWTFyYXV1TGhCWXJraFlzQURqWEl3bGxPTkwyc01GMUU2OVNIVG1vV0tvNU5fdHdoWE5fX1BtT1ozMzc5ZVNDVGdnTFNZd3hyR1VwS3FXRDFva3JWZlRIWmNlcTk4WHQ2QjFtZHIxcmxLV2RiRmhsRDQ3Q1pldEhrNW1xQUlianp1UzlONENJWllhd0lIZE5LWVotN2tRNFQyUFg4QWdadHFNdHdjY2c0bWx3ME40c09LbWVZN2Q2bGw0bXpXV201bVo0aktTeHdpYmJ3STEwOFcxWVFlSlQ4QW9WZFlkc09YWkdWc3ZxZVVZOU9qbzR2RQ==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;}}}&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sshKey: &amp;#39;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIN1Z2jXmGnPWGAVrtltN9A2q5D8QtJlRvhvdB2QXoZG devop@bastion.ocp.ken.lab&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">capabilities:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> baselineCapabilitySet: vCurrent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-------### 只裝Operator Hub ###---------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">capabilities:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> baselineCapabilitySet: None
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> additionalEnabledCapabilities:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - marketplace
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="建立k8s-manifest--files">建立K8S manifest files
&lt;/h4>&lt;p>在相同目錄下執行
重裝時記得將此目錄清除乾淨&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ openshift-install create manifests --dir /home/devop/ocp/install/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Consuming Install Config from target directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WARNING Making control-plane schedulable by setting MastersSchedulable to true for Scheduler cluster settings
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Manifests created in: /home/devop/ocp/install/manifests and /home/devop/ocp/install/openshift
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="ｍastersschedulablefalse">ＭastersSchedulable:false
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ cd manifests/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion manifests]$ cat cluster-scheduler-02-config.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: config.openshift.io/v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: Scheduler
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> creationTimestamp: null
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mastersSchedulable: false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> policy:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">status: {}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="創建ignition-config-file">創建Ignition config file
&lt;/h4>&lt;p>重裝時記得將此目錄清除乾淨&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ openshift-install create ignition-configs --dir /home/devop/ocp/install/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Consuming Worker Machines from target directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Consuming Openshift Manifests from target directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Consuming Common Manifests from target directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Consuming OpenShift Install (Manifests) from target directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Consuming Master Machines from target directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Ignition-Configs created in: /home/devop/ocp/install and /home/devop/ocp/install/auth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ tree install/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">install/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── auth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── kubeadmin-password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   └── kubeconfig
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── bootstrap.ign
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── master.ign
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── metadata.json
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── worker.ign
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1 directory, 6 files
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">##確認 sha512sum
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion ocp]# sha512sum bootstrap.ign
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">460f76f9bc8b1df7095326c6b581b60f1150e477ae416b065c7b18ae040dc530a3086857d649ae04f646ccf9cce16ea9a4c32c8fe48b3630413f8ebe3f924329 bootstrap.ign
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="安裝http-web-server">安裝Http Web Server
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>安裝httpd&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@bastion ~]# yum install httpd -y
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>設定httpd 預設port 8989、修改SELinux&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># vim /etc/httpd/conf/httpd.conf &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Listen&lt;/span> &lt;span class="mi">8989&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --add-port=8989/tcp --permanent &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># firewall-cmd --reload &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">success&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># semanage port -a -t http_port_t -p tcp 8989&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>將ignition檔案複製到 /var/www/html&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># cp /home/devop/ocp/*.ign /var/www/html/ocp/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># cp /var/www/html/ocp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># chmod 644 *.ign&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>啟動httpd並測試連線&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@bastion ocp]# systemctl enable httpd --now
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion ocp]# curl http://192.168.33.21:8989/ocp/bootstrap.ign
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="安裝bootstrap">安裝BootStrap
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>將虛擬機開機，並使用rhel core os 的iso檔開機，
若前面dhcp server、dns server設定成功，即會自動拿到FQDN、IP
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221011155843248.png"
loading="lazy"
alt="image-20221011155843248"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在bootstrap執行安裝指令&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo coreos-installer install --ignition-url=http://192.168.33.21:8989/ocp/bootstrap.ign /dev/sda --insecure-ignition
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(--insecure-ignition can replace using --ignition-hash=sha512-xxxxxxxxxxxxx)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>出現此畫面後 執行重新啟動 reboot
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221011165057146.png"
loading="lazy"
alt="image-20221011165057146"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>開機後確認已寫入硬碟
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221011165808592.png"
loading="lazy"
alt="image-20221011165808592"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在bastion登入bootstrap&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">bastion&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="err">$&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ssh&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">core&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">bootstrap&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">The&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">authenticity&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">of&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;bootstrap (192.168.33.22)&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">can&lt;/span>&lt;span class="s1">&amp;#39;t be established.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">ED25519 key fingerprint is SHA256:pnQoMRtW8f/3EjIQ7qNG4+NIB+ObrTd4E8aEbvRqMQw.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">This key is not known by any other names
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Warning: Permanently added &amp;#39;&lt;/span>&lt;span class="n">bootstrap&lt;/span>&lt;span class="s1">&amp;#39; (ED25519) to the list of known hosts.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">client_global_hostkeys_private_confirm: server gave bad signature for RSA key 0: error in libcrypto
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Red Hat Enterprise Linux CoreOS 411.86.202208112011-0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> Part of OpenShift 4.11, RHCOS is a Kubernetes native operating system
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> managed by the Machine Config Operator (`clusteroperator/machine-config`).
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">WARNING: Direct SSH access to machines is not recommended; instead,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">make configuration changes via `machineconfig` objects:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> https://docs.openshift.com/container-platform/4.11/architecture/architecture-rhcos.html
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">---
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">This is the bootstrap node; it will be destroyed when the master is fully up.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">The primary services are release-image.service followed by bootkube.service. To watch their status, run e.g.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> journalctl -b -f -u release-image.service -u bootkube.service
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>查看log，到出現machine api時才可接續安裝&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[core@bootstrap ~]$ journalctl -b -f -u release-image.service -u bootkube.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Create &amp;#34;99_openshift-cluster-api_worker-user-data-secret.yaml&amp;#34; secrets.v1./worker-user-data -n openshift-machine-api
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>此時才可繼續安裝 master01、master02、master03
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221011173412330.png"
loading="lazy"
alt="image-20221011173412330"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>出現此畫面即可關閉bootstrap&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221011172057819.png"
loading="lazy"
alt="image-20221011172057819"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221013110951260.png"
loading="lazy"
alt="image-20221013110951260"
>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="安裝-ｍaster-node">安裝 Ｍaster Node
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>將虛擬機開機，並使用rhel core os 的iso檔開機，
若前面dhcp server、dns server設定成功，即會自動拿到FQDN、IP&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在master執行安裝指令，三台相同 (若設定ＭastersSchedulable:false，則worker需一起安裝）&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo coreos-installer install --ignition-url=http://192.168.33.21:8989/ocp/master.ign /dev/sda --insecure-ignition
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">出現install complete 即可reboot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012012023876.png"
loading="lazy"
alt="image-20221012012023876"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>持續監控bootstrap的 Log&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[core@bootstrap ~]$ journalctl -b -f -u release-image.service -u bootkube.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>Master Node裝完會自動重開機&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在bastion 驗證節點&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master1.ocp.ken.lab Ready master 4m22s v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master2.ocp.ken.lab Ready master 3m37s v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master3.ocp.ken.lab Ready master 3m21s v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>查看bootstrap的 Log,確認安裝完成&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012013436842.png"
loading="lazy"
alt="image-20221012013436842"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012014537780.png"
loading="lazy"
alt="image-20221012014537780"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在Bastion 執行oc 指令確認ocp cluster CSR&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master1.ocp.ken.lab Ready master 18m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master2.ocp.ken.lab Ready master 17m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master3.ocp.ken.lab Ready master 17m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc get csr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME AGE SIGNERNAME REQUESTOR REQUESTEDDURATION CONDITION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-7sgfx 18m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-lphdj 17m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-ndft5 17m kubernetes.io/kubelet-serving system:node:master3.ocp.ken.lab &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-p42p5 17m kubernetes.io/kubelet-serving system:node:master2.ocp.ken.lab &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-vgmd9 17m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-zpfw4 18m kubernetes.io/kubelet-serving system:node:master1.ocp.ken.lab &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">system:openshift:openshift-authenticator-2zxkf 15m kubernetes.io/kube-apiserver-client system:serviceaccount:openshift-authentication-operator:authentication-operator &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">system:openshift:openshift-monitoring-ln69x 15m kubernetes.io/kube-apiserver-client system:serviceaccount:openshift-monitoring:cluster-monitoring-operator &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>確認cluster operator&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion install]$ oc get co -A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME VERSION AVAILABLE PROGRESSING DEGRADED SINCE MESSAGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">authentication 4.11.7 False False False 76s APIServicesAvailable: PreconditionNotReady...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cloud-controller-manager 4.11.7 True False False 2m36s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cloud-credential True False False 13m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster-autoscaler
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">config-operator 4.11.7 True False False 40s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">console
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csi-snapshot-controller 4.11.7 True False False 1s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">etcd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">image-registry
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ingress
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">insights
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-apiserver Unknown False False 112s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-controller-manager False True False 75s StaticPodsAvailable: 0 nodes are active; 3 nodes are at revision 0; 0 nodes have achieved new revision 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-scheduler False True False 35s StaticPodsAvailable: 0 nodes are active; 3 nodes are at revision 0; 0 nodes have achieved new revision 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-storage-version-migrator 4.11.7 True False False 59s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">machine-api
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">machine-approver
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">machine-config True Working towards 4.11.7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">marketplace
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">monitoring
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">network False True False 2m53s The network is starting up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node-tuning
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openshift-apiserver
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openshift-controller-manager False True False 100s Available: no daemon pods available on any node.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openshift-samples
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">operator-lifecycle-manager
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">operator-lifecycle-manager-catalog
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">operator-lifecycle-manager-packageserver
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service-ca 4.11.7 True False False 33s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">storage 4.11.7 True False False 49s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>關閉bootstrap，安裝worker node&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="安裝-workerinfra-node">安裝 Worker＆Infra Node
&lt;/h2>&lt;p>&lt;a class="link" href="https://docs.openshift.com/container-platform/4.11/machine_management/user_infra/adding-bare-metal-compute-user-infra.html" target="_blank" rel="noopener"
>https://docs.openshift.com/container-platform/4.11/machine_management/user_infra/adding-bare-metal-compute-user-infra.html&lt;/a>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>將虛擬機開機，並使用rhel core os 的iso檔開機，
若前面dhcp server、dns server設定成功，即會自動拿到FQDN、IP&lt;/p>
&lt;/li>
&lt;li>
&lt;p>執行安裝指令 (worker1、worker2、infra1、infra2、infra3)&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo coreos-installer install --ignition-url=http://192.168.33.21:8989/ocp/worker.ign /dev/sda --insecure-ignition
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">出現install complete 即可reboot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>在bastion 確認nodes、csr (會有很多需approve的 csr，後續加node後還會有)&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master1.ocp.ken.lab Ready master 36m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master2.ocp.ken.lab Ready master 35m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master3.ocp.ken.lab Ready master 35m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc get csr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME AGE SIGNERNAME REQUESTOR REQUESTEDDURATION CONDITION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-7sgfx 37m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-lphdj 37m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-ndft5 36m kubernetes.io/kubelet-serving system:node:master3.ocp.ken.lab &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-nwplh 0s kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Pending
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-p42p5 36m kubernetes.io/kubelet-serving system:node:master2.ocp.ken.lab &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-pcsl2 115s kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Pending
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-vgmd9 36m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-zpfw4 37m kubernetes.io/kubelet-serving system:node:master1.ocp.ken.lab &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">system:openshift:openshift-authenticator-2zxkf 35m kubernetes.io/kube-apiserver-client system:serviceaccount:openshift-authentication-operator:authentication-operator &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">system:openshift:openshift-monitoring-ln69x 34m kubernetes.io/kube-apiserver-client system:serviceaccount:openshift-monitoring:cluster-monitoring-operator &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>Approve All CSR&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$oc adm certificate approve &amp;lt;csr_name&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$oc get csr -o go-template=&amp;#39;{{range .items}}{{if not .status}}{{.metadata.name}}{{&amp;#34;\n&amp;#34;}}{{end}}{{end}}&amp;#39; | xargs --no-run-if-empty oc adm certificate approve
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion auth]$ oc get csr -A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME AGE SIGNERNAME REQUESTOR REQUESTEDDURATION CONDITION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-2trmm 18m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-9xhq4 16m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-b4jns 2m45s kubernetes.io/kubelet-serving system:node:infra1.ocp.ken.lab &amp;lt;none&amp;gt; Pending
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-b55jd 3m57s kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-bdtnw 16m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-bngbr 2m40s kubernetes.io/kubelet-serving system:node:infra2.ocp.ken.lab &amp;lt;none&amp;gt; Pending
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-kd66h 2m51s kubernetes.io/kubelet-serving system:node:infra2.ocp.ken.lab &amp;lt;none&amp;gt; Pending
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-lzk6w 2m46s kubernetes.io/kubelet-serving system:node:worker1.ocp.ken.lab &amp;lt;none&amp;gt; Pending
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-rtkr6 2m46s kubernetes.io/kubelet-serving system:node:worker2.ocp.ken.lab &amp;lt;none&amp;gt; Pending
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-swwhm 18m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-v67v6 16m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-vhlqb 3m56s kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper &amp;lt;none&amp;gt; Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion auth]$ oc get csr -o go-template=&amp;#39;{{range .items}}{{if not .status}}{{.metadata.name}}{{&amp;#34;\n&amp;#34;}}{{end}}{{end}}&amp;#39; | xargs --no-run-if-empty oc adm certificate approve
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-2trmm approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-9xhq4 approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-b55jd approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-bdtnw approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-swwhm approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-v67v6 approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-vhlqb approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion auth]$ oc get csr -o go-template=&amp;#39;{{range .items}}{{if not .status}}{{.metadata.name}}{{&amp;#34;\n&amp;#34;}}{{end}}{{end}}&amp;#39; | xargs --no-run-if-empty oc adm certificate approve
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-b4jns approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-bngbr approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-cq46l approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-kd66h approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-lzk6w approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-rtkr6 approved
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">certificatesigningrequest.certificates.k8s.io/csr-t6l2b approved
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>再次確認node狀態&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion auth]$ oc get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra1.ocp.ken.lab Ready worker 2m32s v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra2.ocp.ken.lab Ready,SchedulingDisabled worker 2m38s v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master1.ocp.ken.lab NotReady master 78m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master2.ocp.ken.lab NotReady master 78m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master3.ocp.ken.lab NotReady master 78m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker1.ocp.ken.lab Ready worker 2m33s v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker2.ocp.ken.lab Ready worker 2m34s v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master1.ocp.ken.lab Ready master 39m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master2.ocp.ken.lab Ready master 39m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master3.ocp.ken.lab Ready master 38m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker1.ocp.ken.lab Ready worker 95s v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker2.ocp.ken.lab Ready worker 90s v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc get po -A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="安裝後的設定">安裝後的設定
&lt;/h2>&lt;h4 id="設定nfs">設定NFS
&lt;/h4>&lt;p>&lt;a class="link" href="https://access.redhat.com/solutions/4618011" target="_blank" rel="noopener"
>https://access.redhat.com/solutions/4618011&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://access.redhat.com/solutions/5900501" target="_blank" rel="noopener"
>https://access.redhat.com/solutions/5900501&lt;/a>&lt;/p>
&lt;p>on vmware vsphere&lt;/p>
&lt;p>&lt;a class="link" href="https://vergiehadiana.medium.com/guide-deploy-nfs-storage-for-dynamic-provisioning-and-image-registry-for-red-hat-openshift-b15e16f357b4" target="_blank" rel="noopener"
>https://vergiehadiana.medium.com/guide-deploy-nfs-storage-for-dynamic-provisioning-and-image-registry-for-red-hat-openshift-b15e16f357b4&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://hackmd.io/@kd-ocp/S1EIu6V25" target="_blank" rel="noopener"
>https://hackmd.io/@kd-ocp/S1EIu6V25&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">image:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">image:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">groundhog2k/nfs-subdir-external-provisioner:v3.2.0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="設定外部image-registry">設定外部Image Registry
&lt;/h4>&lt;p>&lt;a class="link" href="https://access.redhat.com/documentation/zh-cn/openshift_container_platform/4.6/html/images/images-configuration-file_image-configuration" target="_blank" rel="noopener"
>https://access.redhat.com/documentation/zh-cn/openshift_container_platform/4.6/html/images/images-configuration-file_image-configuration&lt;/a>&lt;/p>
&lt;h4 id="設定htpasswd-provider">設定Htpasswd Provider
&lt;/h4>&lt;p>&lt;a class="link" href="https://docs.openshift.com/container-platform/4.11/authentication/identity_providers/configuring-htpasswd-identity-provider.html" target="_blank" rel="noopener"
>https://docs.openshift.com/container-platform/4.11/authentication/identity_providers/configuring-htpasswd-identity-provider.html&lt;/a>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>利用htpasswd 產生htpasswd檔案&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ htpasswd -c -B -b users.htpasswd admin redhat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Adding password for user admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ htpasswd -B -b users.htpasswd ken xxxxxxxx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Adding password for user ken
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ htpasswd -B -b users.htpasswd view redhat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Adding password for user view
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>產生secret 將 htpasswd 放入secret&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc whoami
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">system:admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc create secret generic users-htpasswd --from-file htpasswd=users.htpasswd -n openshift-config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">secret/users-htpasswd created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc get secret -n openshift-config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME TYPE DATA AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">builder-dockercfg-r46z8 kubernetes.io/dockercfg 1 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">builder-token-cgvp8 kubernetes.io/service-account-token 4 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">default-dockercfg-8mhbj kubernetes.io/dockercfg 1 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">default-token-nfc27 kubernetes.io/service-account-token 4 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deployer-dockercfg-qdwcq kubernetes.io/dockercfg 1 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deployer-token-bfplj kubernetes.io/service-account-token 4 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">etcd-client kubernetes.io/tls 2 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">etcd-metric-client kubernetes.io/tls 2 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">etcd-metric-signer kubernetes.io/tls 2 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">etcd-signer kubernetes.io/tls 2 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">initial-service-account-private-key Opaque 1 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pull-secret kubernetes.io/dockerconfigjson 1 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">users-htpasswd Opaque 1 10s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">webhook-authentication-integrated-oauth Opaque 1 8h
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>新增 htpasswd provider&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc get oauth cluster -o yaml &amp;gt; oauth.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ vim oauth.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ cat oauth.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: config.openshift.io/v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: OAuth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> annotations:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> include.release.openshift.io/ibm-cloud-managed: &amp;#34;true&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> include.release.openshift.io/self-managed-high-availability: &amp;#34;true&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> include.release.openshift.io/single-node-developer: &amp;#34;true&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> release.openshift.io/create-only: &amp;#34;true&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> creationTimestamp: &amp;#34;2022-10-11T17:14:37Z&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> generation: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ownerReferences:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - apiVersion: config.openshift.io/v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kind: ClusterVersion
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> uid: d1c0dbf6-000f-4b1e-aa27-1bd8a667afac
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resourceVersion: &amp;#34;1533&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> uid: 3e95cfe7-7c02-47eb-8b4e-7f0d61766461
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> identityProviders:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: htpasswd_provider
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mappingMethod: claim
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type: HTPasswd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> htpasswd:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fileData:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: users-htpasswd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc apply -f oauth.yaml -n openshift-config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: resource oauths/cluster is missing the kubectl.kubernetes.io/last-applied-configuration annotation which is required by oc apply. oc apply should only be used on resources created declaratively by either oc create --save-config or oc apply. The missing annotation will be patched automatically.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">oauth.config.openshift.io/cluster configured
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ watch oc get po -n openshift-authentication
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012094929634.png"
loading="lazy"
alt="image-20221012094929634"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>調整角色權限&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## 將cluster-admin role 加給 admin、ken
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc adm policy add-cluster-role-to-user cluster-admin admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrole.rbac.authorization.k8s.io/cluster-admin added: &amp;#34;admin&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc adm policy add-cluster-role-to-user cluster-admin ken
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: User &amp;#39;ken&amp;#39; not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrole.rbac.authorization.k8s.io/cluster-admin added: &amp;#34;ken&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## 將cluster-view role 加給 view
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc get clusterroles | grep view
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">view 2022-10-11T17:13:19Z
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc adm policy add-cluster-role-to-user view view
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: User &amp;#39;view&amp;#39; not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrole.rbac.authorization.k8s.io/view added: &amp;#34;view&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>將預設可建立project的權限刪除，只給admin、ken&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## 取得 self-provisioner的role
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc get clusterrolebindings | grep self-provisioner
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">self-provisioners ClusterRole/self-provisioner 8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## 取得 self-provisioners role binding的group
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc describe clusterrolebindings self-provisioners
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name: self-provisioners
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Labels: &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Annotations: rbac.authorization.kubernetes.io/autoupdate: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Role:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Kind: ClusterRole
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name: self-provisioner
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Subjects:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Kind Name Namespace
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ---- ---- ---------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Group system:authenticated:oauth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">##移除 self-provisioner的rolebinding
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc adm policy remove-cluster-role-from-group self-provisioner system:authenticated:oauth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: Your changes may get lost whenever a master is restarted, unless you prevent reconciliation of this rolebinding using the following command: oc annotate clusterrolebinding.rbac self-provisioners &amp;#39;rbac.authorization.kubernetes.io/autoupdate=false&amp;#39; --overwrite
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrole.rbac.authorization.k8s.io/self-provisioner removed: &amp;#34;system:authenticated:oauth&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">##新增可以建立project的group
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc adm groups new new-project-group admin ken
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">group.user.openshift.io/new-project-group created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">##將new-project-group再bind上self-provisioner
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc adm policy add-cluster-role-to-group self-provisioner new-project-group
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrole.rbac.authorization.k8s.io/self-provisioner added: &amp;#34;new-project-group&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>取得console url&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">get&lt;/span> &lt;span class="n">route&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">console&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">NAME&lt;/span> &lt;span class="n">HOST&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">PORT&lt;/span> &lt;span class="n">PATH&lt;/span> &lt;span class="n">SERVICES&lt;/span> &lt;span class="n">PORT&lt;/span> &lt;span class="n">TERMINATION&lt;/span> &lt;span class="n">WILDCARD&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">console&lt;/span> &lt;span class="n">console&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">console&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apps&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span> &lt;span class="n">console&lt;/span> &lt;span class="n">https&lt;/span> &lt;span class="n">reencrypt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Redirect&lt;/span> &lt;span class="n">None&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">downloads&lt;/span> &lt;span class="n">downloads&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">console&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apps&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span> &lt;span class="n">downloads&lt;/span> &lt;span class="n">http&lt;/span> &lt;span class="n">edge&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Redirect&lt;/span> &lt;span class="n">None&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### 刪除 kubeadmin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">delete&lt;/span> &lt;span class="n">secret&lt;/span> &lt;span class="n">kubeadmin&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">kube&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">system&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>連線至console &lt;a class="link" href="https://console-openshift-console.apps.ocp.ken.lab" target="_blank" rel="noopener"
>https://console-openshift-console.apps.ocp.ken.lab&lt;/a> 並測試登入&lt;/p>
&lt;p>admin / redhat (cluster-admin)、view / redhat (view only)
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012095225994.png"
loading="lazy"
alt="image-20221012095225994"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012095300179.png"
loading="lazy"
alt="image-20221012095300179"
>
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012095339064.png"
loading="lazy"
alt="image-20221012095339064"
>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 id="註冊openshift-cluster">註冊openshift cluster
&lt;/h4>&lt;ol>
&lt;li>
&lt;p>從console 點到 Administration &amp;gt; Cluster Settings &amp;gt; Manage subscription settings
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012101701215.png"
loading="lazy"
alt="image-20221012101701215"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>點選Edit subscription settings&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012101731793.png"
loading="lazy"
alt="image-20221012101731793"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>選擇 Self-Support 即可
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012101910450.png"
loading="lazy"
alt="image-20221012101910450"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>約 3~5 分鐘即可更新License&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012102253203.png"
loading="lazy"
alt="image-20221012102253203"
>12&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 id="設定oc-cli-ca">設定OC CLI CA
&lt;/h4>&lt;p>在openshift-authentication project內取得CA並將CA複製到bastion內&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc project openshift-authentication
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Now using project &amp;#34;openshift-authentication&amp;#34; on server &amp;#34;https://api.ocp.ken.lab:6443&amp;#34;.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc get po
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">oauth-openshift-7885f5bd5b-4m5sh 1/1 Running 0 46m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">oauth-openshift-7885f5bd5b-q6vbk 1/1 Running 0 46m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">oauth-openshift-7885f5bd5b-vh4pz 1/1 Running 0 47m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc rsh oauth-openshift-7885f5bd5b-4m5sh cat /run/secrets/kubernetes.io/serviceaccount/ca.crt &amp;gt; ca.crt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">＃＃切換root
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion ocp]# cp /home/devop/ocp/ca.crt /etc/pki/ca-trust/source/anchors/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@bastion ocp]# update-ca-trust extract
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## 切換為devop測試登入
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ~]$ oc login -u admin -p redhat https://api.ocp.ken.lab:6443
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Login successful.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">You have access to 66 projects, the list has been suppressed. You can list all projects with &amp;#39;oc projects&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Using project &amp;#34;openshift-authentication&amp;#34;.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="拆分infra-node">拆分Infra Node
&lt;/h4>&lt;p>&lt;a class="link" href="https://docs.openshift.com/container-platform/4.11/post_installation_configuration/cluster-tasks.html#post-install-cluster-tasks" target="_blank" rel="noopener"
>https://docs.openshift.com/container-platform/4.11/post_installation_configuration/cluster-tasks.html#post-install-cluster-tasks&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://access.redhat.com/solutions/4601131" target="_blank" rel="noopener"
>https://access.redhat.com/solutions/4601131&lt;/a>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>針對infra node 建立label&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc label node infra1.ocp.ken.lab node-role.kubernetes.io/infra=&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/infra1.ocp.ken.lab labeled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc label node infra2.ocp.ken.lab node-role.kubernetes.io/infra=&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/infra2.ocp.ken.lab labeled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc label node infra3.ocp.ken.lab node-role.kubernetes.io/infra=&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/infra3.ocp.ken.lab labeled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra1.ocp.ken.lab Ready infra,worker 4h1m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra2.ocp.ken.lab Ready infra,worker 4h1m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra3.ocp.ken.lab Ready infra,worker 3h19m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master1.ocp.ken.lab Ready master 4h43m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master2.ocp.ken.lab Ready master 4h42m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master3.ocp.ken.lab Ready master 4h41m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker1.ocp.ken.lab Ready worker 4h17m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker2.ocp.ken.lab Ready worker 4h17m v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>建立machine config pool &amp;raquo; infra.mcp.yaml 並apply到 cluster&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ vim infra.mcp.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: machineconfiguration.openshift.io/v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: MachineConfigPool
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: infra
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machineConfigSelector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> matchExpressions:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - {key: machineconfiguration.openshift.io/role, operator: In, values: [worker,infra]}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nodeSelector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> matchLabels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/infra: &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc apply -f infra.mcp.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">machineconfigpool.machineconfiguration.openshift.io/infra created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc get machineconfig
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME GENERATEDBYCONTROLLER IGNITIONVERSION AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">00-master b7aa1d499f15ce7d211d30a823acf83f47aabbe3 3.2.0 5h12m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">00-worker b7aa1d499f15ce7d211d30a823acf83f47aabbe3 3.2.0 5h12m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">01-master-container-runtime b7aa1d499f15ce7d211d30a823acf83f47aabbe3 3.2.0 5h12m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">01-master-kubelet b7aa1d499f15ce7d211d30a823acf83f47aabbe3 3.2.0 5h12m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">01-worker-container-runtime b7aa1d499f15ce7d211d30a823acf83f47aabbe3 3.2.0 5h12m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">01-worker-kubelet b7aa1d499f15ce7d211d30a823acf83f47aabbe3 3.2.0 5h12m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">99-master-generated-registries b7aa1d499f15ce7d211d30a823acf83f47aabbe3 3.2.0 5h12m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">99-master-ssh 3.2.0 5h29m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">99-worker-generated-registries b7aa1d499f15ce7d211d30a823acf83f47aabbe3 3.2.0 5h12m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">99-worker-ssh 3.2.0 5h29m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rendered-infra-407eaba9df9f726f52f84b938fce9025 b7aa1d499f15ce7d211d30a823acf83f47aabbe3 3.2.0 3s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rendered-master-720c11fac56674c6fc876ab6161295aa b7aa1d499f15ce7d211d30a823acf83f47aabbe3 3.2.0 5h12m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rendered-worker-407eaba9df9f726f52f84b938fce9025 b7aa1d499f15ce7d211d30a823acf83f47aabbe3 3.2.0 5h12m
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>建立 machine config &amp;raquo; infra.mc.yaml 並apply到cluster&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ vim infra.mc.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: machineconfiguration.openshift.io/v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: MachineConfig
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: 51-infra
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> labels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machineconfiguration.openshift.io/role: infra
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> config:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ignition:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> version: 3.2.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> storage:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> files:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - path: /etc/infratest
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mode: 0644
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> contents:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source: data:,infra
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc create -f infra.mc.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">machineconfig.machineconfiguration.openshift.io/51-infra created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc get mcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME CONFIG UPDATED UPDATING DEGRADED MACHINECOUNT READYMACHINECOUNT UPDATEDMACHINECOUNT DEGRADEDMACHINECOUNT AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra rendered-infra-407eaba9df9f726f52f84b938fce9025 False True False 3 0 0 0 3m17s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master rendered-master-720c11fac56674c6fc876ab6161295aa True False False 3 3 3 0 5h25m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker rendered-worker-407eaba9df9f726f52f84b938fce9025 True False False 2 2 2 0 5h25m
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>Add a Taint To Infra Node ，使Infra Node不會被app部署到
#此動作可搬完operator後再做&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">oc adm taint nodes node1 node-role.kubernetes.io/infra:NoSchedule
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc adm taint nodes infra3.ocp.ken.lab node-role.kubernetes.io/infra:NoSchedule
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/infra3.ocp.ken.lab tainted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc adm taint nodes infra2.ocp.ken.lab node-role.kubernetes.io/infra:NoSchedule
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/infra2.ocp.ken.lab tainted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc adm taint nodes infra1.ocp.ken.lab node-role.kubernetes.io/infra:NoSchedule
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/infra1.ocp.ken.lab tainted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc describe nodes infra1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name: infra1.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Roles: infra,worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Labels: beta.kubernetes.io/arch=amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> beta.kubernetes.io/os=linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubernetes.io/arch=amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubernetes.io/hostname=infra1.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubernetes.io/os=linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/infra=
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/worker=
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node.openshift.io/os_id=rhcos
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Annotations: machineconfiguration.openshift.io/controlPlaneTopology: HighlyAvailable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machineconfiguration.openshift.io/currentConfig: rendered-infra-c36859c83539d92df71208a425c004df
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machineconfiguration.openshift.io/desiredConfig: rendered-infra-c36859c83539d92df71208a425c004df
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machineconfiguration.openshift.io/desiredDrain: uncordon-rendered-infra-c36859c83539d92df71208a425c004df
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machineconfiguration.openshift.io/lastAppliedDrain: uncordon-rendered-infra-c36859c83539d92df71208a425c004df
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machineconfiguration.openshift.io/reason:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machineconfiguration.openshift.io/state: Done
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> volumes.kubernetes.io/controller-managed-attach-detach: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CreationTimestamp: Thu, 13 Oct 2022 11:26:50 +0800
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Taints: node-role.kubernetes.io/infra:NoSchedule
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Unschedulable: false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Lease:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> HolderIdentity: infra1.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> AcquireTime: &amp;lt;unset&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RenewTime: Thu, 13 Oct 2022 16:23:54 +0800
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>刪除infra node的 worker label&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc edit nodes infra1.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/infra1.ocp.ken.lab edited
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> labels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> beta.kubernetes.io/arch: amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> beta.kubernetes.io/os: linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubernetes.io/arch: amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubernetes.io/hostname: infra2.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubernetes.io/os: linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/infra: &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/worker: &amp;#34;&amp;#34; &amp;gt;&amp;gt;&amp;gt;&amp;gt; 刪除此行
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node.openshift.io/os_id: rhcos
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra1.ocp.ken.lab Ready infra 22h v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra2.ocp.ken.lab Ready infra 22h v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra3.ocp.ken.lab Ready infra 22h v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master1.ocp.ken.lab Ready master 23h v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master2.ocp.ken.lab Ready master 23h v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master3.ocp.ken.lab Ready master 23h v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker1.ocp.ken.lab Ready worker 22h v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker2.ocp.ken.lab Ready worker 22h v1.24.0+3882f8f
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h4 id="operator移動到infra-node">Operator移動到Infra Node
&lt;/h4>&lt;h5 id="router">Router
&lt;/h5>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="err">方法一&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">get&lt;/span> &lt;span class="n">ingresscontroller&lt;/span> &lt;span class="n">default&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ingress&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">yaml&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">router&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">vim&lt;/span> &lt;span class="n">router&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">cat&lt;/span> &lt;span class="n">router&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">apiVersion&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">operator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">v1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">kind&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">IngressController&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">metadata&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">creationTimestamp&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T02:54:05Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">finalizers&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">ingresscontroller&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">operator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">finalizer&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ingresscontroller&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">generation&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">default&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">namespace&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ingress&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resourceVersion&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;26400&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">uid&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">d5c3f18&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="n">f53&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">4140&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">be74&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">35&lt;/span>&lt;span class="n">df5edf4c8b&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">spec&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">clientTLS&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">clientCA&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">clientCertificatePolicy&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">httpCompression&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">httpEmptyRequestsPolicy&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Respond&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">httpErrorCodePages&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">replicas&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tuningOptions&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">unsupportedConfigOverrides&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">null&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodePlacement&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodeSelector&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">availableReplicas&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conditions&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T02:54:13Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reason&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Valid&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;True&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Admitted&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T03:12:03Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;True&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">PodsScheduled&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T03:11:54Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">message&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">The&lt;/span> &lt;span class="n">deployment&lt;/span> &lt;span class="n">has&lt;/span> &lt;span class="n">Available&lt;/span> &lt;span class="n">status&lt;/span> &lt;span class="n">condition&lt;/span> &lt;span class="n">set&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">True&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reason&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">DeploymentAvailable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;True&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">DeploymentAvailable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T03:11:54Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">message&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Minimum&lt;/span> &lt;span class="n">replicas&lt;/span> &lt;span class="n">requirement&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">met&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reason&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">DeploymentMinimumReplicasMet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;True&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">DeploymentReplicasMinAvailable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T03:12:36Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">message&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">All&lt;/span> &lt;span class="n">replicas&lt;/span> &lt;span class="n">are&lt;/span> &lt;span class="n">available&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reason&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">DeploymentReplicasAvailable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;True&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">DeploymentReplicasAllAvailable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T02:54:13Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">message&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">The&lt;/span> &lt;span class="n">configured&lt;/span> &lt;span class="n">endpoint&lt;/span> &lt;span class="n">publishing&lt;/span> &lt;span class="n">strategy&lt;/span> &lt;span class="n">does&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">include&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">managed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">load&lt;/span> &lt;span class="n">balancer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reason&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">EndpointPublishingStrategyExcludesManagedLoadBalancer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;False&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">LoadBalancerManaged&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T02:54:13Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">message&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">No&lt;/span> &lt;span class="n">DNS&lt;/span> &lt;span class="n">zones&lt;/span> &lt;span class="n">are&lt;/span> &lt;span class="n">defined&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">cluster&lt;/span> &lt;span class="n">dns&lt;/span> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reason&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">NoDNSZones&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;False&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">DNSManaged&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T03:11:54Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;True&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Available&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T02:54:13Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;False&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Progressing&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T03:12:03Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;False&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Degraded&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T02:54:13Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">message&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">IngressController&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">upgradeable&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reason&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Upgradeable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;True&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Upgradeable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">lastTransitionTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2022-10-13T03:12:02Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">message&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Canary&lt;/span> &lt;span class="n">route&lt;/span> &lt;span class="n">checks&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">default&lt;/span> &lt;span class="n">ingress&lt;/span> &lt;span class="n">controller&lt;/span> &lt;span class="n">are&lt;/span> &lt;span class="n">successful&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reason&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">CanaryChecksSucceeding&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;True&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">CanaryChecksSucceeding&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">domain&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">apps&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">endpointPublishingStrategy&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hostNetwork&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">httpPort&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">80&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">httpsPort&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">protocol&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">TCP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">statsPort&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1936&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">HostNetwork&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">observedGeneration&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">selector&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">ingresscontroller&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">operator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">deployment&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ingresscontroller&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">default&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tlsProfile&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ciphers&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">ECDHE&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ECDSA&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">AES128&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">GCM&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">SHA256&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">ECDHE&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">RSA&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">AES128&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">GCM&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">SHA256&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">ECDHE&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ECDSA&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">AES256&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">GCM&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">SHA384&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">ECDHE&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">RSA&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">AES256&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">GCM&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">SHA384&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">ECDHE&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ECDSA&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">CHACHA20&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">POLY1305&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">ECDHE&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">RSA&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">CHACHA20&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">POLY1305&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">DHE&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">RSA&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">AES128&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">GCM&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">SHA256&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">DHE&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">RSA&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">AES256&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">GCM&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">SHA384&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">TLS_AES_128_GCM_SHA256&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">TLS_AES_256_GCM_SHA384&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">TLS_CHACHA20_POLY1305_SHA256&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">minTLSVersion&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">VersionTLS12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">apply&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">f&lt;/span> &lt;span class="n">router&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ingress&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Warning&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">resource&lt;/span> &lt;span class="n">ingresscontrollers&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">default&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">missing&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">kubectl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">last&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">applied&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">configuration&lt;/span> &lt;span class="n">annotation&lt;/span> &lt;span class="n">which&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">required&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">apply&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">apply&lt;/span> &lt;span class="n">should&lt;/span> &lt;span class="n">only&lt;/span> &lt;span class="n">be&lt;/span> &lt;span class="n">used&lt;/span> &lt;span class="n">on&lt;/span> &lt;span class="n">resources&lt;/span> &lt;span class="n">created&lt;/span> &lt;span class="n">declaratively&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="n">either&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">create&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">save&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">config&lt;/span> &lt;span class="ow">or&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">apply&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">The&lt;/span> &lt;span class="n">missing&lt;/span> &lt;span class="n">annotation&lt;/span> &lt;span class="n">will&lt;/span> &lt;span class="n">be&lt;/span> &lt;span class="n">patched&lt;/span> &lt;span class="n">automatically&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ingresscontroller&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">operator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">openshift&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">default&lt;/span> &lt;span class="n">configured&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">方法二&lt;/span> &lt;span class="err">（官方建議）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">edit&lt;/span> &lt;span class="n">ingresscontroller&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ingress&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">####加入下方 matchLabels&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">spec&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodePlacement&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodeSelector&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#### 確認ingress-operator已分配到Infra Node &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">get&lt;/span> &lt;span class="n">pod&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ingress&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">wide&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">NAME&lt;/span> &lt;span class="n">READY&lt;/span> &lt;span class="n">STATUS&lt;/span> &lt;span class="n">RESTARTS&lt;/span> &lt;span class="n">AGE&lt;/span> &lt;span class="ne">IP&lt;/span> &lt;span class="n">NODE&lt;/span> &lt;span class="n">NOMINATED&lt;/span> &lt;span class="n">NODE&lt;/span> &lt;span class="n">READINESS&lt;/span> &lt;span class="n">GATES&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">router&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="n">c67b4db8b&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">75&lt;/span>&lt;span class="n">pjr&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="n">Running&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="n">h44m&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">33.26&lt;/span> &lt;span class="n">worker1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">router&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="n">c67b4db8b&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">glwcq&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="n">Terminating&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="n">h44m&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">33.27&lt;/span> &lt;span class="n">worker2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">router&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="n">c4cc569cc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">85&lt;/span>&lt;span class="n">sbm&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="n">Pending&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">28&lt;/span>&lt;span class="n">s&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">get&lt;/span> &lt;span class="n">pod&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ingress&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">wide&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">NAME&lt;/span> &lt;span class="n">READY&lt;/span> &lt;span class="n">STATUS&lt;/span> &lt;span class="n">RESTARTS&lt;/span> &lt;span class="n">AGE&lt;/span> &lt;span class="ne">IP&lt;/span> &lt;span class="n">NODE&lt;/span> &lt;span class="n">NOMINATED&lt;/span> &lt;span class="n">NODE&lt;/span> &lt;span class="n">READINESS&lt;/span> &lt;span class="n">GATES&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">router&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="n">c4cc569cc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">86&lt;/span>&lt;span class="n">ggk&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="n">Running&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">18&lt;/span>&lt;span class="n">m&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">33.32&lt;/span> &lt;span class="n">infra2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">router&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="n">c4cc569cc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">97&lt;/span>&lt;span class="n">mlv&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="n">Running&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">49&lt;/span>&lt;span class="n">m&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">33.31&lt;/span> &lt;span class="n">infra1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="registry">Registry
&lt;/h5>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc get configs.imageregistry.operator.openshift.io/cluster -o yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc edit configs.imageregistry.operator.openshift.io/cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> logLevel: Normal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> managementState: Removed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> observedConfig: null
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> operatorLogLevel: Normal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy: {}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> requests:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> read:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> maxWaitInQueue: 0s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> write:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> maxWaitInQueue: 0s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rolloutStrategy: RollingUpdate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> storage: {}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> unsupportedConfigOverrides: null
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nodeSelector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/infra: &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ oc get pods -o wide -n openshift-image-registry
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster-image-registry-operator-598c5664bd-qz8cs 1/1 Running 0 23h 10.128.0.34 master1.ocp.ken.lab &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">image-pruner-27761760-jh4fz 0/1 Completed 0 101m 10.131.2.8 infra3.ocp.ken.lab &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node-ca-cdt8j 1/1 Running 0 22h 192.168.33.23 master1.ocp.ken.lab &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node-ca-dpzzb 1/1 Running 1 22h 192.168.33.32 infra2.ocp.ken.lab &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node-ca-hfv8c 1/1 Running 1 21h 192.168.33.33 infra3.ocp.ken.lab &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node-ca-hjptk 1/1 Running 1 22h 192.168.33.31 infra1.ocp.ken.lab &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node-ca-k2qhs 1/1 Running 0 22h 192.168.33.24 master2.ocp.ken.lab &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node-ca-lgkg8 1/1 Running 0 22h 192.168.33.27 worker2.ocp.ken.lab &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node-ca-wqpn8 1/1 Running 0 22h 192.168.33.25 master3.ocp.ken.lab &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node-ca-xt8dg 1/1 Running 0 22h 192.168.33.26 worker1.ocp.ken.lab &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="monitoring">Monitoring
&lt;/h5>&lt;p>Include: Prometheus, Thanos Querier, and Alertmanager
先建立ConfigMap cluster-monitor-config.yaml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">get&lt;/span> &lt;span class="n">pod&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitoring&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">wide&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">vim&lt;/span> &lt;span class="n">cluster&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitoring&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">apiVersion&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">v1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">kind&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">ConfigMap&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">metadata&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">cluster&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitoring&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">config&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">namespace&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitoring&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">data&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">|+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">alertmanagerMain&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodeSelector&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">prometheusK8s&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodeSelector&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">prometheusOperator&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodeSelector&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">k8sPrometheusAdapter&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodeSelector&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">kubeStateMetrics&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodeSelector&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">telemeterClient&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodeSelector&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">openshiftStateMetrics&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodeSelector&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">thanosQuerier&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nodeSelector&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">infra&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">---&lt;/span> &lt;span class="err">建立此&lt;/span>&lt;span class="n">ConfigMap&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">create&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">f&lt;/span> &lt;span class="n">cluster&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitoring&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">configmap&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cluster&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitoring&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">config&lt;/span> &lt;span class="n">created&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">---&lt;/span> &lt;span class="err">查看&lt;/span>&lt;span class="n">pod&lt;/span> &lt;span class="err">是否都移轉至&lt;/span>&lt;span class="n">infra&lt;/span> &lt;span class="n">node&lt;/span>&lt;span class="err">，若未移轉則&lt;/span>&lt;span class="n">delete該pod&lt;/span>&lt;span class="err">，使其重新部署&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">exporter&lt;/span>&lt;span class="err">、&lt;/span>&lt;span class="n">cluster&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitoring&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator不用刪除&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">watch&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">get&lt;/span> &lt;span class="n">pod&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitoring&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">wide&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">get&lt;/span> &lt;span class="n">pod&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitoring&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">wide&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">grep&lt;/span> &lt;span class="n">worker&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">bastion&lt;/span> &lt;span class="n">ocp&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">oc&lt;/span> &lt;span class="n">get&lt;/span> &lt;span class="n">pod&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">openshift&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitoring&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">wide&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">grep&lt;/span> &lt;span class="n">master&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cluster&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitoring&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">574&lt;/span>&lt;span class="n">c5f5b7b&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sg6nh&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="n">Running&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">23&lt;/span>&lt;span class="n">h&lt;/span> &lt;span class="mf">10.128&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.33&lt;/span> &lt;span class="n">master1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">exporter&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">hr22c&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="n">Running&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">22&lt;/span>&lt;span class="n">h&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">33.23&lt;/span> &lt;span class="n">master1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">exporter&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">jnqkc&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="n">Running&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">22&lt;/span>&lt;span class="n">h&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">33.25&lt;/span> &lt;span class="n">master3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">exporter&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">lzk6n&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="n">Running&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">22&lt;/span>&lt;span class="n">h&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">33.24&lt;/span> &lt;span class="n">master2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ocp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ken&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lab&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="問題排除">問題排除
&lt;/h2>&lt;h3 id="調整">調整
&lt;/h3>&lt;h5 id="operatorhub-blank">OperatorHub Blank
&lt;/h5>&lt;h6 id="畫面空白">畫面空白
&lt;/h6>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012115352528.png"
loading="lazy"
alt="image-20221012115352528"
>&lt;/p>
&lt;h6 id="在install-configyaml">在install-config.yaml
&lt;/h6>&lt;p>裡面就要加入 marketplace的參數，sample是用來起template、image stream的operator
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221012133723224.png"
loading="lazy"
alt="image-20221012133723224"
>&lt;/p>
&lt;h6 id="install-configyaml">install-config.yaml
&lt;/h6>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ vim install-config.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@bastion ocp]$ cat install-config.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">baseDomain: ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">compute:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- hyperthreading: Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">controlPlane:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hyperthreading: Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: ocp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">networking:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> clusterNetwork:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - cidr: 10.128.0.0/14
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hostPrefix: 23
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> networkType: OpenShiftSDN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> serviceNetwork:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 172.30.0.0/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">platform:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> none: {}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">fips: false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pullSecret: &amp;#39;{&amp;#34;auths&amp;#34;:{&amp;#34;cloud.openshift.com&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K29jbV9hY2Nlc3NfMzEwNjVjNmVmMTk5NDZmNWEwNmUzZmI4MTVmNzk2OTE6NEJRVk1FVk9CTDRZQVRBT0pONEhQVkIyUExFQTdKNDE3WExFU1IzVDk3NU1YUTJXWE9FSjBNTVk0MzFQQk9RUA==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;},&amp;#34;quay.io&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K29jbV9hY2Nlc3NfMzEwNjVjNmVmMTk5NDZmNWEwNmUzZmI4MTVmNzk2OTE6NEJRVk1FVk9CTDRZQVRBT0pONEhQVkIyUExFQTdKNDE3WExFU1IzVDk3NU1YUTJXWE9FSjBNTVk0MzFQQk9RUA==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;},&amp;#34;registry.connect.redhat.com&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;fHVoYy1wb29sLTc5MzgwY2YyLTUxNTEtNGRiNi04YjA3LTRiNzQ4NDcxNWE2NDpleUpoYkdjaU9pSlNVelV4TWlKOS5leUp6ZFdJaU9pSmxOak5rWVdWbU1tSXlaRFEwTVdKaVlUTXpObVUwTkdGbVl6WmtPVEUwWVNKOS5RMlp6Q1JaWWltVDIxM2dpYU9CRWtNWEVkYUtjbnc4WHN1bTY3VEVOdjEyRjBjQUgyNWNZMVdWTjZNUEY2R21CNjh3TmF4TnoxRHVpVnBtY0ZKM2JZTW0yNVVzZGJxeFc4cEd1dGszSzF5NlNUWk9VejlkU0V4UGg4aUxha05qSEQ4Tml6emNmM1lUQjRNUXdhYTVFSG1PMXVTUERUZFRBTXFYS3FFa2gwRXpHOUpKZTlUMnM4bVJXWkVIbndoZW84cktncVZuV1VCeGhqTldFNElfWG1JZnBPRl91akpFNHdXNzRJWjd5UmdoUGExQVVwS3BsY0NJQ2ZGdGtaS29WUTFwNTBzUzNabkxWYjd6ZHdXR21WcXVsNUFoZUNiSHNoNEtpSjFnYXRSbkwtMG92THZoNGdseUZqd0c0Z3lMMEdyS1ItbU5WMFZYc01mVzJDNXNVaXBzVmhKcmhmY01vQjRNSDRDbjZKcjJXS2plbEdqSVdHQzBUV1BBNlZQZDBmc0lyLTRCY2RBdUFmcm5SaWpGM3d0Mng3RFdXQ1RScFVPbUVMY3U5bDR6Wm5uZkVSejNMd01rNmhCWTFyYXV1TGhCWXJraFlzQURqWEl3bGxPTkwyc01GMUU2OVNIVG1vV0tvNU5fdHdoWE5fX1BtT1ozMzc5ZVNDVGdnTFNZd3hyR1VwS3FXRDFva3JWZlRIWmNlcTk4WHQ2QjFtZHIxcmxLV2RiRmhsRDQ3Q1pldEhrNW1xQUlianp1UzlONENJWllhd0lIZE5LWVotN2tRNFQyUFg4QWdadHFNdHdjY2c0bWx3ME40c09LbWVZN2Q2bGw0bXpXV201bVo0aktTeHdpYmJ3STEwOFcxWVFlSlQ4QW9WZFlkc09YWkdWc3ZxZVVZOU9qbzR2RQ==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;},&amp;#34;registry.redhat.io&amp;#34;:{&amp;#34;auth&amp;#34;:&amp;#34;fHVoYy1wb29sLTc5MzgwY2YyLTUxNTEtNGRiNi04YjA3LTRiNzQ4NDcxNWE2NDpleUpoYkdjaU9pSlNVelV4TWlKOS5leUp6ZFdJaU9pSmxOak5rWVdWbU1tSXlaRFEwTVdKaVlUTXpObVUwTkdGbVl6WmtPVEUwWVNKOS5RMlp6Q1JaWWltVDIxM2dpYU9CRWtNWEVkYUtjbnc4WHN1bTY3VEVOdjEyRjBjQUgyNWNZMVdWTjZNUEY2R21CNjh3TmF4TnoxRHVpVnBtY0ZKM2JZTW0yNVVzZGJxeFc4cEd1dGszSzF5NlNUWk9VejlkU0V4UGg4aUxha05qSEQ4Tml6emNmM1lUQjRNUXdhYTVFSG1PMXVTUERUZFRBTXFYS3FFa2gwRXpHOUpKZTlUMnM4bVJXWkVIbndoZW84cktncVZuV1VCeGhqTldFNElfWG1JZnBPRl91akpFNHdXNzRJWjd5UmdoUGExQVVwS3BsY0NJQ2ZGdGtaS29WUTFwNTBzUzNabkxWYjd6ZHdXR21WcXVsNUFoZUNiSHNoNEtpSjFnYXRSbkwtMG92THZoNGdseUZqd0c0Z3lMMEdyS1ItbU5WMFZYc01mVzJDNXNVaXBzVmhKcmhmY01vQjRNSDRDbjZKcjJXS2plbEdqSVdHQzBUV1BBNlZQZDBmc0lyLTRCY2RBdUFmcm5SaWpGM3d0Mng3RFdXQ1RScFVPbUVMY3U5bDR6Wm5uZkVSejNMd01rNmhCWTFyYXV1TGhCWXJraFlzQURqWEl3bGxPTkwyc01GMUU2OVNIVG1vV0tvNU5fdHdoWE5fX1BtT1ozMzc5ZVNDVGdnTFNZd3hyR1VwS3FXRDFva3JWZlRIWmNlcTk4WHQ2QjFtZHIxcmxLV2RiRmhsRDQ3Q1pldEhrNW1xQUlianp1UzlONENJWllhd0lIZE5LWVotN2tRNFQyUFg4QWdadHFNdHdjY2c0bWx3ME40c09LbWVZN2Q2bGw0bXpXV201bVo0aktTeHdpYmJ3STEwOFcxWVFlSlQ4QW9WZFlkc09YWkdWc3ZxZVVZOU9qbzR2RQ==&amp;#34;,&amp;#34;email&amp;#34;:&amp;#34;ken.wang@infotech.com.tw&amp;#34;}}}&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sshKey: &amp;#39;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIN1Z2jXmGnPWGAVrtltN9A2q5D8QtJlRvhvdB2QXoZG devop@bastion.ocp.ken.lab&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">capabilities:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> baselineCapabilitySet: None
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> additionalEnabledCapabilities:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - marketplace
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Redhat_Quay&amp;Clair</title><link>https://wangken0129.github.io/p/redhat_quayclair/</link><pubDate>Sat, 23 Sep 2023 08:18:17 +0800</pubDate><guid>https://wangken0129.github.io/p/redhat_quayclair/</guid><description>&lt;h1 id="install-redhat-quay--clair">Install Redhat Quay &amp;amp; Clair
&lt;/h1>&lt;p>安裝單節點的Quay跟Clair在同一台VM上面執行，需先裝好Clair再安裝Quay。&lt;/p>
&lt;h1 id="參考文件">參考文件
&lt;/h1>&lt;p>1.原廠文件：https://access.redhat.com/documentation/en-us/red_hat_quay/2.9/html/manage_red_hat_quay/clair-initial-setup&lt;/p>
&lt;p>2.原廠文件：https://access.redhat.com/documentation/zh-tw/red_hat_quay/3.7/html/manage_red_hat_quay/clair-intro2&lt;/p>
&lt;p>3.quay&amp;amp;clair: &lt;a class="link" href="https://examples.openshift.pub/quay/" target="_blank" rel="noopener"
>https://examples.openshift.pub/quay/&lt;/a>
&lt;a class="link" href="https://www.modb.pro/db/109809" target="_blank" rel="noopener"
>https://www.modb.pro/db/109809&lt;/a> &amp;ndash;&amp;gt; 本篇參考
&lt;a class="link" href="https://docs.projectquay.io/deploy_quay.html" target="_blank" rel="noopener"
>https://docs.projectquay.io/deploy_quay.html&lt;/a>&lt;/p>
&lt;h1 id="架構-單節點">架構 (單節點)
&lt;/h1>&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: left">Clair&lt;/th>
&lt;th>說明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: left">OS_User&lt;/td>
&lt;td>root、devop / redhat&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">OS&lt;/td>
&lt;td>RHEL8.6&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">OS_IP&lt;/td>
&lt;td>192.168.33.34&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">CPU、RAM&lt;/td>
&lt;td>4vCPU、16GB Ram、100GB Disk&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">HostName&lt;/td>
&lt;td>quay.ocp.ken.lab&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">WorkDir&lt;/td>
&lt;td>/home/devop/clair&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">Postgresdb&lt;/td>
&lt;td>clairuser / welcome1 / clairdb&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">Clair&lt;/td>
&lt;td>v3.5.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">Quay&lt;/td>
&lt;td>v3.7.3&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">clairpod&lt;/td>
&lt;td>-p 5433:5432 -p 8081:8081 -p 8089:8089&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: left">Quay&lt;/th>
&lt;th>說明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: left">OS_User&lt;/td>
&lt;td>devop&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">OS&lt;/td>
&lt;td>RHEL8.5&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">OS_IP&lt;/td>
&lt;td>192.168.3.28&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">WorkDir&lt;/td>
&lt;td>/home/devop&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">Postgresdb&lt;/td>
&lt;td>quayuser / welcome1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">quay admin&lt;/td>
&lt;td>quayadmin / welcome1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">redis password&lt;/td>
&lt;td>welcome1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">quay-pod port&lt;/td>
&lt;td>80:8080、3306:3306、5432:5432&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">Quay Version&lt;/td>
&lt;td>v3.7.3&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">Wordpresspod&lt;/td>
&lt;td>8989:80、3307:3306&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h1 id="安裝步驟">安裝步驟
&lt;/h1>&lt;h2 id="os-設定">OS 設定
&lt;/h2>&lt;h3 id="users">Users
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@quay ~]# useradd devop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@quay ~]# passwd devop
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="disk">Disk
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@quay ~]# df -h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Filesystem Size Used Avail Use% Mounted on
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">devtmpfs 7.8G 0 7.8G 0% /dev
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tmpfs 7.8G 0 7.8G 0% /dev/shm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tmpfs 7.8G 8.7M 7.8G 1% /run
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tmpfs 7.8G 0 7.8G 0% /sys/fs/cgroup
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/dev/mapper/rhel-root 61G 2.8G 59G 5% /
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/dev/sda2 1014M 207M 808M 21% /boot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/dev/mapper/rhel-home 30G 245M 30G 1% /home
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/dev/sda1 599M 5.9M 594M 1% /boot/efi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tmpfs 1.6G 0 1.6G 0% /run/user/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tmpfs 1.6G 0 1.6G 0% /run/user/1000
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="network">NetWork
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@quay ~]# nmcli c s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME UUID TYPE DEVICE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ens192 7e9a88db-859f-4580-bfc9-9fbe9c5985c6 ethernet ens192
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@quay ~]# nmcli c mod ens192 ipv4.method manual ipv4.address 192.168.33.34/24 ipv4.gateway 192.168.33.251 ipv4.dns 168.95.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@quay ~]# nmcli c u ens192
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@quay ~]# cat /etc/resolv.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Generated by NetworkManager
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">search ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nameserver 192.168.33.21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nameserver 168.95.1.1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="sudo">sudo
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@quay ~]# cat /etc/sudoers.d/devop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">devop ALL=(ALL) NOPASSWD: ALL
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="subsciption">subsciption
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">root@quay ~]# subscription-manager register
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Registering to: subscription.rhsm.redhat.com:443/subscription
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Username: ken.wang@infotech.com.tw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The system has been registered with ID: 77693b7f-9bbe-412d-9e15-210c55e799ef
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The registered system name is: quay.ocp.ken.lab
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="yum">yum
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@quay ~]# yum repolist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Updating Subscription Management repositories.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">repo id repo name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rhel-8-for-x86_64-appstream-rpms Red Hat Enterprise Linux 8 for x86_64 - AppStream (RPMs)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rhel-8-for-x86_64-baseos-rpms Red Hat Enterprise Linux 8 for x86_64 - BaseOS (RPMs)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="install-podman">Install Podman
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@quay ~]# yum install podman -y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@quay ~]# podman -v
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">podman version 4.1.1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="環境設定">環境設定
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>建立 Clair_pod&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@uat-quay ~]$ cat create_clairpod.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">podman pod create --name=clairpod -p 5433:5432 -p 8081:8081 -p 8089:8089
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@uat-quay ~]$ ./create_clairpod.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>建立 Quay_pod&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@quay quay]$ cat createpod.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">podman pod create --name=quaypod -p 80:8080 -p 443:8443 -p 6379:6379 -p 5432:5432
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@quay quay]$ ./createpod.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">f3fcbd51ffa7454c4e8825806a07252a9072ed7d26ad092e6bd21eb992033948
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>設定防火牆、SELinux&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">quay&lt;/span> &lt;span class="n">quay&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">sudo&lt;/span> &lt;span class="n">systemctl&lt;/span> &lt;span class="n">disable&lt;/span> &lt;span class="n">firewalld&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">now&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">quay&lt;/span> &lt;span class="n">quay&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">sudo&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">quay&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># setenforce 0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">quay&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># vim /etc/selinux/config &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">quay&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># cat /etc/selinux/config &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This file controls the state of SELinux on the system.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># SELINUX= can take one of these three values:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># enforcing - SELinux security policy is enforced.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># permissive - SELinux prints warnings instead of enforcing.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># disabled - No SELinux policy is loaded.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">SELINUX&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">disabled&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># SELINUXTYPE= can take one of these three values:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># targeted - Targeted processes are protected,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># minimum - Modification of targeted policy. Only selected processes are protected. &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># mls - Multi Level Security protection.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">SELINUXTYPE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">targeted&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>調整podman port binding權限&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo su -
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">echo &amp;#34;net.ipv4.ip_unprivileged_port_start = 80&amp;#34; &amp;gt;&amp;gt; /etc/sysctl.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@quay ~]# reboot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>podman 登入 registry.redhat.io&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@quay clair]$ podman login registry.redhat.io
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Username: ken.wang@infotech.com.tw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Login Succeeded!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>podman 登入 安裝quay時使用&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay ~&lt;span class="o">]&lt;/span>$ cat podmanlogin.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#!/bin/bash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">podman login -u&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;redhat+quay&amp;#34;&lt;/span> -p&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;O81WSHRSJR14UAZBK54GQHJS0P1V4CLWAJV1X2C4SD7KO59CQ9N3RE12612XU1HR&amp;#34;&lt;/span> quay.io
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>產生CA&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay certs&lt;span class="o">]&lt;/span>$ cat gencert.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#!/bin/bash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Create certificate given a specific url name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="nv">$#&lt;/span> -ne &lt;span class="m">1&lt;/span> &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;No arguments supplied or too many arguments&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Usage: &lt;/span>&lt;span class="nv">$0&lt;/span>&lt;span class="s2"> domain_name&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">MYNAME&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Generating a private key...for &lt;/span>&lt;span class="nv">$MYNAME&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openssl genrsa -out &lt;span class="nv">$MYNAME&lt;/span>.key &lt;span class="m">4096&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Generating a CSR...for &lt;/span>&lt;span class="nv">$MYNAME&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openssl req -new -key &lt;span class="nv">$MYNAME&lt;/span>.key &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>-out &lt;span class="nv">$MYNAME&lt;/span>.csr &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>-subj &lt;span class="s2">&amp;#34;/C=TW/ST=TW/L=Taipei/O=KEN/OU=LAB/CN=&lt;/span>&lt;span class="nv">$MYNAME&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Generating a certificate...for &lt;/span>&lt;span class="nv">$MYNAME&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openssl x509 -req -days &lt;span class="m">366&lt;/span> -in &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>&lt;span class="nv">$MYNAME&lt;/span>.csr -signkey &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>&lt;span class="nv">$MYNAME&lt;/span>.key &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>-out &lt;span class="nv">$MYNAME&lt;/span>.crt -extensions v3_req -extfile quay.cnf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay certs&lt;span class="o">]&lt;/span>$ cat quay.cnf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>req&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">req_extensions&lt;/span> &lt;span class="o">=&lt;/span> v3_req
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">distinguished_name&lt;/span> &lt;span class="o">=&lt;/span> req_distinguished_name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>req_distinguished_name&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> v3_req &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">basicConstraints&lt;/span> &lt;span class="o">=&lt;/span> CA:FALSE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">keyUsage&lt;/span> &lt;span class="o">=&lt;/span> nonRepudiation, digitalSignature, keyEncipherment
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">subjectAltName&lt;/span> &lt;span class="o">=&lt;/span> @alt_names
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>alt_names&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DNS.1 &lt;span class="o">=&lt;/span> quay.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DNS.2 &lt;span class="o">=&lt;/span> quay
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay ~&lt;span class="o">]&lt;/span>$ ./gencert.sh quay.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Generating a private key...for quay.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Generating RSA private key, &lt;span class="m">2048&lt;/span> bit long modulus &lt;span class="o">(&lt;/span>&lt;span class="m">2&lt;/span> primes&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.....+++++
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.................................+++++
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">e is &lt;span class="m">65537&lt;/span> &lt;span class="o">(&lt;/span>0x010001&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Generating a CSR...for quay.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Generating a certificate...for quay.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Signature ok
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">subject&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">C&lt;/span> &lt;span class="o">=&lt;/span> TW, &lt;span class="nv">ST&lt;/span> &lt;span class="o">=&lt;/span> TW, &lt;span class="nv">L&lt;/span> &lt;span class="o">=&lt;/span> Taipei, &lt;span class="nv">O&lt;/span> &lt;span class="o">=&lt;/span> KEN, &lt;span class="nv">OU&lt;/span> &lt;span class="o">=&lt;/span> LAB, &lt;span class="nv">CN&lt;/span> &lt;span class="o">=&lt;/span> quay.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Getting Private key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay certs&lt;span class="o">]&lt;/span>$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rwxrwxr-x &lt;span class="m">1&lt;/span> devop devop &lt;span class="m">600&lt;/span> Oct &lt;span class="m">17&lt;/span> 17:13 gencert.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> devop devop &lt;span class="m">279&lt;/span> Oct &lt;span class="m">17&lt;/span> 17:12 quay.cnf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> devop devop &lt;span class="m">1988&lt;/span> Oct &lt;span class="m">17&lt;/span> 17:14 quay.ocp.ken.lab.crt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> devop devop &lt;span class="m">1691&lt;/span> Oct &lt;span class="m">17&lt;/span> 17:14 quay.ocp.ken.lab.csr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw------- &lt;span class="m">1&lt;/span> devop devop &lt;span class="m">3243&lt;/span> Oct &lt;span class="m">17&lt;/span> 17:14 quay.ocp.ken.lab.key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay certs&lt;span class="o">]&lt;/span>$ sudo cp quay.ocp.ken.lab.crt /etc/pki/ca-trust/source/anchors/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay certs&lt;span class="o">]&lt;/span>$ sudo update-ca-trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay certs&lt;span class="o">]&lt;/span>$
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="安裝db-postgresql">安裝DB Postgresql
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>建立Clair_pgsql目錄&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">uat&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">quay&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">mkdir&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">pgsql_clair&lt;/span>&lt;span class="o">/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">uat&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">quay&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">chmod&lt;/span> &lt;span class="mi">777&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">pgsql_clair&lt;/span>&lt;span class="o">/&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>建立Quay_pgsql目錄&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">uat&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">quay&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">mkdir&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">pgsql&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">uat&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">quay&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">chmod&lt;/span> &lt;span class="mi">777&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">pgsql&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>啟動Clair_pgsql&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@uat-quay clair&lt;span class="o">]&lt;/span>$ cat start_pgsql_clair.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#!/bin/bash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">podman run -d --pod&lt;span class="o">=&lt;/span>clairpod --name&lt;span class="o">=&lt;/span>clair-pgsql &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -e &lt;span class="nv">POSTGRESQL_ADMIN_PASSWORD&lt;/span>&lt;span class="o">=&lt;/span>welcome1 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -e &lt;span class="nv">POSTGRESQL_USER&lt;/span>&lt;span class="o">=&lt;/span>clairuser &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -e &lt;span class="nv">POSTGRESQL_PASSWORD&lt;/span>&lt;span class="o">=&lt;/span>welcome1 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -e &lt;span class="nv">POSTGRESQL_DATABASE&lt;/span>&lt;span class="o">=&lt;/span>clairdb &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -v /home/devop/var/lib/pgsql_clair:/var/lib/pgsql/data:Z &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> registry.redhat.io/rhel8/postgresql-10:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@uat-quay clair&lt;span class="o">]&lt;/span>$ ./start_pgsql_clair.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>建立Clairdb Extension&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@uat-quay clair&lt;span class="o">]&lt;/span>$ cat test_pgsql_clair.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#!/bin/bash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">podman &lt;span class="nb">exec&lt;/span> -it clair-pgsql /bin/bash -c &lt;span class="s1">&amp;#39;echo &amp;#34;CREATE EXTENSION IF NOT EXISTS \&amp;#34;uuid-ossp\&amp;#34;&amp;#34; | psql -d clairdb -U postgres&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@uat-quay clair&lt;span class="o">]&lt;/span>$ ./test_pgsql_clair.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CREATE EXTENSION
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>啟動Quay_pgsql&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay quay&lt;span class="o">]&lt;/span>$ cat start_pgsql.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#!/bin/bash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">podman run -d --pod&lt;span class="o">=&lt;/span>quaypod --name&lt;span class="o">=&lt;/span>quay-pgsql &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -e &lt;span class="nv">POSTGRESQL_ADMIN_PASSWORD&lt;/span>&lt;span class="o">=&lt;/span>welcome1 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -e &lt;span class="nv">POSTGRESQL_USER&lt;/span>&lt;span class="o">=&lt;/span>quayuser &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -e &lt;span class="nv">POSTGRESQL_PASSWORD&lt;/span>&lt;span class="o">=&lt;/span>welcome1 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -e &lt;span class="nv">POSTGRESQL_DATABASE&lt;/span>&lt;span class="o">=&lt;/span>quaydb &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -v /home/devop/var/lib/pgsql:/var/lib/pgsql/data:Z &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> registry.redhat.io/rhel8/postgresql-10:1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>建立 quaydb Extension&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@quay quay]$ podman exec -it quay-pgsql /bin/bash -c &amp;#39;echo &amp;#34;CREATE EXTENSION IF NOT EXISTS pg_trgm&amp;#34; | psql -d quaydb -U postgres&amp;#39;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="安裝redis">安裝Redis
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>建立redis資料夾&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">mkdir&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">chmod&lt;/span> &lt;span class="mi">777&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">devop&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">redis&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>安裝redis&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@uat-quay ~&lt;span class="o">]&lt;/span>$ cat start_redis.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#!/bin/bash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">podman run -d --pod&lt;span class="o">=&lt;/span>quaypod --name&lt;span class="o">=&lt;/span>quay-redis &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -v /home/devop/var/lib/redis:/var/lib/redis/data:Z &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -e &lt;span class="nv">REDIS_PASSWORD&lt;/span>&lt;span class="o">=&lt;/span>welcome1 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> registry.redhat.io/rhel8/redis-5:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay quay&lt;span class="o">]&lt;/span>$ ./start_redis.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Trying to pull registry.redhat.io/rhel8/redis-5:1...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Getting image &lt;span class="nb">source&lt;/span> signatures
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Checking &lt;span class="k">if&lt;/span> image destination supports signatures
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Copying blob 8b33c6fa797f &lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Copying blob f70d60810c69 &lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Copying blob 545277d80005 &lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Copying blob 399eb2b7226e &lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Copying config c9df129d49 &lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Writing manifest to image destination
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Storing signatures
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">c2576cc7542ec7637d0fa044c53adc1d2123ffdc99f851901f891084301d579c
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>確認container 狀態&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">podman ps
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="配置quay-config">配置Quay Config
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>podman 登入quay.io&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay ~&lt;span class="o">]&lt;/span>$ cat podmanlogin.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#!/bin/bash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">podman login -u&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;redhat+quay&amp;#34;&lt;/span> -p&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;O81WSHRSJR14UAZBK54GQHJS0P1V4CLWAJV1X2C4SD7KO59CQ9N3RE12612XU1HR&amp;#34;&lt;/span> quay.io
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay ~&lt;span class="o">]&lt;/span>$ ./podmanlogin.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Login Succeeded!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安裝quay-config&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@uat-quay ~&lt;span class="o">]&lt;/span>$ cat start_quay_config.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#!/bin/bash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">podman run --rm -it --pod&lt;span class="o">=&lt;/span>quaypod --name&lt;span class="o">=&lt;/span>quay-config &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> registry.redhat.io/quay/quay-rhel8:v3.7.3 config welcome1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20220831115811189.png"
loading="lazy"
alt="image-20220831115811189"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>連線網頁 &lt;a class="link" href="http://quay.ocp.ken.lab" target="_blank" rel="noopener"
>http://quay.ocp.ken.lab&lt;/a> quayconfig welcome1&lt;/p>
&lt;/li>
&lt;li>
&lt;p>左下角共有五項需設定 Hostname、DB、Redis，上傳憑證&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20220831115921288.png"
loading="lazy"
alt="image-20220831115921288"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>設定Server Hostname &amp;amp; TLS : quay.ocp.ken.lab
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221014145935943.png"
loading="lazy"
alt="image-20221014145935943"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>設定DB 資訊&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Database Server: quay.ocp.ken.lab:5432
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Username: quayuser
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password: welcome1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Database Name: quaydb
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221014145956804.png"
loading="lazy"
alt="image-20221014145956804"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>設定redis Hostname&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Redis Hostname: quay.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Redis Port: 6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Redis password: welcome1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221014150016457.png"
loading="lazy"
alt="image-20221014150016457"
>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 id="enable-security-scanner">Enable Security Scanner
&lt;/h4>&lt;pre>&lt;code>##### Enable Security Scanner &amp;amp; Generate PSK
PSK: MTg4MDJnaTQ3OWRjYw==
&lt;/code>&lt;/pre>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221014150103834.png"
loading="lazy"
alt="image-20221014150103834"
>&lt;/p>
&lt;ol start="9">
&lt;li>
&lt;p>保存設定並下載設定檔，並關閉quay-config&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20220831120853324.png"
loading="lazy"
alt="image-20220831120853324"
>&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20220830154235463.png"
loading="lazy"
alt="image-20220830154235463"
>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="解壓縮config">解壓縮Config
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>下載後解壓縮&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@quay quay]$ tar xvf quay-config.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">extra_ca_certs/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">config.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssl.cert
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssl.key
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="設定-clair並啟動">設定 Clair並啟動
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>建立Clair目錄&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@uat-quay ~]$ mkdir -p /home/devop/mnt/clair/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@uat-quay ~]$ chmod 777 /home/devop/mnt/clair/config
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>配置clair的config.yaml &amp;raquo; 要在quay_config階段時Enable Security Scanner 並Generate PSK&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@uat-quay ~]$ cat prekey.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">MTg4MDJnaTQ3OWRjYw==
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@uat-quay clair]$ vim config.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">http_listen_addr: :8081
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">introspection_addr: :8089
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">log_level: info
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">indexer:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> connstring: host=quay.ocp.ken.lab port=5433 dbname=clairdb user=clairuser password=welcome1 sslmode=disable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> scanlock_retry: 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> layer_scan_concurrency: 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> migrations: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">matcher:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> connstring: host=quay.ocp.ken.lab port=5433 dbname=clairdb user=clairuser password=welcome1 sslmode=disable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> max_conn_pool: 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> run: &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> migrations: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> indexer_addr: clair-indexer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">notifier:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> connstring: host=quay.ocp.ken.lab port=5433 dbname=clairdb user=clairuser password=welcome1 sslmode=disable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> delivery_interval: 1m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> poll_interval: 5m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> migrations: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">auth:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> psk:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> key: &amp;#34;MTg4MDJnaTQ3OWRjYw==&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> iss: [&amp;#34;quay&amp;#34;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@uat-quay clair]$ cp config /home/devop/mnt/clair/config/config.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>啟動Clair ( 先停止Quay )&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@uat-quay clair&lt;span class="o">]&lt;/span>$ podman login registry.redhat.io
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Username: ken.wang@infotech.com.tw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Login Succeeded!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay clair&lt;span class="o">]&lt;/span>$ cat start_clair.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#!/bin/bash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">podman run -d --pod clairpod --name clair -e &lt;span class="nv">CLAIR_CONF&lt;/span>&lt;span class="o">=&lt;/span>/clair/config.yaml &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -e &lt;span class="nv">CLAIR_MODE&lt;/span>&lt;span class="o">=&lt;/span>combo -e &lt;span class="nv">SSL_CERT_DIR&lt;/span>&lt;span class="o">=&lt;/span>/etc/pki/tls/certs &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -v /home/devop/mnt/clair/config:/clair:Z &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -v /home/devop/mnt/quay/certs/quay.ocp.ken.lab.crt:/etc/pki/tls/certs/quay.ocp.ken.lab:Z &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> registry.redhat.io/quay/clair-rhel8:v3.5.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay clair&lt;span class="o">]&lt;/span>$ ./start_clair.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Trying to pull registry.redhat.io/quay/clair-rhel8:v3.5.0...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Getting image &lt;span class="nb">source&lt;/span> signatures
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Checking &lt;span class="k">if&lt;/span> image destination supports signatures
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Copying blob d821702c1e09 &lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Copying blob 13897c84ca57 &lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Copying blob 64607cc74f9c &lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Copying config 10e4c3931b &lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Writing manifest to image destination
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Storing signatures
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4d428098362e17ae606dad5412756f880ab40420af4f7a376170242064963154
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>確認container狀態&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@quay clair]$ podman ps
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">eb65b55e9875 localhost/podman-pause:4.1.1-1657551413 About an hour ago Up About an hour ago 0.0.0.0:5433-&amp;gt;5432/tcp, 0.0.0.0:8081-&amp;gt;8081/tcp, 0.0.0.0:8089-&amp;gt;8089/tcp 535faabcd216-infra
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4b465bef2476 registry.redhat.io/rhel8/postgresql-10:1 run-postgresql About an hour ago Up About an hour ago 0.0.0.0:5433-&amp;gt;5432/tcp, 0.0.0.0:8081-&amp;gt;8081/tcp, 0.0.0.0:8089-&amp;gt;8089/tcp clair-pgsql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">154a0b6a0803 localhost/podman-pause:4.1.1-1657551413 About an hour ago Up About an hour ago 0.0.0.0:80-&amp;gt;8080/tcp, 0.0.0.0:443-&amp;gt;8443/tcp, 0.0.0.0:5432-&amp;gt;5432/tcp, 0.0.0.0:6379-&amp;gt;6379/tcp da7ca63d2ac6-infra
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">518b5db0591a registry.redhat.io/rhel8/postgresql-10:1 run-postgresql About an hour ago Up About an hour ago 0.0.0.0:80-&amp;gt;8080/tcp, 0.0.0.0:443-&amp;gt;8443/tcp, 0.0.0.0:5432-&amp;gt;5432/tcp, 0.0.0.0:6379-&amp;gt;6379/tcp quay-pgsql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">c2576cc7542e registry.redhat.io/rhel8/redis-5:1 run-redis 46 minutes ago Up 46 minutes ago 0.0.0.0:80-&amp;gt;8080/tcp, 0.0.0.0:443-&amp;gt;8443/tcp, 0.0.0.0:5432-&amp;gt;5432/tcp, 0.0.0.0:6379-&amp;gt;6379/tcp quay-redis
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>確認更新完成即可啟動Quay (約3分鐘)&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@uat-quay clair]$ podman logs --tail 10 clair
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{&amp;#34;level&amp;#34;:&amp;#34;info&amp;#34;,&amp;#34;component&amp;#34;:&amp;#34;libvuln/New&amp;#34;,&amp;#34;component&amp;#34;:&amp;#34;libvuln/updateDriver/RunUpdaters&amp;#34;,&amp;#34;component&amp;#34;:&amp;#34;internal/updater/Executor&amp;#34;,&amp;#34;run_id&amp;#34;:1879968118,&amp;#34;updater&amp;#34;:&amp;#34;photon-updater-photon3&amp;#34;,&amp;#34;component&amp;#34;:&amp;#34;photon/Updater.Parse&amp;#34;,&amp;#34;time&amp;#34;:&amp;#34;2022-09-14T05:21:38Z&amp;#34;,&amp;#34;time&amp;#34;:&amp;#34;2022-09-14T05:21:38Z&amp;#34;,&amp;#34;message&amp;#34;:&amp;#34;starting parse&amp;#34;}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{&amp;#34;level&amp;#34;:&amp;#34;info&amp;#34;,&amp;#34;component&amp;#34;:&amp;#34;libvuln/New&amp;#34;,&amp;#34;component&amp;#34;:&amp;#34;libvuln/updateDriver/RunUpdaters&amp;#34;,&amp;#34;component&amp;#34;:&amp;#34;internal/updater/Executor&amp;#34;,&amp;#34;run_id&amp;#34;:1879968118,&amp;#34;updater&amp;#34;:&amp;#34;RHEL8-advanced-virtualization&amp;#34;,&amp;#34;ref&amp;#34;:&amp;#34;0f18ac9b-223f-460d-96ed-08ea268e278e&amp;#34;,&amp;#34;time&amp;#34;:&amp;#34;2022-09-14T05:22:38Z&amp;#34;,&amp;#34;time&amp;#34;:&amp;#34;2022-09-14T05:22:38Z&amp;#34;,&amp;#34;message&amp;#34;:&amp;#34;successful update&amp;#34;}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{&amp;#34;level&amp;#34;:&amp;#34;info&amp;#34;,&amp;#34;component&amp;#34;:&amp;#34;libvuln/New&amp;#34;,&amp;#34;component&amp;#34;:&amp;#34;libvuln/updateDriver/RunUpdaters&amp;#34;,&amp;#34;component&amp;#34;:&amp;#34;internal/updater/Executor&amp;#34;,&amp;#34;run_id&amp;#34;:1879968118,&amp;#34;updater&amp;#34;:&amp;#34;photon-updater-photon1&amp;#34;,&amp;#34;ref&amp;#34;:&amp;#34;b1ea50fa-b89c-4f94-a182-a65a9284125a&amp;#34;,&amp;#34;time&amp;#34;:&amp;#34;2022-09-14T05:22:48Z&amp;#34;,&amp;#34;time&amp;#34;:&amp;#34;2022-09-14T05:22:48Z&amp;#34;,&amp;#34;message&amp;#34;:&amp;#34;successful update&amp;#34;}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="啟動quay">啟動Quay
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>啟動Quay&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">##建立quay資料夾 並將config 、 CA 放到&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay quay&lt;span class="o">]&lt;/span>$ mkdir -p /home/devop/mnt/quay/storage
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay quay&lt;span class="o">]&lt;/span>$ mkdir -p /home/devop/mnt/quay/storage
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay quay&lt;span class="o">]&lt;/span>$ mkdir -P /home/devop/mnt/quay/certs/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay quay&lt;span class="o">]&lt;/span>$ chmod &lt;span class="m">777&lt;/span> /home/devop/mnt/quay/storage
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay quay&lt;span class="o">]&lt;/span>$ chmod &lt;span class="m">777&lt;/span> /home/devop/mnt/quay/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay quay&lt;span class="o">]&lt;/span>$ chmod &lt;span class="m">777&lt;/span> /home/devop/mnt/quay/certs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay quay&lt;span class="o">]&lt;/span>$ cp config.yaml /home/devop/mnt/quay/config/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay certs&lt;span class="o">]&lt;/span>$ cp quay.ocp.ken.lab.* /home/devop/mnt/quay/certs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay config&lt;span class="o">]&lt;/span>$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rwxrwxr-x &lt;span class="m">1&lt;/span> devop devop &lt;span class="m">2365&lt;/span> Jan &lt;span class="m">1&lt;/span> &lt;span class="m">1970&lt;/span> config.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">2&lt;/span> devop devop &lt;span class="m">6&lt;/span> Jan &lt;span class="m">1&lt;/span> &lt;span class="m">1970&lt;/span> extra_ca_certs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> devop devop &lt;span class="m">3312&lt;/span> Oct &lt;span class="m">14&lt;/span> 16:10 quay-config.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rwxrwxr-x &lt;span class="m">1&lt;/span> devop devop &lt;span class="m">1204&lt;/span> Jan &lt;span class="m">1&lt;/span> &lt;span class="m">1970&lt;/span> ssl.cert
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rwxrwxr-x &lt;span class="m">1&lt;/span> devop devop &lt;span class="m">1679&lt;/span> Jan &lt;span class="m">1&lt;/span> &lt;span class="m">1970&lt;/span> ssl.key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay config&lt;span class="o">]&lt;/span>$ &lt;span class="nb">cd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@uat-quay ~&lt;span class="o">]&lt;/span>$ cat start_quay.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#!/bin/bash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">podman run -d --pod&lt;span class="o">=&lt;/span>quaypod --name&lt;span class="o">=&lt;/span>quay &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -v /home/devop/mnt/quay/config:/conf/stack:Z &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -v /home/devop/mnt/quay/storage:/datastorage:Z &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> registry.redhat.io/quay/quay-rhel8:v3.7.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@uat-quay ~&lt;span class="o">]&lt;/span>$ ./start_quay.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5f1915f2038f4167fd6e37c4233903dbad7de00acd6e753957ed9ff66b2d8ba2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>devop@quay quay&lt;span class="o">]&lt;/span>$ podman ps
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">eb65b55e9875 localhost/podman-pause:4.1.1-1657551413 About an hour ago Up About an hour ago 0.0.0.0:5433-&amp;gt;5432/tcp, 0.0.0.0:8081-&amp;gt;8081/tcp, 0.0.0.0:8089-&amp;gt;8089/tcp 535faabcd216-infra
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4b465bef2476 registry.redhat.io/rhel8/postgresql-10:1 run-postgresql About an hour ago Up About an hour ago 0.0.0.0:5433-&amp;gt;5432/tcp, 0.0.0.0:8081-&amp;gt;8081/tcp, 0.0.0.0:8089-&amp;gt;8089/tcp clair-pgsql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">154a0b6a0803 localhost/podman-pause:4.1.1-1657551413 About an hour ago Up About an hour ago 0.0.0.0:80-&amp;gt;8080/tcp, 0.0.0.0:443-&amp;gt;8443/tcp, 0.0.0.0:5432-&amp;gt;5432/tcp, 0.0.0.0:6379-&amp;gt;6379/tcp da7ca63d2ac6-infra
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">518b5db0591a registry.redhat.io/rhel8/postgresql-10:1 run-postgresql About an hour ago Up About an hour ago 0.0.0.0:80-&amp;gt;8080/tcp, 0.0.0.0:443-&amp;gt;8443/tcp, 0.0.0.0:5432-&amp;gt;5432/tcp, 0.0.0.0:6379-&amp;gt;6379/tcp quay-pgsql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">c2576cc7542e registry.redhat.io/rhel8/redis-5:1 run-redis About an hour ago Up About an hour ago 0.0.0.0:80-&amp;gt;8080/tcp, 0.0.0.0:443-&amp;gt;8443/tcp, 0.0.0.0:5432-&amp;gt;5432/tcp, 0.0.0.0:6379-&amp;gt;6379/tcp quay-redis
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3c9b87b803d3 registry.redhat.io/quay/clair-rhel8:v3.5.0 &lt;span class="m">12&lt;/span> minutes ago Up &lt;span class="m">12&lt;/span> minutes ago 0.0.0.0:5433-&amp;gt;5432/tcp, 0.0.0.0:8081-&amp;gt;8081/tcp, 0.0.0.0:8089-&amp;gt;8089/tcp clair
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>開啟瀏覽器連線 &lt;a class="link" href="https://quay.ocp.ken.lab" target="_blank" rel="noopener"
>https://quay.ocp.ken.lab&lt;/a> quayadmin/welcome1
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221017172605042.png"
loading="lazy"
alt="image-20221017172605042"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>確認憑證
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221017172616780.png"
loading="lazy"
alt="image-20221017172616780"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>建立管理員帳號、密碼，Create Account&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Username: quayadmin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">E-mail: quayadmin@email.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password: welcome1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20220831122552327.png"
loading="lazy"
alt="image-20220831122552327"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>登入確認
&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20220831122620702.png"
loading="lazy"
alt="image-20220831122620702"
>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h1 id="測試clair">測試Clair
&lt;/h1>&lt;ol>
&lt;li>測試pull &amp;amp; push (憑證可透過 &amp;ndash;tls-verify=false解決 or 將憑證放到podman 設定檔路徑)&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[devop@quay ~]$ openssl x509 -in certs/quay.ocp.ken.lab.crt -out certs/quay.ocp.ken.lab.cert
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@quay ~]$ podman login quay.ocp.ken.lab --cert-dir=/home/devop/certs/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Username: quayadmin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Login Succeeded!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@quay ~]$ sudo mkdir /etc/containers/certs.d/quay.ocp.ken.lab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@quay ~]$ sudo cp /home/devop/certs/quay.ocp.ken.lab.crt /etc/containers/certs.d/quay.ocp.ken.lab/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">＃＃＃重開terminal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@quay ~]$ podman pull docker.io/library/ubuntu:20.04
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Trying to pull docker.io/library/ubuntu:20.04...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Getting image source signatures
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Copying blob fb0b3276a519 done
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Copying config 817578334b done
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Writing manifest to image destination
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Storing signatures
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">817578334b4dd5e2b0654610e895e08e1bea996c58119bb9c7e3bd9e74dd8936
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@quay ~]$ podman tag docker.io/library/ubuntu:20.04 quay.ocp.ken.lab/quayadmin/ubuntu:20.04
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[devop@quay ~]$ podman push quay.ocp.ken.lab/quayadmin/ubuntu:20.04 --cert-dir=/home/devop/certs/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Getting image source signatures
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Copying blob cdca8156a203 done
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Copying config 817578334b done
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Writing manifest to image destination
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Storing signatures
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221017174835521.png"
loading="lazy"
alt="image-20221017174835521"
>&lt;/p>
&lt;ol start="2">
&lt;li>
&lt;p>查看Security Scan&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/image-20221017174905497.png"
loading="lazy"
alt="image-20221017174905497"
>&lt;/p>
&lt;/li>
&lt;/ol></description></item><item><title>Hello World</title><link>https://wangken0129.github.io/p/hello-world/</link><pubDate>Tue, 19 Sep 2023 05:10:00 +0800</pubDate><guid>https://wangken0129.github.io/p/hello-world/</guid><description>&lt;h1 id="hello-world">Hello World
&lt;/h1>&lt;h2 id="description">Description
&lt;/h2>&lt;p>This is a blog for my labs and knowledge bases.&lt;/p>
&lt;p>Happy engineering.&lt;/p>
&lt;p>這是Ken的部落格，用來放我的Lab跟知識庫。&lt;/p>
&lt;p>當個快樂的工程師。&lt;/p>
&lt;p>&lt;img src="https://kenkenny.synology.me:5543/images/2023/09/0*ngAthWxOvKZHvsw9.jpeg"
loading="lazy"
alt="The Dangers of Hacking and What a Hacker Can Do to Your Computer? | by Sravan Cynixit | Quick Code | Medium"
>&lt;/p>
&lt;h2 id="this-is-a-test-shell-script">This is a test shell script
&lt;/h2>&lt;p>Generate certificate script&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="c1"># Create certificate given a specific url name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="nv">$#&lt;/span> -ne &lt;span class="m">1&lt;/span> &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;No arguments supplied or too many arguments&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Usage: &lt;/span>&lt;span class="nv">$0&lt;/span>&lt;span class="s2"> domain_name&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">MYNAME&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Generating a private key...for &lt;/span>&lt;span class="nv">$MYNAME&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openssl genrsa -out &lt;span class="nv">$MYNAME&lt;/span>.key &lt;span class="m">2048&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Generating a CSR...for &lt;/span>&lt;span class="nv">$MYNAME&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openssl req -new -key &lt;span class="nv">$MYNAME&lt;/span>.key &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>-out &lt;span class="nv">$MYNAME&lt;/span>.csr &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>-subj &lt;span class="s2">&amp;#34;/C=US/ST=NC/L=Raleigh/O=RedHat/OU=RHT/CN=&lt;/span>&lt;span class="nv">$MYNAME&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Generating a certificate...for &lt;/span>&lt;span class="nv">$MYNAME&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openssl x509 -req -days &lt;span class="m">366&lt;/span> -in &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>&lt;span class="nv">$MYNAME&lt;/span>.csr -signkey &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>&lt;span class="nv">$MYNAME&lt;/span>.key &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>-out &lt;span class="nv">$MYNAME&lt;/span>.crt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item></channel></rss>