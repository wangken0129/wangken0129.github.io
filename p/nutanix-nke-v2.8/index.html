<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Nutanix-NKE-v2.8"><title>Nutanix-NKE-v2.8</title>
<link rel=canonical href=https://wangken0129.github.io/p/nutanix-nke-v2.8/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="Nutanix-NKE-v2.8"><meta property='og:description' content="Nutanix-NKE-v2.8"><meta property='og:url' content='https://wangken0129.github.io/p/nutanix-nke-v2.8/'><meta property='og:site_name' content="Ken's blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Kubernetes'><meta property='article:tag' content='Nutanix'><meta property='article:tag' content='NKE'><meta property='article:published_time' content='2023-10-11T05:34:51+08:00'><meta property='article:modified_time' content='2023-10-11T05:34:51+08:00'><meta name=twitter:title content="Nutanix-NKE-v2.8"><meta name=twitter:description content="Nutanix-NKE-v2.8"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切換選單>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_c68a00bbf16dac8.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🇹🇼</span></figure><div class=site-meta><h1 class=site-name><a href=/>Ken's blog</a></h1><h2 class=site-description>紀錄與分享，當個快樂的工程師</h2></div></header><ol class=menu-social><li><a href=https://github.com/wangken0129/wangken0129.github.io target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/ken-wang-88924b181/ target=_blank title=LinkedIn rel=me><svg class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>夜晚模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目錄</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#前言>前言</a></li><li><a href=#版本資訊>版本、資訊</a></li><li><a href=#安裝步驟>安裝步驟</a><ol><li><a href=#check-nke-enabled>Check NKE Enabled</a></li><li><a href=#check-nke-version>Check NKE Version</a></li><li><a href=#download-os-image>Download OS Image</a></li><li><a href=#create-cluster>Create Cluster</a></li></ol></li><li><a href=#驗證-nke-叢集>驗證 NKE 叢集</a><ol><li><a href=#介面>介面</a></li><li><a href=#enter-cluster>Enter Cluster</a><ol><li><a href=#ssh-access>SSH Access：</a></li><li><a href=#download-kubeconfig>Download Kubeconfig：</a></li></ol></li></ol></li><li><a href=#nutanix-files-串接>Nutanix Files 串接</a><ol><li><a href=#files>Files</a></li><li><a href=#create-storage-class>Create Storage Class</a></li></ol></li><li><a href=#部署服務>部署服務</a><ol><li><a href=#部署redmine>部署redmine</a></li></ol></li><li><a href=#options--add-ons>Options & Add-Ons</a><ol><li><a href=#infra-logging>Infra Logging</a></li></ol></li><li><a href=#擴充節點>擴充節點</a><ol><li><a href=#add-node-pool>Add Node Pool</a></li><li><a href=#resize-node-pool>Resize Node Pool</a></li></ol></li><li><a href=#升級kubernetes>升級Kubernetes</a><ol><li><a href=#步驟>步驟</a></li></ol></li><li><a href=#advanced-kubernetes-tp>Advanced Kubernetes (TP)</a><ol><li><a href=#新增management-cluster>新增Management Cluster</a></li><li><a href=#完成前後對照>完成前後對照</a></li></ol></li><li><a href=#總結>總結</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/lab-category/ style=background-color:#2a9d8f;color:#fff>Lab Category</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/nutanix-nke-v2.8/>Nutanix-NKE-v2.8</a></h2><h3 class=article-subtitle>Nutanix-NKE-v2.8</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Oct 11, 2023</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>閱讀時間: 16 分鐘</time></div></footer></div></header><section class=article-content><h1 id=nutanix-nke-karbon-實作>Nutanix NKE (Karbon) 實作</h1><h2 id=前言>前言</h2><p>此測試主要目的為安裝NKE、測試CSI Driver、驗證服務及升級，</p><p>並且能夠執行擴充、刪減、升級等操作，皆使用非離線的方式完成。</p><h2 id=版本資訊>版本、資訊</h2><p>PC2023.3 預設NKE版本為v2.2.3，已先升級到v2.8.0，以測試更高的Kubernetes版本。</p><p>參考連結：https://portal.nutanix.com/page/documents/details?targetId=Nutanix-Kubernetes-Engine-v2_8:Nutanix-Kubernetes-Engine-v2_8</p><p>Port需求：</p><p><a class=link href="https://portal.nutanix.com/page/documents/list?type=software&amp;filterKey=software&amp;filterVal=Ports%20and%20Protocols&amp;productType=Nutanix%20Kubernetes%20Engine" target=_blank rel=noopener>https://portal.nutanix.com/page/documents/list?type=software&filterKey=software&filterVal=Ports%20and%20Protocols&productType=Nutanix%20Kubernetes%20Engine</a></p><p>Calico vs Flannel (Calico不支援Node在不同Vlan)：</p><p><a class=link href=https://www.modb.pro/db/152417 target=_blank rel=noopener>https://www.modb.pro/db/152417</a></p><p>Shell：https://blog.csdn.net/low5252/article/details/103646475</p><p>版本：</p><p>AOS: 6.5.3.6</p><p>Prism Central: 2023.3</p><p>NKE: 2.8.0</p><p>Kubernetes: 1.24.10</p><p>架構：</p><p>共會有八個VM：Control Plane *2 、etcd *3 、Worker Node *3</p><p>NKE 運作架構</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/nke_multi-cluster_onprem_diagram_v2.svg loading=lazy alt="The Nutanix Bible"></p><h2 id=安裝步驟>安裝步驟</h2><h3 id=check-nke-enabled>Check NKE Enabled</h3><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231002180337566.png loading=lazy alt=image-20231002180337566></p><h3 id=check-nke-version>Check NKE Version</h3><p>NKE: v2.7.0</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231002180455854.png loading=lazy alt=image-20231002180455854></p><p>v2.7.0 UI出不來，故升級到v2.8.0</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003113901890.png loading=lazy alt=image-20231003113901890></p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003113957749.png loading=lazy alt=image-20231003113957749></p><h3 id=download-os-image>Download OS Image</h3><p>下載的是ntnx-1.5</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003114547878.png loading=lazy alt=image-20231003114547878></p><h3 id=create-cluster>Create Cluster</h3><ol><li><p>配置IPAM</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003095321526.png loading=lazy alt=image-20231003095321526></p></li><li><p>到Kubernetes Management &ndash;> Create Cluster &ndash;> Production Cluster &ndash;> Next</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003130720675.png loading=lazy alt=image-20231003130720675></p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003114440806.png loading=lazy alt=image-20231003114440806></p></li><li><p>輸入Cluster Name、版本等資訊，先安裝1.24.10</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003134121155.png loading=lazy alt=image-20231003134121155></p></li><li><p>選擇Node的子網，Additional可不選，Woker Node數量</p><p>Control Plane可選擇External Loadbalance or Active-Passive，</p><p>前者需建立好Loadbalance，可擴充性較高，</p><p>後者只能使用兩個Control Plane，作為主要跟備援的Node，且要提供一個VIP在IPAM的管理範圍外面。</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003135441332.png loading=lazy alt=image-20231003135441332></p></li><li><p>etcd的數量</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003135458249.png loading=lazy alt=image-20231003135458249></p></li><li><p>選擇Kubenetes網路 Calico or Flannel ，兩者比較在上面的連結，這裡選擇Flannel 其他預設</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003135128065.png loading=lazy alt=image-20231003135128065></p></li><li><p>選擇預設的Storage Class ，預設的會使用iSCSI Data Service的IP去連結Nutanix Cluster的Volume空間</p><p>後續有需要NFS可以再加入，其他預設即可點選Create</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003135239648.png loading=lazy alt=image-20231003135239648></p></li><li><p>之後會開始自動安裝NKE Cluster</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003135634766.png loading=lazy alt=image-20231003135634766></p></li><li><p>順序大概是 Create etcd VM &ndash;> Create etcd Cluster &ndash;> Create Master VM &ndash;> Create Worker VM &ndash;> Create NKE Cluster</p><p>會自動建立一些PVC給Cluster內部使用</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003140541856.png loading=lazy alt=image-20231003140541856></p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003141114844.png alt=image-20231003141114844 style=zoom:50%></li><li><p>建立的VM 以及VIP已掛在Master Node上面</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003141434688.png loading=lazy alt=image-20231003141434688></p></li><li><p>約15分鐘Cluster就建立完成了</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003141957766.png loading=lazy alt=image-20231003141957766></p></li><li><p>回到Kubenetes Management 可看到NKE Cluster建立完成，Status: Healthy</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003142114057.png loading=lazy alt=image-20231003142114057></p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003142215697.png loading=lazy alt=image-20231003142215697></p></li></ol><h2 id=驗證-nke-叢集>驗證 NKE 叢集</h2><h3 id=介面>介面</h3><p>Node Pools：Worker可以再加，etcd跟 Control Plane是不能再新增</p><p>Woker Node</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003144146664.png loading=lazy alt=image-20231003144146664></p><p>Control Plane Node</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003142534886.png loading=lazy alt=image-20231003142534886></p><p>etcd Node</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003142549532.png loading=lazy alt=image-20231003142549532></p><p>Storage Class為預設的 Nutanix Volume</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003142618575.png loading=lazy alt=image-20231003142618575></p><h3 id=enter-cluster>Enter Cluster</h3><h4 id=ssh-access>SSH Access：</h4><p>此方法可直接進入被鎖定的節點上面，下載.sh檔案並執行，裡面會內含Private Key</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003142742864.png loading=lazy alt=image-20231003142742864></p><h4 id=download-kubeconfig>Download Kubeconfig：</h4><p>下載Kubeconfig並設定環境變數，需要安裝kubectl</p><p>此檔案可能會自動rotate certicifate，記得再重新下載即可</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003142830309.png loading=lazy alt=image-20231003142830309></p><ol><li><p>安裝Kubectl ( Mac )</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % curl -LO <span class=s2>&#34;https://dl.k8s.io/release/v1.24.10/bin/darwin/amd64/kubectl&#34;</span>
</span></span><span class=line><span class=cl>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span class=line><span class=cl>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span class=line><span class=cl><span class=m>100</span>   <span class=m>138</span>  <span class=m>100</span>   <span class=m>138</span>    <span class=m>0</span>     <span class=m>0</span>    <span class=m>518</span>      <span class=m>0</span> --:--:-- --:--:-- --:--:--   <span class=m>532</span>
</span></span><span class=line><span class=cl><span class=m>100</span> 50.2M  <span class=m>100</span> 50.2M    <span class=m>0</span>     <span class=m>0</span>   717k      <span class=m>0</span>  0:01:11  0:01:11 --:--:--  984k
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ll
</span></span><span class=line><span class=cl>total <span class=m>104600</span>
</span></span><span class=line><span class=cl>drwxr-xr-x   <span class=m>5</span> wangken  staff       <span class=m>160</span> <span class=m>10</span>  <span class=m>3</span> 14:52 .
</span></span><span class=line><span class=cl>drwxr-xr--+ <span class=m>73</span> wangken  staff      <span class=m>2336</span> <span class=m>10</span>  <span class=m>3</span> 14:30 ..
</span></span><span class=line><span class=cl>-rw-r--r--@  <span class=m>1</span> wangken  staff      <span class=m>3497</span> <span class=m>10</span>  <span class=m>3</span> 14:28 ken-nke1-kubectl.cfg
</span></span><span class=line><span class=cl>-rwxr-xr-x@  <span class=m>1</span> wangken  staff      <span class=m>4538</span> <span class=m>10</span>  <span class=m>3</span> 14:26 ken-nke1-ssh-access.sh
</span></span><span class=line><span class=cl>-rw-r--r--   <span class=m>1</span> wangken  staff  <span class=m>52739872</span> <span class=m>10</span>  <span class=m>3</span> 14:45 kubectl
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % chmod +x kubectl 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ./kubectl version
</span></span><span class=line><span class=cl>WARNING: This version information is deprecated and will be replaced with the output from kubectl version --short.  Use --output<span class=o>=</span>yaml<span class=p>|</span>json to get the full version.
</span></span><span class=line><span class=cl>Client Version: version.Info<span class=o>{</span>Major:<span class=s2>&#34;1&#34;</span>, Minor:<span class=s2>&#34;24&#34;</span>, GitVersion:<span class=s2>&#34;v1.24.10&#34;</span>, GitCommit:<span class=s2>&#34;5c1d2d4295f9b4eb12bfbf6429fdf989f2ca8a02&#34;</span>, GitTreeState:<span class=s2>&#34;clean&#34;</span>, BuildDate:<span class=s2>&#34;2023-01-18T19:15:31Z&#34;</span>, GoVersion:<span class=s2>&#34;go1.19.5&#34;</span>, Compiler:<span class=s2>&#34;gc&#34;</span>, Platform:<span class=s2>&#34;darwin/amd64&#34;</span><span class=o>}</span>
</span></span><span class=line><span class=cl>Kustomize Version: v4.5.4
</span></span><span class=line><span class=cl>The connection to the server localhost:8080 was refused - did you specify the right host or port?
</span></span></code></pre></td></tr></table></div></div></li><li><p>可直接執行或是把kubectl 丟到 /usr/local/bin</p></li><li><p>直接執行需要帶入 &ndash;kubeconfig + 下載的config檔案</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ./kubectl get nodes --kubeconfig ken-nke1-kubectl.cfg 
</span></span><span class=line><span class=cl>NAME                       STATUS   ROLES                  AGE   VERSION
</span></span><span class=line><span class=cl>ken-nke1-906a07-master-0   Ready    control-plane,master   55m   v1.24.10
</span></span><span class=line><span class=cl>ken-nke1-906a07-master-1   Ready    control-plane,master   54m   v1.24.10
</span></span><span class=line><span class=cl>ken-nke1-906a07-worker-0   Ready    node                   51m   v1.24.10
</span></span><span class=line><span class=cl>ken-nke1-906a07-worker-1   Ready    node                   51m   v1.24.10
</span></span><span class=line><span class=cl>ken-nke1-906a07-worker-2   Ready    node                   51m   v1.24.10
</span></span></code></pre></td></tr></table></div></div></li><li><p>另一種就是把kubectl 放到預設指令執行的地方，可用echo $PATH去找</p><p>再輸入export KUBECONFIG=下載的kubeconfig 存放的路徑即可直接執行kubectl get nodes等指令</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>wangken</span><span class=err>@</span><span class=n>wangken</span><span class=o>-</span><span class=n>MAC</span> <span class=n>ken</span><span class=o>-</span><span class=n>nke1</span> <span class=o>%</span> <span class=n>echo</span> <span class=o>$</span><span class=n>PATH</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>Library</span><span class=o>/</span><span class=n>Frameworks</span><span class=o>/</span><span class=n>Python</span><span class=o>.</span><span class=n>framework</span><span class=o>/</span><span class=n>Versions</span><span class=o>/</span><span class=mf>3.11</span><span class=o>/</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=n>opt</span><span class=o>/</span><span class=n>homebrew</span><span class=o>/</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=n>opt</span><span class=o>/</span><span class=n>homebrew</span><span class=o>/</span><span class=n>sbin</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>local</span><span class=o>/</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=n>System</span><span class=o>/</span><span class=n>Cryptexes</span><span class=o>/</span><span class=n>App</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=p>:</span><span class=o>/</span><span class=n>sbin</span><span class=p>:</span><span class=o>/</span><span class=n>opt</span><span class=o>/</span><span class=n>X11</span><span class=o>/</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=n>Library</span><span class=o>/</span><span class=n>Apple</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>com</span><span class=o>.</span><span class=n>apple</span><span class=o>.</span><span class=n>security</span><span class=o>.</span><span class=n>cryptexd</span><span class=o>/</span><span class=n>codex</span><span class=o>.</span><span class=n>system</span><span class=o>/</span><span class=n>bootstrap</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>local</span><span class=o>/</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>com</span><span class=o>.</span><span class=n>apple</span><span class=o>.</span><span class=n>security</span><span class=o>.</span><span class=n>cryptexd</span><span class=o>/</span><span class=n>codex</span><span class=o>.</span><span class=n>system</span><span class=o>/</span><span class=n>bootstrap</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>com</span><span class=o>.</span><span class=n>apple</span><span class=o>.</span><span class=n>security</span><span class=o>.</span><span class=n>cryptexd</span><span class=o>/</span><span class=n>codex</span><span class=o>.</span><span class=n>system</span><span class=o>/</span><span class=n>bootstrap</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>appleinternal</span><span class=o>/</span><span class=n>bin</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>因為我不想把kubectl放到系統裡面(日後可能還要更新)，所以我直接做一個執行檔案來連線此NKE叢集</p><p>日後就透過nke-ctl這個執行檔來連線</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % cat nke-ctl 
</span></span><span class=line><span class=cl><span class=c1>#!/bin/bash</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>./kubectl --kubeconfig<span class=o>=</span>./ken-nke1-kubectl.cfg <span class=nv>$*</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=err>範例</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>wangken</span><span class=err>@</span><span class=n>wangken</span><span class=o>-</span><span class=n>MAC</span> <span class=n>ken</span><span class=o>-</span><span class=n>nke1</span> <span class=o>%</span> <span class=o>./</span><span class=n>nke</span><span class=o>-</span><span class=n>ctl</span> <span class=n>get</span> <span class=n>nodes</span>
</span></span><span class=line><span class=cl><span class=n>NAME</span>                       <span class=n>STATUS</span>   <span class=n>ROLES</span>                  <span class=n>AGE</span>   <span class=n>VERSION</span>
</span></span><span class=line><span class=cl><span class=n>ken</span><span class=o>-</span><span class=n>nke1</span><span class=o>-</span><span class=mi>906</span><span class=n>a07</span><span class=o>-</span><span class=n>master</span><span class=o>-</span><span class=mi>0</span>   <span class=n>Ready</span>    <span class=n>control</span><span class=o>-</span><span class=n>plane</span><span class=p>,</span><span class=n>master</span>   <span class=mi>79</span><span class=n>m</span>   <span class=n>v1</span><span class=o>.</span><span class=mf>24.10</span>
</span></span><span class=line><span class=cl><span class=n>ken</span><span class=o>-</span><span class=n>nke1</span><span class=o>-</span><span class=mi>906</span><span class=n>a07</span><span class=o>-</span><span class=n>master</span><span class=o>-</span><span class=mi>1</span>   <span class=n>Ready</span>    <span class=n>control</span><span class=o>-</span><span class=n>plane</span><span class=p>,</span><span class=n>master</span>   <span class=mi>78</span><span class=n>m</span>   <span class=n>v1</span><span class=o>.</span><span class=mf>24.10</span>
</span></span><span class=line><span class=cl><span class=n>ken</span><span class=o>-</span><span class=n>nke1</span><span class=o>-</span><span class=mi>906</span><span class=n>a07</span><span class=o>-</span><span class=n>worker</span><span class=o>-</span><span class=mi>0</span>   <span class=n>Ready</span>    <span class=n>node</span>                   <span class=mi>75</span><span class=n>m</span>   <span class=n>v1</span><span class=o>.</span><span class=mf>24.10</span>
</span></span><span class=line><span class=cl><span class=n>ken</span><span class=o>-</span><span class=n>nke1</span><span class=o>-</span><span class=mi>906</span><span class=n>a07</span><span class=o>-</span><span class=n>worker</span><span class=o>-</span><span class=mi>1</span>   <span class=n>Ready</span>    <span class=n>node</span>                   <span class=mi>75</span><span class=n>m</span>   <span class=n>v1</span><span class=o>.</span><span class=mf>24.10</span>
</span></span><span class=line><span class=cl><span class=n>ken</span><span class=o>-</span><span class=n>nke1</span><span class=o>-</span><span class=mi>906</span><span class=n>a07</span><span class=o>-</span><span class=n>worker</span><span class=o>-</span><span class=mi>2</span>   <span class=n>Ready</span>    <span class=n>node</span>                   <span class=mi>75</span><span class=n>m</span>   <span class=n>v1</span><span class=o>.</span><span class=mf>24.10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>wangken</span><span class=err>@</span><span class=n>wangken</span><span class=o>-</span><span class=n>MAC</span> <span class=n>ken</span><span class=o>-</span><span class=n>nke1</span> <span class=o>%</span> <span class=o>./</span><span class=n>nke</span><span class=o>-</span><span class=n>ctl</span> <span class=n>get</span> <span class=n>storageclass</span>   
</span></span><span class=line><span class=cl><span class=n>NAME</span>                             <span class=n>PROVISIONER</span>       <span class=n>RECLAIMPOLICY</span>   <span class=n>VOLUMEBINDINGMODE</span>   <span class=n>ALLOWVOLUMEEXPANSION</span>   <span class=n>AGE</span>
</span></span><span class=line><span class=cl><span class=n>default</span><span class=o>-</span><span class=n>storageclass</span> <span class=p>(</span><span class=n>default</span><span class=p>)</span>   <span class=n>csi</span><span class=o>.</span><span class=n>nutanix</span><span class=o>.</span><span class=n>com</span>   <span class=n>Delete</span>          <span class=n>Immediate</span>           <span class=bp>true</span>                   <span class=mi>74</span><span class=n>m</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>wangken</span><span class=err>@</span><span class=n>wangken</span><span class=o>-</span><span class=n>MAC</span> <span class=n>ken</span><span class=o>-</span><span class=n>nke1</span> <span class=o>%</span> <span class=o>./</span><span class=n>nke</span><span class=o>-</span><span class=n>ctl</span> <span class=n>get</span> <span class=n>ns</span>          
</span></span><span class=line><span class=cl><span class=n>NAME</span>              <span class=n>STATUS</span>   <span class=n>AGE</span>
</span></span><span class=line><span class=cl><span class=n>default</span>           <span class=n>Active</span>   <span class=mi>84</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>node</span><span class=o>-</span><span class=n>lease</span>   <span class=n>Active</span>   <span class=mi>84</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>public</span>       <span class=n>Active</span>   <span class=mi>84</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>       <span class=n>Active</span>   <span class=mi>84</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>Active</span>   <span class=mi>79</span><span class=n>m</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>wangken</span><span class=err>@</span><span class=n>wangken</span><span class=o>-</span><span class=n>MAC</span> <span class=n>ken</span><span class=o>-</span><span class=n>nke1</span> <span class=o>%</span> <span class=o>./</span><span class=n>nke</span><span class=o>-</span><span class=n>ctl</span> <span class=n>get</span> <span class=n>pod</span> <span class=o>-</span><span class=n>n</span> <span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>
</span></span><span class=line><span class=cl><span class=n>NAME</span>                                        <span class=n>READY</span>   <span class=n>STATUS</span>    <span class=n>RESTARTS</span>   <span class=n>AGE</span>
</span></span><span class=line><span class=cl><span class=n>alertmanager</span><span class=o>-</span><span class=n>main</span><span class=o>-</span><span class=mi>0</span>                         <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>76</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>alertmanager</span><span class=o>-</span><span class=n>main</span><span class=o>-</span><span class=mi>1</span>                         <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>76</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>alertmanager</span><span class=o>-</span><span class=n>main</span><span class=o>-</span><span class=mi>2</span>                         <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>76</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>csi</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>controller</span><span class=o>-</span><span class=mi>5</span><span class=n>fc6f8f5c4</span><span class=o>-</span><span class=mi>7</span><span class=n>bq96</span>    <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>79</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>csi</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>webhook</span><span class=o>-</span><span class=mi>78957</span><span class=n>b8ddd</span><span class=o>-</span><span class=mi>2</span><span class=n>c9n8</span>       <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>79</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>fluent</span><span class=o>-</span><span class=n>bit</span><span class=o>-</span><span class=mi>67</span><span class=n>vdl</span>                            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>79</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>fluent</span><span class=o>-</span><span class=n>bit</span><span class=o>-</span><span class=mi>6</span><span class=n>kxjz</span>                            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>79</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>fluent</span><span class=o>-</span><span class=n>bit</span><span class=o>-</span><span class=n>fgnrx</span>                            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>79</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>fluent</span><span class=o>-</span><span class=n>bit</span><span class=o>-</span><span class=n>gffxw</span>                            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>79</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>fluent</span><span class=o>-</span><span class=n>bit</span><span class=o>-</span><span class=n>rs5n8</span>                            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>79</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>state</span><span class=o>-</span><span class=n>metrics</span><span class=o>-</span><span class=mi>7</span><span class=n>bcb7f8cb6</span><span class=o>-</span><span class=n>tkjwf</span>         <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>76</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>kubernetes</span><span class=o>-</span><span class=n>events</span><span class=o>-</span><span class=n>printer</span><span class=o>-</span><span class=mi>8</span><span class=n>d4c49454</span><span class=o>-</span><span class=n>m9ss6</span>   <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>79</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>node</span><span class=o>-</span><span class=n>exporter</span><span class=o>-</span><span class=mi>9</span><span class=n>gtjl</span>                         <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>76</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>node</span><span class=o>-</span><span class=n>exporter</span><span class=o>-</span><span class=n>dl7k8</span>                         <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>76</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>node</span><span class=o>-</span><span class=n>exporter</span><span class=o>-</span><span class=n>g7jw7</span>                         <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>76</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>node</span><span class=o>-</span><span class=n>exporter</span><span class=o>-</span><span class=n>mv6xt</span>                         <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>76</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>node</span><span class=o>-</span><span class=n>exporter</span><span class=o>-</span><span class=n>nvk6w</span>                         <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>76</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>controller</span><span class=o>-</span><span class=mi>864</span><span class=n>cc4767b</span><span class=o>-</span><span class=n>gl2sx</span>     <span class=mi>5</span><span class=o>/</span><span class=mi>5</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>79</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>node</span><span class=o>-</span><span class=mi>8</span><span class=n>c2cc</span>                      <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>79</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>node</span><span class=o>-</span><span class=n>sf6wd</span>                      <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>79</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>node</span><span class=o>-</span><span class=n>shkkl</span>                      <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>79</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>prometheus</span><span class=o>-</span><span class=n>k8s</span><span class=o>-</span><span class=mi>0</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>76</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>prometheus</span><span class=o>-</span><span class=n>k8s</span><span class=o>-</span><span class=mi>1</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>76</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>prometheus</span><span class=o>-</span><span class=n>operator</span><span class=o>-</span><span class=mi>59</span><span class=n>d64b7bc7</span><span class=o>-</span><span class=n>t8slv</span>        <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>76</span><span class=n>m</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>coredns</span><span class=o>-</span><span class=mi>7</span><span class=n>b95cd4468</span><span class=o>-</span><span class=n>nv7jk</span>                       <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d1h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>coredns</span><span class=o>-</span><span class=mi>7</span><span class=n>b95cd4468</span><span class=o>-</span><span class=n>xxwgf</span>                       <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d1h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>apiserver</span><span class=o>-</span><span class=n>ken</span><span class=o>-</span><span class=n>nke1</span><span class=o>-</span><span class=mi>906</span><span class=n>a07</span><span class=o>-</span><span class=n>master</span><span class=o>-</span><span class=mi>0</span>        <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d1h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>apiserver</span><span class=o>-</span><span class=n>ken</span><span class=o>-</span><span class=n>nke1</span><span class=o>-</span><span class=mi>906</span><span class=n>a07</span><span class=o>-</span><span class=n>master</span><span class=o>-</span><span class=mi>1</span>        <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d1h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>flannel</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=mi>4</span><span class=n>r6j2</span>                          <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d1h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>flannel</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>dp5jv</span>                          <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d1h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>flannel</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>gqz5j</span>                          <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d1h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>flannel</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>slmqt</span>                          <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d1h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>flannel</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>z7hnh</span>                          <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d1h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>proxy</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=mi>6</span><span class=n>x8c2</span>                            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d1h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>proxy</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=mi>892</span><span class=n>ch</span>                            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d1h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>proxy</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>frrjt</span>                            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d1h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>proxy</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>nkfrm</span>                            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d1h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>proxy</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>pf9xm</span>                            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d1h</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=nutanix-files-串接>Nutanix Files 串接</h2><h3 id=files>Files</h3><ol><li><p>建立一個File Server，DNS設定 192.168.101.198 > ken-files.nutanixlab.local</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003165718907.png loading=lazy alt=image-20231003165718907></p></li><li><p>選擇一個Files VM就好</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003165749736.png loading=lazy alt=image-20231003165749736></p></li><li><p>設定Client Network</p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003165917669.png alt=image-20231003165917669 style=zoom:50%></li><li><p>設定gateway、IP等</p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003170011745.png alt=image-20231003170011745 style=zoom:50%></li><li><p>設定Storage Network</p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003170149444.png alt=image-20231003170149444 style=zoom:50%></li><li><p>選擇SMB、NFS Protocol，然後Create</p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003170257630.png alt=image-20231003170257630 style=zoom:50%></li><li><p>建立完成</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231005100336390.png loading=lazy alt=image-20231005100336390></p></li><li><p>建立一個NFS Share : ken-nke</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003163145985.png loading=lazy alt=image-20231003163145985></p></li><li><p>選擇Authentication: System、Root Squash (後續因redmine需要修改資料夾權限為777，故改為none)</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003163212281.png loading=lazy alt=image-20231003163212281></p></li><li><p>建立完後複製Mount Path、Share Path</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003180229922.png loading=lazy alt=image-20231003180229922></p></li></ol><h3 id=create-storage-class>Create Storage Class</h3><ol><li><p>點回Kubenetes Management &ndash;> Storage &ndash;> Storage Class</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003163529624.png loading=lazy alt=image-20231003163529624></p></li><li><p>輸入 Endpoint、Export Path，</p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003180314869.png alt=image-20231003180314869 style=zoom:50%></li><li><p>建立完成</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231003164104978.png loading=lazy alt=image-20231003164104978></p></li><li><p>確認Storageclass</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ./nke-ctl get storageclass       
</span></span><span class=line><span class=cl>NAME                             PROVISIONER       RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
</span></span><span class=line><span class=cl>default-storageclass (default)   csi.nutanix.com   Delete          Immediate           true                   154m
</span></span><span class=line><span class=cl>ntnx-files                       csi.nutanix.com   Delete          Immediate           false                  3m35s
</span></span></code></pre></td></tr></table></div></div></li><li><p>建立測試pvc</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % cat test.pvc.yaml 
</span></span><span class=line><span class=cl>kind: PersistentVolumeClaim
</span></span><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: test-pv-claim
</span></span><span class=line><span class=cl>  labels:
</span></span><span class=line><span class=cl>    app: test
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  storageClassName: ntnx-files
</span></span><span class=line><span class=cl>  accessModes:
</span></span><span class=line><span class=cl>    - ReadWriteOnce
</span></span><span class=line><span class=cl>  resources:
</span></span><span class=line><span class=cl>    requests:
</span></span><span class=line><span class=cl>      storage: 20Gi
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ./nke-ctl create -f test.pvc.yaml 
</span></span><span class=line><span class=cl>persistentvolumeclaim/test-pv-claim created
</span></span></code></pre></td></tr></table></div></div></li><li><p>確認為bond狀態代表OK</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ./nke-ctl get pvc
</span></span><span class=line><span class=cl>NAME            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
</span></span><span class=line><span class=cl>test-pv-claim   Bound    pvc-3f91422b-03d6-469e-940a-da87691be83a   20Gi       RWO            ntnx-files     7s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ./nke-ctl delete -f test.pvc.yaml 
</span></span><span class=line><span class=cl>persistentvolumeclaim &#34;test-pv-claim&#34; deleted
</span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=部署服務>部署服務</h2><p>之後有其他服務部署上去會再更新。</p><h3 id=部署redmine>部署redmine</h3><p>redmine是開源的專案管理軟體，部署時會需要使用PostgreSQL作為Database</p><p>部署在redmine的namespace，共會有以下幾個檔案</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ll
</span></span><span class=line><span class=cl>-rw-r--r--   <span class=m>1</span> wangken  staff       <span class=m>244</span> <span class=m>10</span>  <span class=m>3</span> 17:30 pg-config.yaml
</span></span><span class=line><span class=cl>-rw-r--r--   <span class=m>1</span> wangken  staff      <span class=m>1106</span> <span class=m>10</span>  <span class=m>3</span> 17:30 pg-deploy.yaml
</span></span><span class=line><span class=cl>-rw-r--r--   <span class=m>1</span> wangken  staff       <span class=m>255</span> <span class=m>10</span>  <span class=m>3</span> 17:30 pg-pvc.yaml
</span></span><span class=line><span class=cl>-rw-r--r--   <span class=m>1</span> wangken  staff       <span class=m>222</span> <span class=m>10</span>  <span class=m>3</span> 15:47 pg-svc.yaml
</span></span><span class=line><span class=cl>-rw-r--r--   <span class=m>1</span> wangken  staff      <span class=m>1070</span> <span class=m>10</span>  <span class=m>3</span> 16:24 redmine-config.yaml
</span></span><span class=line><span class=cl>-rw-r--r--   <span class=m>1</span> wangken  staff      <span class=m>2461</span> <span class=m>10</span>  <span class=m>3</span> 17:29 redmine-deploy.yaml
</span></span><span class=line><span class=cl>-rw-r--r--   <span class=m>1</span> wangken  staff       <span class=m>264</span> <span class=m>10</span>  <span class=m>5</span> 10:05 redmine-svc.yaml
</span></span><span class=line><span class=cl>-rw-r--r--   <span class=m>1</span> wangken  staff       <span class=m>218</span> <span class=m>10</span>  <span class=m>3</span> 16:40 test.pvc.yaml
</span></span></code></pre></td></tr></table></div></div><ol><li><p>建立Namespace</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ./nke-ctl create ns redmine
</span></span><span class=line><span class=cl>namespace/redmine created
</span></span></code></pre></td></tr></table></div></div></li><li><p>建立PostgreSQL</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ./nke-ctl create -f pg-pvc.yaml -n redmine
</span></span><span class=line><span class=cl>persistentvolumeclaim/redmine-postgres-pv-claim created
</span></span><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ./nke-ctl create -f pg-config.yaml -n redmine
</span></span><span class=line><span class=cl>configmap/redmine-postgres-config created
</span></span><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ./nke-ctl create -f pg-deploy.yaml -n redmine 
</span></span><span class=line><span class=cl>deployment.apps/redmine-postgres-deployment created
</span></span><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ./nke-ctl create -f pg-svc.yaml -n redmine 
</span></span><span class=line><span class=cl>service/redmine-postgres-service created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ./nke-ctl get all -n redmine
</span></span><span class=line><span class=cl>NAME                                               READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod/redmine-postgres-deployment-7bd9859c6d-8c4b5   1/1     Running   0          67s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                               TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE
</span></span><span class=line><span class=cl>service/redmine-postgres-service   NodePort   172.19.78.32   &lt;none&gt;        5432:31432/TCP   60s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                          READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment.apps/redmine-postgres-deployment   1/1     1            1           67s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                                     DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>replicaset.apps/redmine-postgres-deployment-7bd9859c6d   1         1         1       67s
</span></span></code></pre></td></tr></table></div></div></li><li><p>驗證PostgreSQL，可以下載 pgAdmin連線確認</p><p><a class=link href=https://www.pgadmin.org/download/pgadmin-4-macos/ target=_blank rel=noopener>https://www.pgadmin.org/download/pgadmin-4-macos/</a></p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231005102945359.png loading=lazy alt=image-20231005102945359></p></li><li><p>確認有redmine database存在</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231005103031353.png loading=lazy alt=image-20231005103031353></p></li><li><p>建立redmine服務，service選用cluster vip，Port 8000</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ./nke-ctl apply -f redmine-pvc.yaml -n redmine
</span></span><span class=line><span class=cl>persistentvolumeclaim/redmine-files created
</span></span><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ./nke-ctl apply -f redmine-config.yaml -n redmine
</span></span><span class=line><span class=cl>configmap/redmine-config created
</span></span><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ./nke-ctl apply -f redmine-deploy.yaml -n redmine 
</span></span><span class=line><span class=cl>deployment.apps/redmine created
</span></span><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ./nke-ctl apply -f redmine-svc.yaml -n redmine
</span></span><span class=line><span class=cl>service/redmine-service created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ./nke-ctl get pvc -n redmine
</span></span><span class=line><span class=cl>NAME                        STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS           AGE
</span></span><span class=line><span class=cl>redmine-files               Bound    pvc-fa7253bf-da76-4048-a622-e6b159a94124   1Gi        RWO            ntnx-files             12s
</span></span><span class=line><span class=cl>redmine-postgres-pv-claim   Bound    pvc-532dc4e2-876e-4ebf-b3c5-481226c0eb4f   20Gi       RWO            default-storageclass   24m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ./nke-ctl get all -n redmine                  
</span></span><span class=line><span class=cl>NAME                                               READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod/redmine-7fd78679f9-cwxg4                       1/1     Running   <span class=m>0</span>          6m31s
</span></span><span class=line><span class=cl>pod/redmine-postgres-deployment-7bd9859c6d-fv5pb   1/1     Running   <span class=m>0</span>          53m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                               TYPE        CLUSTER-IP       EXTERNAL-IP       PORT<span class=o>(</span>S<span class=o>)</span>          AGE
</span></span><span class=line><span class=cl>service/redmine-postgres-service   NodePort    172.19.193.158   &lt;none&gt;            5432:31432/TCP   53m
</span></span><span class=line><span class=cl>service/redmine-service            ClusterIP   172.19.139.23    192.168.101.199   8000/TCP         2s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                          READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment.apps/redmine                       1/1     <span class=m>1</span>            <span class=m>1</span>           6m31s
</span></span><span class=line><span class=cl>deployment.apps/redmine-postgres-deployment   1/1     <span class=m>1</span>            <span class=m>1</span>           53m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                                     DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>replicaset.apps/redmine-7fd78679f9                       <span class=m>1</span>         <span class=m>1</span>         <span class=m>1</span>       6m31s
</span></span><span class=line><span class=cl>replicaset.apps/redmine-postgres-deployment-7bd9859c6d   <span class=m>1</span>         <span class=m>1</span>         <span class=m>1</span>       53m
</span></span></code></pre></td></tr></table></div></div></li><li><p>確認config file可以存在ntnx-files這個storageclass</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231005153105877.png loading=lazy alt=image-20231005153105877></p></li><li><p>網頁連線redmine : http://192.168.101.199:8000 ，預設 admin/admin 再進去修改</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231005153419432.png loading=lazy alt=image-20231005153419432></p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231005153452116.png loading=lazy alt=image-20231005153452116></p></li><li><p>確認OK</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231005155001640.png loading=lazy alt=image-20231005155001640></p></li><li><p>後續就可以透由redmine去做專案管理，甚至是結合CI/CD</p></li></ol><h2 id=options--add-ons>Options & Add-Ons</h2><h3 id=infra-logging>Infra Logging</h3><p>說明：如果沒有Logging stack的話，可以啟用Infra logging (Elasticsearch and Kibana)來使用。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Note:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    You can deploy the ELK-based NKE logging stack to provide a simplified experience for users with environments that do not have the logging stack implementation. In environments where the logging implementation exists or where there are no explicit requirements for logging, disable the logging stack to reduce resource consumption.
</span></span><span class=line><span class=cl>    The minimum uplink speed recommended is 30 Mb/s.
</span></span></code></pre></td></tr></table></div></div><ol><li><p>從Prism Central VM 登入Karbon</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>nutanix@NTNX-172-16-90-75-A-PCVM:~$ karbon/karbonctl login --pc-username ken.wang@nutanixlab.local
</span></span><span class=line><span class=cl>Please enter the password for the PC user: ken.wang@nutanixlab.local
</span></span><span class=line><span class=cl>Login successful
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>nutanix@NTNX-172-16-90-75-A-PCVM:~$ karbon/karbonctl cluster list
</span></span><span class=line><span class=cl>Name        UUID                                    Control Plane IPs (VIP)                               Version      OS Version    Status      Worker IPs
</span></span><span class=line><span class=cl>ken-nke1    906a075d-e27b-47bd-59c3-b71701147650    192.168.101.213, 192.168.101.215 (192.168.101.199)    1.24.10-0    ntnx-1.5      kSuccess    192.168.101.208, 192.168.101.201, 192.168.101.207
</span></span></code></pre></td></tr></table></div></div></li><li><p>enable infra logging</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>nutanix@NTNX-172-16-90-75-A-PCVM:~$ karbon/karbonctl cluster infra-logging enable --cluster-name=ken-nke1
</span></span><span class=line><span class=cl>Successfully enabled infra logging: [POST /karbon/v1-alpha.1/k8s/clusters/{name}/enable-infra-logging][200] postEnableInfraLoggingO
</span></span></code></pre></td></tr></table></div></div></li><li><p>回到NKE Cluster確認 pod status</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>wangken</span><span class=err>@</span><span class=n>wangken</span><span class=o>-</span><span class=n>MAC</span> <span class=n>ken</span><span class=o>-</span><span class=n>nke1</span> <span class=o>%</span> <span class=o>./</span><span class=n>nke</span><span class=o>-</span><span class=n>ctl</span> <span class=n>get</span> <span class=n>pod</span> <span class=o>-</span><span class=n>A</span>
</span></span><span class=line><span class=cl><span class=n>NAMESPACE</span>     <span class=n>NAME</span>                                           <span class=n>READY</span>   <span class=n>STATUS</span>    <span class=n>RESTARTS</span>   <span class=n>AGE</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>coredns</span><span class=o>-</span><span class=mi>7</span><span class=n>b95cd4468</span><span class=o>-</span><span class=n>nv7jk</span>                       <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>coredns</span><span class=o>-</span><span class=mi>7</span><span class=n>b95cd4468</span><span class=o>-</span><span class=n>xxwgf</span>                       <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>apiserver</span><span class=o>-</span><span class=n>ken</span><span class=o>-</span><span class=n>nke1</span><span class=o>-</span><span class=mi>906</span><span class=n>a07</span><span class=o>-</span><span class=n>master</span><span class=o>-</span><span class=mi>0</span>        <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>apiserver</span><span class=o>-</span><span class=n>ken</span><span class=o>-</span><span class=n>nke1</span><span class=o>-</span><span class=mi>906</span><span class=n>a07</span><span class=o>-</span><span class=n>master</span><span class=o>-</span><span class=mi>1</span>        <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>flannel</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=mi>4</span><span class=n>r6j2</span>                          <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>flannel</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>dp5jv</span>                          <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>flannel</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>gqz5j</span>                          <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>flannel</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>slmqt</span>                          <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>flannel</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>z7hnh</span>                          <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>proxy</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=mi>6</span><span class=n>x8c2</span>                            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>proxy</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=mi>892</span><span class=n>ch</span>                            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>proxy</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>frrjt</span>                            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>proxy</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>nkfrm</span>                            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>proxy</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>pf9xm</span>                            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>alertmanager</span><span class=o>-</span><span class=n>main</span><span class=o>-</span><span class=mi>0</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>alertmanager</span><span class=o>-</span><span class=n>main</span><span class=o>-</span><span class=mi>1</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>alertmanager</span><span class=o>-</span><span class=n>main</span><span class=o>-</span><span class=mi>2</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>csi</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>controller</span><span class=o>-</span><span class=mi>5</span><span class=n>fc6f8f5c4</span><span class=o>-</span><span class=mi>7</span><span class=n>bq96</span>       <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>csi</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>webhook</span><span class=o>-</span><span class=mi>78957</span><span class=n>b8ddd</span><span class=o>-</span><span class=mi>2</span><span class=n>c9n8</span>          <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>elasticsearch</span><span class=o>-</span><span class=n>logging</span><span class=o>-</span><span class=mi>0</span>                        <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>m45s</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>fluent</span><span class=o>-</span><span class=n>bit</span><span class=o>-</span><span class=mi>6</span><span class=n>cjst</span>                               <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>m43s</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>fluent</span><span class=o>-</span><span class=n>bit</span><span class=o>-</span><span class=mi>74</span><span class=n>fw9</span>                               <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>m42s</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>fluent</span><span class=o>-</span><span class=n>bit</span><span class=o>-</span><span class=n>dn9qc</span>                               <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>m43s</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>fluent</span><span class=o>-</span><span class=n>bit</span><span class=o>-</span><span class=n>gwrsq</span>                               <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>m43s</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>fluent</span><span class=o>-</span><span class=n>bit</span><span class=o>-</span><span class=n>xdq2n</span>                               <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>m43s</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>kibana</span><span class=o>-</span><span class=n>logging</span><span class=o>-</span><span class=mi>6</span><span class=n>ccd475856</span><span class=o>-</span><span class=n>cb4dd</span>                <span class=mi>1</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>m45s</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>state</span><span class=o>-</span><span class=n>metrics</span><span class=o>-</span><span class=mi>7</span><span class=n>bcb7f8cb6</span><span class=o>-</span><span class=n>tkjwf</span>            <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>kubernetes</span><span class=o>-</span><span class=n>events</span><span class=o>-</span><span class=n>printer</span><span class=o>-</span><span class=mi>8</span><span class=n>d4c49454</span><span class=o>-</span><span class=n>m9ss6</span>      <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>node</span><span class=o>-</span><span class=n>exporter</span><span class=o>-</span><span class=mi>9</span><span class=n>gtjl</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>node</span><span class=o>-</span><span class=n>exporter</span><span class=o>-</span><span class=n>dl7k8</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>node</span><span class=o>-</span><span class=n>exporter</span><span class=o>-</span><span class=n>g7jw7</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>node</span><span class=o>-</span><span class=n>exporter</span><span class=o>-</span><span class=n>mv6xt</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>node</span><span class=o>-</span><span class=n>exporter</span><span class=o>-</span><span class=n>nvk6w</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>controller</span><span class=o>-</span><span class=mi>864</span><span class=n>cc4767b</span><span class=o>-</span><span class=n>gl2sx</span>        <span class=mi>5</span><span class=o>/</span><span class=mi>5</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>node</span><span class=o>-</span><span class=mi>8</span><span class=n>c2cc</span>                         <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>node</span><span class=o>-</span><span class=n>sf6wd</span>                         <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>node</span><span class=o>-</span><span class=n>shkkl</span>                         <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>prometheus</span><span class=o>-</span><span class=n>k8s</span><span class=o>-</span><span class=mi>0</span>                               <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>prometheus</span><span class=o>-</span><span class=n>k8s</span><span class=o>-</span><span class=mi>1</span>                               <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>prometheus</span><span class=o>-</span><span class=n>operator</span><span class=o>-</span><span class=mi>59</span><span class=n>d64b7bc7</span><span class=o>-</span><span class=n>t8slv</span>           <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>2</span><span class=n>d2h</span>
</span></span><span class=line><span class=cl><span class=n>redmine</span>       <span class=n>redmine</span><span class=o>-</span><span class=mi>7</span><span class=n>fd78679f9</span><span class=o>-</span><span class=n>cwxg4</span>                       <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>75</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>redmine</span>       <span class=n>redmine</span><span class=o>-</span><span class=n>postgres</span><span class=o>-</span><span class=n>deployment</span><span class=o>-</span><span class=mi>7</span><span class=n>bd9859c6d</span><span class=o>-</span><span class=n>fv5pb</span>   <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>123</span><span class=n>m</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>多了以下幾個pod出現</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ntnx-system   elasticsearch-logging-0                        1/1     Running   0          2m45s
</span></span><span class=line><span class=cl>ntnx-system   fluent-bit-6cjst                               1/1     Running   0          2m43s
</span></span><span class=line><span class=cl>ntnx-system   fluent-bit-74fw9                               1/1     Running   0          2m42s
</span></span><span class=line><span class=cl>ntnx-system   fluent-bit-dn9qc                               1/1     Running   0          2m43s
</span></span><span class=line><span class=cl>ntnx-system   fluent-bit-gwrsq                               1/1     Running   0          2m43s
</span></span><span class=line><span class=cl>ntnx-system   fluent-bit-xdq2n                               1/1     Running   0          2m43s
</span></span><span class=line><span class=cl>ntnx-system   kibana-logging-6ccd475856-cb4dd                1/2     Running   0          2m45s
</span></span></code></pre></td></tr></table></div></div></li><li><p>從Prism 介面上去看多了Logging的選項</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231005164515179.png loading=lazy alt=image-20231005164515179></p></li><li><p>點進去Logging介面，預設使用worker node的30950 port，點選Explore on my own</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231005164742058.png loading=lazy alt=image-20231005164742058></p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231005170115884.png loading=lazy alt=image-20231005170115884></p></li><li><p>點選左邊的選單&ndash;> Analytics &ndash;> Discover</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231005170207799.png loading=lazy alt=image-20231005170207799></p></li><li><p>建立新的index pattern，名稱輸入*</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231005170304609.png loading=lazy alt=image-20231005170304609></p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231005170428292.png loading=lazy alt=image-20231005170428292></p></li><li><p>點回Discover確認有抓到資訊</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231005170840491.png loading=lazy alt=image-20231005170840491></p></li></ol><h2 id=擴充節點>擴充節點</h2><p>兩個方式，第一個是新增Node Pool，第二種是在現有的Node Pool 調整 Node的數量</p><h3 id=add-node-pool>Add Node Pool</h3><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231005172622386.png loading=lazy alt=image-20231005172622386></p><p>原本的Node數量</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ./nke-ctl get nodes                             
</span></span><span class=line><span class=cl>NAME                       STATUS   ROLES                  AGE    VERSION
</span></span><span class=line><span class=cl>ken-nke1-906a07-master-0   Ready    control-plane,master   2d3h   v1.24.10
</span></span><span class=line><span class=cl>ken-nke1-906a07-master-1   Ready    control-plane,master   2d3h   v1.24.10
</span></span><span class=line><span class=cl>ken-nke1-906a07-worker-0   Ready    node                   2d3h   v1.24.10
</span></span><span class=line><span class=cl>ken-nke1-906a07-worker-1   Ready    node                   2d3h   v1.24.10
</span></span><span class=line><span class=cl>ken-nke1-906a07-worker-2   Ready    node                   2d3h   v1.24.10
</span></span></code></pre></td></tr></table></div></div><p>新增後約3~5分鐘就完成建立，並帶有dev的前綴詞</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ./nke-ctl get nodes
</span></span><span class=line><span class=cl>NAME                           STATUS   ROLES                  AGE    VERSION
</span></span><span class=line><span class=cl>ken-nke1-906a07-dev-worker-0   Ready    node                   54s    v1.24.10
</span></span><span class=line><span class=cl>ken-nke1-906a07-master-0       Ready    control-plane,master   2d3h   v1.24.10
</span></span><span class=line><span class=cl>ken-nke1-906a07-master-1       Ready    control-plane,master   2d3h   v1.24.10
</span></span><span class=line><span class=cl>ken-nke1-906a07-worker-0       Ready    node                   2d3h   v1.24.10
</span></span><span class=line><span class=cl>ken-nke1-906a07-worker-1       Ready    node                   2d3h   v1.24.10
</span></span><span class=line><span class=cl>ken-nke1-906a07-worker-2       Ready    node                   2d3h   v1.24.10
</span></span></code></pre></td></tr></table></div></div><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231005173405029.png loading=lazy alt=image-20231005173405029></p><p>要刪除Node Pool 要先刪除那個Node</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231005173856946.png loading=lazy alt=image-20231005173856946></p><p>約3~5分鐘後就刪除完成，再刪除Node Pool</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231005174024769.png loading=lazy alt=image-20231005174024769></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ./nke-ctl get nodes                                                     
</span></span><span class=line><span class=cl>NAME                       STATUS   ROLES                  AGE    VERSION
</span></span><span class=line><span class=cl>ken-nke1-906a07-master-0   Ready    control-plane,master   2d3h   v1.24.10
</span></span><span class=line><span class=cl>ken-nke1-906a07-master-1   Ready    control-plane,master   2d3h   v1.24.10
</span></span><span class=line><span class=cl>ken-nke1-906a07-worker-0   Ready    node                   2d3h   v1.24.10
</span></span><span class=line><span class=cl>ken-nke1-906a07-worker-1   Ready    node                   2d3h   v1.24.10
</span></span><span class=line><span class=cl>ken-nke1-906a07-worker-2   Ready    node                   2d3h   v1.24.10
</span></span></code></pre></td></tr></table></div></div><h3 id=resize-node-pool>Resize Node Pool</h3><p>點選Node Pool &ndash;> Actions &ndash;> Resize ，從 3 調整到4</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231005174203052.png loading=lazy alt=image-20231005174203052></p><p>約3~5分鐘就出現新的worker node 3</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wangken@wangken-MAC ken-nke1 % ./nke-ctl get nodes
</span></span><span class=line><span class=cl>NAME                       STATUS   ROLES                  AGE    VERSION
</span></span><span class=line><span class=cl>ken-nke1-906a07-master-0   Ready    control-plane,master   2d3h   v1.24.10
</span></span><span class=line><span class=cl>ken-nke1-906a07-master-1   Ready    control-plane,master   2d3h   v1.24.10
</span></span><span class=line><span class=cl>ken-nke1-906a07-worker-0   Ready    node                   2d3h   v1.24.10
</span></span><span class=line><span class=cl>ken-nke1-906a07-worker-1   Ready    node                   2d3h   v1.24.10
</span></span><span class=line><span class=cl>ken-nke1-906a07-worker-2   Ready    node                   2d3h   v1.24.10
</span></span><span class=line><span class=cl>ken-nke1-906a07-worker-3   Ready    node                   54s    v1.24.10
</span></span></code></pre></td></tr></table></div></div><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231005174557923.png loading=lazy alt=image-20231005174557923></p><p>除了用Delete的方式移除worker-3之外，也可以用resize調整worker node數量</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231005174749203.png loading=lazy alt=image-20231005174749203></p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231005174815545.png loading=lazy alt=image-20231005174815545></p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231005175011853.png loading=lazy alt=image-20231005175011853></p><p>驗證OK</p><h2 id=升級kubernetes>升級Kubernetes</h2><p>理論上順序應為 LCM 升級NKE版本 &ndash;> OS image 升級 &ndash;> Kubernetes version 升級</p><p>這裡NKE、OS image已經為最新版本，故只做Kubernetes version升級</p><h3 id=步驟>步驟</h3><p>點進NKE Cluster &ndash;> More &ndash;> Upgrade Kubernetes</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011093836949.png loading=lazy alt=image-20231011093836949></p><p>點選要升級的版本 1.25.6-0 &ndash;> Upgrade</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011093920386.png loading=lazy alt=image-20231011093920386></p><p>開始跑 Health ckeck</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011094057124.png loading=lazy alt=image-20231011094057124></p><p>現行版本</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011094304560.png loading=lazy alt=image-20231011094304560></p><p>會先進行master的升級，再來執行worker node滾動升級</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011094357148.png loading=lazy alt=image-20231011094357148></p><p>我的服務replica 只有設定1，所以服務會暫時中斷</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011094815399.png loading=lazy alt=image-20231011094815399></p><p>Cluster內也會有服務重啟，Kubenetes 已升級完成，因為只做Kubernetes升級所以Kernel 跟Container-runtime都不會升級</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011095351235.png loading=lazy alt=image-20231011095351235></p><p>約30分鐘內即升級完畢</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011100949610.png loading=lazy alt=image-20231011100949610></p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011101014871.png loading=lazy alt=image-20231011101014871></p><p>因redmine服務需要先啟動DB再啟動redmine，所以將redmine的pod刪除，服務才會正常</p><p>這個可以去設定啟動順序，但因測試使用，故沒特別設定</p><p>確認服務正常</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011101550166.png loading=lazy alt=image-20231011101550166></p><h2 id=advanced-kubernetes-tp>Advanced Kubernetes (TP)</h2><p>進階的Kubernetes是Nutanix目前正在開發中的功能，啟用方式是會有一個管理用的NKE Cluster，然後去部署Agent到被管理的叢集</p><p>運作模式有點像是Rancher的管理方式，都需要一個Management的Cluster，這樣好處是Management掛了不會去影響現有服務。</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011103506802.png loading=lazy alt=image-20231011103506802></p><h3 id=新增management-cluster>新增Management Cluster</h3><ol><li><p>官方建議是要至少兩個worker node，先用一個來測試功能</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011110314489.png loading=lazy alt=image-20231011110314489></p></li><li><p>給予名稱、版本</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011110355671.png loading=lazy alt=image-20231011110355671></p></li><li><p>選擇網段、worker node數量</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011110436588.png loading=lazy alt=image-20231011110436588></p></li><li><p>選擇 Network Provider</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011110520814.png loading=lazy alt=image-20231011110520814></p></li><li><p>選擇Storage class，之後點選Create</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011110617541.png loading=lazy alt=image-20231011110617541></p></li><li><p>建立中</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011111332153.png loading=lazy alt=image-20231011111332153></p></li><li><p>NKE Cluster 建立完成</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011113040549.png loading=lazy alt=image-20231011113040549></p></li><li><p>ssh 進入PCVM ， 針對ken-mgmt cluster啟用Advance Management</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>nutanix@NTNX-172-16-90-75-A-PCVM:~$ /home/nutanix/karbon/karbonctl login --pc-username ken.wang@nutanixlab.local
</span></span><span class=line><span class=cl>Please enter the password for the PC user: ken.wang@nutanixlab.local
</span></span><span class=line><span class=cl>Login successful
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>nutanix@NTNX-172-16-90-75-A-PCVM:~$ /home/nutanix/karbon/karbonctl karbon-management enable --cluster-name ken-mgmt
</span></span><span class=line><span class=cl>2023-10-11T03:32:34.711Z client_wrapper.go:300: [INFO] Successfully created new resource: &amp;{karbon-mgmt false 0xc0005340e0 0xc0008925e0 /v1, Kind=Namespace karbon-mgmt}
</span></span><span class=line><span class=cl>2023-10-11T03:32:34.784Z client_wrapper.go:317: [INFO] Successfully patched existing resource. NS: karbon-mgmt, Name: servicemonitors.monitoring.coreos.com
</span></span><span class=line><span class=cl>2023-10-11T03:32:34.805Z client_wrapper.go:300: [INFO] Successfully created new resource: &amp;{karbon-mgmt true 0xc000e66ee0 0xc00103e1f0 networking.k8s.io/v1, Kind=NetworkPolicy traefik}
</span></span><span class=line><span class=cl>2023-10-11T03:32:34.832Z client_wrapper.go:300: [INFO] Successfully created new resource: &amp;{karbon-mgmt true 0xc0001f7490 0xc000c5a300 /v1, Kind=ConfigMap traefik-dynamic-configmap}
</span></span><span class=line><span class=cl>2023-10-11T03:32:34.881Z client_wrapper.go:300: [INFO] Successfully created new resource: &amp;{karbon-mgmt false 0xc00062b3b0 0xc000c5a428 apiextensions.k8s.io/v1, Kind=CustomResourceDefinition ingressroutes.traefik.containo.us}
</span></span><span class=line><span class=cl>2023-10-11T03:32:34.92Z client_wrapper.go:300: [INFO] Successfully created new resource: &amp;{karbon-mgmt false 0xc0001dc7e0 0xc000c5a4b8 apiextensions.k8s.io/v1, Kind=CustomResourceDefinition ingressroutetcps.traefik.containo.us}
</span></span><span class=line><span class=cl>2023-10-11T03:32:34.999Z client_wrapper.go:300: [INFO] Successfully created
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>Waiting on 172.16.90.75 (Up, ZeusLeader) to start:  KarbonUI KarbonCore
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Waiting on 172.16.90.75 (Up, ZeusLeader) to start:  KarbonUI KarbonCore
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Waiting on 172.16.90.75 (Up, ZeusLeader) to start: 
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>2b7839f469 karbon-ui:v2.8.0 Up 38 seconds (healthy)
</span></span><span class=line><span class=cl>2ef4e4d10f karbon-core:v2.8.0 Up 35 seconds (healthy)
</span></span><span class=line><span class=cl>2b7839f469 karbon-ui:v2.8.0 Up 43 seconds (healthy)
</span></span><span class=line><span class=cl>Successfully enabled karbon management!
</span></span></code></pre></td></tr></table></div></div></li><li><p>Deploy Agent 在ken-nke1 Cluster</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>nutanix</span><span class=err>@</span><span class=n>NTNX</span><span class=o>-</span><span class=mi>172</span><span class=o>-</span><span class=mi>16</span><span class=o>-</span><span class=mi>90</span><span class=o>-</span><span class=mi>75</span><span class=o>-</span><span class=n>A</span><span class=o>-</span><span class=n>PCVM</span><span class=p>:</span><span class=o>~$</span> <span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>nutanix</span><span class=o>/</span><span class=n>karbon</span><span class=o>/</span><span class=n>karbonctl</span> <span class=n>karbon</span><span class=o>-</span><span class=n>agent</span> <span class=n>enable</span> <span class=o>--</span><span class=n>cluster</span><span class=o>-</span><span class=n>name</span> <span class=n>ken</span><span class=o>-</span><span class=n>nke1</span> <span class=o>--</span><span class=n>mgmt</span><span class=o>-</span><span class=n>name</span> <span class=n>ken</span><span class=o>-</span><span class=n>mgmt</span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>11</span><span class=n>T03</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=mf>30.244</span><span class=n>Z</span> <span class=n>k8s_versioning</span><span class=o>.</span><span class=n>go</span><span class=p>:</span><span class=mi>181</span><span class=p>:</span> <span class=p>[</span><span class=n>ERROR</span><span class=p>]</span> <span class=n>Failed</span> <span class=n>to</span> <span class=n>get</span> <span class=n>Namespace</span> <span class=k>for</span> <span class=n>verification</span> <span class=p>:</span> <span class=n>namespaces</span> <span class=s2>&#34;karbon-agent&#34;</span> <span class=ow>not</span> <span class=n>found</span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>11</span><span class=n>T03</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=mf>30.28</span><span class=n>Z</span> <span class=n>client_wrapper</span><span class=o>.</span><span class=n>go</span><span class=p>:</span><span class=mi>300</span><span class=p>:</span> <span class=p>[</span><span class=n>INFO</span><span class=p>]</span> <span class=n>Successfully</span> <span class=n>created</span> <span class=n>new</span> <span class=n>resource</span><span class=p>:</span> <span class=o>&amp;</span><span class=p>{</span> <span class=bp>false</span> <span class=mh>0xc001142850</span> <span class=mh>0xc001136038</span> <span class=o>/</span><span class=n>v1</span><span class=p>,</span> <span class=n>Kind</span><span class=o>=</span><span class=n>Namespace</span> <span class=n>karbon</span><span class=o>-</span><span class=n>agent</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>11</span><span class=n>T03</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=mf>30.302</span><span class=n>Z</span> <span class=n>karbon_mgmt_sentry</span><span class=o>.</span><span class=n>go</span><span class=p>:</span><span class=mi>169</span><span class=p>:</span> <span class=p>[</span><span class=n>INFO</span><span class=p>]</span> <span class=n>The</span> <span class=n>Karbon</span><span class=o>-</span><span class=n>Mgmt</span> <span class=n>pod</span> <span class=n>is</span> <span class=n>ready</span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>11</span><span class=n>T03</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=mf>30.303</span><span class=n>Z</span> <span class=n>karbon_mgmt_sentry</span><span class=o>.</span><span class=n>go</span><span class=p>:</span><span class=mi>173</span><span class=p>:</span> <span class=p>[</span><span class=n>ERROR</span><span class=p>]</span> <span class=n>Empty</span> <span class=n>payload</span> <span class=k>return</span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>11</span><span class=n>T03</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=mf>30.325</span><span class=n>Z</span> <span class=n>karbon_mgmt_sentry</span><span class=o>.</span><span class=n>go</span><span class=p>:</span><span class=mi>169</span><span class=p>:</span> <span class=p>[</span><span class=n>INFO</span><span class=p>]</span> <span class=n>The</span> <span class=n>Karbon</span><span class=o>-</span><span class=n>Mgmt</span> <span class=n>pod</span> <span class=n>is</span> <span class=n>ready</span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>11</span><span class=n>T03</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=mi>31</span><span class=n>Z</span> <span class=n>karbon_mgmt_sentry</span><span class=o>.</span><span class=n>go</span><span class=p>:</span><span class=mi>169</span><span class=p>:</span> <span class=p>[</span><span class=n>INFO</span><span class=p>]</span> <span class=n>The</span> <span class=n>Karbon</span><span class=o>-</span><span class=n>Mgmt</span> <span class=n>pod</span> <span class=n>is</span> <span class=n>ready</span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>11</span><span class=n>T03</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=mf>33.758</span><span class=n>Z</span> <span class=n>agent_installer</span><span class=o>.</span><span class=n>go</span><span class=p>:</span><span class=mi>187</span><span class=p>:</span> <span class=p>[</span><span class=n>INFO</span><span class=p>]</span> <span class=n>Edgemgmt</span> <span class=n>image</span> <span class=n>passed</span> <span class=n>is</span><span class=p>:</span> <span class=n>sherlock</span><span class=o>-</span><span class=n>edgemgmt</span><span class=p>:</span><span class=mi>3274</span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>11</span><span class=n>T03</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=mf>33.758</span><span class=n>Z</span> <span class=n>agent_installer</span><span class=o>.</span><span class=n>go</span><span class=p>:</span><span class=mi>194</span><span class=p>:</span> <span class=p>[</span><span class=n>INFO</span><span class=p>]</span> <span class=n>Controller</span> <span class=n>image</span> <span class=n>passed</span> <span class=n>is</span><span class=p>:</span> <span class=n>datastream</span><span class=o>-</span><span class=n>controller</span><span class=p>:</span><span class=mi>2490</span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>10</span> <span class=mi>20</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=mf>33.947060</span> <span class=n>I</span> <span class=o>|</span> <span class=n>creating</span> <span class=mi>3</span> <span class=n>resource</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>10</span> <span class=mi>20</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=mf>33.971481</span> <span class=n>I</span> <span class=o>|</span> <span class=n>Clearing</span> <span class=n>discovery</span> <span class=n>cache</span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>10</span> <span class=mi>20</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=mf>33.971530</span> <span class=n>I</span> <span class=o>|</span> <span class=n>beginning</span> <span class=n>wait</span> <span class=k>for</span> <span class=mi>3</span> <span class=n>resources</span> <span class=n>with</span> <span class=n>timeout</span> <span class=n>of</span> <span class=mi>1</span><span class=n>m0s</span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>10</span> <span class=mi>20</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=mf>37.401949</span> <span class=n>I</span> <span class=o>|</span> <span class=n>creating</span> <span class=mi>29</span> <span class=n>resource</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>10</span> <span class=mi>20</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=mf>37.635612</span> <span class=n>I</span> <span class=o>|</span> <span class=n>beginning</span> <span class=n>wait</span> <span class=k>for</span> <span class=mi>29</span> <span class=n>resources</span> <span class=n>with</span> <span class=n>timeout</span> <span class=n>of</span> <span class=mi>15</span><span class=n>m0s</span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>10</span> <span class=mi>20</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=mf>37.803750</span> <span class=n>I</span> <span class=o>|</span> <span class=n>Deployment</span> <span class=n>is</span> <span class=ow>not</span> <span class=n>ready</span><span class=p>:</span> <span class=n>karbon</span><span class=o>-</span><span class=n>agent</span><span class=o>/</span><span class=n>controller</span><span class=o>-</span><span class=n>deployment</span><span class=o>.</span> <span class=mi>0</span> <span class=n>out</span> <span class=n>of</span> <span class=mi>1</span> <span class=n>expected</span> <span class=n>pods</span> <span class=n>are</span> <span class=n>ready</span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>10</span> <span class=mi>20</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=mf>39.845704</span> <span class=n>I</span> <span class=o>|</span> <span class=n>Deployment</span> <span class=n>is</span> <span class=ow>not</span> <span class=n>ready</span><span class=p>:</span> <span class=n>karbon</span><span class=o>-</span><span class=n>agent</span><span class=o>/</span><span class=n>controller</span><span class=o>-</span><span class=n>deployment</span><span class=o>.</span> <span class=mi>0</span> <span class=n>out</span> <span class=n>of</span> <span class=mi>1</span> <span class=n>expected</span> <span class=n>pods</span> <span class=n>are</span> <span class=n>ready</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>10</span> <span class=mi>20</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=mf>53.847939</span> <span class=n>I</span> <span class=o>|</span> <span class=n>Deployment</span> <span class=n>is</span> <span class=ow>not</span> <span class=n>ready</span><span class=p>:</span> <span class=n>karbon</span><span class=o>-</span><span class=n>agent</span><span class=o>/</span><span class=n>controller</span><span class=o>-</span><span class=n>deployment</span><span class=o>.</span> <span class=mi>0</span> <span class=n>out</span> <span class=n>of</span> <span class=mi>1</span> <span class=n>expected</span> <span class=n>pods</span> <span class=n>are</span> <span class=n>ready</span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>10</span> <span class=mi>20</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=mf>55.865197</span> <span class=n>I</span> <span class=o>|</span> <span class=n>Deployment</span> <span class=n>is</span> <span class=ow>not</span> <span class=n>ready</span><span class=p>:</span> <span class=n>karbon</span><span class=o>-</span><span class=n>agent</span><span class=o>/</span><span class=n>edgemgmt</span><span class=o>.</span> <span class=mi>0</span> <span class=n>out</span> <span class=n>of</span> <span class=mi>1</span> <span class=n>expected</span> <span class=n>pods</span> <span class=n>are</span> <span class=n>ready</span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>10</span> <span class=mi>20</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=mf>57.851395</span> <span class=n>I</span> <span class=o>|</span> <span class=n>Deployment</span> <span class=n>is</span> <span class=ow>not</span> <span class=n>ready</span><span class=p>:</span> <span class=n>karbon</span><span class=o>-</span><span class=n>agent</span><span class=o>/</span><span class=n>edgemgmt</span><span class=o>.</span> <span class=mi>0</span> <span class=n>out</span> <span class=n>of</span> <span class=mi>1</span> <span class=n>expected</span> <span class=n>pods</span> <span class=n>are</span> <span class=n>ready</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>10</span> <span class=mi>20</span><span class=p>:</span><span class=mi>39</span><span class=p>:</span><span class=mf>25.875878</span> <span class=n>I</span> <span class=o>|</span> <span class=n>release</span> <span class=n>installed</span> <span class=n>successfully</span><span class=p>:</span> <span class=n>karbon</span><span class=o>-</span><span class=n>agent</span><span class=o>/</span><span class=n>servicedomain</span><span class=o>-</span><span class=mf>2.5</span><span class=o>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>11</span><span class=n>T03</span><span class=p>:</span><span class=mi>39</span><span class=p>:</span><span class=mf>25.875</span><span class=n>Z</span> <span class=n>helm_agent_installer</span><span class=o>.</span><span class=n>go</span><span class=p>:</span><span class=mi>66</span><span class=p>:</span> <span class=p>[</span><span class=n>INFO</span><span class=p>]</span> <span class=n>Deployed</span> <span class=n>Agent</span> <span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>nutanix</span><span class=o>/</span><span class=n>karbon</span><span class=o>/</span><span class=n>sherlock_edge_deployer_pc</span><span class=o>.</span><span class=n>tgz</span> <span class=n>using</span> <span class=n>helm</span> <span class=n>chart</span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>11</span><span class=n>T03</span><span class=p>:</span><span class=mi>39</span><span class=p>:</span><span class=mf>25.875</span><span class=n>Z</span> <span class=n>karbonagent_enable</span><span class=o>.</span><span class=n>go</span><span class=p>:</span><span class=mi>182</span><span class=p>:</span> <span class=p>[</span><span class=n>INFO</span><span class=p>]</span> <span class=n>Successfully</span> <span class=n>deployed</span> <span class=n>karbon</span> <span class=n>agent</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>Successfully</span> <span class=n>Enabled</span> <span class=n>the</span> <span class=n>Karbon</span> <span class=n>Agent</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>原本的 pod</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>wangken</span><span class=err>@</span><span class=n>wangken</span><span class=o>-</span><span class=n>MAC</span> <span class=n>ken</span><span class=o>-</span><span class=n>nke1</span> <span class=o>%</span> <span class=o>./</span><span class=n>nke</span><span class=o>-</span><span class=n>ctl</span> <span class=n>get</span> <span class=n>po</span> <span class=o>-</span><span class=n>A</span>        
</span></span><span class=line><span class=cl><span class=n>NAMESPACE</span>     <span class=n>NAME</span>                                           <span class=n>READY</span>   <span class=n>STATUS</span>    <span class=n>RESTARTS</span>       <span class=n>AGE</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>coredns</span><span class=o>-</span><span class=mi>7</span><span class=n>b95cd4468</span><span class=o>-</span><span class=mi>5</span><span class=n>zqhg</span>                       <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>42</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>coredns</span><span class=o>-</span><span class=mi>7</span><span class=n>b95cd4468</span><span class=o>-</span><span class=n>qhszt</span>                       <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>109</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>apiserver</span><span class=o>-</span><span class=n>ken</span><span class=o>-</span><span class=n>nke1</span><span class=o>-</span><span class=mi>906</span><span class=n>a07</span><span class=o>-</span><span class=n>master</span><span class=o>-</span><span class=mi>0</span>        <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>2</span> <span class=p>(</span><span class=mi>113</span><span class=n>m</span> <span class=n>ago</span><span class=p>)</span>   <span class=mi>113</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>apiserver</span><span class=o>-</span><span class=n>ken</span><span class=o>-</span><span class=n>nke1</span><span class=o>-</span><span class=mi>906</span><span class=n>a07</span><span class=o>-</span><span class=n>master</span><span class=o>-</span><span class=mi>1</span>        <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>1</span> <span class=p>(</span><span class=mi>113</span><span class=n>m</span> <span class=n>ago</span><span class=p>)</span>   <span class=mi>113</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>flannel</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>dp5jv</span>                          <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>7</span><span class=n>d21h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>flannel</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>gqz5j</span>                          <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>7</span><span class=n>d21h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>flannel</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>slmqt</span>                          <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>7</span><span class=n>d21h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>flannel</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>z7hnh</span>                          <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>7</span><span class=n>d21h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>proxy</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=mi>75</span><span class=n>tnd</span>                            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>104</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>proxy</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>lqmzt</span>                            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>104</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>proxy</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>qwzcd</span>                            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>104</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>proxy</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>rcqfv</span>                            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>105</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>alertmanager</span><span class=o>-</span><span class=n>main</span><span class=o>-</span><span class=mi>0</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>42</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>alertmanager</span><span class=o>-</span><span class=n>main</span><span class=o>-</span><span class=mi>1</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>1</span> <span class=p>(</span><span class=mi>103</span><span class=n>m</span> <span class=n>ago</span><span class=p>)</span>   <span class=mi>103</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>alertmanager</span><span class=o>-</span><span class=n>main</span><span class=o>-</span><span class=mi>2</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>1</span> <span class=p>(</span><span class=mi>103</span><span class=n>m</span> <span class=n>ago</span><span class=p>)</span>   <span class=mi>103</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>blackbox</span><span class=o>-</span><span class=n>exporter</span><span class=o>-</span><span class=mi>7</span><span class=n>d494dffb6</span><span class=o>-</span><span class=mi>5</span><span class=n>w2zm</span>             <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>42</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>csi</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>controller</span><span class=o>-</span><span class=mi>5</span><span class=n>fc6f8f5c4</span><span class=o>-</span><span class=n>hvcsj</span>       <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>109</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>csi</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>webhook</span><span class=o>-</span><span class=mi>78957</span><span class=n>b8ddd</span><span class=o>-</span><span class=n>pwggj</span>          <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>109</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>elasticsearch</span><span class=o>-</span><span class=n>logging</span><span class=o>-</span><span class=mi>0</span>                        <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>104</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>fluent</span><span class=o>-</span><span class=n>bit</span><span class=o>-</span><span class=mi>6</span><span class=n>cjst</span>                               <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>5</span><span class=n>d18h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>fluent</span><span class=o>-</span><span class=n>bit</span><span class=o>-</span><span class=mi>74</span><span class=n>fw9</span>                               <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>5</span><span class=n>d18h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>fluent</span><span class=o>-</span><span class=n>bit</span><span class=o>-</span><span class=n>dn9qc</span>                               <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>5</span><span class=n>d18h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>fluent</span><span class=o>-</span><span class=n>bit</span><span class=o>-</span><span class=n>gwrsq</span>                               <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>5</span><span class=n>d18h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>kibana</span><span class=o>-</span><span class=n>logging</span><span class=o>-</span><span class=mi>6</span><span class=n>ccd475856</span><span class=o>-</span><span class=n>xgmjz</span>                <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>1</span> <span class=p>(</span><span class=mi>104</span><span class=n>m</span> <span class=n>ago</span><span class=p>)</span>   <span class=mi>109</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>kube</span><span class=o>-</span><span class=n>state</span><span class=o>-</span><span class=n>metrics</span><span class=o>-</span><span class=mi>758</span><span class=n>b544d66</span><span class=o>-</span><span class=n>ns667</span>            <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>42</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>kubernetes</span><span class=o>-</span><span class=n>events</span><span class=o>-</span><span class=n>printer</span><span class=o>-</span><span class=mi>8</span><span class=n>d4c49454</span><span class=o>-</span><span class=n>kjtkm</span>      <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>42</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>node</span><span class=o>-</span><span class=n>exporter</span><span class=o>-</span><span class=mi>9698</span><span class=n>d</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>102</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>node</span><span class=o>-</span><span class=n>exporter</span><span class=o>-</span><span class=n>hhqzn</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>103</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>node</span><span class=o>-</span><span class=n>exporter</span><span class=o>-</span><span class=n>wkg4z</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>104</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>node</span><span class=o>-</span><span class=n>exporter</span><span class=o>-</span><span class=n>z5d8f</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>102</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>controller</span><span class=o>-</span><span class=mi>864</span><span class=n>cc4767b</span><span class=o>-</span><span class=n>mhftm</span>        <span class=mi>5</span><span class=o>/</span><span class=mi>5</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>109</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>node</span><span class=o>-</span><span class=mi>8</span><span class=n>c2cc</span>                         <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>7</span><span class=n>d21h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>node</span><span class=o>-</span><span class=n>sf6wd</span>                         <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>7</span><span class=n>d21h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>prometheus</span><span class=o>-</span><span class=n>adapter</span><span class=o>-</span><span class=mi>56755</span><span class=n>b575c</span><span class=o>-</span><span class=n>clhp2</span>            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>104</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>prometheus</span><span class=o>-</span><span class=n>adapter</span><span class=o>-</span><span class=mi>56755</span><span class=n>b575c</span><span class=o>-</span><span class=n>fb979</span>            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>42</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>prometheus</span><span class=o>-</span><span class=n>k8s</span><span class=o>-</span><span class=mi>0</span>                               <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>42</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>prometheus</span><span class=o>-</span><span class=n>k8s</span><span class=o>-</span><span class=mi>1</span>                               <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>103</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>   <span class=n>prometheus</span><span class=o>-</span><span class=n>operator</span><span class=o>-</span><span class=mi>655</span><span class=n>cf4b548</span><span class=o>-</span><span class=n>tr7kv</span>           <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>42</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>redmine</span>       <span class=n>redmine</span><span class=o>-</span><span class=mi>7</span><span class=n>fd78679f9</span><span class=o>-</span><span class=mi>7682</span><span class=n>g</span>                       <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>42</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>redmine</span>       <span class=n>redmine</span><span class=o>-</span><span class=n>postgres</span><span class=o>-</span><span class=n>deployment</span><span class=o>-</span><span class=mi>7</span><span class=n>bd9859c6d</span><span class=o>-</span><span class=n>thrcv</span>   <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>42</span><span class=n>m</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>部署Agent完成後的pod，新增了兩個Namespace: karbon-agent、project-ingress</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>wangken</span><span class=err>@</span><span class=n>wangken</span><span class=o>-</span><span class=n>MAC</span> <span class=n>ken</span><span class=o>-</span><span class=n>nke1</span> <span class=o>%</span> <span class=o>./</span><span class=n>nke</span><span class=o>-</span><span class=n>ctl</span> <span class=n>get</span> <span class=n>po</span> <span class=o>-</span><span class=n>A</span>
</span></span><span class=line><span class=cl><span class=n>NAMESPACE</span>         <span class=n>NAME</span>                                           <span class=n>READY</span>   <span class=n>STATUS</span>    <span class=n>RESTARTS</span>       <span class=n>AGE</span>
</span></span><span class=line><span class=cl><span class=n>karbon</span><span class=o>-</span><span class=n>agent</span>      <span class=n>controller</span><span class=o>-</span><span class=n>deployment</span><span class=o>-</span><span class=mi>788</span><span class=n>c9df5b</span><span class=o>-</span><span class=n>rg47k</span>          <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>119</span><span class=n>s</span>
</span></span><span class=line><span class=cl><span class=n>karbon</span><span class=o>-</span><span class=n>agent</span>      <span class=n>edgemgmt</span><span class=o>-</span><span class=n>c97765dc7</span><span class=o>-</span><span class=n>fhs6d</span>                       <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>119</span><span class=n>s</span>
</span></span><span class=line><span class=cl><span class=n>karbon</span><span class=o>-</span><span class=n>agent</span>      <span class=n>nats</span><span class=o>-</span><span class=n>c9bd445bb</span><span class=o>-</span><span class=n>lzvdg</span>                           <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>72</span><span class=n>s</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>       <span class=n>coredns</span><span class=o>-</span><span class=mi>7</span><span class=n>b95cd4468</span><span class=o>-</span><span class=mi>5</span><span class=n>zqhg</span>                       <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>46</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>       <span class=n>coredns</span><span class=o>-</span><span class=mi>7</span><span class=n>b95cd4468</span><span class=o>-</span><span class=n>qhszt</span>                       <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>113</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>       <span class=n>kube</span><span class=o>-</span><span class=n>apiserver</span><span class=o>-</span><span class=n>ken</span><span class=o>-</span><span class=n>nke1</span><span class=o>-</span><span class=mi>906</span><span class=n>a07</span><span class=o>-</span><span class=n>master</span><span class=o>-</span><span class=mi>0</span>        <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>2</span> <span class=p>(</span><span class=mi>117</span><span class=n>m</span> <span class=n>ago</span><span class=p>)</span>   <span class=mi>117</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>       <span class=n>kube</span><span class=o>-</span><span class=n>apiserver</span><span class=o>-</span><span class=n>ken</span><span class=o>-</span><span class=n>nke1</span><span class=o>-</span><span class=mi>906</span><span class=n>a07</span><span class=o>-</span><span class=n>master</span><span class=o>-</span><span class=mi>1</span>        <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>1</span> <span class=p>(</span><span class=mi>117</span><span class=n>m</span> <span class=n>ago</span><span class=p>)</span>   <span class=mi>117</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>       <span class=n>kube</span><span class=o>-</span><span class=n>flannel</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>dp5jv</span>                          <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>7</span><span class=n>d21h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>       <span class=n>kube</span><span class=o>-</span><span class=n>flannel</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>gqz5j</span>                          <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>7</span><span class=n>d21h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>       <span class=n>kube</span><span class=o>-</span><span class=n>flannel</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>slmqt</span>                          <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>7</span><span class=n>d21h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>       <span class=n>kube</span><span class=o>-</span><span class=n>flannel</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>z7hnh</span>                          <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>7</span><span class=n>d21h</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>       <span class=n>kube</span><span class=o>-</span><span class=n>proxy</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=mi>75</span><span class=n>tnd</span>                            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>108</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>       <span class=n>kube</span><span class=o>-</span><span class=n>proxy</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>lqmzt</span>                            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>108</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>       <span class=n>kube</span><span class=o>-</span><span class=n>proxy</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>qwzcd</span>                            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>108</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>kube</span><span class=o>-</span><span class=n>system</span>       <span class=n>kube</span><span class=o>-</span><span class=n>proxy</span><span class=o>-</span><span class=n>ds</span><span class=o>-</span><span class=n>rcqfv</span>                            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>109</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>alertmanager</span><span class=o>-</span><span class=n>main</span><span class=o>-</span><span class=mi>0</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>46</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>alertmanager</span><span class=o>-</span><span class=n>main</span><span class=o>-</span><span class=mi>1</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>1</span> <span class=p>(</span><span class=mi>107</span><span class=n>m</span> <span class=n>ago</span><span class=p>)</span>   <span class=mi>108</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>alertmanager</span><span class=o>-</span><span class=n>main</span><span class=o>-</span><span class=mi>2</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>1</span> <span class=p>(</span><span class=mi>107</span><span class=n>m</span> <span class=n>ago</span><span class=p>)</span>   <span class=mi>108</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>blackbox</span><span class=o>-</span><span class=n>exporter</span><span class=o>-</span><span class=mi>7</span><span class=n>d494dffb6</span><span class=o>-</span><span class=mi>5</span><span class=n>w2zm</span>             <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>46</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>csi</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>controller</span><span class=o>-</span><span class=mi>5</span><span class=n>fc6f8f5c4</span><span class=o>-</span><span class=n>hvcsj</span>       <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>113</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>csi</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>webhook</span><span class=o>-</span><span class=mi>78957</span><span class=n>b8ddd</span><span class=o>-</span><span class=n>pwggj</span>          <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>113</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>elasticsearch</span><span class=o>-</span><span class=n>logging</span><span class=o>-</span><span class=mi>0</span>                        <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>109</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>fluent</span><span class=o>-</span><span class=n>bit</span><span class=o>-</span><span class=mi>6</span><span class=n>cjst</span>                               <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>5</span><span class=n>d19h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>fluent</span><span class=o>-</span><span class=n>bit</span><span class=o>-</span><span class=mi>74</span><span class=n>fw9</span>                               <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>5</span><span class=n>d19h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>fluent</span><span class=o>-</span><span class=n>bit</span><span class=o>-</span><span class=n>dn9qc</span>                               <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>5</span><span class=n>d19h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>fluent</span><span class=o>-</span><span class=n>bit</span><span class=o>-</span><span class=n>gwrsq</span>                               <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>5</span><span class=n>d19h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>kibana</span><span class=o>-</span><span class=n>logging</span><span class=o>-</span><span class=mi>6</span><span class=n>ccd475856</span><span class=o>-</span><span class=n>xgmjz</span>                <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>1</span> <span class=p>(</span><span class=mi>108</span><span class=n>m</span> <span class=n>ago</span><span class=p>)</span>   <span class=mi>113</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>kube</span><span class=o>-</span><span class=n>state</span><span class=o>-</span><span class=n>metrics</span><span class=o>-</span><span class=mi>758</span><span class=n>b544d66</span><span class=o>-</span><span class=n>ns667</span>            <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>46</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>kubernetes</span><span class=o>-</span><span class=n>events</span><span class=o>-</span><span class=n>printer</span><span class=o>-</span><span class=mi>8</span><span class=n>d4c49454</span><span class=o>-</span><span class=n>kjtkm</span>      <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>46</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>node</span><span class=o>-</span><span class=n>exporter</span><span class=o>-</span><span class=mi>9698</span><span class=n>d</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>106</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>node</span><span class=o>-</span><span class=n>exporter</span><span class=o>-</span><span class=n>hhqzn</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>107</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>node</span><span class=o>-</span><span class=n>exporter</span><span class=o>-</span><span class=n>wkg4z</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>108</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>node</span><span class=o>-</span><span class=n>exporter</span><span class=o>-</span><span class=n>z5d8f</span>                            <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>106</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>controller</span><span class=o>-</span><span class=mi>864</span><span class=n>cc4767b</span><span class=o>-</span><span class=n>mhftm</span>        <span class=mi>5</span><span class=o>/</span><span class=mi>5</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>113</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>node</span><span class=o>-</span><span class=mi>8</span><span class=n>c2cc</span>                         <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>7</span><span class=n>d21h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>node</span><span class=o>-</span><span class=n>sf6wd</span>                         <span class=mi>3</span><span class=o>/</span><span class=mi>3</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>7</span><span class=n>d21h</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>prometheus</span><span class=o>-</span><span class=n>adapter</span><span class=o>-</span><span class=mi>56755</span><span class=n>b575c</span><span class=o>-</span><span class=n>clhp2</span>            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>108</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>prometheus</span><span class=o>-</span><span class=n>adapter</span><span class=o>-</span><span class=mi>56755</span><span class=n>b575c</span><span class=o>-</span><span class=n>fb979</span>            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>46</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>prometheus</span><span class=o>-</span><span class=n>k8s</span><span class=o>-</span><span class=mi>0</span>                               <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>46</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>prometheus</span><span class=o>-</span><span class=n>k8s</span><span class=o>-</span><span class=mi>1</span>                               <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>108</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>       <span class=n>prometheus</span><span class=o>-</span><span class=n>operator</span><span class=o>-</span><span class=mi>655</span><span class=n>cf4b548</span><span class=o>-</span><span class=n>tr7kv</span>           <span class=mi>2</span><span class=o>/</span><span class=mi>2</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>46</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>project</span><span class=o>-</span><span class=n>ingress</span>   <span class=n>datastream</span><span class=o>-</span><span class=n>mqtt</span><span class=o>-</span><span class=n>ingress</span><span class=o>-</span><span class=mi>54</span><span class=n>b8c67bdd</span><span class=o>-</span><span class=n>d7kbl</span>       <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>56</span><span class=n>s</span>
</span></span><span class=line><span class=cl><span class=n>project</span><span class=o>-</span><span class=n>ingress</span>   <span class=n>datastream</span><span class=o>-</span><span class=n>rtsp</span><span class=o>-</span><span class=n>ingress</span><span class=o>-</span><span class=mi>59</span><span class=n>c47c8f7c</span><span class=o>-</span><span class=n>pgwpc</span>       <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>56</span><span class=n>s</span>
</span></span><span class=line><span class=cl><span class=n>project</span><span class=o>-</span><span class=n>ingress</span>   <span class=n>nats</span><span class=o>-</span><span class=mi>8</span><span class=n>bc8494cd</span><span class=o>-</span><span class=n>vxs4b</span>                           <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>72</span><span class=n>s</span>
</span></span><span class=line><span class=cl><span class=n>redmine</span>           <span class=n>redmine</span><span class=o>-</span><span class=mi>7</span><span class=n>fd78679f9</span><span class=o>-</span><span class=mi>7682</span><span class=n>g</span>                       <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>46</span><span class=n>m</span>
</span></span><span class=line><span class=cl><span class=n>redmine</span>           <span class=n>redmine</span><span class=o>-</span><span class=n>postgres</span><span class=o>-</span><span class=n>deployment</span><span class=o>-</span><span class=mi>7</span><span class=n>bd9859c6d</span><span class=o>-</span><span class=n>thrcv</span>   <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>              <span class=mi>46</span><span class=n>m</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=完成前後對照>完成前後對照</h3><p>原本的畫面</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011092930911.png loading=lazy alt=image-20231011092930911></p><p>因爲測試使用，故把Worker Node數量降到2</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011105655407.png loading=lazy alt=image-20231011105655407></p><p>完成後多了一個Namespace的選項</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011114956233.png loading=lazy alt=image-20231011114956233></p><p>權限部分應該是還沒做好，登出後用local admin帳號登入就看得到namespace內容</p><p>然後ken-mgmt的worker node數量調整為2後，就可以看到namespace裡面的Deployment跟其他資訊</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011120129274.png loading=lazy alt=image-20231011120129274></p><p>Workloads</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011132124834.png loading=lazy alt=image-20231011132124834></p><p>Workloads : Deployments</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011125442631.png loading=lazy alt=image-20231011125442631></p><p>Deployment詳細資訊</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011125601847.png loading=lazy alt=image-20231011125601847></p><p>Deployment詳細資訊，Pod名稱跟Yaml格式</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011125620243.png loading=lazy alt=image-20231011125620243></p><p>Config有 ConfigMaps跟Secrets</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011125748609.png loading=lazy alt=image-20231011125748609></p><p>Network裡面的Service，看是走Nodeport or ClusterIP or Ingress</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011125845677.png loading=lazy alt=image-20231011125845677></p><p>Endpoints</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011125950105.png loading=lazy alt=image-20231011125950105></p><p>PVC</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011130008347.png loading=lazy alt=image-20231011130008347></p><p>點進去都可以看到Yaml格式，就跟使用kubectl edit 會出現的yaml是一樣的，但這邊無法編輯</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011130058520.png loading=lazy alt=image-20231011130058520></p><p>Charts還不確定會有什麼可以呈現</p><p><img src=https://kenkenny.synology.me:5543/images/2023/10/image-20231011130156905.png loading=lazy alt=image-20231011130156905></p><h2 id=總結>總結</h2><p>NKE 的部署很簡單、快速，透過CSI Driver 可以結合Nutanix本身的檔案系統 ( Volume / Files ) 來做儲存</p><p>其實是很適合現有使用Nutanix ，但又同時想要擁有Kuberntes來做開發測試，或是高階玩家想省授權費用的人，</p><p>因為NKE 本身的監控、Log沒有像Redhat Openshift 有很多預設做好的介面跟Operator，</p><p>所以若是正式環境會需要自己部署ELK、Prometheus、Service Mesh等軟體。</p></section><footer class=article-footer><section class=article-tags><a href=/tags/kubernetes/>Kubernetes</a>
<a href=/tags/nutanix/>Nutanix</a>
<a href=/tags/nke/>NKE</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相關文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/nutanix_nkp-v2.13_ahv/><div class=article-details><h2 class=article-title>Nutanix_NKP-v2.13_AHV</h2></div></a></article><article><a href=/p/ocp-4.16.3_on_nutanixipi/><div class=article-details><h2 class=article-title>OCP-4.16.3_on_Nutanix(IPI)</h2></div></a></article><article><a href=/p/nutanix_nkp-v2.13_preprovisioned/><div class=article-details><h2 class=article-title>Nutanix_NKP-v2.13_Preprovisioned</h2></div></a></article><article><a href=/p/nutanix_nkp-v2.12_ahv/><div class=article-details><h2 class=article-title>Nutanix_NKP-v2.12_AHV</h2></div></a></article><article><a href=/p/nutanix_ndk-v1.0.0_on_ocp-4.13/><div class=article-details><h2 class=article-title>Nutanix_NDK-v1.0.0_On_OCP-4.13</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//wangken0129.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2023 -
2025 Ken's blog</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 建立<br>主題 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 設計</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>