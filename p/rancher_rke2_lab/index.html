<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Rancher_RKE2_Lab"><title>Rancher_RKE2_Lab</title>
<link rel=canonical href=https://wangken0129.github.io/p/rancher_rke2_lab/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="Rancher_RKE2_Lab"><meta property='og:description' content="Rancher_RKE2_Lab"><meta property='og:url' content='https://wangken0129.github.io/p/rancher_rke2_lab/'><meta property='og:site_name' content="Ken's blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='SUSE'><meta property='article:tag' content='Rancher'><meta property='article:tag' content='Kubernetes'><meta property='article:published_time' content='2023-09-23T07:42:08+08:00'><meta property='article:modified_time' content='2023-09-23T07:42:08+08:00'><meta name=twitter:title content="Rancher_RKE2_Lab"><meta name=twitter:description content="Rancher_RKE2_Lab"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ›é¸å–®>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_c68a00bbf16dac8.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ‡¹ğŸ‡¼</span></figure><div class=site-meta><h1 class=site-name><a href=/>Ken's blog</a></h1><h2 class=site-description>ç´€éŒ„èˆ‡åˆ†äº«ï¼Œç•¶å€‹å¿«æ¨‚çš„å·¥ç¨‹å¸«</h2></div></header><ol class=menu-social><li><a href=https://github.com/wangken0129/wangken0129.github.io target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/ken-wang-88924b181/ target=_blank title=LinkedIn rel=me><svg class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>å¤œæ™šæ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®éŒ„</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#åƒè€ƒè³‡æ–™>åƒè€ƒè³‡æ–™</a></li><li><a href=#rke2-vs-rke-vs-k3s>RKE2 vs RKE vs K3S</a></li><li><a href=#æ¶æ§‹>æ¶æ§‹</a></li><li><a href=#å®‰è£ä½œæ¥­ç³»çµ±-no-swap>å®‰è£ä½œæ¥­ç³»çµ± (No Swap)</a></li><li><a href=#è¨»å†Šä½œæ¥­ç³»çµ±>è¨»å†Šä½œæ¥­ç³»çµ±</a></li><li><a href=#å®‰è£rms>å®‰è£RMS</a><ol><li><a href=#å®‰è£dns-server>å®‰è£DNS Server</a></li><li><a href=#å®‰è£ngnix>å®‰è£Ngnix</a></li><li><a href=#èª¿æ•´é˜²ç«ç‰†è¨­å®š>èª¿æ•´é˜²ç«ç‰†è¨­å®š</a></li><li><a href=#å®‰è£nfs-server>å®‰è£NFS Server</a></li></ol></li><li><a href=#å®‰è£rke2-1>å®‰è£RKE2-1</a><ol><li><a href=#å®‰è£rke2>å®‰è£RKE2</a></li><li><a href=#install-rancher-and-cert-manager>install rancher and cert-manager</a></li></ol></li><li><a href=#å®‰è£rke2-2>å®‰è£RKE2-2</a><ol><li><a href=#å®‰è£rke2-3>å®‰è£RKE2</a></li></ol></li><li><a href=#å®‰è£rke-2-3>å®‰è£RKE 2-3</a><ol><li><a href=#å®‰è£rke2-4>å®‰è£RKE2</a></li></ol></li></ol><ol><li><a href=#æ¶æ§‹-å»ºè­°ç”¨v124ä»¥ä¸Š>æ¶æ§‹ å»ºè­°ç”¨v1.24ä»¥ä¸Š</a></li><li><a href=#ä½œæ¥­ç³»çµ±èˆ‡å®‰è£dokcer>ä½œæ¥­ç³»çµ±èˆ‡å®‰è£Dokcer</a></li><li><a href=#å¾rancherç®¡ç†ä»‹é¢æ–°å¢cluster>å¾Rancherç®¡ç†ä»‹é¢æ–°å¢Cluster</a></li></ol><ol><li><a href=#authentication-ldap>Authentication LDAP</a></li><li><a href=#storageè¨­å®š>Storageè¨­å®š</a></li><li><a href=#å®‰è£logging>å®‰è£Logging</a></li><li><a href=#å®‰è£monitoring>å®‰è£Monitoring</a></li><li><a href=#å®‰è£neuvector>å®‰è£Neuvector</a></li></ol><ol><li><a href=#rancher-backup-å‚™ä»½é‚„åŸapp>Rancher Backup (å‚™ä»½é‚„åŸAPP)</a></li><li><a href=#å‚™ä»½rancher-cluster-etcd>å‚™ä»½Rancher Cluster etcd</a></li><li><a href=#å‡ç´šrancher-cluster>å‡ç´šRancher Cluster</a></li><li><a href=#roll-backup-rancher-helm>Roll Backup Rancher (Helm)</a></li><li><a href=#é‚„åŸrancher-cluster-etcd>é‚„åŸRancher Cluster etcd</a></li><li><a href=#å‚™ä»½downstream-cluster>å‚™ä»½Downstream Cluster</a></li><li><a href=#é‚„åŸdownstream-cluster>é‚„åŸDownstream Cluster</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/lab-category/ style=background-color:#2a9d8f;color:#fff>Lab Category</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/rancher_rke2_lab/>Rancher_RKE2_Lab</a></h2><h3 class=article-subtitle>Rancher_RKE2_Lab</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Sep 23, 2023</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é–±è®€æ™‚é–“: 31 åˆ†é˜</time></div></footer></div></header><section class=article-content><h1 id=rancher-rke2-cluster>Rancher RKE2 Cluster</h1><p>Rancher RKE2 å®‰è£Lab</p><h2 id=åƒè€ƒè³‡æ–™>åƒè€ƒè³‡æ–™</h2><p><a class=link href=https://docs.rke2.io/#how-is-this-different-from-rke-or-k3s target=_blank rel=noopener>https://docs.rke2.io/#how-is-this-different-from-rke-or-k3s</a></p><h2 id=rke2-vs-rke-vs-k3s>RKE2 vs RKE vs K3S</h2><p>RKE2 combines the best-of-both-worlds from the 1.x version of RKE (hereafter referred to as RKE1) and K3s.</p><p>From K3s, it inherits the usability, ease-of-operations, and deployment model.</p><p>From RKE1, it inherits close alignment with upstream Kubernetes. In places K3s has diverged from upstream Kubernetes in order to optimize for edge deployments, but RKE1 and RKE2 can stay closely aligned with upstream.</p><p>Importantly, RKE2 does not rely on Docker as RKE1 does. RKE1 leveraged Docker for deploying and managing the control plane components as well as the container runtime for Kubernetes. RKE2 launches control plane components as static pods, managed by the kubelet. The embedded container runtime is containerd.</p><h2 id=æ¶æ§‹>æ¶æ§‹</h2><p>devop/suse</p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221026120148575.png loading=lazy alt=image-20221026120148575></p><p>DownStream K8S</p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221026120458643.png loading=lazy alt=image-20221026120458643></p><h2 id=å®‰è£ä½œæ¥­ç³»çµ±-no-swap>å®‰è£ä½œæ¥­ç³»çµ± (No Swap)</h2><p>é—œé–‰é˜²ç«ç‰†</p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221025140147837.png loading=lazy alt=image-20221025140147837></p><h2 id=è¨»å†Šä½œæ¥­ç³»çµ±>è¨»å†Šä½œæ¥­ç³»çµ±</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>yast2
</span></span><span class=line><span class=cl>email: ken.wang@infotech.com.tw
</span></span><span class=line><span class=cl>Registry Code: B8203D65240BDA3A
</span></span></code></pre></td></tr></table></div></div><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221025145420736.png loading=lazy alt=image-20221025145420736></p><h2 id=å®‰è£rms>å®‰è£RMS</h2><p><a class=link href=https://kb.vmware.com/s/article/57122 target=_blank rel=noopener>https://kb.vmware.com/s/article/57122</a></p><h3 id=å®‰è£dns-server>å®‰è£DNS Server</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~&gt; sudo zypper install -t pattern dhcp_dns_server
</span></span><span class=line><span class=cl>[sudo] root çš„å¯†ç¢¼ï¼š
</span></span><span class=line><span class=cl>devop@rms:~&gt; sudo yast2
</span></span></code></pre></td></tr></table></div></div><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221025153349050.png loading=lazy alt=image-20221025153349050></p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221025153502151.png loading=lazy alt=image-20221025153502151></p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221025153543482.png loading=lazy alt=image-20221025153543482></p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221025153718281.png loading=lazy alt=image-20221025153718281></p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221025153903862.png loading=lazy alt=image-20221025153903862></p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221025154021819.png loading=lazy alt=image-20221025154021819></p><h3 id=å®‰è£ngnix>å®‰è£Ngnix</h3><ol><li><p>å®‰è£nginx</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rms</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>sudo</span> <span class=n>zypper</span> <span class=n>install</span> <span class=n>nginx</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>sudo</span><span class=p>]</span> <span class=n>root</span> <span class=err>çš„å¯†ç¢¼ï¼š</span>
</span></span><span class=line><span class=cl><span class=err>æ­£åœ¨é‡æ–°æ•´ç†æœå‹™</span> <span class=s1>&#39;Basesystem_Module_15_SP4_x86_64&#39;</span><span class=err>ã€‚</span>
</span></span><span class=line><span class=cl><span class=err>æ­£åœ¨é‡æ–°æ•´ç†æœå‹™</span> <span class=s1>&#39;Desktop_Applications_Module_15_SP4_x86_64&#39;</span><span class=err>ã€‚</span>
</span></span><span class=line><span class=cl><span class=err>æ­£åœ¨é‡æ–°æ•´ç†æœå‹™</span> <span class=s1>&#39;SUSE_Linux_Enterprise_Server_15_SP4_x86_64&#39;</span><span class=err>ã€‚</span>
</span></span><span class=line><span class=cl><span class=err>æ­£åœ¨é‡æ–°æ•´ç†æœå‹™</span> <span class=s1>&#39;Server_Applications_Module_15_SP4_x86_64&#39;</span><span class=err>ã€‚</span>
</span></span><span class=line><span class=cl><span class=err>æ­£åœ¨è¼‰å…¥å¥—ä»¶åº«è³‡æ–™</span><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=err>æ­£åœ¨è®€å–å·²å®‰è£çš„å¥—ä»¶</span><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=err>æ­£åœ¨è§£æ±ºå¥—ä»¶ç›¸ä¾æ€§</span><span class=o>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>å°‡æœƒå®‰è£ä¸‹åˆ—</span> <span class=mi>1</span> <span class=err>å€‹æ–°çš„å¥—ä»¶ï¼š</span>
</span></span><span class=line><span class=cl>  <span class=n>nginx</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>1</span> <span class=err>è¦å®‰è£çš„æ–°å¥—ä»¶</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=err>å…¨éƒ¨ä¸‹è¼‰å¤§å°ï¼š</span><span class=mf>702.9</span> <span class=n>KiB</span><span class=err>ã€‚å·²å¿«å–ï¼š</span><span class=mi>0</span> <span class=n>B</span><span class=err>ã€‚</span> <span class=err>å®Œæˆæ“ä½œå¾Œï¼Œå°‡ä½¿ç”¨é¡å¤–çš„</span> <span class=mf>2.3</span> <span class=n>MiB</span><span class=err>ã€‚</span>
</span></span><span class=line><span class=cl><span class=err>è¦ç¹¼çºŒå—ï¼Ÿ</span> <span class=p>[</span><span class=n>y</span><span class=o>/</span><span class=n>n</span><span class=o>/</span><span class=n>v</span><span class=o>/...</span><span class=err>?</span> <span class=err>é¡¯ç¤ºæ‰€æœ‰é¸é …</span><span class=p>]</span> <span class=p>(</span><span class=n>y</span><span class=p>):</span> <span class=n>y</span>
</span></span><span class=line><span class=cl><span class=err>æ­£åœ¨å–å‡º</span> <span class=err>å¥—ä»¶</span> <span class=n>nginx</span><span class=o>-</span><span class=mf>1.21</span><span class=o>.</span><span class=mi>5</span><span class=o>-</span><span class=mf>150400.1</span><span class=o>.</span><span class=mf>8.</span><span class=n>x86_64</span>           <span class=p>(</span><span class=mi>1</span><span class=o>/</span><span class=mi>1</span><span class=p>),</span> <span class=mf>702.9</span> <span class=n>KiB</span> <span class=p>(</span><span class=err>å·²è§£é–‹</span>   <span class=mf>2.3</span> <span class=n>MiB</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=err>æ­£åœ¨å–å›ï¸°</span> <span class=n>nginx</span><span class=o>-</span><span class=mf>1.21</span><span class=o>.</span><span class=mi>5</span><span class=o>-</span><span class=mf>150400.1</span><span class=o>.</span><span class=mf>8.</span><span class=n>x86_64</span><span class=o>.</span><span class=n>rpm</span> <span class=o>......................................</span><span class=p>[</span><span class=err>å®Œæˆ</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>æ­£åœ¨æª¢æŸ¥æª”æ¡ˆè¡çªï¼š</span> <span class=o>.................................................................</span><span class=p>[</span><span class=err>å®Œæˆ</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>useradd</span> <span class=o>-</span><span class=n>r</span> <span class=o>-</span><span class=n>c</span> <span class=n>User</span> <span class=k>for</span> <span class=n>nginx</span> <span class=o>-</span><span class=n>d</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>nginx</span> <span class=o>-</span><span class=n>U</span> <span class=n>nginx</span> <span class=o>-</span><span class=n>s</span> <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=mi>1</span><span class=o>/</span><span class=mi>1</span><span class=p>)</span> <span class=err>æ­£åœ¨å®‰è£ï¼š</span><span class=n>nginx</span><span class=o>-</span><span class=mf>1.21</span><span class=o>.</span><span class=mi>5</span><span class=o>-</span><span class=mf>150400.1</span><span class=o>.</span><span class=mf>8.</span><span class=n>x86_64</span> <span class=o>.....................................</span><span class=p>[</span><span class=err>å®Œæˆ</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>è¨­å®šngnix</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rms</span><span class=p>:</span><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>nginx</span><span class=o>&gt;</span> <span class=n>sudo</span> <span class=n>cat</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>nginx</span><span class=o>/</span><span class=n>nginx</span><span class=o>.</span><span class=n>conf</span>
</span></span><span class=line><span class=cl><span class=n>worker_processes</span> <span class=mi>4</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>worker_rlimit_nofile</span> <span class=mi>40000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>load_module</span> <span class=n>lib64</span><span class=o>/</span><span class=n>nginx</span><span class=o>/</span><span class=n>modules</span><span class=o>/</span><span class=n>ngx_stream_module</span><span class=o>.</span><span class=n>so</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>events</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>worker_connections</span> <span class=mi>8192</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#http {</span>
</span></span><span class=line><span class=cl><span class=c1>#    server {</span>
</span></span><span class=line><span class=cl><span class=c1>#        listen         80;</span>
</span></span><span class=line><span class=cl><span class=c1>#        return 301 https://$host$request_uri;</span>
</span></span><span class=line><span class=cl><span class=c1>#    }</span>
</span></span><span class=line><span class=cl><span class=c1>#}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>stream</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>upstream</span> <span class=n>rancher_servers_http</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>least_conn</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>server</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>33.41</span><span class=p>:</span><span class=mi>80</span> <span class=n>max_fails</span><span class=o>=</span><span class=mi>3</span> <span class=n>fail_timeout</span><span class=o>=</span><span class=mi>5</span><span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>server</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>33.42</span><span class=p>:</span><span class=mi>80</span> <span class=n>max_fails</span><span class=o>=</span><span class=mi>3</span> <span class=n>fail_timeout</span><span class=o>=</span><span class=mi>5</span><span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>server</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>33.43</span><span class=p>:</span><span class=mi>80</span> <span class=n>max_fails</span><span class=o>=</span><span class=mi>3</span> <span class=n>fail_timeout</span><span class=o>=</span><span class=mi>5</span><span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>#å¾Œç«¯web server</span>
</span></span><span class=line><span class=cl>    <span class=n>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	    <span class=n>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	    <span class=n>proxy_pass</span> <span class=n>rancher_servers_http</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>upstream</span> <span class=n>rancher_servers_https</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	    <span class=n>least_conn</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>server</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>33.41</span><span class=p>:</span><span class=mi>443</span> <span class=n>max_fails</span><span class=o>=</span><span class=mi>3</span> <span class=n>fail_timeout</span><span class=o>=</span><span class=mi>5</span><span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>server</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>33.42</span><span class=p>:</span><span class=mi>443</span> <span class=n>max_fails</span><span class=o>=</span><span class=mi>3</span> <span class=n>fail_timeout</span><span class=o>=</span><span class=mi>5</span><span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>server</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>33.43</span><span class=p>:</span><span class=mi>443</span> <span class=n>max_fails</span><span class=o>=</span><span class=mi>3</span> <span class=n>fail_timeout</span><span class=o>=</span><span class=mi>5</span><span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	    <span class=n>listen</span> <span class=mi>443</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	    <span class=n>proxy_pass</span> <span class=n>rancher_servers_https</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>upstream</span> <span class=n>rancher_servers_6443</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>least_conn</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>server</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>33.41</span><span class=p>:</span><span class=mi>6443</span> <span class=n>max_fails</span><span class=o>=</span><span class=mi>3</span> <span class=n>fail_timeout</span><span class=o>=</span><span class=mi>5</span><span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>server</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>33.42</span><span class=p>:</span><span class=mi>6443</span> <span class=n>max_fails</span><span class=o>=</span><span class=mi>3</span> <span class=n>fail_timeout</span><span class=o>=</span><span class=mi>5</span><span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>server</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>33.43</span><span class=p>:</span><span class=mi>6443</span> <span class=n>max_fails</span><span class=o>=</span><span class=mi>3</span> <span class=n>fail_timeout</span><span class=o>=</span><span class=mi>5</span><span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>listen</span> <span class=mi>6443</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>proxy_pass</span> <span class=n>rancher_servers_6443</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>upstream</span> <span class=n>rancher_servers_9345</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>least_conn</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>server</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>33.41</span><span class=p>:</span><span class=mi>9345</span> <span class=n>max_fails</span><span class=o>=</span><span class=mi>3</span> <span class=n>fail_timeout</span><span class=o>=</span><span class=mi>5</span><span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>server</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>33.42</span><span class=p>:</span><span class=mi>9345</span> <span class=n>max_fails</span><span class=o>=</span><span class=mi>3</span> <span class=n>fail_timeout</span><span class=o>=</span><span class=mi>5</span><span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>server</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>33.43</span><span class=p>:</span><span class=mi>9345</span> <span class=n>max_fails</span><span class=o>=</span><span class=mi>3</span> <span class=n>fail_timeout</span><span class=o>=</span><span class=mi>5</span><span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>listen</span> <span class=mi>9345</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>proxy_pass</span> <span class=n>rancher_servers_9345</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>log_format</span> <span class=n>basic</span> <span class=s1>&#39;$remote_addr [$time_local] &#39;</span>
</span></span><span class=line><span class=cl>                     <span class=s1>&#39;$protocol $status $bytes_sent $bytes_received &#39;</span>
</span></span><span class=line><span class=cl>                     <span class=s1>&#39;$session_time &#34;$upstream_addr&#34; &#39;</span>
</span></span><span class=line><span class=cl>                     <span class=s1>&#39;&#34;$upstream_bytes_sent&#34; &#34;$upstream_bytes_received&#34; &#34;$upstream_connect_time&#34;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>access_log</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=nb>log</span><span class=o>/</span><span class=n>nginx</span><span class=o>/</span><span class=n>access</span><span class=o>.</span><span class=n>log</span> <span class=n>basic</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>error_log</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=nb>log</span><span class=o>/</span><span class=n>nginx</span><span class=o>/</span><span class=n>error</span><span class=o>.</span><span class=n>log</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>å•Ÿå‹•æœå‹™</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:/etc/nginx&gt; sudo nginx -t
</span></span><span class=line><span class=cl>nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
</span></span><span class=line><span class=cl>nginx: configuration file /etc/nginx/nginx.conf test is successful
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>devop@rms:/etc/nginx&gt; sudo systemctl enable nginx --now
</span></span><span class=line><span class=cl>Created symlink /etc/systemd/system/multi-user.target.wants/nginx.service â†’ /usr/lib/systemd/system/nginx.service.
</span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=èª¿æ•´é˜²ç«ç‰†è¨­å®š>èª¿æ•´é˜²ç«ç‰†è¨­å®š</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rms</span><span class=p>:</span><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>nginx</span><span class=o>&gt;</span> <span class=n>sudo</span> <span class=n>firewall</span><span class=o>-</span><span class=n>cmd</span> <span class=o>--</span><span class=n>add</span><span class=o>-</span><span class=n>port</span><span class=o>=</span><span class=mi>80</span><span class=o>/</span><span class=n>tcp</span> <span class=o>--</span><span class=n>permanent</span>
</span></span><span class=line><span class=cl><span class=n>success</span>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rms</span><span class=p>:</span><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>nginx</span><span class=o>&gt;</span> <span class=n>sudo</span> <span class=n>firewall</span><span class=o>-</span><span class=n>cmd</span> <span class=o>--</span><span class=n>add</span><span class=o>-</span><span class=n>port</span><span class=o>=</span><span class=mi>443</span><span class=o>/</span><span class=n>tcp</span> <span class=o>--</span><span class=n>permanent</span>
</span></span><span class=line><span class=cl><span class=n>success</span>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rms</span><span class=p>:</span><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>nginx</span><span class=o>&gt;</span> <span class=n>sudo</span> <span class=n>firewall</span><span class=o>-</span><span class=n>cmd</span> <span class=o>--</span><span class=n>add</span><span class=o>-</span><span class=n>port</span><span class=o>=</span><span class=mi>6443</span><span class=o>/</span><span class=n>tcp</span> <span class=o>--</span><span class=n>permanent</span>
</span></span><span class=line><span class=cl><span class=n>success</span>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rms</span><span class=p>:</span><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>nginx</span><span class=o>&gt;</span> <span class=n>sudo</span> <span class=n>firewall</span><span class=o>-</span><span class=n>cmd</span> <span class=o>--</span><span class=n>add</span><span class=o>-</span><span class=n>port</span><span class=o>=</span><span class=mi>9345</span><span class=o>/</span><span class=n>tcp</span> <span class=o>--</span><span class=n>permanent</span>
</span></span><span class=line><span class=cl><span class=n>success</span>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rms</span><span class=p>:</span><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>nginx</span><span class=o>&gt;</span> <span class=n>sudo</span> <span class=n>firewall</span><span class=o>-</span><span class=n>cmd</span> <span class=o>--</span><span class=n>reload</span> 
</span></span><span class=line><span class=cl><span class=n>success</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Inbound Rules for RKE2 Server Nodes
</span></span><span class=line><span class=cl>Protocol	Port	Source	Description
</span></span><span class=line><span class=cl>TCP	9345	RKE2 agent nodes	Kubernetes API
</span></span><span class=line><span class=cl>TCP	6443	RKE2 agent nodes	Kubernetes API
</span></span><span class=line><span class=cl>UDP	8472	RKE2 server and agent nodes	Required only for Flannel VXLAN
</span></span><span class=line><span class=cl>TCP	10250	RKE2 server and agent nodes	kubelet
</span></span><span class=line><span class=cl>TCP	2379	RKE2 server nodes	etcd client port
</span></span><span class=line><span class=cl>TCP	2380	RKE2 server nodes	etcd peer port
</span></span><span class=line><span class=cl>TCP	30000-32767	RKE2 server and agent nodes	NodePort port range
</span></span><span class=line><span class=cl>UDP	8472	RKE2 server and agent nodes	Cilium CNI VXLAN
</span></span><span class=line><span class=cl>TCP	4240	RKE2 server and agent nodes	Cilium CNI health checks
</span></span><span class=line><span class=cl>ICMP	8/0	RKE2 server and agent nodes	Cilium CNI health checks
</span></span><span class=line><span class=cl>TCP	179	RKE2 server and agent nodes	Calico CNI with BGP
</span></span><span class=line><span class=cl>UDP	4789	RKE2 server and agent nodes	Calico CNI with VXLAN
</span></span><span class=line><span class=cl>TCP	5473	RKE2 server and agent nodes	Calico CNI with Typha
</span></span><span class=line><span class=cl>TCP	9098	RKE2 server and agent nodes	Calico Typha health checks
</span></span><span class=line><span class=cl>TCP	9099	RKE2 server and agent nodes	Calico health checks
</span></span><span class=line><span class=cl>TCP	5473	RKE2 server and agent nodes	Calico CNI with Typha
</span></span><span class=line><span class=cl>UDP	8472	RKE2 server and agent nodes	Canal CNI with VXLAN
</span></span><span class=line><span class=cl>TCP	9099	RKE2 server and agent nodes	Canal CNI health checks
</span></span><span class=line><span class=cl>UDP	51820	RKE2 server and agent nodes	Canal CNI with WireGuard IPv4
</span></span><span class=line><span class=cl>UDP	51821	RKE2 server and agent nodes	Canal CNI with WireGuard IPv6/dual-stack
</span></span></code></pre></td></tr></table></div></div><p>ç”¨ansibleä¾†åŸ·è¡Œé–‹å•Ÿport (é‡å°å„å€‹nodes)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wangken@wangken-MAC aps-rancher % cat inventory 
</span></span><span class=line><span class=cl>[rke2-cluster]
</span></span><span class=line><span class=cl>192.168.2.[71:73] ansible_ssh_pass=P@55w.rd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[downstream]
</span></span><span class=line><span class=cl>192.168.2.[74:78] ansible_ssh_pass=P@55w.rd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>wangken@wangken-MAC aps-rancher % cat ansible.cfg 
</span></span><span class=line><span class=cl>[defaults]
</span></span><span class=line><span class=cl>inventory = /Users/wangken/ansible/infoserver/aps-rancher/inventory
</span></span><span class=line><span class=cl>remote_user = devop
</span></span><span class=line><span class=cl>sudo_user = root
</span></span><span class=line><span class=cl>host_key_checking = False
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[privilege_escalation]
</span></span><span class=line><span class=cl>become = true
</span></span><span class=line><span class=cl>become_user = root
</span></span><span class=line><span class=cl>become_ask_pass = true
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>wangken@wangken-MAC aps-rancher % cat firewall.yml 
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>- hosts: rke2-cluster
</span></span><span class=line><span class=cl>  tasks:
</span></span><span class=line><span class=cl>    - name:
</span></span><span class=line><span class=cl>      firewalld:
</span></span><span class=line><span class=cl>        port: &#34;{{ item }}&#34;
</span></span><span class=line><span class=cl>        permanent: yes
</span></span><span class=line><span class=cl>        immediate: yes
</span></span><span class=line><span class=cl>        state: enabled
</span></span><span class=line><span class=cl>      with_items:
</span></span><span class=line><span class=cl>       - 9345/tcp
</span></span><span class=line><span class=cl>       - 6443/tcp
</span></span><span class=line><span class=cl>       - 8472/udp
</span></span><span class=line><span class=cl>       - 10250/tcp
</span></span><span class=line><span class=cl>       - 2379-2380/tcp
</span></span><span class=line><span class=cl>       - 30000-32767/tcp
</span></span><span class=line><span class=cl>       - 8472/udp
</span></span><span class=line><span class=cl>       - 4240/tcp
</span></span><span class=line><span class=cl>       - 179/tcp
</span></span><span class=line><span class=cl>       - 4789/udp
</span></span><span class=line><span class=cl>       - 5473/tcp
</span></span><span class=line><span class=cl>       - 9098/tcp
</span></span><span class=line><span class=cl>       - 9099/tcp
</span></span><span class=line><span class=cl>       - 8472/udp
</span></span><span class=line><span class=cl>       - 51820/udp
</span></span><span class=line><span class=cl>       - 51821/udp
</span></span><span class=line><span class=cl> wangken@wangken-MAC aps-rancher % ansible-playbook firewall.yml
</span></span><span class=line><span class=cl> TASK [firewalld] ***************************************************************
</span></span><span class=line><span class=cl>changed: [192.168.2.73] =&gt; (item=9345/tcp)
</span></span><span class=line><span class=cl>changed: [192.168.2.72] =&gt; (item=9345/tcp)
</span></span><span class=line><span class=cl>changed: [192.168.2.71] =&gt; (item=9345/tcp)
</span></span><span class=line><span class=cl>changed: [192.168.2.72] =&gt; (item=6443/tcp)
</span></span><span class=line><span class=cl>changed: [192.168.2.73] =&gt; (item=6443/tcp)
</span></span><span class=line><span class=cl>changed: [192.168.2.71] =&gt; (item=6443/tcp)
</span></span><span class=line><span class=cl>changed: [192.168.2.73] =&gt; (item=8472/udp)
</span></span><span class=line><span class=cl>changed: [192.168.2.72] =&gt; (item=8472/udp)
</span></span><span class=line><span class=cl>changed: [192.168.2.71] =&gt; (item=8472/udp)
</span></span><span class=line><span class=cl>changed: [192.168.2.73] =&gt; (item=10250/tcp)
</span></span><span class=line><span class=cl>changed: [192.168.2.71] =&gt; (item=10250/tcp)
</span></span><span class=line><span class=cl>changed: [192.168.2.72] =&gt; (item=10250/tcp)
</span></span><span class=line><span class=cl>changed: [192.168.2.72] =&gt; (item=2379-2380/tcp)
</span></span><span class=line><span class=cl>changed: [192.168.2.73] =&gt; (item=2379-2380/tcp)
</span></span><span class=line><span class=cl>changed: [192.168.2.71] =&gt; (item=2379-2380/tcp)
</span></span><span class=line><span class=cl>changed: [192.168.2.71] =&gt; (item=30000-32767/tcp)
</span></span><span class=line><span class=cl>changed: [192.168.2.73] =&gt; (item=30000-32767/tcp)
</span></span><span class=line><span class=cl>changed: [192.168.2.72] =&gt; (item=30000-32767/tcp)
</span></span></code></pre></td></tr></table></div></div><h3 id=å®‰è£nfs-server>å®‰è£NFS Server</h3><p><a class=link href=https://documentation.suse.com/sles/15-SP1/html/SLES-all/cha-nfs.html target=_blank rel=noopener>https://documentation.suse.com/sles/15-SP1/html/SLES-all/cha-nfs.html</a></p><ol><li><p>å»ºç«‹NFS Server ç›®éŒ„</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:/&gt; pwd
</span></span><span class=line><span class=cl>/
</span></span><span class=line><span class=cl>devop@rms:/&gt; sudo mkdir nfs
</span></span><span class=line><span class=cl>devop@rms:/&gt; sudo chmod 777 nfs
</span></span><span class=line><span class=cl>devop@rms:/&gt; ll
</span></span><span class=line><span class=cl>drwxrwxrwx   1 root root    0 11æœˆ  8 14:33 nfs
</span></span></code></pre></td></tr></table></div></div></li><li><p>å®‰è£NFS Serverå¥—ä»¶ (SUSE OS)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:/home&gt; sudo zypper install yast2-nfs-server
</span></span><span class=line><span class=cl>ä¸‹åˆ— 1 å€‹æ¨è–¦çš„å¥—ä»¶å·²è‡ªå‹•è¢«é¸å–ï¼š
</span></span><span class=line><span class=cl>  nfs-kernel-server
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>å°‡æœƒå®‰è£ä¸‹åˆ— 2 å€‹æ–°çš„å¥—ä»¶ï¼š
</span></span><span class=line><span class=cl>  nfs-kernel-server yast2-nfs-server
</span></span></code></pre></td></tr></table></div></div></li><li><p>è¨­å®šnfs-server path</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rms</span><span class=p>:</span><span class=o>/</span><span class=n>home</span><span class=o>&gt;</span> <span class=n>sudo</span> <span class=n>vim</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>exports</span> 
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rms</span><span class=p>:</span><span class=o>/</span><span class=n>home</span><span class=o>&gt;</span> <span class=n>cat</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>exports</span> 
</span></span><span class=line><span class=cl><span class=c1># See the exports(5) manpage for a description of the syntax of this file.</span>
</span></span><span class=line><span class=cl><span class=c1># This file contains a list of all directories that are to be exported to </span>
</span></span><span class=line><span class=cl><span class=c1># other computers via NFS (Network File System).</span>
</span></span><span class=line><span class=cl><span class=c1># This file used by rpc.nfsd and rpc.mountd. See their manpages for details</span>
</span></span><span class=line><span class=cl><span class=c1># on how make changes in this file effective.</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>nfs</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>33.0</span><span class=o>/</span><span class=mf>255.255</span><span class=o>.</span><span class=mf>255.0</span><span class=p>(</span><span class=n>rw</span><span class=p>,</span><span class=n>sync</span><span class=p>,</span><span class=n>no_root_squash</span><span class=p>,</span><span class=n>insecure</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>----</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åƒæ•¸</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span> <span class=n>rw</span><span class=err>ï¼š</span><span class=n>read</span><span class=o>-</span><span class=n>write</span><span class=err>ï¼Œå¯è®€å¯«çš„æ¬Šé™ï¼›</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span> <span class=n>ro</span><span class=err>ï¼š</span><span class=n>read</span><span class=o>-</span><span class=n>only</span><span class=err>ï¼Œå”¯è®€çš„æ¬Šé™ï¼›</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span> <span class=n>sync</span><span class=err>ï¼šè³‡æ–™åŒæ­¥å¯«å…¥åˆ°è¨˜æ†¶é«”èˆ‡ç¡¬ç¢Ÿç•¶ä¸­ï¼›</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span> <span class=n>async</span><span class=err>ï¼šè³‡æ–™æœƒå…ˆæš«å­˜æ–¼è¨˜æ†¶é«”ç•¶ä¸­ï¼Œè€Œéç›´æ¥å¯«å…¥ç¡¬ç¢Ÿã€‚</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span> <span class=n>no_root_squash</span><span class=err>ï¼š</span>
</span></span><span class=line><span class=cl>      <span class=err>ç™»å…¥</span> <span class=n>NFS</span> <span class=err>ä¸»æ©Ÿä½¿ç”¨åˆ†äº«ç›®éŒ„çš„ä½¿ç”¨è€…å¦‚æœæ˜¯</span> <span class=n>root</span><span class=err>ï¼Œå°æ–¼åˆ†äº«çš„ç›®éŒ„å…·æœ‰</span> <span class=n>root</span> <span class=err>çš„æ¬Šé™ã€‚</span>
</span></span><span class=line><span class=cl>      <span class=err>æ¥µä¸å®‰å…¨ï¼Œä¸å»ºè­°ä½¿ç”¨ã€‚</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span> <span class=n>root_squash</span><span class=err>ï¼š</span>
</span></span><span class=line><span class=cl>      <span class=err>ç™»å…¥</span> <span class=n>NFS</span> <span class=err>ä¸»æ©Ÿä½¿ç”¨åˆ†äº«ç›®éŒ„çš„ä½¿ç”¨è€…å¦‚æœæ˜¯</span> <span class=n>root</span><span class=err>ï¼Œæ¬Šé™å°‡è¢«å£“ç¸®æˆåŒ¿åä½¿ç”¨è€…ï¼Œ</span>
</span></span><span class=line><span class=cl>      <span class=err>é€šå¸¸ä»–çš„</span> <span class=n>UID</span> <span class=err>èˆ‡</span> <span class=n>GID</span> <span class=err>éƒ½æœƒè®Šæˆ</span> <span class=n>nobody</span><span class=p>(</span><span class=n>nfsnobody</span><span class=p>)</span> <span class=err>é‚£å€‹ç³»çµ±å¸³è™Ÿçš„èº«ä»½ï¼›</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span> <span class=n>all_squash</span><span class=err>ï¼š</span>
</span></span><span class=line><span class=cl>      <span class=err>ä¸è«–ç™»å…¥</span> <span class=n>NFS</span> <span class=err>çš„ä½¿ç”¨è€…èº«ä»½ç‚ºä½•ï¼Œéƒ½æœƒè¢«å£“ç¸®æˆç‚ºåŒ¿åä½¿ç”¨è€…ï¼Œé€šå¸¸æ˜¯</span> <span class=n>nobody</span><span class=p>(</span><span class=n>nfsnobody</span><span class=p>)</span> <span class=err>ã€‚</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span> <span class=n>anonuid</span><span class=err>ï¼š</span>
</span></span><span class=line><span class=cl>      <span class=n>anon</span> <span class=err>æ„æŒ‡</span> <span class=n>anonymous</span> <span class=p>(</span><span class=err>åŒ¿åè€…</span><span class=p>)</span><span class=err>ï¼Œè‡ªè¨‚åŒ¿åä½¿ç”¨è€…çš„</span> <span class=n>UID</span><span class=err>ã€‚</span> 
</span></span><span class=line><span class=cl>    <span class=o>*</span> <span class=n>anongid</span><span class=err>ï¼šè‡ªè¨‚åŒ¿åä½¿ç”¨è€…çš„æ˜¯è®Šæˆ</span> <span class=n>GID</span><span class=err>ã€‚</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>å•Ÿå‹•nfs serverã€èª¿æ•´é˜²ç«ç‰†</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rms</span><span class=p>:</span><span class=o>/</span><span class=n>home</span><span class=o>&gt;</span> <span class=n>sudo</span> <span class=n>systemctl</span> <span class=n>enable</span> <span class=n>nfs</span><span class=o>-</span><span class=n>server</span> <span class=o>--</span><span class=n>now</span>
</span></span><span class=line><span class=cl><span class=n>Created</span> <span class=n>symlink</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>systemd</span><span class=o>/</span><span class=n>system</span><span class=o>/</span><span class=n>multi</span><span class=o>-</span><span class=n>user</span><span class=o>.</span><span class=n>target</span><span class=o>.</span><span class=n>wants</span><span class=o>/</span><span class=n>nfs</span><span class=o>-</span><span class=n>server</span><span class=o>.</span><span class=n>service</span> <span class=err>â†’</span> <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>systemd</span><span class=o>/</span><span class=n>system</span><span class=o>/</span><span class=n>nfs</span><span class=o>-</span><span class=n>server</span><span class=o>.</span><span class=n>service</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rms</span><span class=p>:</span><span class=o>~/</span><span class=n>nfs</span><span class=o>&gt;</span> <span class=n>sudo</span> <span class=n>firewall</span><span class=o>-</span><span class=n>cmd</span> <span class=o>--</span><span class=n>add</span><span class=o>-</span><span class=n>service</span><span class=o>=</span><span class=n>nfs</span> <span class=o>--</span><span class=n>permanent</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>sudo</span><span class=p>]</span> <span class=n>root</span> <span class=err>çš„å¯†ç¢¼ï¼š</span>
</span></span><span class=line><span class=cl><span class=n>success</span>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rms</span><span class=p>:</span><span class=o>~/</span><span class=n>nfs</span><span class=o>&gt;</span> <span class=n>sudo</span> <span class=n>firewall</span><span class=o>-</span><span class=n>cmd</span> <span class=o>--</span><span class=n>reload</span>
</span></span><span class=line><span class=cl><span class=n>success</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rms</span><span class=p>:</span><span class=o>~/</span><span class=n>nfs</span><span class=o>&gt;</span> <span class=n>sudo</span> <span class=n>showmount</span> <span class=o>-</span><span class=n>e</span>
</span></span><span class=line><span class=cl><span class=n>Export</span> <span class=n>list</span> <span class=k>for</span> <span class=n>rms</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>nfs</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>33.0</span><span class=o>/</span><span class=mf>255.255</span><span class=o>.</span><span class=mf>255.0</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=å®‰è£rke2-1>å®‰è£RKE2-1</h2><ol><li>å®‰è£OS</li><li>èª¿æ•´DNS æŒ‡å‘192.168.33.40</li><li>é—œé–‰é˜²ç«ç‰†</li></ol><h3 id=å®‰è£rke2>å®‰è£RKE2</h3><ol><li><p>ä¸‹è¼‰install.sh</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rke2-1:~&gt; curl -sfL https://get.rke2.io --output install.sh
</span></span><span class=line><span class=cl>devop@rke2-1:~&gt; chmod +x install.sh
</span></span></code></pre></td></tr></table></div></div></li><li><p>æ–°å¢è¨­å®šæª”</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rke2-1:~&gt; sudo mkdir -p /etc/rancher/rke2/
</span></span><span class=line><span class=cl>[sudo] root çš„å¯†ç¢¼ï¼š
</span></span><span class=line><span class=cl>devop@rke2-1:~&gt; sudo vim /etc/rancher/rke2/config.yaml
</span></span><span class=line><span class=cl>node-name:
</span></span><span class=line><span class=cl>  - &#34;rke2-1&#34;
</span></span><span class=line><span class=cl>token: my-shared-secret
</span></span><span class=line><span class=cl>tls-san:
</span></span><span class=line><span class=cl>  - rms.rancher.ken.lab
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> devop@rke2-1:~&gt; rke2 etcd-snapshot save \ 
</span></span><span class=line><span class=cl> --name pre-upgrade-snapshot
</span></span></code></pre></td></tr></table></div></div></li><li><p>å®‰è£rke2 &ndash; version 1.23.9</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>sudo</span> <span class=n>INSTALL_RKE2_CHANNEL</span><span class=o>=</span><span class=n>v1</span><span class=o>.</span><span class=mf>23.9</span><span class=o>+</span><span class=n>rke2r1</span> <span class=o>./</span><span class=n>install</span><span class=o>.</span><span class=n>sh</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>WARN</span><span class=p>]</span>  <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>local</span> <span class=n>is</span> <span class=n>read</span><span class=o>-</span><span class=n>only</span> <span class=ow>or</span> <span class=n>a</span> <span class=n>mount</span> <span class=n>point</span><span class=p>;</span> <span class=n>installing</span> <span class=n>to</span> <span class=o>/</span><span class=n>opt</span><span class=o>/</span><span class=n>rke2</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>INFO</span><span class=p>]</span>  <span class=n>finding</span> <span class=n>release</span> <span class=k>for</span> <span class=n>channel</span> <span class=n>v1</span><span class=o>.</span><span class=mf>23.9</span><span class=o>+</span><span class=n>rke2r1</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>INFO</span><span class=p>]</span>  <span class=n>using</span> <span class=n>v1</span><span class=o>.</span><span class=mf>23.9</span><span class=o>+</span><span class=n>rke2r1</span> <span class=n>as</span> <span class=n>release</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>INFO</span><span class=p>]</span>  <span class=n>downloading</span> <span class=n>checksums</span> <span class=n>at</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>releases</span><span class=o>/</span><span class=n>download</span><span class=o>/</span><span class=n>v1</span><span class=o>.</span><span class=mf>23.9</span><span class=o>+</span><span class=n>rke2r1</span><span class=o>/</span><span class=n>sha256sum</span><span class=o>-</span><span class=n>amd64</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>INFO</span><span class=p>]</span>  <span class=n>downloading</span> <span class=n>tarball</span> <span class=n>at</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>releases</span><span class=o>/</span><span class=n>download</span><span class=o>/</span><span class=n>v1</span><span class=o>.</span><span class=mf>23.9</span><span class=o>+</span><span class=n>rke2r1</span><span class=o>/</span><span class=n>rke2</span><span class=o>.</span><span class=n>linux</span><span class=o>-</span><span class=n>amd64</span><span class=o>.</span><span class=n>tar</span><span class=o>.</span><span class=n>gz</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>INFO</span><span class=p>]</span>  <span class=n>verifying</span> <span class=n>tarball</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>INFO</span><span class=p>]</span>  <span class=n>unpacking</span> <span class=n>tarball</span> <span class=n>file</span> <span class=n>to</span> <span class=o>/</span><span class=n>opt</span><span class=o>/</span><span class=n>rke2</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>INFO</span><span class=p>]</span>  <span class=n>updating</span> <span class=n>tarball</span> <span class=n>contents</span> <span class=n>to</span> <span class=n>reflect</span> <span class=n>install</span> <span class=n>path</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>INFO</span><span class=p>]</span>  <span class=n>moving</span> <span class=n>systemd</span> <span class=n>units</span> <span class=n>to</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>systemd</span><span class=o>/</span><span class=n>system</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>INFO</span><span class=p>]</span>  <span class=n>install</span> <span class=n>complete</span><span class=p>;</span> <span class=n>you</span> <span class=n>may</span> <span class=n>want</span> <span class=n>to</span> <span class=n>run</span><span class=p>:</span>  <span class=k>export</span> <span class=n>PATH</span><span class=o>=$</span><span class=n>PATH</span><span class=p>:</span><span class=o>/</span><span class=n>opt</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>bin</span>
</span></span><span class=line><span class=cl><span class=o>--</span>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span><span class=o>~&gt;</span>  <span class=k>export</span> <span class=n>PATH</span><span class=o>=$</span><span class=n>PATH</span><span class=p>:</span><span class=o>/</span><span class=n>opt</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>bin</span>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>sudo</span> <span class=n>systemctl</span> <span class=n>enable</span> <span class=n>rke2</span><span class=o>-</span><span class=n>server</span> <span class=o>--</span><span class=n>now</span>
</span></span><span class=line><span class=cl><span class=n>Created</span> <span class=n>symlink</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>systemd</span><span class=o>/</span><span class=n>system</span><span class=o>/</span><span class=n>multi</span><span class=o>-</span><span class=n>user</span><span class=o>.</span><span class=n>target</span><span class=o>.</span><span class=n>wants</span><span class=o>/</span><span class=n>rke2</span><span class=o>-</span><span class=n>server</span><span class=o>.</span><span class=n>service</span> <span class=err>â†’</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>systemd</span><span class=o>/</span><span class=n>system</span><span class=o>/</span><span class=n>rke2</span><span class=o>-</span><span class=n>server</span><span class=o>.</span><span class=n>service</span><span class=o>.</span>
</span></span></code></pre></td></tr></table></div></div><ol><li>èª¿æ•´kubectl ã€rke2 æŒ‡ä»¤åŠkubeconfig &#187; å¯æŠŠ rke2ã€kubectlã€rke2.yaml scpåˆ° rms</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>mkdir</span> <span class=o>.</span><span class=n>kube</span>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>sudo</span> <span class=n>cp</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>rke2</span><span class=o>.</span><span class=n>yaml</span> <span class=o>.</span><span class=n>kube</span><span class=o>/</span><span class=n>config</span>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>sudo</span> <span class=n>chown</span> <span class=n>devop</span> <span class=o>.</span><span class=n>kube</span><span class=o>/</span><span class=n>config</span> 
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>sudo</span> <span class=n>cp</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>kubectl</span> <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>local</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>cp</span> <span class=o>/</span><span class=n>opt</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>rke2</span> <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>local</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span>
</span></span><span class=line><span class=cl><span class=o>----</span>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>sudo</span> <span class=n>scp</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>rke2</span><span class=o>.</span><span class=n>yaml</span> <span class=n>devop</span><span class=err>@</span><span class=mf>192.168</span><span class=o>.</span><span class=mf>33.40</span><span class=p>:</span><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>devop</span><span class=o>/.</span><span class=n>kube</span><span class=o>/</span><span class=n>config</span>
</span></span><span class=line><span class=cl><span class=n>The</span> <span class=n>authenticity</span> <span class=n>of</span> <span class=n>host</span> <span class=s1>&#39;192.168.33.40 (192.168.33.40)&#39;</span> <span class=n>can</span><span class=s1>&#39;t be established.</span>
</span></span><span class=line><span class=cl><span class=n>ECDSA</span> <span class=n>key</span> <span class=n>fingerprint</span> <span class=n>is</span> <span class=n>SHA256</span><span class=p>:</span><span class=n>NS1PCnKGGGiOsCVPSdoRDhX5jq0yhqhtEIr3pMNDSzw</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>Are</span> <span class=n>you</span> <span class=n>sure</span> <span class=n>you</span> <span class=n>want</span> <span class=n>to</span> <span class=k>continue</span> <span class=n>connecting</span> <span class=p>(</span><span class=n>yes</span><span class=o>/</span><span class=n>no</span><span class=o>/</span><span class=p>[</span><span class=n>fingerprint</span><span class=p>])</span><span class=err>?</span> <span class=n>yes</span>
</span></span><span class=line><span class=cl><span class=n>Warning</span><span class=p>:</span> <span class=n>Permanently</span> <span class=n>added</span> <span class=s1>&#39;192.168.33.40&#39;</span> <span class=p>(</span><span class=n>ECDSA</span><span class=p>)</span> <span class=n>to</span> <span class=n>the</span> <span class=n>list</span> <span class=n>of</span> <span class=n>known</span> <span class=n>hosts</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>Password</span><span class=p>:</span> 
</span></span><span class=line><span class=cl><span class=n>rke2</span><span class=o>.</span><span class=n>yaml</span>                                                                <span class=mi>100</span><span class=o>%</span> <span class=mi>2969</span>     <span class=mf>2.6</span><span class=n>MB</span><span class=o>/</span><span class=n>s</span>   <span class=mi>00</span><span class=p>:</span><span class=mi>00</span>    
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>sudo</span> <span class=n>scp</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>kubectl</span>  <span class=n>root</span><span class=err>@</span><span class=mf>192.168</span><span class=o>.</span><span class=mf>33.40</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>local</span><span class=o>/</span><span class=n>bin</span>
</span></span><span class=line><span class=cl><span class=n>Password</span><span class=p>:</span> 
</span></span><span class=line><span class=cl><span class=n>kubectl</span>                                                                  <span class=mi>100</span><span class=o>%</span>   <span class=mi>47</span><span class=n>MB</span> <span class=mf>220.3</span><span class=n>MB</span><span class=o>/</span><span class=n>s</span>   <span class=mi>00</span><span class=p>:</span><span class=mi>00</span>    
</span></span></code></pre></td></tr></table></div></div></li><li><p>ç¢ºèªpod status (åˆ‡åˆ° rmsä¾†æ“ä½œ)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~&gt; kubectl get pods -A
</span></span><span class=line><span class=cl>NAMESPACE     NAME                                                    READY   STATUS      RESTARTS   AGE
</span></span><span class=line><span class=cl>kube-system   cloud-controller-manager-rke2-1                         1/1     Running     0          5m46s
</span></span><span class=line><span class=cl>kube-system   etcd-rke2-1                                             1/1     Running     0          5m30s
</span></span><span class=line><span class=cl>kube-system   helm-install-rke2-canal-9pg26                           0/1     Completed   0          5m35s
</span></span><span class=line><span class=cl>kube-system   helm-install-rke2-coredns-d4j4q                         0/1     Completed   0          5m35s
</span></span><span class=line><span class=cl>kube-system   helm-install-rke2-ingress-nginx-gz7db                   0/1     Completed   0          5m35s
</span></span><span class=line><span class=cl>kube-system   helm-install-rke2-metrics-server-fx65q                  0/1     Completed   0          5m35s
</span></span><span class=line><span class=cl>kube-system   kube-apiserver-rke2-1                                   1/1     Running     0          5m21s
</span></span><span class=line><span class=cl>kube-system   kube-controller-manager-rke2-1                          1/1     Running     0          5m47s
</span></span><span class=line><span class=cl>kube-system   kube-proxy-rke2-1                                       1/1     Running     0          5m43s
</span></span><span class=line><span class=cl>kube-system   kube-scheduler-rke2-1                                   1/1     Running     0          5m47s
</span></span><span class=line><span class=cl>kube-system   rke2-canal-qkrdv                                        2/2     Running     0          5m19s
</span></span><span class=line><span class=cl>kube-system   rke2-coredns-rke2-coredns-545d64676-2q6x9               1/1     Running     0          5m20s
</span></span><span class=line><span class=cl>kube-system   rke2-coredns-rke2-coredns-autoscaler-5dd676f5c7-5bwdl   1/1     Running     0          5m20s
</span></span><span class=line><span class=cl>kube-system   rke2-ingress-nginx-controller-gxp6v                     1/1     Running     0          4m42s
</span></span><span class=line><span class=cl>kube-system   rke2-metrics-server-6564db4569-98ghm                    1/1     Running     0          4m53s
</span></span><span class=line><span class=cl>devop@rms:~&gt; 
</span></span></code></pre></td></tr></table></div></div></li><li><p>å®‰è£Helm</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~&gt; wget https://get.helm.sh/helm-v3.8.2-linux-amd64.tar.gz
</span></span><span class=line><span class=cl>--2022-10-25 16:55:33--  https://get.helm.sh/helm-v3.8.2-linux-amd64.tar.gz
</span></span><span class=line><span class=cl>Resolving get.helm.sh (get.helm.sh)... 152.199.39.108, 2606:2800:247:1cb7:261b:1f9c:2074:3c
</span></span><span class=line><span class=cl>Connecting to get.helm.sh (get.helm.sh)|152.199.39.108|:443... connected.
</span></span><span class=line><span class=cl>HTTP request sent, awaiting response... 200 OK
</span></span><span class=line><span class=cl>Length: 13633605 (13M) [application/x-tar]
</span></span><span class=line><span class=cl>Saving to: â€˜helm-v3.8.2-linux-amd64.tar.gzâ€™
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>helm-v3.8.2-linux-amd64.ta 100%[=======================================&gt;]  13.00M  34.4MB/s    in 0.4s    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2022-10-25 16:55:35 (34.4 MB/s) - â€˜helm-v3.8.2-linux-amd64.tar.gzâ€™ saved [13633605/13633605]
</span></span><span class=line><span class=cl>devop@rms:~&gt; tar zxvf helm-v3.8.2-linux-amd64.tar.gz
</span></span><span class=line><span class=cl>linux-amd64/
</span></span><span class=line><span class=cl>linux-amd64/helm
</span></span><span class=line><span class=cl>linux-amd64/LICENSE
</span></span><span class=line><span class=cl>linux-amd64/README.md
</span></span><span class=line><span class=cl>devop@rms:~&gt; sudo cp linux-amd64/helm /usr/local/bin/
</span></span><span class=line><span class=cl>[sudo] root çš„å¯†ç¢¼ï¼š
</span></span><span class=line><span class=cl>devop@rms:~&gt; helm version
</span></span><span class=line><span class=cl>version.BuildInfo{Version:&#34;v3.8.2&#34;, GitCommit:&#34;6e3701edea09e5d55a8ca2aae03a68917630e91b&#34;, GitTreeState:&#34;clean&#34;, GoVersion:&#34;go1.17.5&#34;}
</span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=install-rancher-and-cert-manager>install rancher and cert-manager</h3><ol><li><p>Add helm repo & Install Cert-manager</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rms</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>helm</span> <span class=n>repo</span> <span class=n>add</span> <span class=n>rancher</span><span class=o>-</span><span class=n>stable</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>releases</span><span class=o>.</span><span class=n>rancher</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>server</span><span class=o>-</span><span class=n>charts</span><span class=o>/</span><span class=n>stable</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;rancher-stable&#34;</span> <span class=n>has</span> <span class=n>been</span> <span class=n>added</span> <span class=n>to</span> <span class=n>your</span> <span class=n>repositories</span>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rms</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>kubectl</span> <span class=n>create</span> <span class=n>namespace</span> <span class=n>cattle</span><span class=o>-</span><span class=n>system</span>
</span></span><span class=line><span class=cl><span class=n>namespace</span><span class=o>/</span><span class=n>cattle</span><span class=o>-</span><span class=n>system</span> <span class=n>created</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rms</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>kubectl</span> <span class=n>apply</span> <span class=o>-</span><span class=n>f</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>/</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>/</span><span class=n>releases</span><span class=o>/</span><span class=n>download</span><span class=o>/</span><span class=n>v1</span><span class=o>.</span><span class=mf>7.1</span><span class=o>/</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>.</span><span class=n>crds</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=n>customresourcedefinition</span><span class=o>.</span><span class=n>apiextensions</span><span class=o>.</span><span class=n>k8s</span><span class=o>.</span><span class=n>io</span><span class=o>/</span><span class=n>certificaterequests</span><span class=o>.</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>.</span><span class=n>io</span> <span class=n>created</span>
</span></span><span class=line><span class=cl><span class=n>customresourcedefinition</span><span class=o>.</span><span class=n>apiextensions</span><span class=o>.</span><span class=n>k8s</span><span class=o>.</span><span class=n>io</span><span class=o>/</span><span class=n>certificates</span><span class=o>.</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>.</span><span class=n>io</span> <span class=n>created</span>
</span></span><span class=line><span class=cl><span class=n>customresourcedefinition</span><span class=o>.</span><span class=n>apiextensions</span><span class=o>.</span><span class=n>k8s</span><span class=o>.</span><span class=n>io</span><span class=o>/</span><span class=n>challenges</span><span class=o>.</span><span class=n>acme</span><span class=o>.</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>.</span><span class=n>io</span> <span class=n>created</span>
</span></span><span class=line><span class=cl><span class=n>customresourcedefinition</span><span class=o>.</span><span class=n>apiextensions</span><span class=o>.</span><span class=n>k8s</span><span class=o>.</span><span class=n>io</span><span class=o>/</span><span class=n>clusterissuers</span><span class=o>.</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>.</span><span class=n>io</span> <span class=n>created</span>
</span></span><span class=line><span class=cl><span class=n>customresourcedefinition</span><span class=o>.</span><span class=n>apiextensions</span><span class=o>.</span><span class=n>k8s</span><span class=o>.</span><span class=n>io</span><span class=o>/</span><span class=n>issuers</span><span class=o>.</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>.</span><span class=n>io</span> <span class=n>created</span>
</span></span><span class=line><span class=cl><span class=n>customresourcedefinition</span><span class=o>.</span><span class=n>apiextensions</span><span class=o>.</span><span class=n>k8s</span><span class=o>.</span><span class=n>io</span><span class=o>/</span><span class=n>orders</span><span class=o>.</span><span class=n>acme</span><span class=o>.</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>.</span><span class=n>io</span> <span class=n>created</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rms</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>helm</span> <span class=n>repo</span> <span class=n>add</span> <span class=n>jetstack</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>charts</span><span class=o>.</span><span class=n>jetstack</span><span class=o>.</span><span class=n>io</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;jetstack&#34;</span> <span class=n>has</span> <span class=n>been</span> <span class=n>added</span> <span class=n>to</span> <span class=n>your</span> <span class=n>repositories</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rms</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>helm</span> <span class=n>repo</span> <span class=n>update</span>
</span></span><span class=line><span class=cl><span class=n>Hang</span> <span class=n>tight</span> <span class=k>while</span> <span class=n>we</span> <span class=n>grab</span> <span class=n>the</span> <span class=n>latest</span> <span class=n>from</span> <span class=n>your</span> <span class=n>chart</span> <span class=n>repositories</span><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=o>...</span><span class=n>Successfully</span> <span class=n>got</span> <span class=n>an</span> <span class=n>update</span> <span class=n>from</span> <span class=n>the</span> <span class=s2>&#34;jetstack&#34;</span> <span class=n>chart</span> <span class=n>repository</span>
</span></span><span class=line><span class=cl><span class=o>...</span><span class=n>Successfully</span> <span class=n>got</span> <span class=n>an</span> <span class=n>update</span> <span class=n>from</span> <span class=n>the</span> <span class=s2>&#34;rancher-stable&#34;</span> <span class=n>chart</span> <span class=n>repository</span>
</span></span><span class=line><span class=cl><span class=n>Update</span> <span class=n>Complete</span><span class=o>.</span> <span class=err>âˆ</span><span class=n>Happy</span> <span class=n>Helming</span><span class=o>!</span><span class=err>âˆ</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rms</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>helm</span> <span class=n>install</span> <span class=n>cert</span><span class=o>-</span><span class=n>manager</span> <span class=n>jetstack</span><span class=o>/</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span> \
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=o>--</span><span class=n>namespace</span> <span class=n>cert</span><span class=o>-</span><span class=n>manager</span> \
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=o>--</span><span class=n>create</span><span class=o>-</span><span class=n>namespace</span> \
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=o>--</span><span class=n>version</span> <span class=n>v1</span><span class=o>.</span><span class=mf>7.1</span>
</span></span><span class=line><span class=cl><span class=n>NAME</span><span class=p>:</span> <span class=n>cert</span><span class=o>-</span><span class=n>manager</span>
</span></span><span class=line><span class=cl><span class=n>LAST</span> <span class=n>DEPLOYED</span><span class=p>:</span> <span class=n>Tue</span> <span class=n>Oct</span> <span class=mi>25</span> <span class=mi>17</span><span class=p>:</span><span class=mi>01</span><span class=p>:</span><span class=mi>20</span> <span class=mi>2022</span>
</span></span><span class=line><span class=cl><span class=n>NAMESPACE</span><span class=p>:</span> <span class=n>cert</span><span class=o>-</span><span class=n>manager</span>
</span></span><span class=line><span class=cl><span class=n>STATUS</span><span class=p>:</span> <span class=n>deployed</span>
</span></span><span class=line><span class=cl><span class=n>REVISION</span><span class=p>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>TEST</span> <span class=n>SUITE</span><span class=p>:</span> <span class=n>None</span>
</span></span><span class=line><span class=cl><span class=n>NOTES</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=n>cert</span><span class=o>-</span><span class=n>manager</span> <span class=n>v1</span><span class=o>.</span><span class=mf>7.1</span> <span class=n>has</span> <span class=n>been</span> <span class=n>deployed</span> <span class=n>successfully</span><span class=o>!</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>In</span> <span class=n>order</span> <span class=n>to</span> <span class=n>begin</span> <span class=n>issuing</span> <span class=n>certificates</span><span class=p>,</span> <span class=n>you</span> <span class=n>will</span> <span class=n>need</span> <span class=n>to</span> <span class=n>set</span> <span class=n>up</span> <span class=n>a</span> <span class=n>ClusterIssuer</span>
</span></span><span class=line><span class=cl><span class=ow>or</span> <span class=n>Issuer</span> <span class=n>resource</span> <span class=p>(</span><span class=k>for</span> <span class=n>example</span><span class=p>,</span> <span class=n>by</span> <span class=n>creating</span> <span class=n>a</span> <span class=s1>&#39;letsencrypt-staging&#39;</span> <span class=n>issuer</span><span class=p>)</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>More</span> <span class=n>information</span> <span class=n>on</span> <span class=n>the</span> <span class=n>different</span> <span class=n>types</span> <span class=n>of</span> <span class=n>issuers</span> <span class=ow>and</span> <span class=n>how</span> <span class=n>to</span> <span class=n>configure</span> <span class=n>them</span>
</span></span><span class=line><span class=cl><span class=n>can</span> <span class=n>be</span> <span class=n>found</span> <span class=ow>in</span> <span class=n>our</span> <span class=n>documentation</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>.</span><span class=n>io</span><span class=o>/</span><span class=n>docs</span><span class=o>/</span><span class=n>configuration</span><span class=o>/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>For</span> <span class=n>information</span> <span class=n>on</span> <span class=n>how</span> <span class=n>to</span> <span class=n>configure</span> <span class=n>cert</span><span class=o>-</span><span class=n>manager</span> <span class=n>to</span> <span class=n>automatically</span> <span class=n>provision</span>
</span></span><span class=line><span class=cl><span class=n>Certificates</span> <span class=k>for</span> <span class=n>Ingress</span> <span class=n>resources</span><span class=p>,</span> <span class=n>take</span> <span class=n>a</span> <span class=n>look</span> <span class=n>at</span> <span class=n>the</span> <span class=err>`</span><span class=n>ingress</span><span class=o>-</span><span class=n>shim</span><span class=err>`</span>
</span></span><span class=line><span class=cl><span class=n>documentation</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>.</span><span class=n>io</span><span class=o>/</span><span class=n>docs</span><span class=o>/</span><span class=n>usage</span><span class=o>/</span><span class=n>ingress</span><span class=o>/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rms</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>kubectl</span> <span class=n>get</span> <span class=n>pods</span> <span class=o>--</span><span class=n>namespace</span> <span class=n>cert</span><span class=o>-</span><span class=n>manager</span>
</span></span><span class=line><span class=cl><span class=n>NAME</span>                                     <span class=n>READY</span>   <span class=n>STATUS</span>    <span class=n>RESTARTS</span>   <span class=n>AGE</span>
</span></span><span class=line><span class=cl><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>-</span><span class=mi>76</span><span class=n>d44b459c</span><span class=o>-</span><span class=n>xnr7q</span>            <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>75</span><span class=n>s</span>
</span></span><span class=line><span class=cl><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>-</span><span class=n>cainjector</span><span class=o>-</span><span class=mi>9</span><span class=n>b679cc6</span><span class=o>-</span><span class=mi>8</span><span class=n>lk2m</span>   <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>75</span><span class=n>s</span>
</span></span><span class=line><span class=cl><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>-</span><span class=n>webhook</span><span class=o>-</span><span class=mi>57</span><span class=n>c994b6b9</span><span class=o>-</span><span class=n>hssn2</span>    <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>75</span><span class=n>s</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>å®‰è£Rancher</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~&gt; helm install rancher rancher-stable/rancher --namespace cattle-system --set hostname=rms.rancher.ken.lab --version 2.6.6
</span></span><span class=line><span class=cl>NAME: rancher
</span></span><span class=line><span class=cl>LAST DEPLOYED: Tue Oct 25 17:05:13 2022
</span></span><span class=line><span class=cl>NAMESPACE: cattle-system
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: 1
</span></span><span class=line><span class=cl>TEST SUITE: None
</span></span><span class=line><span class=cl>NOTES:
</span></span><span class=line><span class=cl>Rancher Server has been installed.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NOTE: Rancher may take several minutes to fully initialize. Please standby while Certificates are being issued, Containers are started and the Ingress rule comes up.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Check out our docs at https://rancher.com/docs/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>If you provided your own bootstrap password during installation, browse to https://rms.rancher.ken.lab to get started.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>If this is the first time you installed Rancher, get started by running this command and clicking the URL it generates:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>```
</span></span><span class=line><span class=cl>echo https://rms.rancher.ken.lab/dashboard/?setup=$(kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=&#39;{{.data.bootstrapPassword|base64decode}}&#39;)
</span></span><span class=line><span class=cl>```
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>To get just the bootstrap password on its own, run:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>```
</span></span><span class=line><span class=cl>kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=&#39;{{.data.bootstrapPassword|base64decode}}{{ &#34;\n&#34; }}&#39;
</span></span><span class=line><span class=cl>```
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Happy Containering!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-----
</span></span><span class=line><span class=cl>å¯†ç¢¼ï¼š
</span></span><span class=line><span class=cl>devop@rms:~&gt; kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=&#39;{{.data.bootstrapPassword|base64decode}}{{ &#34;\n&#34; }}&#39;
</span></span><span class=line><span class=cl>mc85v6z7s6tnfcrwpnd67pg4phlnnch64gwsd5gwkflsmt8bjqckgg
</span></span></code></pre></td></tr></table></div></div></li><li><p>ç€è¦½å™¨é€£ç·š <a class=link href=https://rms.rancher.ken.lab target=_blank rel=noopener>https://rms.rancher.ken.lab</a></p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221025170335200.png loading=lazy alt=image-20221025170335200></p></li><li><p>ç™»å…¥å¾Œä¿®æ”¹é è¨­å¯†ç¢¼
admin / rancheradmin
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221025170619277.png loading=lazy alt=image-20221025170619277></p></li><li><p>ç™»å…¥æ¸¬è©¦
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221025170758099.png loading=lazy alt=image-20221025170758099></p></li></ol><h2 id=å®‰è£rke2-2>å®‰è£RKE2-2</h2><ol><li>å®‰è£OS</li><li>èª¿æ•´DNS æŒ‡å‘192.168.33.40</li><li>é—œé–‰é˜²ç«ç‰†</li></ol><h3 id=å®‰è£rke2-3>å®‰è£RKE2</h3><ol><li><p>ä¸‹è¼‰install.sh</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rke2-2:~&gt; curl -sfL https://get.rke2.io --output install.sh
</span></span><span class=line><span class=cl>devop@rke2-2:~&gt; chmod +x install.sh
</span></span></code></pre></td></tr></table></div></div></li><li><p>æ–°å¢è¨­å®šæª”</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rke2-2:~&gt; sudo mkdir -p /etc/rancher/rke2/
</span></span><span class=line><span class=cl>[sudo] root çš„å¯†ç¢¼ï¼š
</span></span><span class=line><span class=cl>devop@rke2-2:~&gt; sudo vim /etc/rancher/rke2/config.yaml
</span></span><span class=line><span class=cl>server: https://rms.rancher.ken.lab:9345
</span></span><span class=line><span class=cl>node-name:
</span></span><span class=line><span class=cl>  - &#34;rke2-2&#34;
</span></span><span class=line><span class=cl>token: my-shared-secret
</span></span><span class=line><span class=cl>tls-san:
</span></span><span class=line><span class=cl>  - rms.rancher.ken.lab
</span></span></code></pre></td></tr></table></div></div></li><li><p>å®‰è£rke2</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rke2-2:~&gt; sudo INSTALL_RKE2_CHANNEL=v1.23.9+rke2r1 ./install.sh
</span></span></code></pre></td></tr></table></div></div></li><li><p>å•Ÿå‹•æœå‹™</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rke2</span><span class=o>-</span><span class=mi>2</span><span class=p>:</span><span class=o>~&gt;</span> <span class=k>export</span> <span class=n>PATH</span><span class=o>=$</span><span class=n>PATH</span><span class=p>:</span><span class=o>/</span><span class=n>opt</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>bin</span>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rke2</span><span class=o>-</span><span class=mi>2</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>sudo</span> <span class=n>systemctl</span> <span class=n>enable</span> <span class=n>rke2</span><span class=o>-</span><span class=n>server</span> <span class=o>--</span><span class=n>now</span>
</span></span><span class=line><span class=cl><span class=n>Created</span> <span class=n>symlink</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>systemd</span><span class=o>/</span><span class=n>system</span><span class=o>/</span><span class=n>multi</span><span class=o>-</span><span class=n>user</span><span class=o>.</span><span class=n>target</span><span class=o>.</span><span class=n>wants</span><span class=o>/</span><span class=n>rke2</span><span class=o>-</span><span class=n>server</span><span class=o>.</span><span class=n>service</span> <span class=err>â†’</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>systemd</span><span class=o>/</span><span class=n>system</span><span class=o>/</span><span class=n>rke2</span><span class=o>-</span><span class=n>server</span><span class=o>.</span><span class=n>service</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rke2</span><span class=o>-</span><span class=mi>2</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>systemctl</span> <span class=n>status</span> <span class=n>rke2</span><span class=o>-</span><span class=n>server</span><span class=o>.</span><span class=n>service</span>
</span></span><span class=line><span class=cl><span class=err>â—</span> <span class=n>rke2</span><span class=o>-</span><span class=n>server</span><span class=o>.</span><span class=n>service</span> <span class=o>-</span> <span class=n>Rancher</span> <span class=n>Kubernetes</span> <span class=n>Engine</span> <span class=n>v2</span> <span class=p>(</span><span class=n>server</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=n>Loaded</span><span class=p>:</span> <span class=n>loaded</span> <span class=p>(</span><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>systemd</span><span class=o>/</span><span class=n>system</span><span class=o>/</span><span class=n>rke2</span><span class=o>-</span><span class=n>server</span><span class=o>.</span><span class=n>service</span><span class=p>;</span> <span class=n>enabled</span><span class=p>;</span> <span class=n>vendor</span> <span class=n>preset</span><span class=p>:</span> <span class=n>disabled</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=n>Active</span><span class=p>:</span> <span class=n>active</span> <span class=p>(</span><span class=n>running</span><span class=p>)</span> <span class=n>since</span> <span class=n>Tue</span> <span class=mi>2022</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>25</span> <span class=mi>17</span><span class=p>:</span><span class=mi>53</span><span class=p>:</span><span class=mi>05</span> <span class=n>CST</span><span class=p>;</span> <span class=mi>17</span><span class=nb>min</span> <span class=n>ago</span>
</span></span><span class=line><span class=cl>       <span class=n>Docs</span><span class=p>:</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=c1>#readme</span>
</span></span><span class=line><span class=cl>    <span class=n>Process</span><span class=p>:</span> <span class=mi>5602</span> <span class=n>ExecStartPre</span><span class=o>=/</span><span class=n>bin</span><span class=o>/</span><span class=n>sh</span> <span class=o>-</span><span class=n>xc</span> <span class=o>!</span> <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>systemctl</span> <span class=n>is</span><span class=o>-</span><span class=n>enabled</span> <span class=o>--</span><span class=n>quiet</span> <span class=n>nm</span><span class=o>-</span><span class=n>cloud</span><span class=o>-</span><span class=n>setup</span><span class=o>.</span><span class=n>service</span> <span class=p>(</span><span class=n>code</span><span class=o>=</span><span class=n>exited</span><span class=p>,</span> <span class=n>status</span><span class=o>=</span><span class=mi>0</span><span class=o>/</span><span class=n>SUCCESS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>Process</span><span class=p>:</span> <span class=mi>5604</span> <span class=n>ExecStartPre</span><span class=o>=/</span><span class=n>sbin</span><span class=o>/</span><span class=n>modprobe</span> <span class=n>br_netfilter</span> <span class=p>(</span><span class=n>code</span><span class=o>=</span><span class=n>exited</span><span class=p>,</span> <span class=n>status</span><span class=o>=</span><span class=mi>0</span><span class=o>/</span><span class=n>SUCCESS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>Process</span><span class=p>:</span> <span class=mi>5605</span> <span class=n>ExecStartPre</span><span class=o>=/</span><span class=n>sbin</span><span class=o>/</span><span class=n>modprobe</span> <span class=n>overlay</span> <span class=p>(</span><span class=n>code</span><span class=o>=</span><span class=n>exited</span><span class=p>,</span> <span class=n>status</span><span class=o>=</span><span class=mi>0</span><span class=o>/</span><span class=n>SUCCESS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=n>Main</span> <span class=n>PID</span><span class=p>:</span> <span class=mi>5606</span> <span class=p>(</span><span class=n>rke2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>Tasks</span><span class=p>:</span> <span class=mi>148</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>åˆ‡æ›åˆ°RMS ç¢ºèªnodesç‹€æ…‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~&gt; kubectl get nodes
</span></span><span class=line><span class=cl>NAME     STATUS   ROLES                       AGE   VERSION
</span></span><span class=line><span class=cl>rke2-1   Ready    control-plane,etcd,master   81m   v1.23.9+rke2r1
</span></span><span class=line><span class=cl>rke2-2   Ready    control-plane,etcd,master   17m   v1.23.9+rke2r1
</span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=å®‰è£rke-2-3>å®‰è£RKE 2-3</h2><ol><li>å®‰è£OS</li><li>èª¿æ•´DNS æŒ‡å‘192.168.33.40</li><li>é—œé–‰é˜²ç«ç‰†</li></ol><h3 id=å®‰è£rke2-4>å®‰è£RKE2</h3><ol><li><p>ä¸‹è¼‰install.sh</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rke2-3:~&gt; curl -sfL https://get.rke2.io --output install.sh
</span></span><span class=line><span class=cl>devop@rke2-3:~&gt; chmod +x install.sh
</span></span></code></pre></td></tr></table></div></div></li><li><p>æ–°å¢è¨­å®šæª”</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rke2-3:~&gt; sudo mkdir -p /etc/rancher/rke2/
</span></span><span class=line><span class=cl>[sudo] root çš„å¯†ç¢¼ï¼š
</span></span><span class=line><span class=cl>devop@rke2-3:~&gt; sudo vim /etc/rancher/rke2/config.yaml
</span></span><span class=line><span class=cl>server: https://rms.rancher.ken.lab:9345
</span></span><span class=line><span class=cl>node-name:
</span></span><span class=line><span class=cl>  - &#34;rke2-3&#34;
</span></span><span class=line><span class=cl>token: my-shared-secret
</span></span><span class=line><span class=cl>tls-san:
</span></span><span class=line><span class=cl>  - rms.rancher.ken.lab
</span></span></code></pre></td></tr></table></div></div></li><li><p>å®‰è£rke2</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rke2</span><span class=o>-</span><span class=mi>3</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>sudo</span> <span class=n>INSTALL_RKE2_CHANNEL</span><span class=o>=</span><span class=n>v1</span><span class=o>.</span><span class=mf>23.9</span><span class=o>+</span><span class=n>rke2r1</span> <span class=o>./</span><span class=n>install</span><span class=o>.</span><span class=n>sh</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>WARN</span><span class=p>]</span>  <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>local</span> <span class=n>is</span> <span class=n>read</span><span class=o>-</span><span class=n>only</span> <span class=ow>or</span> <span class=n>a</span> <span class=n>mount</span> <span class=n>point</span><span class=p>;</span> <span class=n>installing</span> <span class=n>to</span> <span class=o>/</span><span class=n>opt</span><span class=o>/</span><span class=n>rke2</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>INFO</span><span class=p>]</span>  <span class=n>finding</span> <span class=n>release</span> <span class=k>for</span> <span class=n>channel</span> <span class=n>v1</span><span class=o>.</span><span class=mf>23.9</span><span class=o>+</span><span class=n>rke2r1</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>INFO</span><span class=p>]</span>  <span class=n>using</span> <span class=n>v1</span><span class=o>.</span><span class=mf>23.9</span><span class=o>+</span><span class=n>rke2r1</span> <span class=n>as</span> <span class=n>release</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>INFO</span><span class=p>]</span>  <span class=n>downloading</span> <span class=n>checksums</span> <span class=n>at</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>releases</span><span class=o>/</span><span class=n>download</span><span class=o>/</span><span class=n>v1</span><span class=o>.</span><span class=mf>23.9</span><span class=o>+</span><span class=n>rke2r1</span><span class=o>/</span><span class=n>sha256sum</span><span class=o>-</span><span class=n>amd64</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>INFO</span><span class=p>]</span>  <span class=n>downloading</span> <span class=n>tarball</span> <span class=n>at</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>releases</span><span class=o>/</span><span class=n>download</span><span class=o>/</span><span class=n>v1</span><span class=o>.</span><span class=mf>23.9</span><span class=o>+</span><span class=n>rke2r1</span><span class=o>/</span><span class=n>rke2</span><span class=o>.</span><span class=n>linux</span><span class=o>-</span><span class=n>amd64</span><span class=o>.</span><span class=n>tar</span><span class=o>.</span><span class=n>gz</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>INFO</span><span class=p>]</span>  <span class=n>verifying</span> <span class=n>tarball</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>INFO</span><span class=p>]</span>  <span class=n>unpacking</span> <span class=n>tarball</span> <span class=n>file</span> <span class=n>to</span> <span class=o>/</span><span class=n>opt</span><span class=o>/</span><span class=n>rke2</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>INFO</span><span class=p>]</span>  <span class=n>updating</span> <span class=n>tarball</span> <span class=n>contents</span> <span class=n>to</span> <span class=n>reflect</span> <span class=n>install</span> <span class=n>path</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>INFO</span><span class=p>]</span>  <span class=n>moving</span> <span class=n>systemd</span> <span class=n>units</span> <span class=n>to</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>systemd</span><span class=o>/</span><span class=n>system</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>INFO</span><span class=p>]</span>  <span class=n>install</span> <span class=n>complete</span><span class=p>;</span> <span class=n>you</span> <span class=n>may</span> <span class=n>want</span> <span class=n>to</span> <span class=n>run</span><span class=p>:</span>  <span class=k>export</span> <span class=n>PATH</span><span class=o>=$</span><span class=n>PATH</span><span class=p>:</span><span class=o>/</span><span class=n>opt</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>bin</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>å•Ÿå‹•æœå‹™</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rke2</span><span class=o>-</span><span class=mi>3</span><span class=p>:</span><span class=o>~&gt;</span> <span class=k>export</span> <span class=n>PATH</span><span class=o>=$</span><span class=n>PATH</span><span class=p>:</span><span class=o>/</span><span class=n>opt</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>bin</span>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rke2</span><span class=o>-</span><span class=mi>3</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>sudo</span> <span class=n>systemctl</span> <span class=n>enable</span> <span class=n>rke2</span><span class=o>-</span><span class=n>server</span> <span class=o>--</span><span class=n>now</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>åˆ‡æ›åˆ°RMS ç¢ºèªNodes</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~&gt; kubectl get nodes
</span></span><span class=line><span class=cl>NAME     STATUS   ROLES                       AGE   VERSION
</span></span><span class=line><span class=cl>rke2-1   Ready    control-plane,etcd,master   91m   v1.23.9+rke2r1
</span></span><span class=line><span class=cl>rke2-2   Ready    control-plane,etcd,master   27m   v1.23.9+rke2r1
</span></span><span class=line><span class=cl>rke2-3   Ready    control-plane,etcd,master   58s   v1.23.9+rke2r1
</span></span></code></pre></td></tr></table></div></div><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221025181826167.png loading=lazy alt=image-20221025181826167></p></li></ol><h1 id=æ–°å¢down-stream-k8s>æ–°å¢Down Stream K8s</h1><h2 id=æ¶æ§‹-å»ºè­°ç”¨v124ä»¥ä¸Š>æ¶æ§‹ å»ºè­°ç”¨v1.24ä»¥ä¸Š</h2><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221026120534677.png loading=lazy alt=image-20221026120534677></p><h2 id=ä½œæ¥­ç³»çµ±èˆ‡å®‰è£dokcer>ä½œæ¥­ç³»çµ±èˆ‡å®‰è£Dokcer</h2><p>è¦é—œé–‰é˜²ç«ç‰†ã€å®‰è£Docker (ç”¨RKE2 ä¸ç”¨å®‰è£Docker)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>éœ€å…ˆè¨»å†Šç³»çµ±æˆ–æ˜¯è¨­å®šrepo</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>devop</span><span class=err>@</span><span class=nx>master01</span><span class=p>:~&gt;</span> <span class=nx>sudo</span> <span class=nx>SUSEConnect</span> <span class=o>-</span><span class=nx>p</span> <span class=nx>sle</span><span class=o>-</span><span class=nx>module</span><span class=o>-</span><span class=nx>containers</span><span class=o>/</span><span class=mf>15.4</span><span class=o>/</span><span class=nx>x86_64</span>
</span></span><span class=line><span class=cl><span class=nx>Registering</span> <span class=nx>system</span> <span class=nx>to</span> <span class=nx>SUSE</span> <span class=nx>Customer</span> <span class=nx>Center</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Updating</span> <span class=nx>system</span> <span class=nx>details</span> <span class=nx>on</span> <span class=nx>https</span><span class=p>:</span><span class=c1>//scc.suse.com ...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Activating</span> <span class=nx>sle</span><span class=o>-</span><span class=nx>module</span><span class=o>-</span><span class=nx>containers</span> <span class=mf>15.4</span> <span class=nx>x86_64</span> <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=p>&gt;</span> <span class=nx>Adding</span> <span class=nx>service</span> <span class=nx>to</span> <span class=nx>system</span> <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=p>&gt;</span> <span class=nx>Installing</span> <span class=nx>release</span> <span class=kn>package</span> <span class=o>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Successfully</span> <span class=nx>registered</span> <span class=nx>system</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>devop</span><span class=err>@</span><span class=nx>master01</span><span class=p>:~&gt;</span> <span class=nx>sudo</span> <span class=nx>zypper</span> <span class=o>-</span><span class=nx>n</span> <span class=nx>install</span> <span class=nx>docker</span>
</span></span><span class=line><span class=cl><span class=nx>æ­£åœ¨é‡æ–°æ•´ç†æœå‹™</span> <span class=err>&#39;</span><span class=nx>Basesystem_Module_15_SP4_x86_64</span><span class=err>&#39;ã€‚</span>
</span></span><span class=line><span class=cl><span class=nx>æ­£åœ¨é‡æ–°æ•´ç†æœå‹™</span> <span class=err>&#39;</span><span class=nx>Containers_Module_15_SP4_x86_64</span><span class=err>&#39;ã€‚</span>
</span></span><span class=line><span class=cl><span class=nx>æ­£åœ¨é‡æ–°æ•´ç†æœå‹™</span> <span class=err>&#39;</span><span class=nx>SUSE_Linux_Enterprise_Server_15_SP4_x86_64</span><span class=err>&#39;ã€‚</span>
</span></span><span class=line><span class=cl><span class=nx>æ­£åœ¨é‡æ–°æ•´ç†æœå‹™</span> <span class=err>&#39;</span><span class=nx>Server_Applications_Module_15_SP4_x86_64</span><span class=err>&#39;ã€‚</span>
</span></span><span class=line><span class=cl><span class=nx>æ­£åœ¨è¼‰å…¥å¥—ä»¶åº«è³‡æ–™</span><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=nx>æ­£åœ¨è®€å–å·²å®‰è£çš„å¥—ä»¶</span><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=nx>æ­£åœ¨è§£æ±ºå¥—ä»¶ç›¸ä¾æ€§</span><span class=o>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>ä¸‹åˆ—</span> <span class=mi>1</span> <span class=nx>å€‹æ¨è–¦çš„å¥—ä»¶å·²è‡ªå‹•è¢«é¸å–</span><span class=err>ï¼š</span>
</span></span><span class=line><span class=cl>  <span class=nx>git</span><span class=o>-</span><span class=nx>core</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>å°‡æœƒå®‰è£ä¸‹åˆ—</span> <span class=mi>7</span> <span class=nx>å€‹æ–°çš„å¥—ä»¶</span><span class=err>ï¼š</span>
</span></span><span class=line><span class=cl>  <span class=nx>catatonit</span> <span class=nx>containerd</span> <span class=nx>docker</span> <span class=nx>docker</span><span class=o>-</span><span class=nx>bash</span><span class=o>-</span><span class=nx>completion</span> <span class=nx>git</span><span class=o>-</span><span class=nx>core</span> <span class=nx>libsha1detectcoll1</span> <span class=nx>runc</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>7</span> <span class=nx>è¦å®‰è£çš„æ–°å¥—ä»¶</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>å…¨éƒ¨ä¸‹è¼‰å¤§å°</span><span class=err>ï¼š</span><span class=mf>52.2</span> <span class=nx>MiB</span><span class=err>ã€‚</span><span class=nx>å·²å¿«å–</span><span class=err>ï¼š</span><span class=mi>0</span> <span class=nx>B</span><span class=err>ã€‚</span> <span class=nx>å®Œæˆæ“ä½œå¾Œ</span><span class=err>ï¼Œ</span><span class=nx>å°‡ä½¿ç”¨é¡å¤–çš„</span> <span class=mf>242.1</span> <span class=nx>MiB</span><span class=err>ã€‚</span>
</span></span><span class=line><span class=cl><span class=nx>è¦ç¹¼çºŒå—</span><span class=err>ï¼Ÿ</span> <span class=p>[</span><span class=nx>y</span><span class=o>/</span><span class=nx>n</span><span class=o>/</span><span class=nx>v</span><span class=o>/...</span><span class=err>?</span> <span class=nx>é¡¯ç¤ºæ‰€æœ‰é¸é …</span><span class=p>]</span> <span class=p>(</span><span class=nx>y</span><span class=p>):</span> <span class=nx>y</span>
</span></span><span class=line><span class=cl><span class=nx>æ­£åœ¨å–å‡º</span> <span class=nx>å¥—ä»¶</span> <span class=nx>libsha1detectcoll1</span><span class=o>-</span><span class=mf>1.0.3</span><span class=o>-</span><span class=mf>2.18</span><span class=p>.</span><span class=nf>x86_64</span>                <span class=p>(</span><span class=mi>1</span><span class=o>/</span><span class=mi>7</span><span class=p>),</span>  <span class=mf>23.2</span> <span class=nf>KiB</span> <span class=p>(</span><span class=nx>å·²è§£é–‹</span>  <span class=mf>45.8</span> <span class=nx>KiB</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>æ­£åœ¨å–å›</span><span class=err>ï¸°</span> <span class=nx>libsha1detectcoll1</span><span class=o>-</span><span class=mf>1.0.3</span><span class=o>-</span><span class=mf>2.18</span><span class=p>.</span><span class=nx>x86_64</span><span class=p>.</span><span class=nx>rpm</span> <span class=o>..........................................</span><span class=p>.[</span><span class=nx>å®Œæˆ</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>æ­£åœ¨å–å‡º</span> <span class=nx>å¥—ä»¶</span> <span class=nx>catatonit</span><span class=o>-</span><span class=mf>0.1.5</span><span class=o>-</span><span class=mf>3.3.2</span><span class=p>.</span><span class=nf>x86_64</span>                        <span class=p>(</span><span class=mi>2</span><span class=o>/</span><span class=mi>7</span><span class=p>),</span> <span class=mf>257.2</span> <span class=nf>KiB</span> <span class=p>(</span><span class=nx>å·²è§£é–‹</span> <span class=mf>696.5</span> <span class=nx>KiB</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>æ­£åœ¨å–å›</span><span class=err>ï¸°</span> <span class=nx>catatonit</span><span class=o>-</span><span class=mf>0.1.5</span><span class=o>-</span><span class=mf>3.3.2</span><span class=p>.</span><span class=nx>x86_64</span><span class=p>.</span><span class=nx>rpm</span> <span class=o>...................................................</span><span class=p>[</span><span class=nx>å®Œæˆ</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>æ­£åœ¨å–å‡º</span> <span class=nx>å¥—ä»¶</span> <span class=nx>runc</span><span class=o>-</span><span class=mf>1.1.4</span><span class=o>-</span><span class=mf>150000.33.4</span><span class=p>.</span><span class=nf>x86_64</span>                       <span class=p>(</span><span class=mi>3</span><span class=o>/</span><span class=mi>7</span><span class=p>),</span>   <span class=mf>2.6</span> <span class=nf>MiB</span> <span class=p>(</span><span class=nx>å·²è§£é–‹</span>   <span class=mf>9.1</span> <span class=nx>MiB</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>æ­£åœ¨å–å›</span><span class=err>ï¸°</span> <span class=nx>runc</span><span class=o>-</span><span class=mf>1.1.4</span><span class=o>-</span><span class=mf>150000.33.4</span><span class=p>.</span><span class=nx>x86_64</span><span class=p>.</span><span class=nx>rpm</span> <span class=o>....................................</span><span class=p>[</span><span class=nx>å®Œæˆ</span> <span class=p>(</span><span class=mf>288.0</span> <span class=nx>KiB</span><span class=o>/</span><span class=nx>s</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=nx>æ­£åœ¨å–å‡º</span> <span class=nx>å¥—ä»¶</span> <span class=nx>containerd</span><span class=o>-</span><span class=mf>1.6.6</span><span class=o>-</span><span class=mf>150000.73.2</span><span class=p>.</span><span class=nf>x86_64</span>                 <span class=p>(</span><span class=mi>4</span><span class=o>/</span><span class=mi>7</span><span class=p>),</span>  <span class=mf>17.7</span> <span class=nf>MiB</span> <span class=p>(</span><span class=nx>å·²è§£é–‹</span>  <span class=mf>74.2</span> <span class=nx>MiB</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>æ­£åœ¨å–å›</span><span class=err>ï¸°</span> <span class=nx>containerd</span><span class=o>-</span><span class=mf>1.6.6</span><span class=o>-</span><span class=mf>150000.73.2</span><span class=p>.</span><span class=nx>x86_64</span><span class=p>.</span><span class=nx>rpm</span> <span class=o>..............................</span><span class=p>..[</span><span class=nx>å®Œæˆ</span> <span class=p>(</span><span class=mf>3.6</span> <span class=nx>MiB</span><span class=o>/</span><span class=nx>s</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=nx>æ­£åœ¨å–å‡º</span> <span class=nx>å¥—ä»¶</span> <span class=nx>git</span><span class=o>-</span><span class=nx>core</span><span class=o>-</span><span class=mf>2.35.3</span><span class=o>-</span><span class=mf>150300.10.15.1</span><span class=p>.</span><span class=nf>x86_64</span>               <span class=p>(</span><span class=mi>5</span><span class=o>/</span><span class=mi>7</span><span class=p>),</span>   <span class=mf>4.8</span> <span class=nf>MiB</span> <span class=p>(</span><span class=nx>å·²è§£é–‹</span>  <span class=mf>26.6</span> <span class=nx>MiB</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>æ­£åœ¨å–å›</span><span class=err>ï¸°</span> <span class=nx>git</span><span class=o>-</span><span class=nx>core</span><span class=o>-</span><span class=mf>2.35.3</span><span class=o>-</span><span class=mf>150300.10.15.1</span><span class=p>.</span><span class=nx>x86_64</span><span class=p>.</span><span class=nx>rpm</span> <span class=o>..........................................</span><span class=p>[</span><span class=nx>å®Œæˆ</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>æ­£åœ¨å–å‡º</span> <span class=nx>å¥—ä»¶</span> <span class=nx>docker</span><span class=o>-</span><span class=mf>20.10.17</span><span class=nx>_ce</span><span class=o>-</span><span class=mf>150000.166.1</span><span class=p>.</span><span class=nf>x86_64</span>              <span class=p>(</span><span class=mi>6</span><span class=o>/</span><span class=mi>7</span><span class=p>),</span>  <span class=mf>26.6</span> <span class=nf>MiB</span> <span class=p>(</span><span class=nx>å·²è§£é–‹</span> <span class=mf>131.4</span> <span class=nx>MiB</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>æ­£åœ¨å–å›</span><span class=err>ï¸°</span> <span class=nx>docker</span><span class=o>-</span><span class=mf>20.10.17</span><span class=nx>_ce</span><span class=o>-</span><span class=mf>150000.166.1</span><span class=p>.</span><span class=nx>x86_64</span><span class=p>.</span><span class=nx>rpm</span> <span class=o>...........................</span><span class=p>..[</span><span class=nx>å®Œæˆ</span> <span class=p>(</span><span class=mf>7.9</span> <span class=nx>MiB</span><span class=o>/</span><span class=nx>s</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=nx>æ­£åœ¨å–å‡º</span> <span class=nx>å¥—ä»¶</span> <span class=nx>docker</span><span class=o>-</span><span class=nx>bash</span><span class=o>-</span><span class=nx>completion</span><span class=o>-</span><span class=mf>20.10.17</span><span class=nx>_ce</span><span class=o>-</span><span class=mf>150000.166.1</span><span class=p>.</span><span class=nf>noarch</span>
</span></span><span class=line><span class=cl>                                                                  <span class=p>(</span><span class=mi>7</span><span class=o>/</span><span class=mi>7</span><span class=p>),</span> <span class=mf>121.3</span> <span class=nf>KiB</span> <span class=p>(</span><span class=nx>å·²è§£é–‹</span> <span class=mf>113.6</span> <span class=nx>KiB</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>æ­£åœ¨å–å›</span><span class=err>ï¸°</span> <span class=nx>docker</span><span class=o>-</span><span class=nx>bash</span><span class=o>-</span><span class=nx>completion</span><span class=o>-</span><span class=mf>20.10.17</span><span class=nx>_ce</span><span class=o>-</span><span class=mf>150000.166.1</span><span class=p>.</span><span class=nx>noarch</span><span class=p>.</span><span class=nx>rpm</span> <span class=o>........................</span><span class=p>.[</span><span class=nx>å®Œæˆ</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>æ­£åœ¨æª¢æŸ¥æª”æ¡ˆè¡çª</span><span class=err>ï¼š</span> <span class=o>...........................................................................</span><span class=p>.[</span><span class=nx>å®Œæˆ</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=mi>1</span><span class=o>/</span><span class=mi>7</span><span class=p>)</span> <span class=nx>æ­£åœ¨å®‰è£</span><span class=err>ï¼š</span><span class=nx>libsha1detectcoll1</span><span class=o>-</span><span class=mf>1.0.3</span><span class=o>-</span><span class=mf>2.18</span><span class=p>.</span><span class=nx>x86_64</span> <span class=o>..........................................</span><span class=p>[</span><span class=nx>å®Œæˆ</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=mi>2</span><span class=o>/</span><span class=mi>7</span><span class=p>)</span> <span class=nx>æ­£åœ¨å®‰è£</span><span class=err>ï¼š</span><span class=nx>catatonit</span><span class=o>-</span><span class=mf>0.1.5</span><span class=o>-</span><span class=mf>3.3.2</span><span class=p>.</span><span class=nx>x86_64</span> <span class=o>................................................</span><span class=p>..[</span><span class=nx>å®Œæˆ</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=mi>3</span><span class=o>/</span><span class=mi>7</span><span class=p>)</span> <span class=nx>æ­£åœ¨å®‰è£</span><span class=err>ï¼š</span><span class=nx>runc</span><span class=o>-</span><span class=mf>1.1.4</span><span class=o>-</span><span class=mf>150000.33.4</span><span class=p>.</span><span class=nx>x86_64</span> <span class=o>................................................</span><span class=p>.[</span><span class=nx>å®Œæˆ</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=mi>4</span><span class=o>/</span><span class=mi>7</span><span class=p>)</span> <span class=nx>æ­£åœ¨å®‰è£</span><span class=err>ï¼š</span><span class=nx>containerd</span><span class=o>-</span><span class=mf>1.6.6</span><span class=o>-</span><span class=mf>150000.73.2</span><span class=p>.</span><span class=nx>x86_64</span> <span class=o>..........................................</span><span class=p>.[</span><span class=nx>å®Œæˆ</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=mi>5</span><span class=o>/</span><span class=mi>7</span><span class=p>)</span> <span class=nx>æ­£åœ¨å®‰è£</span><span class=err>ï¼š</span><span class=nx>git</span><span class=o>-</span><span class=nx>core</span><span class=o>-</span><span class=mf>2.35.3</span><span class=o>-</span><span class=mf>150300.10.15.1</span><span class=p>.</span><span class=nx>x86_64</span> <span class=o>.......................................</span><span class=p>..[</span><span class=nx>å®Œæˆ</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>Updating</span> <span class=o>/</span><span class=nx>etc</span><span class=o>/</span><span class=nx>sysconfig</span><span class=o>/</span><span class=nx>docker</span> <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=mi>6</span><span class=o>/</span><span class=mi>7</span><span class=p>)</span> <span class=nx>æ­£åœ¨å®‰è£</span><span class=err>ï¼š</span><span class=nx>docker</span><span class=o>-</span><span class=mf>20.10.17</span><span class=nx>_ce</span><span class=o>-</span><span class=mf>150000.166.1</span><span class=p>.</span><span class=nx>x86_64</span> <span class=o>.......................................</span><span class=p>.[</span><span class=nx>å®Œæˆ</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=mi>7</span><span class=o>/</span><span class=mi>7</span><span class=p>)</span> <span class=nx>æ­£åœ¨å®‰è£</span><span class=err>ï¼š</span><span class=nx>docker</span><span class=o>-</span><span class=nx>bash</span><span class=o>-</span><span class=nx>completion</span><span class=o>-</span><span class=mf>20.10.17</span><span class=nx>_ce</span><span class=o>-</span><span class=mf>150000.166.1</span><span class=p>.</span><span class=nx>noarch</span> <span class=o>........................</span><span class=p>[</span><span class=nx>å®Œæˆ</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>---</span> <span class=nx>å•Ÿå‹•æœå‹™</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>devop</span><span class=err>@</span><span class=nx>master01</span><span class=p>:~&gt;</span> <span class=nx>sudo</span> <span class=nx>systemctl</span> <span class=nx>enable</span> <span class=nx>docker</span> <span class=o>--</span><span class=nx>now</span>
</span></span><span class=line><span class=cl><span class=nx>Created</span> <span class=nx>symlink</span> <span class=o>/</span><span class=nx>etc</span><span class=o>/</span><span class=nx>systemd</span><span class=o>/</span><span class=nx>system</span><span class=o>/</span><span class=nx>multi</span><span class=o>-</span><span class=nx>user</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>wants</span><span class=o>/</span><span class=nx>docker</span><span class=p>.</span><span class=nx>service</span> <span class=err>â†’</span> <span class=o>/</span><span class=nx>usr</span><span class=o>/</span><span class=nx>lib</span><span class=o>/</span><span class=nx>systemd</span><span class=o>/</span><span class=nx>system</span><span class=o>/</span><span class=nx>docker</span><span class=p>.</span><span class=nx>service</span><span class=p>.</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=å¾rancherç®¡ç†ä»‹é¢æ–°å¢cluster>å¾Rancherç®¡ç†ä»‹é¢æ–°å¢Cluster</h2><ol><li><p>é»é¸Create
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221026121450385.png loading=lazy alt=image-20221026121450385></p></li><li><p>é¸æ“‡Custom è¦æŠŠRKE2çš„é¸é …æ‰“å‹¾ æ‰å¯ä»¥é¸æ“‡RKE2
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221026121555947.png loading=lazy alt=image-20221026121555947>
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221027165708557.png loading=lazy alt=image-20221027165708557></p></li><li><p>å»ºç«‹åç¨±: DownStreamK8S ï¼Œå…¶ä»–Defaultå³å¯
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221026121636567.png loading=lazy alt=image-20221026121636567></p></li><li><p>é‡å°å„Nodeé¸æ“‡ä¸åŒçš„æŒ‡ä»¤-Master
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221026121758039.png loading=lazy alt=image-20221026121758039></p></li><li><p>ç›´æ¥è²¼åœ¨Master01ã€Master02ã€ï¼­aster03ä¸Š
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221026123232444.png loading=lazy alt=image-20221026123232444></p></li><li><p>é‡å°å„Nodeé¸æ“‡ä¸åŒçš„æŒ‡ä»¤-Master
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221026123846849.png loading=lazy alt=image-20221026123846849></p></li><li><p>ç›´æ¥è²¼åœ¨Woker01ã€Worker02
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221026123951429.png loading=lazy alt=image-20221026123951429></p></li><li><p>æŸ¥çœ‹Log
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221026124043002.png loading=lazy alt=image-20221026124043002>
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221026132912006.png loading=lazy alt=image-20221026132912006></p></li><li><p>æŸ¥çœ‹Clusterç‹€æ…‹
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221027134018550.png loading=lazy alt=image-20221027134018550></p></li></ol><h1 id=å®‰è£å¾Œçš„è¨­å®š>å®‰è£å¾Œçš„è¨­å®š</h1><h2 id=authentication-ldap>Authentication LDAP</h2><ol><li>é»åˆ°Users & Authentication
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221028173919721.png loading=lazy alt=image-20221028173919721></li><li>è¨­å®šåƒæ•¸ä¸¦Enable
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221028181954045.png loading=lazy alt=image-20221028181954045>
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221028174539292.png loading=lazy alt=image-20221028174539292>
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221028182009242.png loading=lazy alt=image-20221028182009242></li><li>æŒ‡å®šç‰¹å®šGroupå¯å­˜å–Rancher
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221028182709975.png loading=lazy alt=image-20221028182709975></li><li>ç™»å…¥æ¸¬è©¦
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221028182305555.png loading=lazy alt=image-20221028182305555></li><li>èª¿æ•´ç¾¤çµ„æ¬Šé™ Assign Global Roles
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221028182403843.png loading=lazy alt=image-20221028182403843></li><li>åŠ å…¥ranchersçš„ç¾¤çµ„ç‚ºAdministrator ä¸¦Save
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221028182450209.png loading=lazy alt=image-20221028182450209></li><li>ç¢ºèªæ¬Šé™
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221028182514532.png loading=lazy alt=image-20221028182514532></li></ol><h2 id=storageè¨­å®š>Storageè¨­å®š</h2><ol><li><p>åœ¨Local Clusterçš„infra projectå»ºç«‹rancher-nfs-storageçš„namespace
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221031171840318.png loading=lazy alt=image-20221031171840318></p></li><li><p>å»ºç«‹namespace
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221031172147900.png loading=lazy alt=image-20221031172147900></p></li><li><p>Storage Classçš„yaml</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~/config&gt; cat storageclass.yaml 
</span></span><span class=line><span class=cl>apiVersion: storage.k8s.io/v1
</span></span><span class=line><span class=cl>kind: StorageClass
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  annotations:
</span></span><span class=line><span class=cl>    # è¨­å®šç‚ºdefault StorageClassï¼Œå¦‚æœå»ºç«‹pvcæ™‚ä¸æŒ‡å®šStorageClassï¼Œå‰‡æœƒä½¿ç”¨ç•¶å‰çš„StorageClass
</span></span><span class=line><span class=cl>    storageclass.kubernetes.io/is-default-class: &#34;true&#34;
</span></span><span class=line><span class=cl>  name: default-nfs-storage
</span></span><span class=line><span class=cl>  namespace: rancher-nfs-storage
</span></span><span class=line><span class=cl>provisioner: provisioner-nfs # or choose another name, must match deployment&#39;s env PROVISIONER_NAME&#39;
</span></span><span class=line><span class=cl>parameters:
</span></span><span class=line><span class=cl>  # åˆªé™¤PVCæ™‚ä¸æœƒä¿ç•™è³‡æ–™
</span></span><span class=line><span class=cl>  archiveOnDelete: &#34;false&#34;
</span></span><span class=line><span class=cl># å›æ”¶ç­–ç•¥ï¼šåˆªé™¤
</span></span><span class=line><span class=cl>reclaimPolicy: Delete
</span></span><span class=line><span class=cl>#å…è¨±pvcå»ºç«‹å¾Œæ“´å®¹
</span></span><span class=line><span class=cl>allowVolumeExpansion: true 
</span></span></code></pre></td></tr></table></div></div></li><li><p>Deployment.yaml</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~/config&gt; cat deployment.yaml 
</span></span><span class=line><span class=cl>apiVersion: apps/v1
</span></span><span class=line><span class=cl>kind: Deployment
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: nfs-client-provisioner
</span></span><span class=line><span class=cl>  labels:
</span></span><span class=line><span class=cl>    app: nfs-client-provisioner
</span></span><span class=line><span class=cl>  # replace with namespace where provisioner is deployed
</span></span><span class=line><span class=cl>  namespace: rancher-nfs-storage
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  replicas: 1
</span></span><span class=line><span class=cl>  strategy:
</span></span><span class=line><span class=cl>    type: Recreate
</span></span><span class=line><span class=cl>  selector:
</span></span><span class=line><span class=cl>    matchLabels:
</span></span><span class=line><span class=cl>      app: nfs-client-provisioner
</span></span><span class=line><span class=cl>  template:
</span></span><span class=line><span class=cl>    metadata:
</span></span><span class=line><span class=cl>      labels:
</span></span><span class=line><span class=cl>        app: nfs-client-provisioner
</span></span><span class=line><span class=cl>    spec:
</span></span><span class=line><span class=cl>      serviceAccountName: nfs-client-provisioner
</span></span><span class=line><span class=cl>      containers:
</span></span><span class=line><span class=cl>        - name: nfs-client-provisioner
</span></span><span class=line><span class=cl>          image: k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2
</span></span><span class=line><span class=cl>          volumeMounts:
</span></span><span class=line><span class=cl>            - name: nfs-client-root
</span></span><span class=line><span class=cl>              mountPath: /persistentvolumes
</span></span><span class=line><span class=cl>          env:
</span></span><span class=line><span class=cl>            - name: PROVISIONER_NAME
</span></span><span class=line><span class=cl>              value: provisioner-nfs
</span></span><span class=line><span class=cl>            - name: NFS_SERVER
</span></span><span class=line><span class=cl>              value: 192.168.33.40
</span></span><span class=line><span class=cl>            - name: NFS_PATH
</span></span><span class=line><span class=cl>              value: /nfs
</span></span><span class=line><span class=cl>      volumes:
</span></span><span class=line><span class=cl>        - name: nfs-client-root
</span></span><span class=line><span class=cl>          nfs:
</span></span><span class=line><span class=cl>            server: 192.168.33.40
</span></span><span class=line><span class=cl>            path: /nfs
</span></span></code></pre></td></tr></table></div></div></li><li><p>rbac.yaml</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>kind: ServiceAccount
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: nfs-client-provisioner
</span></span><span class=line><span class=cl>  # replace with namespace where provisioner is deployed
</span></span><span class=line><span class=cl>  namespace: rancher-nfs-storage
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>kind: ClusterRole
</span></span><span class=line><span class=cl>apiVersion: rbac.authorization.k8s.io/v1
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: nfs-client-provisioner-runner
</span></span><span class=line><span class=cl>rules:
</span></span><span class=line><span class=cl>  - apiGroups: [&#34;&#34;]
</span></span><span class=line><span class=cl>    resources: [&#34;persistentvolumes&#34;]
</span></span><span class=line><span class=cl>    verbs: [&#34;get&#34;, &#34;list&#34;, &#34;watch&#34;, &#34;create&#34;, &#34;delete&#34;]
</span></span><span class=line><span class=cl>  - apiGroups: [&#34;&#34;]
</span></span><span class=line><span class=cl>    resources: [&#34;persistentvolumeclaims&#34;]
</span></span><span class=line><span class=cl>    verbs: [&#34;get&#34;, &#34;list&#34;, &#34;watch&#34;, &#34;update&#34;]
</span></span><span class=line><span class=cl>  - apiGroups: [&#34;storage.k8s.io&#34;]
</span></span><span class=line><span class=cl>    resources: [&#34;storageclasses&#34;]
</span></span><span class=line><span class=cl>    verbs: [&#34;get&#34;, &#34;list&#34;, &#34;watch&#34;]
</span></span><span class=line><span class=cl>  - apiGroups: [&#34;&#34;]
</span></span><span class=line><span class=cl>    resources: [&#34;events&#34;]
</span></span><span class=line><span class=cl>    verbs: [&#34;create&#34;, &#34;update&#34;, &#34;patch&#34;]
</span></span><span class=line><span class=cl>  - apiGroups: [&#34;&#34;]
</span></span><span class=line><span class=cl>    resources: [&#34;services&#34;, &#34;endpoints&#34;]
</span></span><span class=line><span class=cl>    verbs: [&#34;get&#34;,&#34;create&#34;,&#34;list&#34;, &#34;watch&#34;,&#34;update&#34;]
</span></span><span class=line><span class=cl>  - apiGroups: [&#34;extensions&#34;]
</span></span><span class=line><span class=cl>    resources: [&#34;podsecuritypolicies&#34;]
</span></span><span class=line><span class=cl>    resourceNames: [&#34;nfs-client-provisioner&#34;]
</span></span><span class=line><span class=cl>    verbs: [&#34;use&#34;]
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>kind: ClusterRoleBinding
</span></span><span class=line><span class=cl>apiVersion: rbac.authorization.k8s.io/v1
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: run-nfs-client-provisioner
</span></span><span class=line><span class=cl>subjects:
</span></span><span class=line><span class=cl>  - kind: ServiceAccount
</span></span><span class=line><span class=cl>    name: nfs-client-provisioner
</span></span><span class=line><span class=cl>    # replace with namespace where provisioner is deployed
</span></span><span class=line><span class=cl>    namespace: rancher-nfs-storage
</span></span><span class=line><span class=cl>roleRef:
</span></span><span class=line><span class=cl>  kind: ClusterRole
</span></span><span class=line><span class=cl>  name: nfs-client-provisioner-runner
</span></span><span class=line><span class=cl>  apiGroup: rbac.authorization.k8s.io
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>kind: Role
</span></span><span class=line><span class=cl>apiVersion: rbac.authorization.k8s.io/v1
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: leader-locking-nfs-client-provisioner
</span></span><span class=line><span class=cl>  # replace with namespace where provisioner is deployed
</span></span><span class=line><span class=cl>  namespace: rancher-nfs-storage
</span></span><span class=line><span class=cl>rules:
</span></span><span class=line><span class=cl>  - apiGroups: [&#34;&#34;]
</span></span><span class=line><span class=cl>    resources: [&#34;endpoints&#34;]
</span></span><span class=line><span class=cl>    verbs: [&#34;get&#34;, &#34;list&#34;, &#34;watch&#34;, &#34;create&#34;, &#34;update&#34;, &#34;patch&#34;]
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>kind: RoleBinding
</span></span><span class=line><span class=cl>apiVersion: rbac.authorization.k8s.io/v1
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: leader-locking-nfs-client-provisioner
</span></span><span class=line><span class=cl>  # replace with namespace where provisioner is deployed
</span></span><span class=line><span class=cl>  namespace: rancher-nfs-storage
</span></span><span class=line><span class=cl>subjects:
</span></span><span class=line><span class=cl>  - kind: ServiceAccount
</span></span><span class=line><span class=cl>    name: nfs-client-provisioner
</span></span><span class=line><span class=cl>    # replace with namespace where provisioner is deployed
</span></span><span class=line><span class=cl>    namespace: rancher-nfs-storage
</span></span><span class=line><span class=cl>roleRef:
</span></span><span class=line><span class=cl>  kind: Role
</span></span><span class=line><span class=cl>  name: leader-locking-nfs-client-provisioner
</span></span><span class=line><span class=cl>  apiGroup: rbac.authorization.k8s.io
</span></span></code></pre></td></tr></table></div></div></li><li><p>NFS Serverå…ˆè¨­å®šå¥½å¯é€£ç·šçš„ä¸»æ©Ÿ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=err>ç¯„ä¾‹ï¼š</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=err>@</span><span class=n>bastion</span> <span class=n>auth</span><span class=p>]</span><span class=c1># cat /etc/exports</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>data</span><span class=o>/</span><span class=n>nfsshare</span>	<span class=o>*</span><span class=p>(</span><span class=n>rw</span><span class=p>,</span><span class=n>sync</span><span class=p>,</span><span class=n>no_wdelay</span><span class=p>,</span><span class=n>no_root_squash</span><span class=p>,</span><span class=n>insecure</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rms</span><span class=p>:</span><span class=o>~/</span><span class=n>config</span><span class=o>&gt;</span> <span class=n>cat</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>exports</span> 
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>nfs</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>33.0</span><span class=o>/</span><span class=mf>255.255</span><span class=o>.</span><span class=mf>255.0</span><span class=p>(</span><span class=n>rw</span><span class=p>,</span><span class=n>sync</span><span class=p>,</span><span class=n>no_root_squash</span><span class=p>,</span><span class=n>insecure</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>å°‡rbac.yaml ã€storage class.yamlã€deployment.yamléƒ¨ç½²åˆ°rancher-nfs-storageçš„NSä¸Š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~/config&gt; kubectl create -f rbac.yaml -f storageclass.yaml -f deployment.yaml 
</span></span><span class=line><span class=cl>serviceaccount/nfs-client-provisioner created
</span></span><span class=line><span class=cl>clusterrole.rbac.authorization.k8s.io/nfs-client-provisioner-runner created
</span></span><span class=line><span class=cl>clusterrolebinding.rbac.authorization.k8s.io/run-nfs-client-provisioner created
</span></span><span class=line><span class=cl>role.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner created
</span></span><span class=line><span class=cl>rolebinding.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner created
</span></span><span class=line><span class=cl>storageclass.storage.k8s.io/default-nfs-storage created
</span></span><span class=line><span class=cl>deployment.apps/nfs-client-provisioner created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>devop@rms:~/nfs&gt; kubectl get all -n rancher-nfs-storage
</span></span><span class=line><span class=cl>NAME                                          READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod/nfs-client-provisioner-6b8787f55b-r4m4t   1/1     Running   0          5m19s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                     READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment.apps/nfs-client-provisioner   1/1     1            1           5m19s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                                DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>replicaset.apps/nfs-client-provisioner-6b8787f55b   1         1         1       5m19s
</span></span></code></pre></td></tr></table></div></div></li><li><p>æŸ¥çœ‹WebUIï¼Œç¢ºèªdeploymentã€StorageClass
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221108141107082.png loading=lazy alt=image-20221108141107082></p></li><li><p>æ–°å¢æ¸¬è©¦Claim ç¢ºèªç‹€æ…‹ç‚ºbound</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~/nfs&gt; cat test-claim.yaml 
</span></span><span class=line><span class=cl>kind: PersistentVolumeClaim
</span></span><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: test-claim
</span></span><span class=line><span class=cl>  annotations:
</span></span><span class=line><span class=cl>    #storageclass åç¨±
</span></span><span class=line><span class=cl>    volume.beta.kubernetes.io/storage-class: &#34;default-nfs-storage&#34;
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  #è¨ªå•æ¨¡å¼
</span></span><span class=line><span class=cl>  accessModes:
</span></span><span class=line><span class=cl>    - ReadWriteMany
</span></span><span class=line><span class=cl>  resources:
</span></span><span class=line><span class=cl>    requests:
</span></span><span class=line><span class=cl>      #è«‹æ±‚è³‡æ–™å¤§å°
</span></span><span class=line><span class=cl>      storage: 1024Mi
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>devop@rms:~/nfs&gt; kubectl create -f test-claim.yaml
</span></span><span class=line><span class=cl>persistentvolumeclaim/test-claim created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>devop@rms:~/nfs&gt; kubectl get pv,pvc
</span></span><span class=line><span class=cl>NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                STORAGECLASS          REASON   AGE
</span></span><span class=line><span class=cl>persistentvolume/pvc-f058cf4a-cc7b-4e44-97c3-aa1bfc654b65   1Gi        RWX            Delete           Bound    default/test-claim   default-nfs-storage            33m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                               STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS          AGE
</span></span><span class=line><span class=cl>persistentvolumeclaim/test-claim   Bound    pvc-f058cf4a-cc7b-4e44-97c3-aa1bfc654b65   1Gi        RWX            default-nfs-storage   37m
</span></span></code></pre></td></tr></table></div></div></li><li><p>æ–°å¢æ¸¬è©¦pod ç¢ºèªå¯å¯«å…¥</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@tpeinfoapsrms01:~/nfs&gt; cat test-pod.yaml 
</span></span><span class=line><span class=cl>kind: Pod
</span></span><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: test-pod
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  containers:
</span></span><span class=line><span class=cl>  - name: test-pod
</span></span><span class=line><span class=cl>    image: busybox:latest
</span></span><span class=line><span class=cl>    command:
</span></span><span class=line><span class=cl>      - &#34;/bin/sh&#34;
</span></span><span class=line><span class=cl>    args:
</span></span><span class=line><span class=cl>      - &#34;-c&#34;
</span></span><span class=line><span class=cl>      - &#34;touch /mnt/SUCCESS &amp;&amp; exit 0 || exit 1&#34;
</span></span><span class=line><span class=cl>    volumeMounts:
</span></span><span class=line><span class=cl>      - name: nfs-pvc
</span></span><span class=line><span class=cl>        mountPath: &#34;/mnt&#34;
</span></span><span class=line><span class=cl>  restartPolicy: &#34;Never&#34;
</span></span><span class=line><span class=cl>  volumes:
</span></span><span class=line><span class=cl>    - name: nfs-pvc
</span></span><span class=line><span class=cl>      persistentVolumeClaim:
</span></span><span class=line><span class=cl>        claimName: test-claim
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>devop@rms:~/nfs&gt; kubectl create -f test-pod.yaml 
</span></span><span class=line><span class=cl>pod/test-pod created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>devop@rms:~/nfs&gt; kubectl get pv,pvc
</span></span><span class=line><span class=cl>NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                STORAGECLASS          REASON   AGE
</span></span><span class=line><span class=cl>persistentvolume/pvc-f058cf4a-cc7b-4e44-97c3-aa1bfc654b65   1Gi        RWX            Delete           Bound    default/test-claim   default-nfs-storage            35m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                               STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS          AGE
</span></span><span class=line><span class=cl>persistentvolumeclaim/test-claim   Bound    pvc-f058cf4a-cc7b-4e44-97c3-aa1bfc654b65   1Gi        RWX            default-nfs-storage   38m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>---
</span></span></code></pre></td></tr></table></div></div></li><li><p>WebUI
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221031174825937.png loading=lazy alt=image-20221031174825937></p></li><li><p>åˆªé™¤æ¸¬è©¦ç”¨çš„pv,pvc</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~/nfs&gt; kubectl delete -f test-pod.yaml -f test-claim.yaml 
</span></span><span class=line><span class=cl>pod &#34;test-pod&#34; deleted
</span></span><span class=line><span class=cl>persistentvolumeclaim &#34;test-claim&#34; deleted
</span></span></code></pre></td></tr></table></div></div></li><li><p>åŒæ¨£è¨­å®šä¹Ÿæ”¾åˆ°DownStream K8s ï¼Œå»ºç«‹æ™‚ä¹Ÿå¯é€éWEB UIä¾†å°‡yamlæª”æ”¾åˆ°Cluster
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221031175458133.png loading=lazy alt=image-20221031175458133>
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221031175603727.png loading=lazy alt=image-20221031175603727>
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221031175616696.png loading=lazy alt=image-20221031175616696></p></li></ol><h2 id=å®‰è£logging>å®‰è£Logging</h2><ol><li>é»åˆ°localçš„cluster</li><li>å»ºç«‹project (infra)</li><li>é»é¸Apps &ndash;> Charts &ndash;> logging
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221028163035932.png loading=lazy alt=image-20221028163035932></li><li>Default
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221028163149621.png loading=lazy alt=image-20221028163149621></li><li>é–‹å§‹å®‰è£
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221028163228433.png loading=lazy alt=image-20221028163228433></li><li>é‡æ•´ç¶²é å¾Œå³æœƒå‡ºç¾
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221028163610607.png loading=lazy alt=image-20221028163610607></li><li>å¾ŒçºŒå¯å†é‡å°å¾Œç«¯çš„logging æ©Ÿåˆ¶</li></ol><h2 id=å®‰è£monitoring>å®‰è£Monitoring</h2><p><a class=link href="https://www.ibm.com/docs/en/cloud-private/3.2.0?topic=console-namespace-is-stuck-in-terminating-state" target=_blank rel=noopener>https://www.ibm.com/docs/en/cloud-private/3.2.0?topic=console-namespace-is-stuck-in-terminating-state</a></p><ol><li><p>é»åˆ°localçš„cluster</p></li><li><p>å»ºç«‹project (infra)
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221028161139089.png loading=lazy alt=image-20221028161139089></p></li><li><p>é»é¸Apps &ndash;> Charts &ndash;> monitoring
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221028160838561.png loading=lazy></p></li><li><p>é»é¸Monitoring &ndash; > Install (å®‰è£åˆ°Infra Project)
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221028163730065.png loading=lazy alt=image-20221028163730065></p></li><li><p>Admin API Enableã€PV
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221028163815459.png loading=lazy alt=image-20221028163815459>
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221031180012545.png loading=lazy alt=image-20221031180012545></p></li><li><p>Grafana Enable
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221031180129747.png loading=lazy alt=image-20221031180129747></p></li><li><p>é»é¸Installå¾Œé‡æ–°æ•´ç†WEB UIï¼Œå³æœƒå‡ºç¾Monitoring</p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221031180517689.png loading=lazy alt=image-20221031180517689></p></li><li><p>é»é¸Grafanaç¢ºèªè³‡æ–™
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221031180605633.png loading=lazy alt=image-20221031180605633></p></li><li><p>æŸ¥è©¢Grafanaé è¨­å¸³è™Ÿå¯†ç¢¼
æœƒæ”¾åœ¨cattle-monitoring-systemçš„ Secretè£¡ (å¸³å¯†ç‚ºadmin/prom-operator)
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230923141114566.png loading=lazy alt=image-20230923141114566></p></li></ol><h2 id=å®‰è£neuvector>å®‰è£Neuvector</h2><p><a class=link href=https://www.twblogs.net/a/6225a6dfc1f9c8b6ea0c84d2 target=_blank rel=noopener>https://www.twblogs.net/a/6225a6dfc1f9c8b6ea0c84d2</a>
<a class=link href=https://github.com/IBM/Runtime-Container-Security-for-Kube/blob/main/neuvector.yaml target=_blank rel=noopener>https://github.com/IBM/Runtime-Container-Security-for-Kube/blob/main/neuvector.yaml</a>
<a class=link href=https://www.readfog.com/a/1685538272501141504 target=_blank rel=noopener>https://www.readfog.com/a/1685538272501141504</a>
<a class=link href=https://open-docs.neuvector.com/ target=_blank rel=noopener>https://open-docs.neuvector.com/</a></p><h1 id=rancher-cluster-å‚™ä»½é‚„åŸå‡ç´š>Rancher Cluster (å‚™ä»½.é‚„åŸ.å‡ç´š)</h1><p><a class=link href=https://docs.ranchermanager.rancher.io/getting-started/installation-and-upgrade/install-upgrade-on-a-kubernetes-cluster/upgrades target=_blank rel=noopener>https://docs.ranchermanager.rancher.io/getting-started/installation-and-upgrade/install-upgrade-on-a-kubernetes-cluster/upgrades</a></p><h2 id=rancher-backup-å‚™ä»½é‚„åŸapp>Rancher Backup (å‚™ä»½é‚„åŸAPP)</h2><ol><li><p>åœ¨Apps &ndash;> Charts æœå°‹rancher backups
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221108153112348.png loading=lazy alt=image-20221108153112348></p></li><li><p>é»é¸install
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221108153148832.png loading=lazy alt=image-20221108153148832></p></li><li><p>è¨­å®šå„²å­˜ä½ç½® (Storage Class)</p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221108153231799.png loading=lazy alt=image-20221108153231799></p></li><li><p>é»é¸install
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221108153312905.png loading=lazy alt=image-20221108153312905>
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221108153324294.png loading=lazy alt=image-20221108153324294></p></li><li><p>é‡æ•´Web UIï¼Œå‡ºç¾Rancher Backups
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221108153426191.png loading=lazy alt=image-20221108153426191></p></li><li><p>é»é¸Rancher Backups &ndash;> Create
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221108153514800.png loading=lazy alt=image-20221108153514800></p></li><li><p>è¨­å®šåç¨±ã€åƒæ•¸ç­‰ï¼Œé»é¸Create
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221108153603733.png loading=lazy alt=image-20221108153603733></p></li><li><p>ç¢ºèªå‚™ä»½å®Œæˆ
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221108153642511.png loading=lazy alt=image-20221108153642511></p></li><li><p>æ¸¬è©¦å…ˆå°‡monitoringåˆªé™¤å¾Œå‚™ä»½ ï¼ˆæ‰‹å‹•åˆªé™¤cattle-monitoring-systemã€ç›¸é—œCRDï¼‰</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~&gt; kubectl delete ns cattle-monitoring-system
</span></span><span class=line><span class=cl>--- å¡åœ¨terminating å¯åŸ·è¡Œä¸‹æ–¹æ“ä½œ
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>devop@rms:~&gt; kubectl get ns cattle-monitoring-system -o json &gt; tmp.json
</span></span><span class=line><span class=cl>devop@rms:~&gt; vim tmp.json
</span></span><span class=line><span class=cl>--- åˆªé™¤        &#34;finalizers&#34;: [
</span></span><span class=line><span class=cl>            &#34;kubernetes&#34;
</span></span><span class=line><span class=cl>        ]
</span></span><span class=line><span class=cl>devop@rms:~&gt; kubectl proxy
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--- é–‹å¦ä¸€å€‹terminal
</span></span><span class=line><span class=cl>devop@rms:~&gt; curl -k -H &#34;Content-Type: application/json&#34; -X PUT --data-binary @tmp.json http://127.0.0.1:8001/api/v1/namespaces/cattle-monitoring-system/finalize
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--- ç¢ºèªcattle-monitoring-system åˆªé™¤
</span></span><span class=line><span class=cl>devop@rms:~&gt; kubectl get ns cattle-monitoring-system
</span></span><span class=line><span class=cl>Error from server (NotFound): namespaces &#34;cattle-monitoring-system&#34; not found
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--- åˆªé™¤ç›¸é—œCRD
</span></span><span class=line><span class=cl>devop@rms:~&gt; kubectl delete crd prometheusrules.monitoring.coreos.com 
</span></span><span class=line><span class=cl>customresourcedefinition.apiextensions.k8s.io &#34;prometheusrules.monitoring.coreos.com&#34; deleted
</span></span><span class=line><span class=cl>devop@rms:~&gt; kubectl delete crd prometheuses.monitoring.coreos.com
</span></span><span class=line><span class=cl>customresourcedefinition.apiextensions.k8s.io &#34;prometheuses.monitoring.coreos.com&#34; deleted
</span></span><span class=line><span class=cl>devop@rms:~&gt; kubectl delete crd alertmanagerconfigs.monitoring.coreos.com 
</span></span><span class=line><span class=cl>customresourcedefinition.apiextensions.k8s.io &#34;alertmanagerconfigs.monitoring.coreos.com&#34; deleted
</span></span><span class=line><span class=cl>devop@rms:~&gt; kubectl delete crd alertmanagers.monitoring.coreos.com
</span></span><span class=line><span class=cl>customresourcedefinition.apiextensions.k8s.io &#34;alertmanagers.monitoring.coreos.com&#34; deleted
</span></span><span class=line><span class=cl>devop@rms:~&gt; kubectl delete crd podmonitors.monitoring.coreos.com 
</span></span><span class=line><span class=cl>customresourcedefinition.apiextensions.k8s.io &#34;podmonitors.monitoring.coreos.com&#34; deleted
</span></span><span class=line><span class=cl>devop@rms:~&gt; kubectl delete crd probes.monitoring.coreos.com 
</span></span><span class=line><span class=cl>customresourcedefinition.apiextensions.k8s.io &#34;probes.monitoring.coreos.com&#34; deleted
</span></span><span class=line><span class=cl>devop@rms:~&gt; kubectl delete crd servicemonitors.monitoring.coreos.com  
</span></span><span class=line><span class=cl>customresourcedefinition.apiextensions.k8s.io &#34;servicemonitors.monitoring.coreos.com&#34; deleted
</span></span><span class=line><span class=cl>devop@rms:~&gt; kubectl delete crd thanosrulers.monitoring.coreos.com 
</span></span><span class=line><span class=cl>customresourcedefinition.apiextensions.k8s.io &#34;thanosrulers.monitoring.coreos.com&#34; deleted
</span></span></code></pre></td></tr></table></div></div><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221109100436616.png loading=lazy alt=image-20221109100436616></p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221109100244363.png loading=lazy alt=image-20221109100244363></p></li><li><p>ç¢ºèªå‚™ä»½å®Œæˆå¾Œå°‡Monitoringå®‰è£å›å»
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221109100334288.png loading=lazy alt=image-20221109100334288>
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221109100558546.png loading=lazy alt=image-20221109100558546></p></li><li><p>ç¢ºèªå®‰è£å®Œæˆ
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221109100809009.png loading=lazy alt=image-20221109100809009></p></li><li><p>ç¢ºèªå‚™ä»½æª”æ¡ˆ</p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221109102519201.png loading=lazy alt=image-20221109102519201></p></li><li><p>é‚„åŸå‚™ä»½æª”æ¡ˆ&ndash;>é»é¸restore &ndash;>Create å³æœƒé–‹å§‹åŸ·è¡Œrestore</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Result: The backup file is created and updated to the target storage location. The resources are restored in this order:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   1. Custom Resource Definitions (CRDs)
</span></span><span class=line><span class=cl>   2. Cluster-scoped resources
</span></span><span class=line><span class=cl>   3. Namespaced resources
</span></span></code></pre></td></tr></table></div></div><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221109102614271.png loading=lazy alt=image-20221109102614271></p></li><li><p>ç¢ºèª statusï¼ŒRancher Clusteræœå‹™æœƒä¸­æ–· (ç´„3åˆ†é˜)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~&gt; kubectl get po -n cattle-system
</span></span><span class=line><span class=cl>NAME                             READY   STATUS        RESTARTS   AGE
</span></span><span class=line><span class=cl>rancher-6c8f689f57-bgj4j         0/1     Terminating   0          30s
</span></span><span class=line><span class=cl>rancher-6c8f689f57-jkmpq         0/1     Terminating   0          30s
</span></span><span class=line><span class=cl>rancher-6c8f689f57-tj8tw         0/1     Terminating   0          30s
</span></span><span class=line><span class=cl>rancher-webhook-d6f8b6cb-xzjxc   1/1     Running       0          18h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>devop@rms:~&gt; kubectl logs rancher-backup-6b9fc54cc6-nzt6m -n cattle-resources-system
</span></span><span class=line><span class=cl>INFO[2022/11/09 02:32:31] Marking resource rolebindings.rbac.authorization.k8s.io#v1/fleet-local/request-6hktw for deletion 
</span></span><span class=line><span class=cl>INFO[2022/11/09 02:32:31] Marking resource rolebindings.rbac.authorization.k8s.io#v1/fleet-local/request-d9wpm for deletion 
</span></span><span class=line><span class=cl>INFO[2022/11/09 02:32:31] Marking resource rolebindings.rbac.authorization.k8s.io#v1/fleet-local/request-hskp9 for deletion 
</span></span><span class=line><span class=cl>INFO[2022/11/09 02:32:31] Will retry pruning resources by removing finalizers in 10s 
</span></span><span class=line><span class=cl>INFO[2022/11/09 02:32:41] Retrying pruning resources by removing finalizers 
</span></span><span class=line><span class=cl>INFO[2022/11/09 02:32:41] Processing controllerRef apps/v1/deployments/rancher 
</span></span><span class=line><span class=cl>INFO[2022/11/09 02:32:41] Scaling up controllerRef apps/v1/deployments/rancher to 3 
</span></span><span class=line><span class=cl>INFO[2022/11/09 02:32:41] Done restoring 
</span></span></code></pre></td></tr></table></div></div></li><li><p>ç¢ºèªRancher æœå‹™å•Ÿå‹•
cattle-monitoring-system &ndash; terminating ã€ç›¸é—œcrdé‚„å­˜åœ¨éœ€æ‰‹å‹•åˆªé™¤</p><p>(è‹¥ç‚ºè‡ªå®šç¾©çš„Applicationæ‡‰æœƒå…¨éƒ¨æ¸…ç©ºï¼Œæ­¤è™•ä½¿ç”¨helm chartå®‰è£çš„æœ‰ç•™å­˜è‘—)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~&gt; kubectl get po -n cattle-system
</span></span><span class=line><span class=cl>NAME                             READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>rancher-6c8f689f57-8cn46         1/1     Running   0          71s
</span></span><span class=line><span class=cl>rancher-6c8f689f57-kcqxc         1/1     Running   0          71s
</span></span><span class=line><span class=cl>rancher-6c8f689f57-w5hsz         1/1     Running   0          71s
</span></span><span class=line><span class=cl>rancher-webhook-d6f8b6cb-xzjxc   1/1     Running   0          18h
</span></span><span class=line><span class=cl>devop@rms:~&gt; kubectl get ns
</span></span><span class=line><span class=cl>NAME                                         STATUS        AGE
</span></span><span class=line><span class=cl>cattle-monitoring-system                     Terminating   9m11s
</span></span><span class=line><span class=cl>devop@rms:~&gt; kubectl get crd
</span></span><span class=line><span class=cl>devop@rms:~&gt; kubectl delete crd probes.monitoring.coreos.com 
</span></span><span class=line><span class=cl>...
</span></span></code></pre></td></tr></table></div></div><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221109103725106.png loading=lazy alt=image-20221109103725106></p></li></ol><h2 id=å‚™ä»½rancher-cluster-etcd>å‚™ä»½Rancher Cluster etcd</h2><p><a class=link href=https://docs.rke2.io/backup_restore/ target=_blank rel=noopener>https://docs.rke2.io/backup_restore/</a></p><ol><li><p>ansibleè¨­å®š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wangken@wangken-MAC rke2-lab % cat ansible.cfg 
</span></span><span class=line><span class=cl>[defaults]
</span></span><span class=line><span class=cl>inventory = /Users/wangken/ansible/infoserver/rke2-lab/inventory
</span></span><span class=line><span class=cl>remote_user = devop
</span></span><span class=line><span class=cl>sudo_user = root
</span></span><span class=line><span class=cl>host_key_checking = False
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[privilege_escalation]
</span></span><span class=line><span class=cl>become = true
</span></span><span class=line><span class=cl>become_user = root
</span></span><span class=line><span class=cl>become_ask_pass = true
</span></span><span class=line><span class=cl>--
</span></span><span class=line><span class=cl>wangken@wangken-MAC rke2-lab % cat inventory 
</span></span><span class=line><span class=cl>[rke2-cluster]
</span></span><span class=line><span class=cl>192.168.33.[41:43] ansible_ssh_pass=suse
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[downstreamk8s-master]
</span></span><span class=line><span class=cl>192.168.33.[44:46] ansible_ssh_pass=suse
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[downstreamk8s-worker]
</span></span><span class=line><span class=cl>192.168.33.[47:48] ansible_ssh_pass=suse
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[downstreamk8s:children]
</span></span><span class=line><span class=cl>downstreamk8s-master
</span></span><span class=line><span class=cl>downstreamk8s-worker
</span></span><span class=line><span class=cl>wangken@wangken-MAC rke2-lab % ansible rke2-cluster -m ping
</span></span></code></pre></td></tr></table></div></div></li><li><p>ç¢ºèªå„nodesçš†æœ‰rke2æŒ‡ä»¤ /opt/rke2/bin/rke2</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wangken@wangken-MAC rke2-lab % ansible rke2-cluster -m shell -a &#39;rke2 --help&#39;
</span></span><span class=line><span class=cl>BECOME password: 
</span></span><span class=line><span class=cl>192.168.33.41 | FAILED | rc=127 &gt;&gt;
</span></span><span class=line><span class=cl>/bin/sh: rke2ï¼šå‘½ä»¤æ‰¾ä¸åˆ°non-zero return code
</span></span><span class=line><span class=cl>192.168.33.42 | FAILED | rc=127 &gt;&gt;
</span></span><span class=line><span class=cl>/bin/sh: rke2ï¼šå‘½ä»¤æ‰¾ä¸åˆ°non-zero return code
</span></span><span class=line><span class=cl>192.168.33.43 | FAILED | rc=127 &gt;&gt;
</span></span><span class=line><span class=cl>/bin/sh: rke2ï¼šå‘½ä»¤æ‰¾ä¸åˆ°non-zero return code
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--- copy rke2 åˆ°/usr/local/bin
</span></span><span class=line><span class=cl>wangken@wangken-MAC rke2-lab % ansible rke2-cluster -m shell -a &#39;cp /opt/rke2/bin/rke2 /usr/local/bin/&#39;
</span></span><span class=line><span class=cl>BECOME password: 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>wangken@wangken-MAC rke2-lab % ansible rke2-cluster -m shell -a &#39;rke2 --help&#39;
</span></span><span class=line><span class=cl>BECOME password: 
</span></span><span class=line><span class=cl>192.168.33.41 | CHANGED | rc=0 &gt;&gt;
</span></span><span class=line><span class=cl>192.168.33.42 | CHANGED | rc=0 &gt;&gt;
</span></span><span class=line><span class=cl>192.168.33.43 | CHANGED | rc=0 &gt;&gt;
</span></span></code></pre></td></tr></table></div></div></li><li><p>backup etcd while running</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>Snapshots</span> <span class=n>are</span> <span class=n>enabled</span> <span class=n>by</span> <span class=n>default</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>The</span> <span class=n>snapshot</span> <span class=n>directory</span> <span class=n>defaults</span> <span class=n>to</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>server</span><span class=o>/</span><span class=n>db</span><span class=o>/</span><span class=n>snapshots</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>wangken</span><span class=err>@</span><span class=n>wangken</span><span class=o>-</span><span class=n>MAC</span> <span class=n>rke2</span><span class=o>-</span><span class=n>lab</span> <span class=o>%</span> <span class=n>ansible</span> <span class=n>rke2</span><span class=o>-</span><span class=n>cluster</span> <span class=o>-</span><span class=n>m</span> <span class=n>shell</span> <span class=o>-</span><span class=n>a</span> <span class=s1>&#39;rke2 etcd-snapshot save --name pre-upgrade-snapshot-v2.6.6&#39;</span>
</span></span><span class=line><span class=cl><span class=n>BECOME</span> <span class=n>password</span><span class=p>:</span> 
</span></span><span class=line><span class=cl><span class=mf>192.168</span><span class=o>.</span><span class=mf>33.41</span> <span class=o>|</span> <span class=n>CHANGED</span> <span class=o>|</span> <span class=n>rc</span><span class=o>=</span><span class=mi>0</span> <span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=mf>192.168</span><span class=o>.</span><span class=mf>33.42</span> <span class=o>|</span> <span class=n>CHANGED</span> <span class=o>|</span> <span class=n>rc</span><span class=o>=</span><span class=mi>0</span> <span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=mf>192.168</span><span class=o>.</span><span class=mf>33.43</span> <span class=o>|</span> <span class=n>CHANGED</span> <span class=o>|</span> <span class=n>rc</span><span class=o>=</span><span class=mi>0</span> <span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>wangken</span><span class=err>@</span><span class=n>wangken</span><span class=o>-</span><span class=n>MAC</span> <span class=n>rke2</span><span class=o>-</span><span class=n>lab</span> <span class=o>%</span> <span class=n>ansible</span> <span class=n>rke2</span><span class=o>-</span><span class=n>cluster</span> <span class=o>-</span><span class=n>m</span> <span class=n>shell</span> <span class=o>-</span><span class=n>a</span> <span class=s1>&#39;ls -l /var/lib/rancher/rke2/server/db/snapshots&#39;</span>           
</span></span><span class=line><span class=cl><span class=n>BECOME</span> <span class=n>password</span><span class=p>:</span> 
</span></span></code></pre></td></tr></table></div></div><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221109115637681.png loading=lazy alt=image-20221109115637681>
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221109115733969.png loading=lazy alt=image-20221109115733969></p></li><li><p>åˆ©ç”¨ä¸‹ç¯‡æ–¹æ³•å‡ç´šrancher clusterçš„version
v2.6.6 to v2.6.9</p></li><li><p>å‡ç´šrancher clusterçš„k8s version</p></li></ol><h2 id=å‡ç´šrancher-cluster>å‡ç´šRancher Cluster</h2><ol><li><p>ç¢ºèªRancher Cluster</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~/nfs&gt; helm get values rancher -n cattle-system
</span></span><span class=line><span class=cl>USER-SUPPLIED VALUES:
</span></span><span class=line><span class=cl>hostname: rms.rancher.ken.lab
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>devop@rms:~&gt; helm get values rancher -n cattle-system -o yaml &gt; values.yaml
</span></span><span class=line><span class=cl>devop@rms:~&gt; cat values.yaml 
</span></span><span class=line><span class=cl>hostname: rms.rancher.ken.lab
</span></span></code></pre></td></tr></table></div></div></li><li><p>ç¢ºèªrancher helm chart</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~&gt; helm repo list
</span></span><span class=line><span class=cl>NAME          	URL                                              
</span></span><span class=line><span class=cl>rancher-stable	https://releases.rancher.com/server-charts/stable
</span></span><span class=line><span class=cl>jetstack      	https://charts.jetstack.io                       
</span></span><span class=line><span class=cl>neuvector     	https://neuvector.github.io/neuvector-helm/  
</span></span></code></pre></td></tr></table></div></div></li><li><p>update helm chart</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~&gt; helm repo update
</span></span><span class=line><span class=cl>Hang tight while we grab the latest from your chart repositories...
</span></span><span class=line><span class=cl>...Successfully got an update from the &#34;rancher-stable&#34; chart repository
</span></span><span class=line><span class=cl>...Successfully got an update from the &#34;neuvector&#34; chart repository
</span></span><span class=line><span class=cl>...Successfully got an update from the &#34;jetstack&#34; chart repository
</span></span><span class=line><span class=cl>Update Complete. âˆHappy Helming!âˆ
</span></span></code></pre></td></tr></table></div></div></li><li><p>ç¢ºèªç›®å‰rancher æœ€æ–°ç‰ˆæœ¬</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~&gt; helm search repo rancher-stable
</span></span><span class=line><span class=cl>NAME                  	CHART VERSION	APP VERSION	DESCRIPTION                                       
</span></span><span class=line><span class=cl>rancher-stable/rancher	2.6.9        	v2.6.9     	Install Rancher Server to manage Kubernetes clu...
</span></span></code></pre></td></tr></table></div></div></li><li><p>ç¢ºèªæ›´æ–°é …ç›®</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~&gt; helm fetch rancher-stable/rancher --version=2.6.9
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>devop@rms:~&gt; tar xvf rancher-2.6.9.tgz 
</span></span><span class=line><span class=cl>rancher/Chart.yaml
</span></span><span class=line><span class=cl>rancher/values.yaml
</span></span><span class=line><span class=cl>rancher/templates/NOTES.txt
</span></span><span class=line><span class=cl>rancher/templates/_helpers.tpl
</span></span><span class=line><span class=cl>rancher/templates/clusterRoleBinding.yaml
</span></span><span class=line><span class=cl>rancher/templates/deployment.yaml
</span></span><span class=line><span class=cl>rancher/templates/ingress.yaml
</span></span><span class=line><span class=cl>rancher/templates/issuer-letsEncrypt.yaml
</span></span><span class=line><span class=cl>rancher/templates/issuer-rancher.yaml
</span></span><span class=line><span class=cl>rancher/templates/post-delete-hook-cluster-role-binding.yaml
</span></span><span class=line><span class=cl>rancher/templates/post-delete-hook-cluster-role.yaml
</span></span><span class=line><span class=cl>rancher/templates/post-delete-hook-config-map.yaml
</span></span><span class=line><span class=cl>rancher/templates/post-delete-hook-job.yaml
</span></span><span class=line><span class=cl>rancher/templates/post-delete-hook-psp.yaml
</span></span><span class=line><span class=cl>rancher/templates/post-delete-hook-service-account.yaml
</span></span><span class=line><span class=cl>rancher/templates/pvc.yaml
</span></span><span class=line><span class=cl>rancher/templates/secret.yaml
</span></span><span class=line><span class=cl>rancher/templates/service.yaml
</span></span><span class=line><span class=cl>rancher/templates/serviceAccount.yaml
</span></span><span class=line><span class=cl>rancher/.helmignore
</span></span><span class=line><span class=cl>rancher/README.md
</span></span><span class=line><span class=cl>rancher/scripts/post-delete-hook.sh
</span></span><span class=line><span class=cl>----
</span></span><span class=line><span class=cl>devop@rms:~&gt; tree rancher
</span></span><span class=line><span class=cl>rancher
</span></span><span class=line><span class=cl>â”œâ”€â”€ Chart.yaml
</span></span><span class=line><span class=cl>â”œâ”€â”€ README.md
</span></span><span class=line><span class=cl>â”œâ”€â”€ scripts
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ post-delete-hook.sh
</span></span><span class=line><span class=cl>â”œâ”€â”€ templates
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ clusterRoleBinding.yaml
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ deployment.yaml
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ _helpers.tpl
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ ingress.yaml
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ issuer-letsEncrypt.yaml
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ issuer-rancher.yaml
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ NOTES.txt
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ post-delete-hook-cluster-role-binding.yaml
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ post-delete-hook-cluster-role.yaml
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ post-delete-hook-config-map.yaml
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ post-delete-hook-job.yaml
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ post-delete-hook-psp.yaml
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ post-delete-hook-service-account.yaml
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ pvc.yaml
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ secret.yaml
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ serviceAccount.yaml
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ service.yaml
</span></span><span class=line><span class=cl>â””â”€â”€ values.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2 directories, 21 files
</span></span></code></pre></td></tr></table></div></div></li><li><p>åŸ·è¡Œæ›´æ–°</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~&gt; helm upgrade rancher rancher-stable/rancher --namespace cattle-system -f values.yaml --version=2.6.9
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Release &#34;rancher&#34; has been upgraded. Happy Helming!
</span></span><span class=line><span class=cl>NAME: rancher
</span></span><span class=line><span class=cl>LAST DEPLOYED: Tue Nov  8 15:52:00 2022
</span></span><span class=line><span class=cl>NAMESPACE: cattle-system
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: 2
</span></span><span class=line><span class=cl>TEST SUITE: None
</span></span><span class=line><span class=cl>NOTES:
</span></span><span class=line><span class=cl>Rancher Server has been installed.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NOTE: Rancher may take several minutes to fully initialize. Please standby while Certificates are being issued, Containers are started and the Ingress rule comes up.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Check out our docs at https://rancher.com/docs/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>If you provided your own bootstrap password during installation, browse to https://rms.rancher.ken.lab to get started.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>If this is the first time you installed Rancher, get started by running this command and clicking the URL it generates:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>```
</span></span><span class=line><span class=cl>echo https://rms.rancher.ken.lab/dashboard/?setup=$(kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=&#39;{{.data.bootstrapPassword|base64decode}}&#39;)
</span></span><span class=line><span class=cl>```
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>To get just the bootstrap password on its own, run:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>```
</span></span><span class=line><span class=cl>kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=&#39;{{.data.bootstrapPassword|base64decode}}{{ &#34;\n&#34; }}&#39;
</span></span><span class=line><span class=cl>```
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Happy Containering!
</span></span></code></pre></td></tr></table></div></div></li><li><p>ç¢ºèªstatus</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~&gt; kubectl get pod -n cattle-system
</span></span><span class=line><span class=cl>NAME                               READY   STATUS              RESTARTS       AGE
</span></span><span class=line><span class=cl>helm-operation-trgz9               0/2     Completed           0              17m
</span></span><span class=line><span class=cl>rancher-6c8f689f57-47hfd           0/1     ContainerCreating   0              43s
</span></span><span class=line><span class=cl>rancher-6c8f689f57-g666k           0/1     ContainerCreating   0              43s
</span></span><span class=line><span class=cl>rancher-7fd65d9cd6-m9gt7           1/1     Running             2 (7d1h ago)   13d
</span></span><span class=line><span class=cl>rancher-7fd65d9cd6-vjcpk           1/1     Running             2 (7d1h ago)   13d
</span></span><span class=line><span class=cl>rancher-webhook-5b65595df9-9xsrc   1/1     Running             2 (7d1h ago)   13d
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>devop@rms:~&gt; kubectl get pod -n cattle-system
</span></span><span class=line><span class=cl>NAME                             READY   STATUS      RESTARTS   AGE
</span></span><span class=line><span class=cl>helm-operation-ffdn6             0/2     Completed   0          13m
</span></span><span class=line><span class=cl>helm-operation-kjqgc             0/2     Completed   0          14m
</span></span><span class=line><span class=cl>helm-operation-tfbhr             0/2     Completed   0          13m
</span></span><span class=line><span class=cl>helm-operation-trgz9             0/2     Completed   0          33m
</span></span><span class=line><span class=cl>rancher-6c8f689f57-47hfd         1/1     Running     0          16m
</span></span><span class=line><span class=cl>rancher-6c8f689f57-g666k         1/1     Running     0          16m
</span></span><span class=line><span class=cl>rancher-6c8f689f57-nkfkb         1/1     Running     0          15m
</span></span><span class=line><span class=cl>rancher-webhook-d6f8b6cb-xzjxc   1/1     Running     0          13m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>devop@rms:~&gt; helm  history rancher -n cattle-system
</span></span><span class=line><span class=cl>REVISION	UPDATED                 	STATUS    	CHART        	APP VERSION	DESCRIPTION     
</span></span><span class=line><span class=cl>1       	Tue Oct 25 17:05:13 2022	superseded	rancher-2.6.6	v2.6.6     	Install complete
</span></span><span class=line><span class=cl>2       	Tue Nov  8 15:52:00 2022	superseded	rancher-2.6.9	v2.6.9     	Upgrade complete
</span></span><span class=line><span class=cl>3       	Wed Nov  9 10:55:25 2022	superseded	rancher-2.6.6	v2.6.6     	Rollback to 1   
</span></span><span class=line><span class=cl>4       	Wed Nov  9 12:04:06 2022	deployed  	rancher-2.6.9	v2.6.9     	Upgrade complete
</span></span></code></pre></td></tr></table></div></div></li><li><p>å¾Web UIç¢ºèªç‰ˆæœ¬ v2.6.9
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221108160654097.png loading=lazy alt=image-20221108160654097></p></li><li><p>å‡ç´šk8s versionï¼Œé‡å°å‡ç´šå¾Œçš„Rancher Clusteré»é¸edit config</p><p>v1.23.9 to v1.24.4
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221109121235714.png loading=lazy alt=image-20221109121235714></p></li><li><p>é»é¸saveï¼ŒæŸ¥çœ‹å‡ç´šç‹€æ…‹ rolling upgrade ï¼ŒæœŸé–“Web UIä¸å—å½±éŸ¿</p></li></ol><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221109121345121.png loading=lazy alt=image-20221109121345121>
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221109121459412.png loading=lazy alt=image-20221109121459412></p><ol start=11><li><p>nodesè¼ªæµå‡ç´š (RAMçš„ä½¿ç”¨ç‡æœƒé£†é«˜)
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221109121632971.png loading=lazy alt=image-20221109121632971></p></li><li><p>å‡ç´šå®Œæˆ
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221109134021037.png loading=lazy alt=image-20221109134021037></p></li></ol><h2 id=roll-backup-rancher-helm>Roll Backup Rancher (Helm)</h2><p><a class=link href=https://docs.ranchermanager.rancher.io/getting-started/installation-and-upgrade/install-upgrade-on-a-kubernetes-cluster/rollbacks target=_blank rel=noopener>https://docs.ranchermanager.rancher.io/getting-started/installation-and-upgrade/install-upgrade-on-a-kubernetes-cluster/rollbacks</a></p><p><strong>é›–å®˜æ–¹æ–‡ä»¶æœ‰å¯«åˆ°ï¼Œä½†åŸå» ä¸å»ºè­°é€™éº¼åš</strong> ï¼Œåªé‡å°rancher ç‰ˆæœ¬å›å¾©</p><ol><li><p>æŸ¥çœ‹rancherå®‰è£éçš„ç‰ˆæœ¬</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~&gt; helm history rancher -n cattle-system
</span></span><span class=line><span class=cl>REVISION	UPDATED                 	STATUS    	CHART        	APP VERSION	DESCRIPTION     
</span></span><span class=line><span class=cl>1       	Tue Oct 25 17:05:13 2022	superseded	rancher-2.6.6	v2.6.6     	Install complete
</span></span><span class=line><span class=cl>2       	Tue Nov  8 15:52:00 2022	deployed  	rancher-2.6.9	v2.6.9     	Upgrade complete
</span></span></code></pre></td></tr></table></div></div></li><li><p>åˆ©ç”¨helm é‚„åŸrancherç‰ˆæœ¬</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~&gt; helm rollback rancher 1 -n cattle-system
</span></span><span class=line><span class=cl>Rollback was a success! Happy Helming!
</span></span></code></pre></td></tr></table></div></div></li><li><p>ç¢ºèªstatus</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~&gt; watch kubectl get po -n cattle-system
</span></span><span class=line><span class=cl>NAME                             READY   STATUS              RESTARTS   AGE
</span></span><span class=line><span class=cl>rancher-6c8f689f57-kcqxc         1/1     Running             0          23m
</span></span><span class=line><span class=cl>rancher-6c8f689f57-w5hsz         1/1     Running             0          23m
</span></span><span class=line><span class=cl>rancher-7fd65d9cd6-hsbhg         0/1     ContainerCreating   0          24s
</span></span><span class=line><span class=cl>rancher-7fd65d9cd6-zrdm8         0/1     Running             0          24s
</span></span><span class=line><span class=cl>rancher-webhook-d6f8b6cb-xzjxc   1/1     Running             0          19h
</span></span><span class=line><span class=cl>devop@rms:~&gt; helm history rancher -n cattle-system
</span></span><span class=line><span class=cl>REVISION	UPDATED                 	STATUS    	CHART        	APP VERSION	DESCRIPTION     
</span></span><span class=line><span class=cl>1       	Tue Oct 25 17:05:13 2022	superseded	rancher-2.6.6	v2.6.6     	Install complete
</span></span><span class=line><span class=cl>2       	Tue Nov  8 15:52:00 2022	superseded	rancher-2.6.9	v2.6.9     	Upgrade complete
</span></span><span class=line><span class=cl>3       	Wed Nov  9 10:55:25 2022	deployed  	rancher-2.6.6	v2.6.6     	Rollback to 1 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>devop@rms:~&gt; kubectl get po -n cattle-system
</span></span><span class=line><span class=cl>NAME                             READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>rancher-7fd65d9cd6-hsbhg         1/1     Running   0          34m
</span></span><span class=line><span class=cl>rancher-7fd65d9cd6-qz9xb         1/1     Running   0          33m
</span></span><span class=line><span class=cl>rancher-7fd65d9cd6-zrdm8         1/1     Running   0          34m
</span></span><span class=line><span class=cl>rancher-webhook-d6f8b6cb-xzjxc   1/1     Running   0          19h
</span></span><span class=line><span class=cl>devop@rms:~&gt; kubectl describe po rancher-7fd65d9cd6-hsbhg -n cattle-system 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Containers:
</span></span><span class=line><span class=cl>  rancher:
</span></span><span class=line><span class=cl>    Container ID:  containerd://13a9d5362e57776b8cfb54f63e872cd81b6ec38623716d7d3b3006f57acc9f89
</span></span><span class=line><span class=cl>    Image:         rancher/rancher:v2.6.6
</span></span></code></pre></td></tr></table></div></div></li><li><p>é‡æ•´Web UIç¢ºèªç‰ˆæœ¬å·²ç‚ºv2.6.6
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221109105523237.png loading=lazy alt=image-20221109105523237></p></li></ol><h2 id=é‚„åŸrancher-cluster-etcd>é‚„åŸRancher Cluster etcd</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=err>é †åºï¼š</span>
</span></span><span class=line><span class=cl><span class=mf>1.</span> <span class=err>åœæ­¢æ‰€æœ‰</span><span class=n>nodeçš„rke2</span><span class=o>-</span><span class=n>server</span> <span class=n>service</span>
</span></span><span class=line><span class=cl><span class=mf>2.</span> <span class=err>åœ¨ç¬¬ä¸€å€‹ç¯€é»</span> <span class=err>åŸ·è¡Œ</span><span class=n>restoreæŒ‡ä»¤</span>
</span></span><span class=line><span class=cl><span class=mf>3.</span> <span class=err>å•Ÿå‹•ç¬¬ä¸€å€‹ç¯€é»çš„</span> <span class=n>rke2</span><span class=o>-</span><span class=n>server</span> <span class=n>service</span>
</span></span><span class=line><span class=cl><span class=mf>4.</span> <span class=err>åˆªé™¤å‰©ä¸‹å…©å€‹ç¯€é»çš„</span><span class=n>dbç›®éŒ„</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>server</span><span class=o>/</span><span class=n>db</span>
</span></span><span class=line><span class=cl><span class=mf>5.</span> <span class=err>å•Ÿå‹•å‰©ä¸‹å…©å€‹ç¯€é»çš„</span> <span class=n>rke2</span><span class=o>-</span><span class=n>server</span> <span class=n>service</span>
</span></span></code></pre></td></tr></table></div></div><ol><li><p>å…ˆç¢ºèªå…ˆå‰åšsnapshotçš„æª”æ¡ˆéƒ½åœ¨</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>wangken</span><span class=err>@</span><span class=n>wangken</span><span class=o>-</span><span class=n>MAC</span> <span class=n>rke2</span><span class=o>-</span><span class=n>lab</span> <span class=o>%</span> <span class=n>ansible</span> <span class=n>rke2</span><span class=o>-</span><span class=n>cluster</span> <span class=o>-</span><span class=n>m</span> <span class=n>shell</span> <span class=o>-</span><span class=n>a</span> <span class=s1>&#39;ls -l /var/lib/rancher/rke2/server/db/snapshots&#39;</span>
</span></span><span class=line><span class=cl><span class=n>BECOME</span> <span class=n>password</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>192.168</span><span class=o>.</span><span class=mf>33.43</span> <span class=o>|</span> <span class=n>CHANGED</span> <span class=o>|</span> <span class=n>rc</span><span class=o>=</span><span class=mi>0</span> <span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=err>ç¸½ç”¨é‡</span> <span class=mi>270504</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>41029664</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>7</span> <span class=mi>12</span><span class=p>:</span><span class=mi>00</span> <span class=n>etcd</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>3</span><span class=o>-</span><span class=mi>1667793600</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>41029664</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>8</span> <span class=mi>00</span><span class=p>:</span><span class=mi>00</span> <span class=n>etcd</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>3</span><span class=o>-</span><span class=mi>1667836800</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>41029664</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>8</span> <span class=mi>12</span><span class=p>:</span><span class=mi>00</span> <span class=n>etcd</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>3</span><span class=o>-</span><span class=mi>1667880000</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>41029664</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>9</span> <span class=mi>00</span><span class=p>:</span><span class=mi>00</span> <span class=n>etcd</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>3</span><span class=o>-</span><span class=mi>1667923200</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>56426528</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>9</span> <span class=mi>12</span><span class=p>:</span><span class=mi>00</span> <span class=n>etcd</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>3</span><span class=o>-</span><span class=mi>1667966400</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>56426528</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>9</span> <span class=mi>11</span><span class=p>:</span><span class=mi>58</span> <span class=n>pre</span><span class=o>-</span><span class=n>upgrade</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>v2</span><span class=o>.</span><span class=mf>6.6</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>3</span><span class=o>-</span><span class=mi>1667966290</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>192.168</span><span class=o>.</span><span class=mf>33.42</span> <span class=o>|</span> <span class=n>CHANGED</span> <span class=o>|</span> <span class=n>rc</span><span class=o>=</span><span class=mi>0</span> <span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=err>ç¸½ç”¨é‡</span> <span class=mi>270512</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>40488992</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>7</span> <span class=mi>12</span><span class=p>:</span><span class=mi>00</span> <span class=n>etcd</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>2</span><span class=o>-</span><span class=mi>1667793600</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>40488992</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>8</span> <span class=mi>00</span><span class=p>:</span><span class=mi>00</span> <span class=n>etcd</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>2</span><span class=o>-</span><span class=mi>1667836800</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>40488992</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>8</span> <span class=mi>12</span><span class=p>:</span><span class=mi>00</span> <span class=n>etcd</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>2</span><span class=o>-</span><span class=mi>1667880000</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>40488992</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>9</span> <span class=mi>00</span><span class=p>:</span><span class=mi>00</span> <span class=n>etcd</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>2</span><span class=o>-</span><span class=mi>1667923200</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>57511968</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>9</span> <span class=mi>12</span><span class=p>:</span><span class=mi>00</span> <span class=n>etcd</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>2</span><span class=o>-</span><span class=mi>1667966400</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>57511968</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>9</span> <span class=mi>11</span><span class=p>:</span><span class=mi>58</span> <span class=n>pre</span><span class=o>-</span><span class=n>upgrade</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>v2</span><span class=o>.</span><span class=mf>6.6</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>2</span><span class=o>-</span><span class=mi>1667966291</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>192.168</span><span class=o>.</span><span class=mf>33.41</span> <span class=o>|</span> <span class=n>CHANGED</span> <span class=o>|</span> <span class=n>rc</span><span class=o>=</span><span class=mi>0</span> <span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=err>ç¸½ç”¨é‡</span> <span class=mi>269656</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>41537568</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>7</span> <span class=mi>12</span><span class=p>:</span><span class=mi>00</span> <span class=n>etcd</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=mi>1667793600</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>41537568</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>8</span> <span class=mi>00</span><span class=p>:</span><span class=mi>00</span> <span class=n>etcd</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=mi>1667836800</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>41537568</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>8</span> <span class=mi>12</span><span class=p>:</span><span class=mi>00</span> <span class=n>etcd</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=mi>1667880000</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>41537568</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>9</span> <span class=mi>00</span><span class=p>:</span><span class=mi>00</span> <span class=n>etcd</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=mi>1667923200</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>54976544</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>9</span> <span class=mi>12</span><span class=p>:</span><span class=mi>00</span> <span class=n>etcd</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=mi>1667966400</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>54976544</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>9</span> <span class=mi>11</span><span class=p>:</span><span class=mi>58</span> <span class=n>pre</span><span class=o>-</span><span class=n>upgrade</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>v2</span><span class=o>.</span><span class=mf>6.6</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=mi>1667966289</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>ç¢ºèªç›®éŒ„etcd</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>wangken</span><span class=err>@</span><span class=n>wangken</span><span class=o>-</span><span class=n>MAC</span> <span class=n>rke2</span><span class=o>-</span><span class=n>lab</span> <span class=o>%</span> <span class=n>ansible</span> <span class=n>rke2</span><span class=o>-</span><span class=n>cluster</span> <span class=o>-</span><span class=n>m</span> <span class=n>shell</span> <span class=o>-</span><span class=n>a</span> <span class=s1>&#39;ls -l /var/lib/rancher/rke2/server/db/&#39;</span>         
</span></span><span class=line><span class=cl><span class=n>BECOME</span> <span class=n>password</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>192.168</span><span class=o>.</span><span class=mf>33.41</span> <span class=o>|</span> <span class=n>CHANGED</span> <span class=o>|</span> <span class=n>rc</span><span class=o>=</span><span class=mi>0</span> <span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=err>ç¸½ç”¨é‡</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>drwx</span><span class=o>------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span>  <span class=mi>32</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>9</span> <span class=mi>12</span><span class=p>:</span><span class=mi>20</span> <span class=n>etcd</span>
</span></span><span class=line><span class=cl><span class=n>drwx</span><span class=o>------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>400</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>9</span> <span class=mi>12</span><span class=p>:</span><span class=mi>00</span> <span class=n>snapshots</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>192.168</span><span class=o>.</span><span class=mf>33.43</span> <span class=o>|</span> <span class=n>CHANGED</span> <span class=o>|</span> <span class=n>rc</span><span class=o>=</span><span class=mi>0</span> <span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=err>ç¸½ç”¨é‡</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>drwx</span><span class=o>------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span>  <span class=mi>32</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>9</span> <span class=mi>12</span><span class=p>:</span><span class=mi>18</span> <span class=n>etcd</span>
</span></span><span class=line><span class=cl><span class=n>drwx</span><span class=o>------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>400</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>9</span> <span class=mi>12</span><span class=p>:</span><span class=mi>00</span> <span class=n>snapshots</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>192.168</span><span class=o>.</span><span class=mf>33.42</span> <span class=o>|</span> <span class=n>CHANGED</span> <span class=o>|</span> <span class=n>rc</span><span class=o>=</span><span class=mi>0</span> <span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=err>ç¸½ç”¨é‡</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>drwx</span><span class=o>------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span>  <span class=mi>32</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>9</span> <span class=mi>12</span><span class=p>:</span><span class=mi>17</span> <span class=n>etcd</span>
</span></span><span class=line><span class=cl><span class=n>drwx</span><span class=o>------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>400</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>9</span> <span class=mi>12</span><span class=p>:</span><span class=mi>00</span> <span class=n>snapshots</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>åœç”¨rke2-server service</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wangken@wangken-MAC rke2-lab % ansible rke2-cluster -m shell -a &#39;systemctl stop rke2-server&#39;            
</span></span><span class=line><span class=cl>BECOME password: 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>192.168.33.41 | CHANGED | rc=0 &gt;&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>192.168.33.43 | CHANGED | rc=0 &gt;&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>192.168.33.42 | CHANGED | rc=0 &gt;&gt;
</span></span></code></pre></td></tr></table></div></div></li><li><p>åœ¨rke2-1åŸ·è¡Œ restoreæŒ‡ä»¤ä¸¦å•Ÿå‹•rke2-server service</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>rke2</span> <span class=n>server</span> \
</span></span><span class=line><span class=cl>  <span class=o>--</span><span class=n>cluster</span><span class=o>-</span><span class=n>reset</span> \
</span></span><span class=line><span class=cl>  <span class=o>--</span><span class=n>cluster</span><span class=o>-</span><span class=n>reset</span><span class=o>-</span><span class=n>restore</span><span class=o>-</span><span class=n>path</span><span class=o>=&lt;</span><span class=n>PATH</span><span class=o>-</span><span class=n>TO</span><span class=o>-</span><span class=n>SNAPSHOT</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>server</span><span class=o>/</span><span class=n>db</span><span class=o>/</span><span class=n>snapshots</span> <span class=c1># pwd</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>server</span><span class=o>/</span><span class=n>db</span><span class=o>/</span><span class=n>snapshots</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>server</span><span class=o>/</span><span class=n>db</span><span class=o>/</span><span class=n>snapshots</span> <span class=c1># ll</span>
</span></span><span class=line><span class=cl><span class=n>total</span> <span class=mi>269656</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>41537568</span> <span class=n>Nov</span>  <span class=mi>7</span> <span class=mi>12</span><span class=p>:</span><span class=mi>00</span> <span class=n>etcd</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=mi>1667793600</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>41537568</span> <span class=n>Nov</span>  <span class=mi>8</span> <span class=mi>00</span><span class=p>:</span><span class=mi>00</span> <span class=n>etcd</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=mi>1667836800</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>41537568</span> <span class=n>Nov</span>  <span class=mi>8</span> <span class=mi>12</span><span class=p>:</span><span class=mi>00</span> <span class=n>etcd</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=mi>1667880000</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>41537568</span> <span class=n>Nov</span>  <span class=mi>9</span> <span class=mi>00</span><span class=p>:</span><span class=mi>00</span> <span class=n>etcd</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=mi>1667923200</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>54976544</span> <span class=n>Nov</span>  <span class=mi>9</span> <span class=mi>12</span><span class=p>:</span><span class=mi>00</span> <span class=n>etcd</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=mi>1667966400</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>54976544</span> <span class=n>Nov</span>  <span class=mi>9</span> <span class=mi>11</span><span class=p>:</span><span class=mi>58</span> <span class=n>pre</span><span class=o>-</span><span class=n>upgrade</span><span class=o>-</span><span class=n>snapshot</span><span class=o>-</span><span class=n>v2</span><span class=o>.</span><span class=mf>6.6</span><span class=o>-</span><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=mi>1667966289</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>server</span><span class=o>/</span><span class=n>db</span><span class=o>/</span><span class=n>snapshots</span> <span class=c1># rke2 server --cluster-reset --cluster-reset-restore-path=/var/lib/rancher/rke2/server/db/snapshots/pre-upgrade-snapshot-v2.6.6-rke2-1-1667966289</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>INFO</span><span class=p>[</span><span class=mi>0032</span><span class=p>]</span> <span class=n>Defragmenting</span> <span class=n>etcd</span> <span class=n>database</span>                  
</span></span><span class=line><span class=cl><span class=n>INFO</span><span class=p>[</span><span class=mi>0032</span><span class=p>]</span> <span class=n>Reconciling</span> <span class=n>bootstrap</span> <span class=n>data</span> <span class=n>between</span> <span class=n>datastore</span> <span class=ow>and</span> <span class=n>disk</span> 
</span></span><span class=line><span class=cl><span class=n>INFO</span><span class=p>[</span><span class=mi>0032</span><span class=p>]</span> <span class=n>Cluster</span> <span class=n>reset</span><span class=p>:</span> <span class=n>backing</span> <span class=n>up</span> <span class=n>certificates</span> <span class=n>directory</span> <span class=n>to</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>server</span><span class=o>/</span><span class=n>tls</span><span class=o>-</span><span class=mi>1667973877</span> 
</span></span><span class=line><span class=cl><span class=n>INFO</span><span class=p>[</span><span class=mi>0033</span><span class=p>]</span> <span class=n>Defragmenting</span> <span class=n>etcd</span> <span class=n>database</span>                  
</span></span><span class=line><span class=cl><span class=n>INFO</span><span class=p>[</span><span class=mi>0033</span><span class=p>]</span> <span class=n>etcd</span> <span class=n>data</span> <span class=n>store</span> <span class=n>connection</span> <span class=n>OK</span>                
</span></span><span class=line><span class=cl><span class=n>INFO</span><span class=p>[</span><span class=mi>0033</span><span class=p>]</span> <span class=n>Waiting</span> <span class=k>for</span> <span class=n>API</span> <span class=n>server</span> <span class=n>to</span> <span class=n>become</span> <span class=n>available</span>   
</span></span><span class=line><span class=cl><span class=n>INFO</span><span class=p>[</span><span class=mi>0033</span><span class=p>]</span> <span class=n>ETCD</span> <span class=n>server</span> <span class=n>is</span> <span class=n>now</span> <span class=n>running</span>                   
</span></span><span class=line><span class=cl><span class=n>INFO</span><span class=p>[</span><span class=mi>0033</span><span class=p>]</span> <span class=n>rke2</span> <span class=n>is</span> <span class=n>up</span> <span class=ow>and</span> <span class=n>running</span>                       
</span></span><span class=line><span class=cl><span class=n>WARN</span><span class=p>[</span><span class=mi>0033</span><span class=p>]</span> <span class=n>bootstrap</span> <span class=n>key</span> <span class=n>already</span> <span class=n>exists</span>                 
</span></span><span class=line><span class=cl><span class=n>INFO</span><span class=p>[</span><span class=mi>0033</span><span class=p>]</span> <span class=n>Reconciling</span> <span class=n>etcd</span> <span class=n>snapshot</span> <span class=n>data</span> <span class=ow>in</span> <span class=n>rke2</span><span class=o>-</span><span class=n>etcd</span><span class=o>-</span><span class=n>snapshots</span> <span class=n>ConfigMap</span> 
</span></span><span class=line><span class=cl><span class=n>INFO</span><span class=p>[</span><span class=mi>0035</span><span class=p>]</span> <span class=n>Waiting</span> <span class=n>to</span> <span class=n>retrieve</span> <span class=n>kube</span><span class=o>-</span><span class=n>proxy</span> <span class=n>configuration</span><span class=p>;</span> <span class=n>server</span> <span class=n>is</span> <span class=ow>not</span> <span class=n>ready</span><span class=p>:</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=mf>127.0</span><span class=o>.</span><span class=mf>0.1</span><span class=p>:</span><span class=mi>6444</span><span class=o>/</span><span class=n>v1</span><span class=o>-</span><span class=n>rke2</span><span class=o>/</span><span class=n>readyz</span><span class=p>:</span> <span class=mi>500</span> <span class=n>Internal</span> <span class=n>Server</span> <span class=n>Error</span> 
</span></span><span class=line><span class=cl><span class=n>INFO</span><span class=p>[</span><span class=mi>0037</span><span class=p>]</span> <span class=n>Managed</span> <span class=n>etcd</span> <span class=n>cluster</span> <span class=n>membership</span> <span class=n>has</span> <span class=n>been</span> <span class=n>reset</span><span class=p>,</span> <span class=n>restart</span> <span class=n>without</span> <span class=o>--</span><span class=n>cluster</span><span class=o>-</span><span class=n>reset</span> <span class=n>flag</span> <span class=n>now</span><span class=o>.</span> <span class=n>Backup</span> <span class=ow>and</span> <span class=n>delete</span> <span class=o>$</span><span class=p>{</span><span class=n>datadir</span><span class=p>}</span><span class=o>/</span><span class=n>server</span><span class=o>/</span><span class=n>db</span> <span class=n>on</span> <span class=n>each</span> <span class=n>peer</span> <span class=n>etcd</span> <span class=n>server</span> <span class=ow>and</span> <span class=n>rejoin</span> <span class=n>the</span> <span class=n>nodes</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>server</span><span class=o>/</span><span class=n>db</span> <span class=c1># ll</span>
</span></span><span class=line><span class=cl><span class=n>total</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>drwx</span><span class=o>------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span>  <span class=mi>32</span> <span class=n>Nov</span>  <span class=mi>9</span> <span class=mi>14</span><span class=p>:</span><span class=mi>05</span> <span class=n>etcd</span>
</span></span><span class=line><span class=cl><span class=n>drwx</span><span class=o>------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span>  <span class=mi>32</span> <span class=n>Nov</span>  <span class=mi>9</span> <span class=mi>12</span><span class=p>:</span><span class=mi>20</span> <span class=n>etcd</span><span class=o>-</span><span class=n>old</span><span class=o>-</span><span class=mi>1667973863</span>
</span></span><span class=line><span class=cl><span class=n>drwx</span><span class=o>------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>426</span> <span class=n>Nov</span>  <span class=mi>9</span> <span class=mi>14</span><span class=p>:</span><span class=mi>04</span> <span class=n>snapshots</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rke2</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>server</span><span class=o>/</span><span class=n>db</span><span class=o>/</span><span class=n>snapshots</span> <span class=c1># systemctl start rke2-server</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>åˆªé™¤å‰©ä¸‹å…©å€‹ç¯€é»çš„ /var/lib/rancher/rke2/server/db</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rke2</span><span class=o>-</span><span class=mi>2</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>sudo</span> <span class=n>cp</span> <span class=o>-</span><span class=n>r</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>server</span><span class=o>/</span><span class=n>db</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>db_old</span>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rke2</span><span class=o>-</span><span class=mi>2</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>sudo</span> <span class=n>rm</span> <span class=o>-</span><span class=n>rf</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>server</span><span class=o>/</span><span class=n>db</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rke2</span><span class=o>-</span><span class=mi>3</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>sudo</span> <span class=n>cp</span> <span class=o>-</span><span class=n>r</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>server</span><span class=o>/</span><span class=n>db</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>db_old</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>sudo</span><span class=p>]</span> <span class=n>root</span> <span class=err>çš„å¯†ç¢¼ï¼š</span>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rke2</span><span class=o>-</span><span class=mi>3</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>sudo</span> <span class=n>rm</span> <span class=o>-</span><span class=n>rf</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>rancher</span><span class=o>/</span><span class=n>rke2</span><span class=o>/</span><span class=n>server</span><span class=o>/</span><span class=n>db</span>
</span></span><span class=line><span class=cl><span class=n>devop</span><span class=err>@</span><span class=n>rke2</span><span class=o>-</span><span class=mi>3</span><span class=p>:</span><span class=o>~&gt;</span> <span class=n>sudo</span> <span class=n>systemctl</span> <span class=n>start</span> <span class=n>rke2</span><span class=o>-</span><span class=n>server</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>åˆ‡æ›åˆ°rmsç¢ºèªnodeç‹€æ…‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~&gt; kubectl get nodes
</span></span><span class=line><span class=cl>NAME     STATUS   ROLES                       AGE   VERSION
</span></span><span class=line><span class=cl>rke2-1   Ready    control-plane,etcd,master   14d   v1.24.4+rke2r1
</span></span><span class=line><span class=cl>rke2-2   Ready    control-plane,etcd,master   14d   v1.24.4+rke2r1
</span></span><span class=line><span class=cl>rke2-3   Ready    control-plane,etcd,master   14d   v1.24.4+rke2r1
</span></span></code></pre></td></tr></table></div></div></li><li><p>Web UI ç‰ˆæœ¬å›åˆ°v2.6.6
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221109141718197.png loading=lazy alt=image-20221109141718197></p></li><li><p>/var/lib/rancher/rke2/server/db/ æª”æ¡ˆè·¯å¾‘</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>wangken</span><span class=err>@</span><span class=n>wangken</span><span class=o>-</span><span class=n>MAC</span> <span class=n>rke2</span><span class=o>-</span><span class=n>lab</span> <span class=o>%</span> <span class=n>ansible</span> <span class=n>rke2</span><span class=o>-</span><span class=n>cluster</span> <span class=o>-</span><span class=n>m</span> <span class=n>shell</span> <span class=o>-</span><span class=n>a</span> <span class=s1>&#39;ls -l /var/lib/rancher/rke2/server/db/&#39;</span>
</span></span><span class=line><span class=cl><span class=n>BECOME</span> <span class=n>password</span><span class=p>:</span> 
</span></span><span class=line><span class=cl><span class=mf>192.168</span><span class=o>.</span><span class=mf>33.42</span> <span class=o>|</span> <span class=n>CHANGED</span> <span class=o>|</span> <span class=n>rc</span><span class=o>=</span><span class=mi>0</span> <span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=err>ç¸½ç”¨é‡</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>drwx</span><span class=o>------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>32</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>9</span> <span class=mi>14</span><span class=p>:</span><span class=mi>16</span> <span class=n>etcd</span>
</span></span><span class=line><span class=cl><span class=n>drwx</span><span class=o>------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span>  <span class=mi>0</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>9</span> <span class=mi>14</span><span class=p>:</span><span class=mi>17</span> <span class=n>snapshots</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>192.168</span><span class=o>.</span><span class=mf>33.43</span> <span class=o>|</span> <span class=n>CHANGED</span> <span class=o>|</span> <span class=n>rc</span><span class=o>=</span><span class=mi>0</span> <span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=err>ç¸½ç”¨é‡</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>drwx</span><span class=o>------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>32</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>9</span> <span class=mi>14</span><span class=p>:</span><span class=mi>15</span> <span class=n>etcd</span>
</span></span><span class=line><span class=cl><span class=n>drwx</span><span class=o>------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span>  <span class=mi>0</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>9</span> <span class=mi>14</span><span class=p>:</span><span class=mi>15</span> <span class=n>snapshots</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>192.168</span><span class=o>.</span><span class=mf>33.41</span> <span class=o>|</span> <span class=n>CHANGED</span> <span class=o>|</span> <span class=n>rc</span><span class=o>=</span><span class=mi>0</span> <span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=err>ç¸½ç”¨é‡</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>drwx</span><span class=o>------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span>  <span class=mi>32</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>9</span> <span class=mi>14</span><span class=p>:</span><span class=mi>05</span> <span class=n>etcd</span>
</span></span><span class=line><span class=cl><span class=n>drwx</span><span class=o>------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span>  <span class=mi>32</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>9</span> <span class=mi>12</span><span class=p>:</span><span class=mi>20</span> <span class=n>etcd</span><span class=o>-</span><span class=n>old</span><span class=o>-</span><span class=mi>1667973863</span>
</span></span><span class=line><span class=cl><span class=n>drwx</span><span class=o>------</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mi>426</span> <span class=mi>11</span><span class=err>æœˆ</span>  <span class=mi>9</span> <span class=mi>14</span><span class=p>:</span><span class=mi>04</span> <span class=n>snapshots</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>ç¢ºèªpod status å¡åœ¨Terminating</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~&gt; kubectl get po -o wide -n cattle-system
</span></span><span class=line><span class=cl>NAME                             READY   STATUS        RESTARTS   AGE     IP            NODE     NOMINATED NODE   READINESS GATES
</span></span><span class=line><span class=cl>rancher-7fd65d9cd6-fjvxr         1/1     Running       0          16m     10.42.0.127   rke2-1   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>rancher-7fd65d9cd6-hsbhg         0/1     Terminating   0          3h33m   &lt;none&gt;        rke2-3   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>rancher-7fd65d9cd6-qz9xb         1/1     Terminating   0          3h33m   10.42.1.58    rke2-2   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>rancher-7fd65d9cd6-zk2f9         1/1     Running       0          16m     10.42.0.123   rke2-1   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>rancher-7fd65d9cd6-zrdm8         1/1     Running       0          3h33m   10.42.0.117   rke2-1   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>rancher-webhook-d6f8b6cb-j2whv   1/1     Running       0          16m     10.42.0.126   rke2-1   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></td></tr></table></div></div></li><li><p>å¼·åˆ¶åˆªé™¤pod</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>devop@rms:~&gt; kubectl delete pod --grace-period=0 --force -n cattle-system rancher-7fd65d9cd6-qz9xb
</span></span><span class=line><span class=cl>warning: Immediate deletion does not wait for confirmation that the running resource has been terminated. The resource may continue to run on the cluster indefinitely.
</span></span><span class=line><span class=cl>pod &#34;rancher-7fd65d9cd6-qz9xb&#34; force deleted
</span></span><span class=line><span class=cl>devop@rms:~&gt; kubectl delete pod --grace-period=0 --force -n cattle-system rancher-7fd65d9cd6-hsbhg
</span></span><span class=line><span class=cl>warning: Immediate deletion does not wait for confirmation that the running resource has been terminated. The resource may continue to run on the cluster indefinitely.
</span></span><span class=line><span class=cl>pod &#34;rancher-7fd65d9cd6-hsbhg&#34; force deleted
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>devop@rms:~&gt; kubectl get po -o wide -n cattle-system
</span></span><span class=line><span class=cl>NAME                             READY   STATUS              RESTARTS   AGE   IP            NODE     NOMINATED NODE   READINESS GATES
</span></span><span class=line><span class=cl>rancher-7fd65d9cd6-5rglz         0/1     ContainerCreating   0          12m   &lt;none&gt;        rke2-3   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>rancher-7fd65d9cd6-fjvxr         1/1     Running             0          29m   10.42.0.127   rke2-1   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>rancher-7fd65d9cd6-zk2f9         1/1     Running             0          30m   10.42.0.123   rke2-1   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>rancher-webhook-d6f8b6cb-j2whv   1/1     Running             0          29m   10.42.0.126   rke2-1   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></td></tr></table></div></div></li><li><p>é‡å»ºrke2-2ã€rke2-3</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo systemctl stop rke2-server
</span></span><span class=line><span class=cl>sudo rke2 server --cluster-reset
</span></span><span class=line><span class=cl>sudo systemctl start rke2-server
</span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=å‚™ä»½downstream-cluster>å‚™ä»½Downstream Cluster</h2><p>èª¿æ•´å‚™ä»½æ’ç¨‹,ç›®å‰æ¯äº”å°æ™‚å‚™ä»½ä¸€æ¬¡
<strong>/var/lib/rancher/rke2/server/db/snapshots</strong></p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221216114859715.png loading=lazy alt=image-20221216114859715></p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221216115017093.png loading=lazy alt=image-20221216115017093></p><h2 id=é‚„åŸdownstream-cluster>é‚„åŸDownstream Cluster</h2><p>åœ¨Cluster Managementå¯é‡å°Clusteråšé‚„åŸ</p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221216115047603.png loading=lazy alt=image-20221216115047603></p><p>é¸æ“‡è¦é‚„åŸçš„æ™‚é–“é»ã€é‚„åŸçš„ç‰ˆæœ¬åŠetcd</p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20221216115059772.png loading=lazy alt=image-20221216115059772></p></section><footer class=article-footer><section class=article-tags><a href=/tags/suse/>SUSE</a>
<a href=/tags/rancher/>Rancher</a>
<a href=/tags/kubernetes/>Kubernetes</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸é—œæ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/hello-world/><div class=article-details><h2 class=article-title>Hello World</h2></div></a></article><article><a href=/p/nutanix_nkp-v2.13_ahv/><div class=article-details><h2 class=article-title>Nutanix_NKP-v2.13_AHV</h2></div></a></article><article><a href=/p/ocp-4.16.3_on_nutanixipi/><div class=article-details><h2 class=article-title>OCP-4.16.3_on_Nutanix(IPI)</h2></div></a></article><article><a href=/p/nutanix_nkp-v2.13_preprovisioned/><div class=article-details><h2 class=article-title>Nutanix_NKP-v2.13_Preprovisioned</h2></div></a></article><article><a href=/p/nutanix_nkp-v2.12_ahv/><div class=article-details><h2 class=article-title>Nutanix_NKP-v2.12_AHV</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//wangken0129.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2023 -
2025 Ken's blog</section><section class=powerby>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> å»ºç«‹<br>ä¸»é¡Œ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è¨­è¨ˆ</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>