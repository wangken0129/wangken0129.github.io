<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Nutanix Karbon & Files"><title>Nutanix Karbon&amp;Files</title>
<link rel=canonical href=https://wangken0129.github.io/p/karbonfiles/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="Nutanix Karbon&Files"><meta property='og:description' content="Nutanix Karbon & Files"><meta property='og:url' content='https://wangken0129.github.io/p/karbonfiles/'><meta property='og:site_name' content="Ken's blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Nutanix'><meta property='article:tag' content='Karbon'><meta property='article:tag' content='Kubernetes'><meta property='article:published_time' content='2023-09-23T02:46:09+08:00'><meta property='article:modified_time' content='2023-09-23T02:46:09+08:00'><meta name=twitter:title content="Nutanix Karbon&Files"><meta name=twitter:description content="Nutanix Karbon & Files"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切換選單>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_c68a00bbf16dac8.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🇹🇼</span></figure><div class=site-meta><h1 class=site-name><a href=/>Ken's blog</a></h1><h2 class=site-description>紀錄與分享，當個快樂的工程師</h2></div></header><ol class=menu-social><li><a href=https://github.com/wangken0129/wangken0129.github.io target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/ken-wang-88924b181/ target=_blank title=LinkedIn rel=me><svg class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>夜晚模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目錄</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#linux主機安裝設定測試用>Linux主機安裝設定(測試用)</a><ol><li><a href=#安裝一台centos-stream9>安裝一台CentOS-Stream9</a></li><li><a href=#設定router--nat>設定Router & NAT</a></li><li><a href=#安裝dns-server-named>安裝DNS Server (named)</a></li><li><a href=#安裝nfs-server>安裝NFS Server</a></li></ol></li><li><a href=#karbon-airgap>Karbon (Airgap)</a><ol><li><ol><li><a href=#安裝httpd>安裝httpd</a></li><li><a href=#安裝karbon>安裝Karbon</a></li><li><a href=#連線測試nke>連線測試NKE</a></li><li><a href=#新增測試服務-redmine>新增測試服務-redmine</a></li><li><a href=#enable-advance-k8s>Enable Advance k8s</a></li><li><a href=#rancher-install>Rancher install</a></li></ol></li></ol></li><li><a href=#files>FIles</a><ol><li><ol><li><a href=#架構>架構</a></li><li><a href=#安裝ad>安裝AD</a></li><li><a href=#安裝file-server-on-pe>安裝File Server on PE</a></li><li><a href=#file-ha>File HA</a></li><li><a href=#csi>CSI</a></li></ol></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/lab-category/ style=background-color:#2a9d8f;color:#fff>Lab Category</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/karbonfiles/>Nutanix Karbon&amp;Files</a></h2><h3 class=article-subtitle>Nutanix Karbon & Files</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Sep 23, 2023</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>閱讀時間: 21 分鐘</time></div></footer></div></header><section class=article-content><h1 id=karbonfiles>Karbon、Files</h1><p>測試安裝Nutanix 內建的Kubernetes，並使用內建的Storage儲存空間(NFS、Volume)</p><h2 id=linux主機安裝設定測試用>Linux主機安裝設定(測試用)</h2><p>(測試功能又不佔用ip才需要此Linux主機)</p><h3 id=安裝一台centos-stream9>安裝一台CentOS-Stream9</h3><p>IP: 172.16.90.205 , 192.168.1.1
Host: bastion.netfos.ken.lab</p><p>此VM作用為 Router, NAT, DHCP, DNS,Web等等</p><p>PE Network設定,新增192.168.1.1的subnet並綁到vSwitch上 (啟動IPAM)</p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230111135752295.png loading=lazy alt=image-20230111135752295></p><ol><li><p>upload iso to Prism Element</p></li><li><p>on Prism Central import iso</p></li><li><p>create VM on Prism Central
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230111114303181.png loading=lazy alt=image-20230111114303181></p></li><li><p>安裝OS</p></li></ol><h3 id=設定router--nat>設定Router & NAT</h3><p><a class=link href=https://linux.vbird.org/linux_server/centos6/0230router.php target=_blank rel=noopener>https://linux.vbird.org/linux_server/centos6/0230router.php</a></p><ol><li><p>啟動Linux Kernal 的 ip_forwarder功能</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[ken@bastion ~]$ sudo vim /etc/sysctl.conf 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>net.ipv4.ip_forward = 1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[ken@bastion ~]$ sudo sysctl -p
</span></span><span class=line><span class=cl>net.ipv4.ip_forward = 1     
</span></span><span class=line><span class=cl>[ken@bastion ~]$ sudo cat /proc/sys/net/ipv4/ip_forward
</span></span><span class=line><span class=cl>1
</span></span></code></pre></td></tr></table></div></div></li><li><p>NAT設定</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[ken@bastion ~]$ sudo iptables -A INPUT -i ens4 -j ACCEPT
</span></span><span class=line><span class=cl>[ken@bastion ~]$ sudo iptables -A INPUT -i lo -j ACCEPT
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[ken@bastion ~]$ sudo iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -j MASQUERADE
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[ken@bastion ~]$ sudo iptables -L
</span></span><span class=line><span class=cl>Chain INPUT (policy ACCEPT)
</span></span><span class=line><span class=cl>target     prot opt source               destination         
</span></span><span class=line><span class=cl>ACCEPT     all  --  anywhere             anywhere            
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Chain FORWARD (policy ACCEPT)
</span></span><span class=line><span class=cl>target     prot opt source               destination         
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Chain OUTPUT (policy ACCEPT)
</span></span><span class=line><span class=cl>target     prot opt source               destination 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[ken@bastion ~]$ sudo iptables-save
</span></span><span class=line><span class=cl># Generated by iptables-save v1.8.8 (nf_tables) on Wed Jan 11 12:06:10 2023
</span></span><span class=line><span class=cl>*filter
</span></span><span class=line><span class=cl>:INPUT ACCEPT [0:0]
</span></span><span class=line><span class=cl>:FORWARD ACCEPT [0:0]
</span></span><span class=line><span class=cl>:OUTPUT ACCEPT [0:0]
</span></span><span class=line><span class=cl>-A INPUT -i ens4 -j ACCEPT
</span></span><span class=line><span class=cl>COMMIT
</span></span><span class=line><span class=cl># Completed on Wed Jan 11 12:06:10 2023
</span></span><span class=line><span class=cl># Generated by iptables-save v1.8.8 (nf_tables) on Wed Jan 11 12:06:10 2023
</span></span><span class=line><span class=cl>*nat
</span></span><span class=line><span class=cl>:PREROUTING ACCEPT [0:0]
</span></span><span class=line><span class=cl>:INPUT ACCEPT [0:0]
</span></span><span class=line><span class=cl>:OUTPUT ACCEPT [0:0]
</span></span><span class=line><span class=cl>:POSTROUTING ACCEPT [0:0]
</span></span><span class=line><span class=cl>-A POSTROUTING -s 192.168.1.0/24 -j MASQUERADE
</span></span><span class=line><span class=cl>COMMIT
</span></span><span class=line><span class=cl># Completed on Wed Jan 11 12:06:10 2023
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>關閉防火牆
</span></span><span class=line><span class=cl>sudo systemctl disable firewalld --now
</span></span></code></pre></td></tr></table></div></div></li><li><p>DNAT設定
<a class=link href="https://portal.nutanix.com/page/documents/details?targetId=Port-Reference:NKE_Airgap_port_auto_r.html" target=_blank rel=noopener>https://portal.nutanix.com/page/documents/details?targetId=Port-Reference:NKE_Airgap_port_auto_r.html</a>
<a class=link href="https://portal.nutanix.com/page/documents/details?targetId=Port-Reference:Nutanix_Kubernetes_Engine_port_auto_r.html" target=_blank rel=noopener>https://portal.nutanix.com/page/documents/details?targetId=Port-Reference:Nutanix_Kubernetes_Engine_port_auto_r.html</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>## For NKE Registry
</span></span><span class=line><span class=cl>sudo iptables -t nat -A PREROUTING -i ens3 -p tcp --dport 22 \
</span></span><span class=line><span class=cl>     -j DNAT --to-destination 192.168.1.5:22
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo iptables -t nat -A PREROUTING -i ens3 -p tcp --dport 5000 \
</span></span><span class=line><span class=cl>     -j DNAT --to-destination 192.168.1.5:5000
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo iptables-save
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## For NKE Loadbalnacer
</span></span><span class=line><span class=cl>sudo iptables -t nat -A PREROUTING -i ens3 -p tcp --dport 443 \
</span></span><span class=line><span class=cl>     -j DNAT --to-destination 192.168.1.10:22
</span></span><span class=line><span class=cl>sudo iptables -t nat -A PREROUTING -i ens3 -p tcp --dport 2379 \
</span></span><span class=line><span class=cl>     -j DNAT --to-destination 192.168.1.10:2379
</span></span><span class=line><span class=cl>sudo iptables -t nat -A PREROUTING -i ens3 -p tcp --dport 30001 \
</span></span><span class=line><span class=cl>     -j DNAT --to-destination 192.168.1.10:30001
</span></span><span class=line><span class=cl>sudo iptables -t nat -A PREROUTING -i ens3 -p tcp --dport 30000:32767 \
</span></span><span class=line><span class=cl>     -j DNAT --to-destination 192.168.1.10:30000-32767
</span></span><span class=line><span class=cl>sudo iptables-save
</span></span></code></pre></td></tr></table></div></div></li><li><p>拿一台測試VM確認可ping 通
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230111135706837.png loading=lazy alt=image-20230111135706837></p></li></ol><h3 id=安裝dns-server-named>安裝DNS Server (named)</h3><ol><li><p>安裝named</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[ken@bastion ~]$ sudo yum install bind bind-libs bind-chroot bind-utils
</span></span><span class=line><span class=cl>[sudo] password for ken: 
</span></span></code></pre></td></tr></table></div></div></li><li><p>修改named 設定檔 /etc/named.conf</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=err>@</span><span class=n>bastion</span> <span class=n>data</span><span class=p>]</span><span class=c1># cat /etc/named.conf </span>
</span></span><span class=line><span class=cl><span class=o>//</span>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>named</span><span class=o>.</span><span class=n>conf</span>
</span></span><span class=line><span class=cl><span class=o>//</span>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>Provided</span> <span class=n>by</span> <span class=n>Red</span> <span class=n>Hat</span> <span class=n>bind</span> <span class=n>package</span> <span class=n>to</span> <span class=n>configure</span> <span class=n>the</span> <span class=n>ISC</span> <span class=n>BIND</span> <span class=n>named</span><span class=p>(</span><span class=mi>8</span><span class=p>)</span> <span class=n>DNS</span>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>server</span> <span class=n>as</span> <span class=n>a</span> <span class=n>caching</span> <span class=n>only</span> <span class=n>nameserver</span> <span class=p>(</span><span class=n>as</span> <span class=n>a</span> <span class=n>localhost</span> <span class=n>DNS</span> <span class=n>resolver</span> <span class=n>only</span><span class=p>)</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=o>//</span>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>See</span> <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>share</span><span class=o>/</span><span class=n>doc</span><span class=o>/</span><span class=n>bind</span><span class=o>*/</span><span class=n>sample</span><span class=o>/</span> <span class=k>for</span> <span class=n>example</span> <span class=n>named</span> <span class=n>configuration</span> <span class=n>files</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=o>//</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>options</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=n>listen</span><span class=o>-</span><span class=n>on</span> <span class=n>port</span> <span class=mi>53</span> <span class=p>{</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>1.1</span><span class=p>;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>	<span class=o>//</span><span class=n>listen</span><span class=o>-</span><span class=n>on</span><span class=o>-</span><span class=n>v6</span> <span class=n>port</span> <span class=mi>53</span> <span class=p>{</span> <span class=p>::</span><span class=mi>1</span><span class=p>;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>	<span class=n>directory</span> 	<span class=s2>&#34;/var/named&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>dump</span><span class=o>-</span><span class=n>file</span> 	<span class=s2>&#34;/var/named/data/cache_dump.db&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>statistics</span><span class=o>-</span><span class=n>file</span> <span class=s2>&#34;/var/named/data/named_stats.txt&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>memstatistics</span><span class=o>-</span><span class=n>file</span> <span class=s2>&#34;/var/named/data/named_mem_stats.txt&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>secroots</span><span class=o>-</span><span class=n>file</span>	<span class=s2>&#34;/var/named/data/named.secroots&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>recursing</span><span class=o>-</span><span class=n>file</span>	<span class=s2>&#34;/var/named/data/named.recursing&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>allow</span><span class=o>-</span><span class=n>query</span>     <span class=p>{</span> <span class=n>any</span><span class=p>;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>	<span class=c1>## 設定轉寄站</span>
</span></span><span class=line><span class=cl>	<span class=n>forwarders</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=mf>192.168</span><span class=o>.</span><span class=mf>102.1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=mf>192.168</span><span class=o>.</span><span class=mf>102.2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=o>/*</span> 
</span></span><span class=line><span class=cl>	 <span class=o>-</span> <span class=n>If</span> <span class=n>you</span> <span class=n>are</span> <span class=n>building</span> <span class=n>an</span> <span class=n>AUTHORITATIVE</span> <span class=n>DNS</span> <span class=n>server</span><span class=p>,</span> <span class=k>do</span> <span class=n>NOT</span> <span class=n>enable</span> <span class=n>recursion</span><span class=o>.</span>
</span></span><span class=line><span class=cl>	 <span class=o>-</span> <span class=n>If</span> <span class=n>you</span> <span class=n>are</span> <span class=n>building</span> <span class=n>a</span> <span class=n>RECURSIVE</span> <span class=p>(</span><span class=n>caching</span><span class=p>)</span> <span class=n>DNS</span> <span class=n>server</span><span class=p>,</span> <span class=n>you</span> <span class=n>need</span> <span class=n>to</span> <span class=n>enable</span> 
</span></span><span class=line><span class=cl>	   <span class=n>recursion</span><span class=o>.</span> 
</span></span><span class=line><span class=cl>	 <span class=o>-</span> <span class=n>If</span> <span class=n>your</span> <span class=n>recursive</span> <span class=n>DNS</span> <span class=n>server</span> <span class=n>has</span> <span class=n>a</span> <span class=n>public</span> <span class=ne>IP</span> <span class=n>address</span><span class=p>,</span> <span class=n>you</span> <span class=n>MUST</span> <span class=n>enable</span> <span class=n>access</span> 
</span></span><span class=line><span class=cl>	   <span class=n>control</span> <span class=n>to</span> <span class=n>limit</span> <span class=n>queries</span> <span class=n>to</span> <span class=n>your</span> <span class=n>legitimate</span> <span class=n>users</span><span class=o>.</span> <span class=n>Failing</span> <span class=n>to</span> <span class=k>do</span> <span class=n>so</span> <span class=n>will</span>
</span></span><span class=line><span class=cl>	   <span class=n>cause</span> <span class=n>your</span> <span class=n>server</span> <span class=n>to</span> <span class=n>become</span> <span class=n>part</span> <span class=n>of</span> <span class=n>large</span> <span class=n>scale</span> <span class=n>DNS</span> <span class=n>amplification</span> 
</span></span><span class=line><span class=cl>	   <span class=n>attacks</span><span class=o>.</span> <span class=n>Implementing</span> <span class=n>BCP38</span> <span class=n>within</span> <span class=n>your</span> <span class=n>network</span> <span class=n>would</span> <span class=n>greatly</span>
</span></span><span class=line><span class=cl>	   <span class=n>reduce</span> <span class=n>such</span> <span class=n>attack</span> <span class=n>surface</span> 
</span></span><span class=line><span class=cl>	<span class=o>*/</span>
</span></span><span class=line><span class=cl>	<span class=n>recursion</span> <span class=n>yes</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>dnssec</span><span class=o>-</span><span class=n>validation</span> <span class=n>no</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>dnssec</span><span class=o>-</span><span class=n>enable</span> <span class=n>yes</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>managed</span><span class=o>-</span><span class=n>keys</span><span class=o>-</span><span class=n>directory</span> <span class=s2>&#34;/var/named/dynamic&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>geoip</span><span class=o>-</span><span class=n>directory</span> <span class=s2>&#34;/usr/share/GeoIP&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>pid</span><span class=o>-</span><span class=n>file</span> <span class=s2>&#34;/run/named/named.pid&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>session</span><span class=o>-</span><span class=n>keyfile</span> <span class=s2>&#34;/run/named/session.key&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=o>/*</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>fedoraproject</span><span class=o>.</span><span class=n>org</span><span class=o>/</span><span class=n>wiki</span><span class=o>/</span><span class=n>Changes</span><span class=o>/</span><span class=n>CryptoPolicy</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl>	<span class=n>include</span> <span class=s2>&#34;/etc/crypto-policies/back-ends/bind.config&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>logging</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>channel</span> <span class=n>default_debug</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>file</span> <span class=s2>&#34;data/named.run&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>severity</span> <span class=n>dynamic</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>zone</span> <span class=s2>&#34;.&#34;</span> <span class=n>IN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=n>type</span> <span class=n>hint</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>file</span> <span class=s2>&#34;named.ca&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>include</span> <span class=s2>&#34;/etc/named.rfc1912.zones&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>include</span> <span class=s2>&#34;/etc/named.root.key&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>zone</span> <span class=s2>&#34;netfos.ken.lab&#34;</span> <span class=n>IN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>type</span> <span class=n>master</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>file</span> <span class=s2>&#34;ken.zone&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>allow</span><span class=o>-</span><span class=n>update</span> <span class=p>{</span> <span class=n>none</span><span class=p>;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=n>allow</span><span class=o>-</span><span class=n>query</span> <span class=p>{</span> <span class=n>any</span><span class=p>;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=n>allow</span><span class=o>-</span><span class=n>transfer</span> <span class=p>{</span> <span class=n>none</span><span class=p>;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=n>zone</span> <span class=s2>&#34;1.168.192.in-addr.arpa&#34;</span> <span class=n>IN</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>type</span> <span class=n>master</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>file</span> <span class=s2>&#34;ken.reverse&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>allow</span><span class=o>-</span><span class=n>update</span> <span class=p>{</span> <span class=n>none</span><span class=p>;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>                <span class=n>allow</span><span class=o>-</span><span class=n>query</span> <span class=p>{</span> <span class=n>any</span><span class=p>;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>                <span class=n>allow</span><span class=o>-</span><span class=n>transfer</span> <span class=p>{</span> <span class=n>none</span><span class=p>;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>修改正向解析 /var/named/ken.zone</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dns data-lang=dns><span class=line><span class=cl><span class=err>[root@bastion</span><span class=w> </span><span class=err>named]#</span><span class=w> </span><span class=err>cat</span><span class=w> </span><span class=nc>ken.zone</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=na>$TTL</span><span class=w> </span><span class=sc>1</span><span class=err>W</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nc>@</span><span class=w>	</span><span class=k>IN</span><span class=w>	</span><span class=k>SOA</span><span class=w>	</span><span class=py>bastion.netfos.ken.lab.	</span><span class=err>root</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=sc>2019070700</span><span class=w>	</span><span class=c>; serial</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=sc>3</span><span class=err>H</span><span class=w>		</span><span class=c>; refresh (3 hours)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=sc>30</span><span class=err>M</span><span class=w>		</span><span class=c>; retry (30 minutes)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=sc>2</span><span class=err>W</span><span class=w>		</span><span class=c>; expiry (2 weeks)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=sc>1</span><span class=err>W</span><span class=w> </span><span class=p>)</span><span class=w>		</span><span class=c>; minimum (1 week)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>IN</span><span class=w>	</span><span class=k>NS</span><span class=w>	</span><span class=py>bastion.netfos.ken.lab.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=py>bastion.netfos.ken.lab.	</span><span class=k>IN</span><span class=w>	</span><span class=k>A</span><span class=w>	</span><span class=mi>192.168.1.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>;EOF</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>修改反解析 /var/named/ken.reverse</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dns data-lang=dns><span class=line><span class=cl><span class=err>[root@bastion</span><span class=w> </span><span class=err>named]#</span><span class=w> </span><span class=err>cat</span><span class=w> </span><span class=nc>ken.reverse</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=na>$TTL</span><span class=w> </span><span class=sc>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nc>@</span><span class=w>	</span><span class=k>IN</span><span class=w>	</span><span class=k>SOA</span><span class=w>	</span><span class=py>bastion.netfos.ken.lab.	</span><span class=err>root</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=sc>2019070700</span><span class=w>	</span><span class=c>; serial</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=sc>3</span><span class=err>H</span><span class=w>		</span><span class=c>; refresh (3 hours)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=sc>30</span><span class=err>M</span><span class=w>		</span><span class=c>; retry (30 minutes)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=sc>2</span><span class=err>W</span><span class=w>		</span><span class=c>; expiry (2 weeks)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=sc>1</span><span class=err>W</span><span class=w> </span><span class=p>)</span><span class=w>		</span><span class=c>; minimum (1 week)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>IN</span><span class=w>	</span><span class=k>NS</span><span class=w>	</span><span class=py>bastion.netfos.ken.lab.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>;EOF</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>調整防火牆</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=err>@</span><span class=n>bastion</span> <span class=o>~</span><span class=p>]</span><span class=c1># firewall-cmd --add-service=dns --permanent</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>root</span><span class=err>@</span><span class=n>bastion</span> <span class=o>~</span><span class=p>]</span><span class=c1># firewall-cmd --reload</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>啟動服務</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[root@bastion ~]# systemctl enable named --now
</span></span></code></pre></td></tr></table></div></div></li><li><p>驗證DNS</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[ken@bastion ~]$ dig +noall +answer @192.168.1.1 bastion.netfos.ken.lab
</span></span><span class=line><span class=cl>bastion.netfos.ken.lab.	604800	IN	A	192.168.1.1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[ken@bastion ~]$ nslookup 168.95.1.1
</span></span><span class=line><span class=cl>1.1.95.168.in-addr.arpa	name = dns.hinet.net.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Authoritative answers can be found from:
</span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=安裝nfs-server>安裝NFS Server</h3><ol><li><p>install</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[ken@bastion ~]$ sudo yum install nfs-utils
</span></span></code></pre></td></tr></table></div></div></li><li><p>setting</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=o>~</span><span class=p>]</span><span class=o>$</span> <span class=n>sudo</span> <span class=n>mkdir</span> <span class=o>/</span><span class=n>nfs01</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=o>~</span><span class=p>]</span><span class=o>$</span> <span class=n>sudo</span> <span class=n>chmod</span> <span class=mi>777</span> <span class=o>/</span><span class=n>nfs01</span><span class=o>/</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=o>~</span><span class=p>]</span><span class=o>$</span> <span class=n>sudo</span> <span class=n>vim</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>exports</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>nfs01</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>1.0</span><span class=o>/</span><span class=mi>24</span><span class=p>(</span><span class=n>rw</span><span class=p>,</span><span class=n>no_root_squash</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=o>~</span><span class=p>]</span><span class=o>$</span> <span class=n>sudo</span> <span class=n>systemctl</span> <span class=n>enable</span> <span class=o>--</span><span class=n>now</span> <span class=n>rpcbind</span> <span class=n>nfs</span><span class=o>-</span><span class=n>server</span>
</span></span><span class=line><span class=cl><span class=n>Created</span> <span class=n>symlink</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>systemd</span><span class=o>/</span><span class=n>system</span><span class=o>/</span><span class=n>multi</span><span class=o>-</span><span class=n>user</span><span class=o>.</span><span class=n>target</span><span class=o>.</span><span class=n>wants</span><span class=o>/</span><span class=n>nfs</span><span class=o>-</span><span class=n>server</span><span class=o>.</span><span class=n>service</span> <span class=err>→</span> <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>systemd</span><span class=o>/</span><span class=n>system</span><span class=o>/</span><span class=n>nfs</span><span class=o>-</span><span class=n>server</span><span class=o>.</span><span class=n>service</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=o>~</span><span class=p>]</span><span class=o>$</span> 
</span></span><span class=line><span class=cl><span class=err>防火牆關閉或是開</span><span class=n>nfs</span> <span class=n>service</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><hr><h2 id=karbon-airgap>Karbon (Airgap)</h2><p><a class=link href="https://portal.nutanix.com/page/documents/details?targetId=Nutanix-Kubernetes-Engine-v2_6:top-airgap-deploy-t.html" target=_blank rel=noopener>https://portal.nutanix.com/page/documents/details?targetId=Nutanix-Kubernetes-Engine-v2_6:top-airgap-deploy-t.html</a>
<a class=link href=https://next.nutanix.com/nutanix-kubernetes-engine-30/karbon-install-40404 target=_blank rel=noopener>https://next.nutanix.com/nutanix-kubernetes-engine-30/karbon-install-40404</a>
<a class=link href="https://portal.nutanix.com/page/documents/details?targetId=Nutanix-Kubernetes-Engine-v2_6:Nutanix-Kubernetes-Engine-v2_6" target=_blank rel=noopener>https://portal.nutanix.com/page/documents/details?targetId=Nutanix-Kubernetes-Engine-v2_6:Nutanix-Kubernetes-Engine-v2_6</a></p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/airgap-architecture-diagram.png loading=lazy alt=img></p><h4 id=安裝httpd>安裝httpd</h4><ol><li><p>安裝httpd</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[ken@bastion ~]$ sudo yum install httpd
</span></span></code></pre></td></tr></table></div></div></li><li><p>新增資料夾並複製Karbon檔案&解壓縮</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=o>~</span><span class=p>]</span><span class=o>$</span> <span class=n>sudo</span> <span class=n>mkdir</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=o>/</span><span class=n>ntnx</span><span class=o>-</span><span class=mf>2.6</span><span class=o>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>sudo</span><span class=p>]</span> <span class=n>password</span> <span class=k>for</span> <span class=n>ken</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>scp</span> <span class=n>airgap</span><span class=o>-*</span> <span class=n>root</span><span class=err>@</span><span class=mf>172.16</span><span class=o>.</span><span class=mf>90.205</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=o>/</span><span class=n>ntnx</span><span class=o>-</span><span class=mf>2.6</span><span class=o>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>airgap</span><span class=o>-</span><span class=n>ntnx</span><span class=o>-</span><span class=mf>2.6</span><span class=o>.</span><span class=mf>0.</span><span class=n>tar</span><span class=o>.</span><span class=n>gz</span>
</span></span><span class=line><span class=cl><span class=n>airgap</span><span class=o>-</span><span class=n>manifest</span><span class=o>.</span><span class=n>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=o>~</span><span class=p>]</span><span class=o>$</span> <span class=n>sudo</span> <span class=n>tar</span> <span class=n>xvzf</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=o>/</span><span class=n>ntnx</span><span class=o>-</span><span class=mf>2.6</span><span class=o>.</span><span class=mi>0</span><span class=o>/</span><span class=n>airgap</span><span class=o>-</span><span class=n>ntnx</span><span class=o>-</span><span class=mf>2.6</span><span class=o>.</span><span class=mf>0.</span><span class=n>tar</span><span class=o>.</span><span class=n>gz</span> 
</span></span></code></pre></td></tr></table></div></div></li><li><p>啟動httpd,確認可以瀏覽至該目錄</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[ken@bastion ~]$ sudo systemctl enable httpd --now
</span></span><span class=line><span class=cl>Created symlink /etc/systemd/system/multi-user.target.wants/httpd.service → /usr/lib/systemd/system/httpd.service.
</span></span></code></pre></td></tr></table></div></div><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230111164809319.png alt=image-20230111164809319 style=zoom:33%></li></ol><h4 id=安裝karbon>安裝Karbon</h4><p><a class=link href="https://portal.nutanix.com/page/documents/details?targetId=Nutanix-Kubernetes-Engine-v2_6:Nutanix-Kubernetes-Engine-v2_6" target=_blank rel=noopener>https://portal.nutanix.com/page/documents/details?targetId=Nutanix-Kubernetes-Engine-v2_6:Nutanix-Kubernetes-Engine-v2_6</a>
<a class=link href="https://portal.nutanix.com/page/documents/details?targetId=Nutanix-Kubernetes-Engine-v2_6:top-airgap-c.html" target=_blank rel=noopener>https://portal.nutanix.com/page/documents/details?targetId=Nutanix-Kubernetes-Engine-v2_6:top-airgap-c.html</a></p><ul><li><p>PC Enable Karbon</p></li><li><p>LCM確認Karbon版本為最新 (2.6.0)</p></li><li><p>PC 加一張網卡(連192.168.1.0的網段)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>nutanix@NTNX-172-16-90-219-A-PCVM:~/karbon$ sudo ifconfig eth1 192.168.1.2 netmask 255.255.255.0
</span></span><span class=line><span class=cl>nutanix@NTNX-172-16-90-219-A-PCVM:~/karbon$ sudo ip link set eth1 down
</span></span><span class=line><span class=cl>nutanix@NTNX-172-16-90-219-A-PCVM:~/karbon$ sudo ip link set eth1 up
</span></span><span class=line><span class=cl>nutanix@NTNX-172-16-90-219-A-PCVM:~/karbon$ route -n
</span></span><span class=line><span class=cl>Kernel IP routing table
</span></span><span class=line><span class=cl>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
</span></span><span class=line><span class=cl>0.0.0.0         172.16.90.254   0.0.0.0         UG    0      0        0 eth0
</span></span><span class=line><span class=cl>169.254.0.0     0.0.0.0         255.255.0.0     U     1002   0        0 eth0
</span></span><span class=line><span class=cl>172.16.90.0     0.0.0.0         255.255.255.0   U     0      0        0 eth0
</span></span><span class=line><span class=cl>192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 eth1
</span></span></code></pre></td></tr></table></div></div></li></ul><ol><li><p>用nutanix登入進prism central, cd 進/home/nutanix/karbon</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wangken@wangken-MAC % ssh -m hmac-sha2-256 nutanix@172.16.90.219
</span></span><span class=line><span class=cl>Prism Central VM
</span></span><span class=line><span class=cl>nutanix@172.16.90.219&#39;s password: nutanix/4u
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>nutanix@NTNX-172-16-90-219-A-PCVM:~/karbon$ pwd
</span></span><span class=line><span class=cl>/home/nutanix/karbon
</span></span><span class=line><span class=cl>nutanix@NTNX-172-16-90-219-A-PCVM:~/karbon$ ls
</span></span><span class=line><span class=cl>karbonctl
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>登入prism central
</span></span><span class=line><span class=cl>nutanix@NTNX-172-16-90-219-A-PCVM:~/karbon$ ./karbonctl login --pc-ip 172.16.90.219 \
</span></span><span class=line><span class=cl>--pc-username admin \
</span></span><span class=line><span class=cl>--pc-password Nutanix@20230109
</span></span><span class=line><span class=cl>Login successful
</span></span></code></pre></td></tr></table></div></div></li><li><p>填入資訊並執行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>nutanix</span><span class=err>@</span><span class=n>pcvm</span><span class=o>$</span> <span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>nutanix</span><span class=o>/</span><span class=n>karbon</span><span class=o>/</span><span class=n>karbonctl</span> <span class=n>airgap</span> <span class=n>enable</span> \
</span></span><span class=line><span class=cl><span class=o>--</span><span class=n>webserver</span><span class=o>-</span><span class=n>url</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=n>webserver_url</span><span class=o>/</span><span class=n>ntnx</span><span class=o>-</span><span class=n>version</span><span class=o>-</span><span class=n>number</span><span class=o>/</span> \
</span></span><span class=line><span class=cl><span class=o>--</span><span class=n>vlan</span><span class=o>-</span><span class=n>name</span> <span class=n>network_name</span> <span class=o>--</span><span class=k>static</span><span class=o>-</span><span class=n>ip</span> <span class=k>static</span> <span class=n>ip</span><span class=o>-</span><span class=n>address</span> \
</span></span><span class=line><span class=cl><span class=o>--</span><span class=n>storage</span><span class=o>-</span><span class=n>container</span> <span class=n>storage_container_name</span> \
</span></span><span class=line><span class=cl><span class=o>--</span><span class=n>pe</span><span class=o>-</span><span class=n>cluster</span><span class=o>-</span><span class=n>name</span> <span class=n>PE_cluster_name</span> \
</span></span><span class=line><span class=cl><span class=err>–</span><span class=o>-</span><span class=n>pe</span><span class=o>-</span><span class=n>username</span> <span class=n>user</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>----</span> <span class=err>執行安裝指令</span> <span class=p>(</span><span class=err>若出現</span><span class=n>pe</span><span class=o>-</span><span class=n>username的error可以把它調到最前面</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=err>@</span><span class=n>pcvm</span><span class=o>$</span> <span class=o>./</span><span class=n>karbonctl</span> <span class=n>airgap</span> <span class=n>enable</span> \
</span></span><span class=line><span class=cl><span class=err>–</span><span class=o>-</span><span class=n>pe</span><span class=o>-</span><span class=n>username</span> <span class=n>admin</span> \
</span></span><span class=line><span class=cl><span class=o>--</span><span class=n>webserver</span><span class=o>-</span><span class=n>url</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=mf>172.16</span><span class=o>.</span><span class=mf>90.205</span><span class=o>/</span><span class=n>ntnx</span><span class=o>-</span><span class=mf>2.6</span><span class=o>.</span><span class=mi>0</span> \
</span></span><span class=line><span class=cl><span class=o>--</span><span class=n>vlan</span><span class=o>-</span><span class=n>name</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>1.0</span> <span class=o>--</span><span class=k>static</span><span class=o>-</span><span class=n>ip</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>1.5</span> \
</span></span><span class=line><span class=cl><span class=o>--</span><span class=n>storage</span><span class=o>-</span><span class=n>container</span> <span class=n>VM</span> \
</span></span><span class=line><span class=cl><span class=o>--</span><span class=n>pe</span><span class=o>-</span><span class=n>cluster</span><span class=o>-</span><span class=n>name</span> <span class=n>NX3360NG8</span><span class=o>-</span><span class=n>Cluster</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=err>@</span><span class=n>NTNX</span><span class=o>-</span><span class=mi>172</span><span class=o>-</span><span class=mi>16</span><span class=o>-</span><span class=mi>90</span><span class=o>-</span><span class=mi>219</span><span class=o>-</span><span class=n>A</span><span class=o>-</span><span class=n>PCVM</span><span class=p>:</span><span class=o>~/</span><span class=n>karbon</span><span class=o>$</span> <span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>nutanix</span><span class=o>/</span><span class=n>karbon</span><span class=o>/</span><span class=n>karbonctl</span> <span class=n>airgap</span> <span class=n>enable</span> <span class=o>--</span><span class=n>pe</span><span class=o>-</span><span class=n>username</span> <span class=n>admin</span> <span class=o>--</span><span class=n>webserver</span><span class=o>-</span><span class=n>url</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=mf>172.16</span><span class=o>.</span><span class=mf>90.205</span><span class=o>/</span><span class=n>ntnx</span><span class=o>-</span><span class=mf>2.6</span><span class=o>.</span><span class=mi>0</span><span class=o>/</span> <span class=o>--</span><span class=n>vlan</span><span class=o>-</span><span class=n>name</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>1.0</span> <span class=o>--</span><span class=k>static</span><span class=o>-</span><span class=n>ip</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>1.5</span> <span class=o>--</span><span class=n>storage</span><span class=o>-</span><span class=n>container</span> <span class=n>VM</span> <span class=o>--</span><span class=n>pe</span><span class=o>-</span><span class=n>cluster</span><span class=o>-</span><span class=n>name</span> <span class=n>NX3360NG8</span><span class=o>-</span><span class=n>Cluster</span>
</span></span><span class=line><span class=cl><span class=n>Please</span> <span class=n>enter</span> <span class=n>the</span> <span class=n>password</span> <span class=k>for</span> <span class=n>the</span> <span class=n>PE</span> <span class=n>user</span><span class=p>:</span> <span class=n>admin</span>
</span></span><span class=line><span class=cl><span class=n>Successfully</span> <span class=n>submitted</span> <span class=n>request</span> <span class=n>to</span> <span class=n>enable</span> <span class=n>airgap</span><span class=p>:</span> <span class=p>[</span><span class=n>POST</span> <span class=o>/</span><span class=n>airgap</span><span class=p>][</span><span class=mi>202</span><span class=p>]</span> <span class=n>postAirgapAccepted</span>  <span class=o>&amp;</span><span class=p>{</span><span class=n>TaskUUID</span><span class=p>:</span><span class=mh>0xc000370140</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>----</span> <span class=err>確認執行進度</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=err>@</span><span class=n>NTNX</span><span class=o>-</span><span class=mi>172</span><span class=o>-</span><span class=mi>16</span><span class=o>-</span><span class=mi>90</span><span class=o>-</span><span class=mi>219</span><span class=o>-</span><span class=n>A</span><span class=o>-</span><span class=n>PCVM</span><span class=p>:</span><span class=o>~/</span><span class=n>karbon</span><span class=o>$</span> <span class=o>./</span><span class=n>karbonctl</span> <span class=n>airgap</span> <span class=n>list</span>
</span></span><span class=line><span class=cl><span class=n>Airgap</span> <span class=n>UUID</span>                             <span class=n>VM</span> <span class=ne>IP</span>    <span class=n>URL</span>    <span class=n>Status</span>                      <span class=n>Package</span> <span class=n>Upload</span> <span class=n>Status</span>    <span class=n>Registry</span> <span class=n>Status</span>    <span class=n>Status</span> <span class=n>Message</span>
</span></span><span class=line><span class=cl><span class=mi>33844</span><span class=n>fb8</span><span class=o>-</span><span class=n>a677</span><span class=o>-</span><span class=mi>4412</span><span class=o>-</span><span class=mi>5440</span><span class=o>-</span><span class=n>b099f4a5289d</span>             <span class=p>:</span><span class=mi>0</span>     <span class=n>Deploying</span> <span class=n>host</span> <span class=ne>OS</span> <span class=n>images</span>                             <span class=n>Not</span> <span class=n>running</span>  
</span></span></code></pre></td></tr></table></div></div><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230111173203221.png loading=lazy alt=image-20230111173203221></p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112092547218.png loading=lazy alt=image-20230112092547218></p></li><li><p>check ok</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>nutanix</span><span class=err>@</span><span class=n>NTNX</span><span class=o>-</span><span class=mi>172</span><span class=o>-</span><span class=mi>16</span><span class=o>-</span><span class=mi>90</span><span class=o>-</span><span class=mi>219</span><span class=o>-</span><span class=n>A</span><span class=o>-</span><span class=n>PCVM</span><span class=p>:</span><span class=o>~/</span><span class=n>karbon</span><span class=o>$</span> <span class=o>./</span><span class=n>karbonctl</span> <span class=n>airgap</span> <span class=n>list</span>
</span></span><span class=line><span class=cl><span class=n>Airgap</span> <span class=n>UUID</span>                             <span class=n>VM</span> <span class=ne>IP</span>          <span class=n>URL</span>              <span class=n>Status</span>                        <span class=n>Package</span> <span class=n>Upload</span> <span class=n>Status</span>    <span class=n>Registry</span> <span class=n>Status</span>    <span class=n>Status</span> <span class=n>Message</span>
</span></span><span class=line><span class=cl><span class=mf>00e01072</span><span class=o>-</span><span class=n>b5a6</span><span class=o>-</span><span class=mi>4055</span><span class=o>-</span><span class=mi>4</span><span class=n>cfd</span><span class=o>-</span><span class=n>f55d78a8d57b</span>    <span class=mf>192.168</span><span class=o>.</span><span class=mf>1.5</span>    <span class=n>airgap</span><span class=o>-</span><span class=mi>0</span><span class=p>:</span><span class=mi>5000</span>    <span class=n>Airgap</span> <span class=n>registry</span> <span class=n>is</span> <span class=n>running</span>                             <span class=n>Healthy</span> 
</span></span></code></pre></td></tr></table></div></div></li><li><p>在Web UI新增Production Cluster
連線方式用External Loadbalancer: 192.168.1.10 &ndash;> 要額外設定LoadBalancer
control plane: 192.168.1.6-8</p><p>改用Active-Passive Mode &ndash;> VIP 192.168.1.9</p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112164205242.png loading=lazy alt=image-20230112164205242>
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112164222735.png loading=lazy alt=image-20230112164222735></p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112164247610.png loading=lazy alt=image-20230112164247610></p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112164318768.png loading=lazy alt=image-20230112164318768></p><p>抽換為 Active-Passive Mode</p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112170725765.png loading=lazy alt=image-20230112170725765></p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112164346300.png loading=lazy alt=image-20230112164346300>
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112164407434.png loading=lazy alt=image-20230112164407434>
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112164422938.png loading=lazy alt=image-20230112164422938></p></li><li><p>安裝完畢
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112173209983.png loading=lazy alt=image-20230112173209983></p></li></ol><h4 id=連線測試nke>連線測試NKE</h4><ol><li><p>下載kubeconfig
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112173233274.png alt=image-20230112173233274 style=zoom:50%></p></li><li><p>linux 安裝kubectl</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=o>~</span><span class=p>]</span><span class=o>$</span> <span class=n>curl</span> <span class=o>-</span><span class=n>LO</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>dl</span><span class=o>.</span><span class=n>k8s</span><span class=o>.</span><span class=n>io</span><span class=o>/</span><span class=n>release</span><span class=o>/</span><span class=n>v1</span><span class=o>.</span><span class=mf>23.0</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>linux</span><span class=o>/</span><span class=n>amd64</span><span class=o>/</span><span class=n>kubectl</span>
</span></span><span class=line><span class=cl>  <span class=o>%</span> <span class=n>Total</span>    <span class=o>%</span> <span class=n>Received</span> <span class=o>%</span> <span class=n>Xferd</span>  <span class=n>Average</span> <span class=n>Speed</span>   <span class=n>Time</span>    <span class=n>Time</span>     <span class=n>Time</span>  <span class=n>Current</span>
</span></span><span class=line><span class=cl>                                 <span class=n>Dload</span>  <span class=n>Upload</span>   <span class=n>Total</span>   <span class=n>Spent</span>    <span class=n>Left</span>  <span class=n>Speed</span>
</span></span><span class=line><span class=cl><span class=mi>100</span>   <span class=mi>138</span>  <span class=mi>100</span>   <span class=mi>138</span>    <span class=mi>0</span>     <span class=mi>0</span>    <span class=mi>380</span>      <span class=mi>0</span> <span class=o>--</span><span class=p>:</span><span class=o>--</span><span class=p>:</span><span class=o>--</span> <span class=o>--</span><span class=p>:</span><span class=o>--</span><span class=p>:</span><span class=o>--</span> <span class=o>--</span><span class=p>:</span><span class=o>--</span><span class=p>:</span><span class=o>--</span>   <span class=mi>379</span>
</span></span><span class=line><span class=cl><span class=mi>100</span> <span class=mf>44.4</span><span class=n>M</span>  <span class=mi>100</span> <span class=mf>44.4</span><span class=n>M</span>    <span class=mi>0</span>     <span class=mi>0</span>  <span class=mi>8858</span><span class=n>k</span>      <span class=mi>0</span>  <span class=mi>0</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>05</span>  <span class=mi>0</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>05</span> <span class=o>--</span><span class=p>:</span><span class=o>--</span><span class=p>:</span><span class=o>--</span> <span class=mf>10.6</span><span class=n>M</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=o>~</span><span class=p>]</span><span class=o>$</span> <span class=n>sudo</span> <span class=n>install</span> <span class=o>-</span><span class=n>o</span> <span class=n>root</span> <span class=o>-</span><span class=n>g</span> <span class=n>root</span> <span class=o>-</span><span class=n>m</span> <span class=mi>0755</span> <span class=n>kubectl</span> <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>local</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>kubectl</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=o>~</span><span class=p>]</span><span class=o>$</span> <span class=n>kubectl</span> <span class=n>version</span> <span class=o>--</span><span class=n>client</span>
</span></span><span class=line><span class=cl><span class=n>Client</span> <span class=n>Version</span><span class=p>:</span> <span class=n>version</span><span class=o>.</span><span class=n>Info</span><span class=p>{</span><span class=n>Major</span><span class=p>:</span><span class=s2>&#34;1&#34;</span><span class=p>,</span> <span class=n>Minor</span><span class=p>:</span><span class=s2>&#34;23&#34;</span><span class=p>,</span> <span class=n>GitVersion</span><span class=p>:</span><span class=s2>&#34;v1.23.0&#34;</span><span class=p>,</span> <span class=n>GitCommit</span><span class=p>:</span><span class=s2>&#34;ab69524f795c42094a6630298ff53f3c3ebab7f4&#34;</span><span class=p>,</span> <span class=n>GitTreeState</span><span class=p>:</span><span class=s2>&#34;clean&#34;</span><span class=p>,</span> <span class=n>BuildDate</span><span class=p>:</span><span class=s2>&#34;2021-12-07T18:16:20Z&#34;</span><span class=p>,</span> <span class=n>GoVersion</span><span class=p>:</span><span class=s2>&#34;go1.17.3&#34;</span><span class=p>,</span> <span class=n>Compiler</span><span class=p>:</span><span class=s2>&#34;gc&#34;</span><span class=p>,</span> <span class=n>Platform</span><span class=p>:</span><span class=s2>&#34;linux/amd64&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>###將kubeconfig放到.kube/config </span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=o>~</span><span class=p>]</span><span class=o>$</span> <span class=n>cp</span> <span class=n>nke</span><span class=o>-</span><span class=n>kubectl</span><span class=o>.</span><span class=n>cfg</span> <span class=o>.</span><span class=n>kube</span><span class=o>/</span><span class=n>config</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=o>~</span><span class=p>]</span><span class=o>$</span> <span class=n>rm</span> <span class=o>.</span><span class=n>kube</span><span class=o>/</span><span class=n>kubeconfig</span><span class=o>.</span><span class=n>cfg</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=o>~</span><span class=p>]</span><span class=o>$</span> <span class=n>kubectl</span> <span class=n>get</span> <span class=n>nodes</span>
</span></span><span class=line><span class=cl><span class=n>NAME</span>                  <span class=n>STATUS</span>   <span class=n>ROLES</span>    <span class=n>AGE</span>   <span class=n>VERSION</span>
</span></span><span class=line><span class=cl><span class=n>nke</span><span class=o>-</span><span class=mi>34</span><span class=n>f192</span><span class=o>-</span><span class=n>master</span><span class=o>-</span><span class=mi>0</span>   <span class=n>Ready</span>    <span class=n>master</span>   <span class=mi>25</span><span class=n>m</span>   <span class=n>v1</span><span class=o>.</span><span class=mf>23.11</span>
</span></span><span class=line><span class=cl><span class=n>nke</span><span class=o>-</span><span class=mi>34</span><span class=n>f192</span><span class=o>-</span><span class=n>master</span><span class=o>-</span><span class=mi>1</span>   <span class=n>Ready</span>    <span class=n>master</span>   <span class=mi>25</span><span class=n>m</span>   <span class=n>v1</span><span class=o>.</span><span class=mf>23.11</span>
</span></span><span class=line><span class=cl><span class=n>nke</span><span class=o>-</span><span class=mi>34</span><span class=n>f192</span><span class=o>-</span><span class=n>worker</span><span class=o>-</span><span class=mi>0</span>   <span class=n>Ready</span>    <span class=n>node</span>     <span class=mi>23</span><span class=n>m</span>   <span class=n>v1</span><span class=o>.</span><span class=mf>23.11</span>
</span></span><span class=line><span class=cl><span class=n>nke</span><span class=o>-</span><span class=mi>34</span><span class=n>f192</span><span class=o>-</span><span class=n>worker</span><span class=o>-</span><span class=mi>1</span>   <span class=n>Ready</span>    <span class=n>node</span>     <span class=mi>23</span><span class=n>m</span>   <span class=n>v1</span><span class=o>.</span><span class=mf>23.11</span>
</span></span><span class=line><span class=cl><span class=n>nke</span><span class=o>-</span><span class=mi>34</span><span class=n>f192</span><span class=o>-</span><span class=n>worker</span><span class=o>-</span><span class=mi>2</span>   <span class=n>Ready</span>    <span class=n>node</span>     <span class=mi>23</span><span class=n>m</span>   <span class=n>v1</span><span class=o>.</span><span class=mf>23.11</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=n>redmine</span><span class=p>]</span><span class=o>$</span> <span class=n>kubectl</span> <span class=n>get</span> <span class=n>node</span> <span class=o>-</span><span class=n>o</span> <span class=n>wide</span>
</span></span><span class=line><span class=cl><span class=n>NAME</span>                  <span class=n>STATUS</span>   <span class=n>ROLES</span>    <span class=n>AGE</span>   <span class=n>VERSION</span>    <span class=n>INTERNAL</span><span class=o>-</span><span class=ne>IP</span>    <span class=n>EXTERNAL</span><span class=o>-</span><span class=ne>IP</span>   <span class=ne>OS</span><span class=o>-</span><span class=n>IMAGE</span>                <span class=n>KERNEL</span><span class=o>-</span><span class=n>VERSION</span>                <span class=n>CONTAINER</span><span class=o>-</span><span class=n>RUNTIME</span>
</span></span><span class=line><span class=cl><span class=n>nke</span><span class=o>-</span><span class=mi>34</span><span class=n>f192</span><span class=o>-</span><span class=n>master</span><span class=o>-</span><span class=mi>0</span>   <span class=n>Ready</span>    <span class=n>master</span>   <span class=mi>17</span><span class=n>h</span>   <span class=n>v1</span><span class=o>.</span><span class=mf>23.11</span>   <span class=mf>192.168</span><span class=o>.</span><span class=mf>1.27</span>   <span class=o>&lt;</span><span class=n>none</span><span class=o>&gt;</span>        <span class=n>CentOS</span> <span class=n>Linux</span> <span class=mi>7</span> <span class=p>(</span><span class=n>Core</span><span class=p>)</span>   <span class=mf>3.10</span><span class=o>.</span><span class=mi>0</span><span class=o>-</span><span class=mf>1160.71</span><span class=o>.</span><span class=mf>1.</span><span class=n>el7</span><span class=o>.</span><span class=n>x86_64</span>   <span class=n>containerd</span><span class=p>:</span><span class=o>//</span><span class=mf>1.6</span><span class=o>.</span><span class=mi>6</span>
</span></span><span class=line><span class=cl><span class=n>nke</span><span class=o>-</span><span class=mi>34</span><span class=n>f192</span><span class=o>-</span><span class=n>master</span><span class=o>-</span><span class=mi>1</span>   <span class=n>Ready</span>    <span class=n>master</span>   <span class=mi>17</span><span class=n>h</span>   <span class=n>v1</span><span class=o>.</span><span class=mf>23.11</span>   <span class=mf>192.168</span><span class=o>.</span><span class=mf>1.13</span>   <span class=o>&lt;</span><span class=n>none</span><span class=o>&gt;</span>        <span class=n>CentOS</span> <span class=n>Linux</span> <span class=mi>7</span> <span class=p>(</span><span class=n>Core</span><span class=p>)</span>   <span class=mf>3.10</span><span class=o>.</span><span class=mi>0</span><span class=o>-</span><span class=mf>1160.71</span><span class=o>.</span><span class=mf>1.</span><span class=n>el7</span><span class=o>.</span><span class=n>x86_64</span>   <span class=n>containerd</span><span class=p>:</span><span class=o>//</span><span class=mf>1.6</span><span class=o>.</span><span class=mi>6</span>
</span></span><span class=line><span class=cl><span class=n>nke</span><span class=o>-</span><span class=mi>34</span><span class=n>f192</span><span class=o>-</span><span class=n>worker</span><span class=o>-</span><span class=mi>0</span>   <span class=n>Ready</span>    <span class=n>node</span>     <span class=mi>17</span><span class=n>h</span>   <span class=n>v1</span><span class=o>.</span><span class=mf>23.11</span>   <span class=mf>192.168</span><span class=o>.</span><span class=mf>1.84</span>   <span class=o>&lt;</span><span class=n>none</span><span class=o>&gt;</span>        <span class=n>CentOS</span> <span class=n>Linux</span> <span class=mi>7</span> <span class=p>(</span><span class=n>Core</span><span class=p>)</span>   <span class=mf>3.10</span><span class=o>.</span><span class=mi>0</span><span class=o>-</span><span class=mf>1160.71</span><span class=o>.</span><span class=mf>1.</span><span class=n>el7</span><span class=o>.</span><span class=n>x86_64</span>   <span class=n>containerd</span><span class=p>:</span><span class=o>//</span><span class=mf>1.6</span><span class=o>.</span><span class=mi>6</span>
</span></span><span class=line><span class=cl><span class=n>nke</span><span class=o>-</span><span class=mi>34</span><span class=n>f192</span><span class=o>-</span><span class=n>worker</span><span class=o>-</span><span class=mi>1</span>   <span class=n>Ready</span>    <span class=n>node</span>     <span class=mi>17</span><span class=n>h</span>   <span class=n>v1</span><span class=o>.</span><span class=mf>23.11</span>   <span class=mf>192.168</span><span class=o>.</span><span class=mf>1.15</span>   <span class=o>&lt;</span><span class=n>none</span><span class=o>&gt;</span>        <span class=n>CentOS</span> <span class=n>Linux</span> <span class=mi>7</span> <span class=p>(</span><span class=n>Core</span><span class=p>)</span>   <span class=mf>3.10</span><span class=o>.</span><span class=mi>0</span><span class=o>-</span><span class=mf>1160.71</span><span class=o>.</span><span class=mf>1.</span><span class=n>el7</span><span class=o>.</span><span class=n>x86_64</span>   <span class=n>containerd</span><span class=p>:</span><span class=o>//</span><span class=mf>1.6</span><span class=o>.</span><span class=mi>6</span>
</span></span><span class=line><span class=cl><span class=n>nke</span><span class=o>-</span><span class=mi>34</span><span class=n>f192</span><span class=o>-</span><span class=n>worker</span><span class=o>-</span><span class=mi>2</span>   <span class=n>Ready</span>    <span class=n>node</span>     <span class=mi>17</span><span class=n>h</span>   <span class=n>v1</span><span class=o>.</span><span class=mf>23.11</span>   <span class=mf>192.168</span><span class=o>.</span><span class=mf>1.82</span>   <span class=o>&lt;</span><span class=n>none</span><span class=o>&gt;</span>        <span class=n>CentOS</span> <span class=n>Linux</span> <span class=mi>7</span> <span class=p>(</span><span class=n>Core</span><span class=p>)</span>   <span class=mf>3.10</span><span class=o>.</span><span class=mi>0</span><span class=o>-</span><span class=mf>1160.71</span><span class=o>.</span><span class=mf>1.</span><span class=n>el7</span><span class=o>.</span><span class=n>x86_64</span>   <span class=n>containerd</span><span class=p>:</span><span class=o>//</span><span class=mf>1.6</span><span class=o>.</span><span class=mi>6</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>### 新增測試pod</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=o>~</span><span class=p>]</span><span class=o>$</span> <span class=n>kubectl</span> <span class=n>run</span> <span class=o>-</span><span class=n>i</span> <span class=o>-</span><span class=n>t</span> <span class=n>busybox</span> <span class=o>--</span><span class=n>image</span><span class=o>=</span><span class=n>radial</span><span class=o>/</span><span class=n>busyboxplus</span><span class=p>:</span><span class=n>curl</span> <span class=o>--</span><span class=n>restart</span><span class=o>=</span><span class=n>Never</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h4 id=新增測試服務-redmine>新增測試服務-redmine</h4><ol><li><p>postgresql的yaml檔-pvc</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kind: PersistentVolumeClaim
</span></span><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  namespace: redmine
</span></span><span class=line><span class=cl>  name: redmine-postgres-pv-claim
</span></span><span class=line><span class=cl>  labels:
</span></span><span class=line><span class=cl>    app: postgres
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  storageClassName: default-storageclass
</span></span><span class=line><span class=cl>  accessModes:
</span></span><span class=line><span class=cl>    - ReadWriteOnce
</span></span><span class=line><span class=cl>  resources:
</span></span><span class=line><span class=cl>    requests:
</span></span><span class=line><span class=cl>      storage: 20Gi
</span></span></code></pre></td></tr></table></div></div></li><li><p>postgresql的yaml檔-configmap</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=n>redmine</span><span class=p>]</span><span class=o>$</span> <span class=n>cat</span> <span class=n>pgsql</span><span class=o>-</span><span class=n>config</span><span class=o>.</span><span class=n>yaml</span> 
</span></span><span class=line><span class=cl><span class=n>apiVersion</span><span class=p>:</span> <span class=n>v1</span>
</span></span><span class=line><span class=cl><span class=n>kind</span><span class=p>:</span> <span class=n>ConfigMap</span>
</span></span><span class=line><span class=cl><span class=n>metadata</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=n>name</span><span class=p>:</span> <span class=n>redmine</span><span class=o>-</span><span class=n>postgres</span><span class=o>-</span><span class=n>config</span>
</span></span><span class=line><span class=cl>  <span class=n>labels</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=p>:</span> <span class=n>postgres</span>
</span></span><span class=line><span class=cl>  <span class=n>namespace</span><span class=p>:</span> <span class=n>redmine</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=n>POSTGRES_USER</span><span class=p>:</span> <span class=n>postgres</span>
</span></span><span class=line><span class=cl>  <span class=n>POSTGRES_PASSWORD</span><span class=p>:</span> <span class=n>P</span><span class=err>@</span><span class=mi>55</span><span class=n>w</span><span class=o>.</span><span class=n>rd</span>
</span></span><span class=line><span class=cl>  <span class=n>PGDATA</span><span class=p>:</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>postgresql</span><span class=o>/</span><span class=n>pgdata</span>
</span></span><span class=line><span class=cl>  <span class=n>POSTGRES_DB</span><span class=p>:</span> <span class=n>redmine</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>postgresql的yaml檔-deployment</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=n>redmine</span><span class=p>]</span><span class=o>$</span> <span class=n>cat</span> <span class=n>pgsql</span><span class=o>-</span><span class=n>deploy</span><span class=o>.</span><span class=n>yaml</span> 
</span></span><span class=line><span class=cl><span class=n>apiVersion</span><span class=p>:</span> <span class=n>apps</span><span class=o>/</span><span class=n>v1</span>
</span></span><span class=line><span class=cl><span class=n>kind</span><span class=p>:</span> <span class=n>Deployment</span>
</span></span><span class=line><span class=cl><span class=n>metadata</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=n>name</span><span class=p>:</span> <span class=n>redmine</span><span class=o>-</span><span class=n>postgres</span><span class=o>-</span><span class=n>deployment</span>
</span></span><span class=line><span class=cl>  <span class=n>namespace</span><span class=p>:</span> <span class=n>redmine</span>
</span></span><span class=line><span class=cl><span class=n>spec</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=n>strategy</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>type</span><span class=p>:</span> <span class=n>Recreate</span>
</span></span><span class=line><span class=cl>  <span class=n>selector</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>matchLabels</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>app</span><span class=p>:</span> <span class=n>postgres</span>
</span></span><span class=line><span class=cl>  <span class=n>replicas</span><span class=p>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=n>template</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>metadata</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>labels</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>app</span><span class=p>:</span> <span class=n>postgres</span>
</span></span><span class=line><span class=cl>    <span class=n>spec</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>containers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=o>-</span> <span class=n>name</span><span class=p>:</span> <span class=n>postgres</span>
</span></span><span class=line><span class=cl>          <span class=n>image</span><span class=p>:</span> <span class=n>postgres</span><span class=p>:</span><span class=mi>12</span>
</span></span><span class=line><span class=cl>          <span class=n>imagePullPolicy</span><span class=p>:</span> <span class=s2>&#34;IfNotPresent&#34;</span>
</span></span><span class=line><span class=cl>          <span class=n>ports</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=o>-</span> <span class=n>containerPort</span><span class=p>:</span> <span class=mi>5432</span>
</span></span><span class=line><span class=cl>          <span class=n>envFrom</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=o>-</span> <span class=n>configMapRef</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>name</span><span class=p>:</span> <span class=n>redmine</span><span class=o>-</span><span class=n>postgres</span><span class=o>-</span><span class=n>config</span>
</span></span><span class=line><span class=cl>          <span class=n>volumeMounts</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=o>-</span> <span class=n>mountPath</span><span class=p>:</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>postgresql</span><span class=o>/</span><span class=n>data</span>
</span></span><span class=line><span class=cl>              <span class=n>name</span><span class=p>:</span> <span class=n>redmine</span><span class=o>-</span><span class=n>postgredb</span>
</span></span><span class=line><span class=cl>              <span class=n>subPath</span><span class=p>:</span> <span class=n>redmine</span><span class=o>-</span><span class=n>pgsql</span><span class=o>/</span><span class=n>data</span>
</span></span><span class=line><span class=cl>            <span class=o>-</span> <span class=n>mountPath</span><span class=p>:</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>postgresql</span><span class=o>/</span><span class=n>pg_hba</span><span class=o>.</span><span class=n>conf</span>
</span></span><span class=line><span class=cl>              <span class=n>name</span><span class=p>:</span> <span class=n>redmine</span><span class=o>-</span><span class=n>postgredb</span>
</span></span><span class=line><span class=cl>              <span class=n>subPath</span><span class=p>:</span> <span class=n>redmine</span><span class=o>-</span><span class=n>pgsql</span><span class=o>/</span><span class=n>pghba</span><span class=o>.</span><span class=n>conf</span>
</span></span><span class=line><span class=cl>            <span class=o>-</span> <span class=n>mountPath</span><span class=p>:</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>postgresql</span><span class=o>/</span><span class=n>postgresql</span><span class=o>.</span><span class=n>conf</span>
</span></span><span class=line><span class=cl>              <span class=n>name</span><span class=p>:</span> <span class=n>redmine</span><span class=o>-</span><span class=n>postgredb</span>
</span></span><span class=line><span class=cl>              <span class=n>subPath</span><span class=p>:</span> <span class=n>redmine</span><span class=o>-</span><span class=n>pgsql</span><span class=o>/</span><span class=n>postgresql</span><span class=o>.</span><span class=n>conf</span>
</span></span><span class=line><span class=cl>      <span class=n>volumes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=o>-</span> <span class=n>name</span><span class=p>:</span> <span class=n>redmine</span><span class=o>-</span><span class=n>postgredb</span>
</span></span><span class=line><span class=cl>          <span class=n>persistentVolumeClaim</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>claimName</span><span class=p>:</span> <span class=n>redmine</span><span class=o>-</span><span class=n>postgres</span><span class=o>-</span><span class=n>pv</span><span class=o>-</span><span class=n>claim</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>postgresql的yaml檔-svc</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[ken@bastion redmine]$ cat pgsql-svc.yaml 
</span></span><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>kind: Service
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: redmine-postgres-service
</span></span><span class=line><span class=cl>  namespace: redmine
</span></span><span class=line><span class=cl>  labels:
</span></span><span class=line><span class=cl>    app: postgres
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  type: NodePort
</span></span><span class=line><span class=cl>  ports:
</span></span><span class=line><span class=cl>    - port: 5432
</span></span><span class=line><span class=cl>      nodePort: 31432
</span></span><span class=line><span class=cl>  selector:
</span></span><span class=line><span class=cl>    app: postgres
</span></span></code></pre></td></tr></table></div></div></li><li><p>deploy pgsql</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[ken@bastion redmine]$ kubectl apply -f pgsql-pvc.yaml -n redmine
</span></span><span class=line><span class=cl>persistentvolumeclaim/redmine-postgres-pv-claim created
</span></span><span class=line><span class=cl>[ken@bastion redmine]$ kubectl apply -f pgsql-config.yaml -f pgsql-deploy.yaml -f pgsql-svc.yaml -n redmine
</span></span><span class=line><span class=cl>configmap/redmine-postgres-config created
</span></span><span class=line><span class=cl>deployment.apps/redmine-postgres-deployment created
</span></span><span class=line><span class=cl>service/redmine-postgres-service created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>### 確認PV,PVC
</span></span><span class=line><span class=cl>[ken@bastion redmine]$ kubectl get pv,pvc
</span></span><span class=line><span class=cl>NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                                            STORAGECLASS           REASON   AGE
</span></span><span class=line><span class=cl>persistentvolume/pvc-6e4760a1-6884-492f-8ecb-b2dc89ddfdde   30Gi       RWO            Delete           Bound    ntnx-system/prometheus-k8s-db-prometheus-k8s-0   default-storageclass            17h
</span></span><span class=line><span class=cl>persistentvolume/pvc-7875f29e-0b6e-409f-bcc2-d03b315ff2ac   20Gi       RWO            Delete           Bound    redmine/redmine-postgres-pv-claim                default-storageclass            4s
</span></span><span class=line><span class=cl>persistentvolume/pvc-d5e769a0-3c74-4e99-b401-2deb620f90c0   30Gi       RWO            Delete           Bound    ntnx-system/prometheus-k8s-db-prometheus-k8s-1   default-storageclass            17h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                              STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS           AGE
</span></span><span class=line><span class=cl>persistentvolumeclaim/redmine-postgres-pv-claim   Bound    pvc-7875f29e-0b6e-409f-bcc2-d03b315ff2ac   20Gi       RWO            default-storageclass   7s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>### 確認pgsql status
</span></span><span class=line><span class=cl>[ken@bastion redmine]$ kubectl get all -n redmine
</span></span><span class=line><span class=cl>NAME                                               READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod/redmine-postgres-deployment-6f6f66f9cd-4ph9q   1/1     Running   0          6m4s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                               TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE
</span></span><span class=line><span class=cl>service/redmine-postgres-service   NodePort   172.19.202.4   &lt;none&gt;        5432:31432/TCP   6m4s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                          READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment.apps/redmine-postgres-deployment   1/1     1            1           6m4s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                                     DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>replicaset.apps/redmine-postgres-deployment-6f6f66f9cd   1         1         1       6m4s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>### Test node port 31432
</span></span><span class=line><span class=cl>[ken@bastion redmine]$ telnet 192.168.1.84 31432
</span></span><span class=line><span class=cl>Trying 192.168.1.84...
</span></span><span class=line><span class=cl>Connected to 192.168.1.84.
</span></span><span class=line><span class=cl>Escape character is &#39;^]&#39;.
</span></span><span class=line><span class=cl>^CConnection closed by foreign host.
</span></span></code></pre></td></tr></table></div></div></li><li><p>redmine的yaml檔-config</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>data:
</span></span><span class=line><span class=cl>  configuration.yml: |
</span></span><span class=line><span class=cl>    # = Redmine configuration file
</span></span><span class=line><span class=cl>    #
</span></span><span class=line><span class=cl>    # Each environment has its own configuration options.  If you are only
</span></span><span class=line><span class=cl>    # running in production, only the production block needs to be configured.
</span></span><span class=line><span class=cl>    # Environment specific configuration options override the default ones.
</span></span><span class=line><span class=cl>    #
</span></span><span class=line><span class=cl>    # Note that this file needs to be a valid YAML file.
</span></span><span class=line><span class=cl>    # DO NOT USE TABS! Use 2 spaces instead of tabs for indentation.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    # default configuration options for all environments
</span></span><span class=line><span class=cl>    default:
</span></span><span class=line><span class=cl>      email_delivery:
</span></span><span class=line><span class=cl>      autologin_cookie_name:
</span></span><span class=line><span class=cl>      autologin_cookie_path:
</span></span><span class=line><span class=cl>      scm_mercurial_command:
</span></span><span class=line><span class=cl>      scm_git_command:
</span></span><span class=line><span class=cl>      scm_cvs_command:
</span></span><span class=line><span class=cl>      scm_bazaar_command:
</span></span><span class=line><span class=cl>      scm_subversion_path_regexp:
</span></span><span class=line><span class=cl>      scm_mercurial_path_regexp:
</span></span><span class=line><span class=cl>      scm_git_path_regexp:
</span></span><span class=line><span class=cl>      scm_cvs_path_regexp:
</span></span><span class=line><span class=cl>      scm_bazaar_path_regexp:
</span></span><span class=line><span class=cl>      scm_filesystem_path_regexp:
</span></span><span class=line><span class=cl>      scm_stderr_log_file:
</span></span><span class=line><span class=cl>      database_cipher_key:
</span></span><span class=line><span class=cl>      minimagick_font_path:
</span></span><span class=line><span class=cl>    production:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    development:
</span></span><span class=line><span class=cl>kind: ConfigMap
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: redmine-config
</span></span><span class=line><span class=cl>  namespace: redmine
</span></span></code></pre></td></tr></table></div></div></li><li><p>redmine的yaml檔-deploy</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[ken@bastion ~]$ cat redmine-deploy.yaml 
</span></span><span class=line><span class=cl>apiVersion: apps/v1 # for versions before 1.9.0 use apps/v1beta2
</span></span><span class=line><span class=cl>kind: Deployment
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: redmine
</span></span><span class=line><span class=cl>  namespace: redmine
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  replicas: 1
</span></span><span class=line><span class=cl>  selector:
</span></span><span class=line><span class=cl>    matchLabels:
</span></span><span class=line><span class=cl>      app: redmine
</span></span><span class=line><span class=cl>  template:
</span></span><span class=line><span class=cl>    metadata:
</span></span><span class=line><span class=cl>      labels:
</span></span><span class=line><span class=cl>        app: redmine
</span></span><span class=line><span class=cl>    spec:
</span></span><span class=line><span class=cl>      initContainers:
</span></span><span class=line><span class=cl>      # 修正configmap所需的讀寫權限
</span></span><span class=line><span class=cl>      - name: fix-permission-for-configfile
</span></span><span class=line><span class=cl>        image: busybox:1.33.1
</span></span><span class=line><span class=cl>        imagePullPolicy: IfNotPresent
</span></span><span class=line><span class=cl>        command: [&#39;sh&#39;, &#39;-c&#39;, &#39;cat /tmp/configuration.yml &amp;&amp; cp /tmp/configuration.yml /config-tmp-dir/configuration.yml &amp;&amp; chmod -R 777 /config-tmp-dir&#39;]
</span></span><span class=line><span class=cl>        # 同時掛載兩個空間(一個有redmine要得檔案, 另外一個有可自由讀寫的空間)
</span></span><span class=line><span class=cl>        volumeMounts:
</span></span><span class=line><span class=cl>        - name: redmine-config-vol
</span></span><span class=line><span class=cl>          mountPath: /tmp/configuration.yml
</span></span><span class=line><span class=cl>          subPath: configuration.yml
</span></span><span class=line><span class=cl>        - name: redmine-config-tmp-dir
</span></span><span class=line><span class=cl>          mountPath: /config-tmp-dir
</span></span><span class=line><span class=cl>      containers:
</span></span><span class=line><span class=cl>      - name: redmine
</span></span><span class=line><span class=cl>        image: redmine:4.1.5
</span></span><span class=line><span class=cl>        env:
</span></span><span class=line><span class=cl>        - name: REDMINE_DB_POSTGRES
</span></span><span class=line><span class=cl>          value: redmine-postgres-service
</span></span><span class=line><span class=cl>        - name: REDMINE_DB_USER
</span></span><span class=line><span class=cl>          value: postgres
</span></span><span class=line><span class=cl>        - name: REDMINE_DB_PASSWORD
</span></span><span class=line><span class=cl>          value: P@55w.rd
</span></span><span class=line><span class=cl>        - name: REDMINE_DB_DATABASE
</span></span><span class=line><span class=cl>          value: redmine
</span></span><span class=line><span class=cl>     #  default password admin/admin
</span></span><span class=line><span class=cl>        volumeMounts:
</span></span><span class=line><span class=cl>        - name: redmine-config-tmp-dir
</span></span><span class=line><span class=cl>          mountPath: /usr/src/redmine/config/configuration.yml
</span></span><span class=line><span class=cl>          subPath: configuration.yml
</span></span><span class=line><span class=cl>        - name: redmine-files-dir
</span></span><span class=line><span class=cl>          mountPath: /usr/src/redmine/files
</span></span><span class=line><span class=cl>        - name: redmine-plugins
</span></span><span class=line><span class=cl>          mountPath: /usr/src/redmine/plugins
</span></span><span class=line><span class=cl>        - name: redmine-themes
</span></span><span class=line><span class=cl>          mountPath: /usr/src/redmine/public/themes        
</span></span><span class=line><span class=cl>        ports:
</span></span><span class=line><span class=cl>        - containerPort: 3000
</span></span><span class=line><span class=cl>          name: ui
</span></span><span class=line><span class=cl>      # 向k8s取得redmine的yaml檔案
</span></span><span class=line><span class=cl>      volumes:
</span></span><span class=line><span class=cl>      - name: redmine-config-vol
</span></span><span class=line><span class=cl>        configMap:
</span></span><span class=line><span class=cl>          name: redmine-config
</span></span><span class=line><span class=cl>          items:
</span></span><span class=line><span class=cl>          - key: configuration.yml
</span></span><span class=line><span class=cl>            path: configuration.yml
</span></span><span class=line><span class=cl>      # 暫存給redmine與初始化需要的儲存空間(會隨刪除消失)
</span></span><span class=line><span class=cl>      - name: redmine-config-tmp-dir
</span></span><span class=line><span class=cl>        emptyDir: {}
</span></span><span class=line><span class=cl>      - name: redmine-files-dir
</span></span><span class=line><span class=cl>        nfs:
</span></span><span class=line><span class=cl>          path: /nfs01/redmine/
</span></span><span class=line><span class=cl>          server: 192.168.1.1
</span></span><span class=line><span class=cl>      - name: redmine-themes
</span></span><span class=line><span class=cl>        nfs:
</span></span><span class=line><span class=cl>          path: /nfs01/redmine/
</span></span><span class=line><span class=cl>          server: 192.168.1.1 
</span></span><span class=line><span class=cl>      - name: redmine-plugins
</span></span><span class=line><span class=cl>        nfs:
</span></span><span class=line><span class=cl>          path: /nfs01/redmine/
</span></span><span class=line><span class=cl>          server: 192.168.1.1  
</span></span></code></pre></td></tr></table></div></div></li><li><p>redmine的yaml檔-service (NodePort)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[ken@bastion ~]$ cat redmine-svc.yaml 
</span></span><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>kind: Service
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: redmine-service
</span></span><span class=line><span class=cl>  labels: 
</span></span><span class=line><span class=cl>    app: redmine
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  type: NodePort
</span></span><span class=line><span class=cl>  selector:
</span></span><span class=line><span class=cl>    app: redmine
</span></span><span class=line><span class=cl>  ports:
</span></span><span class=line><span class=cl>    - name: ui
</span></span><span class=line><span class=cl>      protocol: TCP
</span></span><span class=line><span class=cl>      port: 3000
</span></span><span class=line><span class=cl>      nodePort: 32748
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> ----------------- ClusterIP
</span></span><span class=line><span class=cl> apiVersion: v1
</span></span><span class=line><span class=cl>kind: Service
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: redmine-service
</span></span><span class=line><span class=cl>  labels: 
</span></span><span class=line><span class=cl>    app: redmine
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  type: ClusterIP
</span></span><span class=line><span class=cl>  selector:
</span></span><span class=line><span class=cl>    app: redmine
</span></span><span class=line><span class=cl>  externalIPs:
</span></span><span class=line><span class=cl>  - 172.16.90.213
</span></span><span class=line><span class=cl>  ports:
</span></span><span class=line><span class=cl>    - name: ui
</span></span><span class=line><span class=cl>      protocol: TCP
</span></span><span class=line><span class=cl>      port: 80
</span></span><span class=line><span class=cl>      targetPort: 3000
</span></span></code></pre></td></tr></table></div></div></li><li><p>部署redmine</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[ken@bastion redmine]$ kubectl apply -f redmine-config.yaml -f redmine-deploy.yaml -f redmine-svc.yaml 
</span></span><span class=line><span class=cl>configmap/redmine-config created
</span></span><span class=line><span class=cl>deployment.apps/redmine created
</span></span><span class=line><span class=cl>service/redmine-service created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[ken@bastion redmine]$ kubectl get all -n redmine
</span></span><span class=line><span class=cl>NAME                                               READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod/redmine-54b45b447c-89rm4                       1/1     Running   0          51s
</span></span><span class=line><span class=cl>pod/redmine-postgres-deployment-6f6f66f9cd-6ngtz   1/1     Running   0          86s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                               TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
</span></span><span class=line><span class=cl>service/redmine-postgres-service   NodePort   172.19.202.4     &lt;none&gt;        5432:31432/TCP   172m
</span></span><span class=line><span class=cl>service/redmine-service            NodePort   172.19.220.153   &lt;none&gt;        3000:32748/TCP   51s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                          READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment.apps/redmine                       1/1     1            1           52s
</span></span><span class=line><span class=cl>deployment.apps/redmine-postgres-deployment   1/1     1            1           172m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                                     DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>replicaset.apps/redmine-54b45b447c                       1         1         1       52s
</span></span><span class=line><span class=cl>replicaset.apps/redmine-postgres-deployment-6f6f66f9cd   1         1         1       172m
</span></span></code></pre></td></tr></table></div></div></li><li><p>預設帳密 admin/admin , 服務皆走node port , 確認連線OK
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230113132436022.png alt=image-20230113132436022 style=zoom:50%></p></li></ol><h4 id=enable-advance-k8s>Enable Advance k8s</h4><p><a class=link href="https://portal.nutanix.com/page/documents/details?targetId=Nutanix-Kubernetes-Engine-v2_5:top-install-advanced-t.html" target=_blank rel=noopener>https://portal.nutanix.com/page/documents/details?targetId=Nutanix-Kubernetes-Engine-v2_5:top-install-advanced-t.html</a></p><ol><li><p>登入Prism Central的VM</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wangken@wangken-MAC ~ % ssh nutanix@172.16.90.219
</span></span><span class=line><span class=cl>Prism Central VM
</span></span><span class=line><span class=cl>nutanix@172.16.90.219&#39;s password: 
</span></span></code></pre></td></tr></table></div></div></li><li><p>karbonctl 登入PC</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>nutanix@NTNX-172-16-90-219-A-PCVM:~$ cd karbon/
</span></span><span class=line><span class=cl>nutanix@NTNX-172-16-90-219-A-PCVM:~/karbon$ ll
</span></span><span class=line><span class=cl>total 66020
</span></span><span class=line><span class=cl>-rwxr-x---. 1 nutanix nutanix 53464168 Oct 14 11:04 karbonctl
</span></span><span class=line><span class=cl>-rw-------. 1 nutanix nutanix 14136153 Jan 11 00:56 kps-cloud-deployer-pc.tar.gz
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>nutanix@NTNX-172-16-90-219-A-PCVM:~/karbon$ ./karbonctl login --pc-username admin
</span></span><span class=line><span class=cl>Please enter the password for the PC user: admin
</span></span><span class=line><span class=cl>Login successful
</span></span></code></pre></td></tr></table></div></div></li><li><p>Enable Advance K8s Management &ndash; airgap mode 不能啟用</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>nutanix</span><span class=err>@</span><span class=n>NTNX</span><span class=o>-</span><span class=mi>172</span><span class=o>-</span><span class=mi>16</span><span class=o>-</span><span class=mi>90</span><span class=o>-</span><span class=mi>219</span><span class=o>-</span><span class=n>A</span><span class=o>-</span><span class=n>PCVM</span><span class=p>:</span><span class=o>~/</span><span class=n>karbon</span><span class=o>$</span> <span class=o>./</span><span class=n>karbonctl</span> <span class=n>karbon</span><span class=o>-</span><span class=n>management</span> <span class=n>enable</span> <span class=o>--</span><span class=n>cluster</span><span class=o>-</span><span class=n>name</span> <span class=n>nke</span>
</span></span><span class=line><span class=cl><span class=n>Advanced</span> <span class=n>Kubernetes</span> <span class=n>Managment</span> <span class=n>can</span> <span class=ow>not</span> <span class=n>be</span> <span class=n>enabled</span> <span class=ow>in</span> <span class=n>airgap</span> <span class=n>mode</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>panic</span><span class=p>:</span> <span class=n>runtime</span> <span class=n>error</span><span class=p>:</span> <span class=n>invalid</span> <span class=n>memory</span> <span class=n>address</span> <span class=ow>or</span> <span class=n>nil</span> <span class=n>pointer</span> <span class=n>dereference</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=k>signal</span> <span class=n>SIGSEGV</span><span class=p>:</span> <span class=n>segmentation</span> <span class=n>violation</span> <span class=n>code</span><span class=o>=</span><span class=mh>0x1</span> <span class=n>addr</span><span class=o>=</span><span class=mh>0x68</span> <span class=n>pc</span><span class=o>=</span><span class=mh>0x155813e</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>goroutine</span> <span class=mi>1</span> <span class=p>[</span><span class=n>running</span><span class=p>]:</span>
</span></span><span class=line><span class=cl><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>nutanix</span><span class=o>-</span><span class=n>core</span><span class=o>/</span><span class=n>acs</span><span class=o>-</span><span class=n>karbonctl</span><span class=o>/</span><span class=n>cmd</span><span class=o>.</span><span class=n>executeK8sRESTAPI</span><span class=p>({</span><span class=mh>0x1b93ae8</span><span class=p>,</span> <span class=mh>0xc00013f1c0</span><span class=p>},</span> <span class=p>{</span><span class=mh>0x0</span><span class=p>,</span> <span class=mh>0x0</span><span class=p>},</span> <span class=p>{</span><span class=mh>0x190b901</span><span class=p>,</span> <span class=mh>0x5</span><span class=p>},</span> <span class=p>{</span><span class=mh>0xc000148200</span><span class=p>,</span> <span class=mh>0xc000523510</span><span class=p>,</span> <span class=mh>0xc000356880</span><span class=p>},</span> <span class=p>{</span><span class=mh>0x28bff08</span><span class=p>,</span> <span class=o>...</span><span class=p>},</span> <span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>circleci</span><span class=o>/</span><span class=n>go</span><span class=o>/</span><span class=n>src</span><span class=o>/</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>nutanix</span><span class=o>-</span><span class=n>core</span><span class=o>/</span><span class=n>acs</span><span class=o>-</span><span class=n>karbonctl</span><span class=o>/</span><span class=n>cmd</span><span class=o>/</span><span class=n>karbonmgmt_enable</span><span class=o>.</span><span class=n>go</span><span class=p>:</span><span class=mi>140</span> <span class=o>+</span><span class=mh>0x5e</span>
</span></span><span class=line><span class=cl><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>nutanix</span><span class=o>-</span><span class=n>core</span><span class=o>/</span><span class=n>acs</span><span class=o>-</span><span class=n>karbonctl</span><span class=o>/</span><span class=n>cmd</span><span class=o>.</span><span class=n>actionKarbonMgmtYaml</span><span class=p>({</span><span class=mh>0x1b93ae8</span><span class=p>,</span> <span class=mh>0xc00013f1c0</span><span class=p>},</span> <span class=p>{</span><span class=mh>0x0</span><span class=p>,</span> <span class=mh>0x0</span><span class=p>},</span> <span class=p>{</span><span class=mh>0xc0003ec0c0</span><span class=p>,</span> <span class=mh>0x7</span><span class=p>,</span> <span class=mh>0x0</span><span class=p>},</span> <span class=p>{</span><span class=mh>0x28bff08</span><span class=p>,</span> <span class=mh>0x0</span><span class=p>,</span> <span class=mh>0x0</span><span class=p>},</span> <span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>circleci</span><span class=o>/</span><span class=n>go</span><span class=o>/</span><span class=n>src</span><span class=o>/</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>nutanix</span><span class=o>-</span><span class=n>core</span><span class=o>/</span><span class=n>acs</span><span class=o>-</span><span class=n>karbonctl</span><span class=o>/</span><span class=n>cmd</span><span class=o>/</span><span class=n>karbonmgmt</span><span class=o>.</span><span class=n>go</span><span class=p>:</span><span class=mi>213</span> <span class=o>+</span><span class=mh>0x191</span>
</span></span><span class=line><span class=cl><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>nutanix</span><span class=o>-</span><span class=n>core</span><span class=o>/</span><span class=n>acs</span><span class=o>-</span><span class=n>karbonctl</span><span class=o>/</span><span class=n>cmd</span><span class=o>.</span><span class=n>processKarbonMgmtYaml</span><span class=p>({</span><span class=mh>0x1b93ae8</span><span class=p>,</span> <span class=mh>0xc00013f1c0</span><span class=p>},</span> <span class=p>{</span><span class=mh>0x190e83e</span><span class=p>,</span> <span class=mh>0x16eeb40</span><span class=p>},</span> <span class=mh>0x1b29ac0</span><span class=p>,</span> <span class=p>{</span><span class=mh>0x0</span><span class=p>,</span> <span class=mh>0x32</span><span class=p>},</span> <span class=p>{</span><span class=mh>0x0</span><span class=p>,</span> <span class=mh>0x2b</span><span class=p>},</span> <span class=p>{</span><span class=mh>0xc0004dcea0</span><span class=p>,</span> <span class=o>...</span><span class=p>},</span> <span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>circleci</span><span class=o>/</span><span class=n>go</span><span class=o>/</span><span class=n>src</span><span class=o>/</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>nutanix</span><span class=o>-</span><span class=n>core</span><span class=o>/</span><span class=n>acs</span><span class=o>-</span><span class=n>karbonctl</span><span class=o>/</span><span class=n>cmd</span><span class=o>/</span><span class=n>karbonmgmt_enable</span><span class=o>.</span><span class=n>go</span><span class=p>:</span><span class=mi>483</span> <span class=o>+</span><span class=mh>0x165</span>
</span></span><span class=line><span class=cl><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>nutanix</span><span class=o>-</span><span class=n>core</span><span class=o>/</span><span class=n>acs</span><span class=o>-</span><span class=n>karbonctl</span><span class=o>/</span><span class=n>cmd</span><span class=o>.</span><span class=n>glob</span><span class=o>..</span><span class=n>func64</span><span class=p>(</span><span class=mh>0x286ba80</span><span class=p>,</span> <span class=p>{</span><span class=mh>0xc00013d060</span><span class=p>,</span> <span class=mh>0x2</span><span class=p>,</span> <span class=mh>0x2</span><span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>circleci</span><span class=o>/</span><span class=n>go</span><span class=o>/</span><span class=n>src</span><span class=o>/</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>nutanix</span><span class=o>-</span><span class=n>core</span><span class=o>/</span><span class=n>acs</span><span class=o>-</span><span class=n>karbonctl</span><span class=o>/</span><span class=n>cmd</span><span class=o>/</span><span class=n>karbonmgmt_enable</span><span class=o>.</span><span class=n>go</span><span class=p>:</span><span class=mi>426</span> <span class=o>+</span><span class=mh>0x1c5</span>
</span></span><span class=line><span class=cl><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>spf13</span><span class=o>/</span><span class=n>cobra</span><span class=o>.</span><span class=p>(</span><span class=o>*</span><span class=n>Command</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=mh>0x286ba80</span><span class=p>,</span> <span class=p>{</span><span class=mh>0xc00013d040</span><span class=p>,</span> <span class=mh>0x2</span><span class=p>,</span> <span class=mh>0x2</span><span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>circleci</span><span class=o>/</span><span class=n>go</span><span class=o>/</span><span class=n>src</span><span class=o>/</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>nutanix</span><span class=o>-</span><span class=n>core</span><span class=o>/</span><span class=n>acs</span><span class=o>-</span><span class=n>karbonctl</span><span class=o>/</span><span class=n>vendor</span><span class=o>/</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>spf13</span><span class=o>/</span><span class=n>cobra</span><span class=o>/</span><span class=n>command</span><span class=o>.</span><span class=n>go</span><span class=p>:</span><span class=mi>860</span> <span class=o>+</span><span class=mh>0x5f8</span>
</span></span><span class=line><span class=cl><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>spf13</span><span class=o>/</span><span class=n>cobra</span><span class=o>.</span><span class=p>(</span><span class=o>*</span><span class=n>Command</span><span class=p>)</span><span class=o>.</span><span class=n>ExecuteC</span><span class=p>(</span><span class=mh>0x2870580</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>circleci</span><span class=o>/</span><span class=n>go</span><span class=o>/</span><span class=n>src</span><span class=o>/</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>nutanix</span><span class=o>-</span><span class=n>core</span><span class=o>/</span><span class=n>acs</span><span class=o>-</span><span class=n>karbonctl</span><span class=o>/</span><span class=n>vendor</span><span class=o>/</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>spf13</span><span class=o>/</span><span class=n>cobra</span><span class=o>/</span><span class=n>command</span><span class=o>.</span><span class=n>go</span><span class=p>:</span><span class=mi>974</span> <span class=o>+</span><span class=mh>0x3bc</span>
</span></span><span class=line><span class=cl><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>spf13</span><span class=o>/</span><span class=n>cobra</span><span class=o>.</span><span class=p>(</span><span class=o>*</span><span class=n>Command</span><span class=p>)</span><span class=o>.</span><span class=n>Execute</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>circleci</span><span class=o>/</span><span class=n>go</span><span class=o>/</span><span class=n>src</span><span class=o>/</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>nutanix</span><span class=o>-</span><span class=n>core</span><span class=o>/</span><span class=n>acs</span><span class=o>-</span><span class=n>karbonctl</span><span class=o>/</span><span class=n>vendor</span><span class=o>/</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>spf13</span><span class=o>/</span><span class=n>cobra</span><span class=o>/</span><span class=n>command</span><span class=o>.</span><span class=n>go</span><span class=p>:</span><span class=mi>902</span>
</span></span><span class=line><span class=cl><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>nutanix</span><span class=o>-</span><span class=n>core</span><span class=o>/</span><span class=n>acs</span><span class=o>-</span><span class=n>karbonctl</span><span class=o>/</span><span class=n>cmd</span><span class=o>.</span><span class=n>Execute</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>circleci</span><span class=o>/</span><span class=n>go</span><span class=o>/</span><span class=n>src</span><span class=o>/</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>nutanix</span><span class=o>-</span><span class=n>core</span><span class=o>/</span><span class=n>acs</span><span class=o>-</span><span class=n>karbonctl</span><span class=o>/</span><span class=n>cmd</span><span class=o>/</span><span class=n>root</span><span class=o>.</span><span class=n>go</span><span class=p>:</span><span class=mi>44</span> <span class=o>+</span><span class=mh>0x25</span>
</span></span><span class=line><span class=cl><span class=n>main</span><span class=o>.</span><span class=n>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>circleci</span><span class=o>/</span><span class=n>go</span><span class=o>/</span><span class=n>src</span><span class=o>/</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>nutanix</span><span class=o>-</span><span class=n>core</span><span class=o>/</span><span class=n>acs</span><span class=o>-</span><span class=n>karbonctl</span><span class=o>/</span><span class=n>main</span><span class=o>.</span><span class=n>go</span><span class=p>:</span><span class=mi>19</span> <span class=o>+</span><span class=mh>0x17</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h4 id=rancher-install>Rancher install</h4><ol><li><p>下載安裝cert-manager</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=n>rancher</span><span class=p>]</span><span class=o>$</span> <span class=n>wget</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>jetstack</span><span class=o>/</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>/</span><span class=n>releases</span><span class=o>/</span><span class=n>download</span><span class=o>/</span><span class=n>v1</span><span class=o>.</span><span class=mf>0.4</span><span class=o>/</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=n>rancher</span><span class=p>]</span><span class=o>$</span> <span class=n>kubectl</span> <span class=n>create</span> <span class=n>ns</span> <span class=n>cert</span><span class=o>-</span><span class=n>manager</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=n>rancher</span><span class=p>]</span><span class=o>$</span> <span class=n>kubectl</span> <span class=n>apply</span> <span class=o>-</span><span class=n>f</span> <span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=n>rancher</span><span class=p>]</span><span class=o>$</span> <span class=n>kubectl</span> <span class=n>get</span> <span class=n>pods</span> <span class=o>-</span><span class=n>n</span> <span class=n>cert</span><span class=o>-</span><span class=n>manager</span>
</span></span><span class=line><span class=cl><span class=n>NAME</span>                                       <span class=n>READY</span>   <span class=n>STATUS</span>    <span class=n>RESTARTS</span>      <span class=n>AGE</span>
</span></span><span class=line><span class=cl><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>-</span><span class=mi>7455</span><span class=n>bdc9bd</span><span class=o>-</span><span class=n>jxjrs</span>              <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>             <span class=mi>109</span><span class=n>s</span>
</span></span><span class=line><span class=cl><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>-</span><span class=n>cainjector</span><span class=o>-</span><span class=mi>5</span><span class=n>bcbb87487</span><span class=o>-</span><span class=n>j27cl</span>   <span class=mi>0</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Error</span>     <span class=mi>4</span> <span class=p>(</span><span class=mi>60</span><span class=n>s</span> <span class=n>ago</span><span class=p>)</span>   <span class=mi>109</span><span class=n>s</span>
</span></span><span class=line><span class=cl><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>-</span><span class=n>webhook</span><span class=o>-</span><span class=mi>55</span><span class=n>b97fbb44</span><span class=o>-</span><span class=mi>5</span><span class=n>xbsd</span>      <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>             <span class=mi>109</span><span class=n>s</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>複製檔案過來</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=n>rancher</span><span class=p>]</span><span class=o>$</span> <span class=n>ll</span>
</span></span><span class=line><span class=cl><span class=n>total</span> <span class=mi>3324</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--.</span> <span class=mi>1</span> <span class=n>ken</span> <span class=n>ken</span> <span class=mi>1679688</span> <span class=n>Jan</span> <span class=mi>16</span> <span class=mi>09</span><span class=p>:</span><span class=mi>44</span> <span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>.</span><span class=n>crds</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--.</span> <span class=mi>1</span> <span class=n>ken</span> <span class=n>ken</span> <span class=mi>1701573</span> <span class=n>Dec</span>  <span class=mi>8</span>  <span class=mi>2021</span> <span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--.</span> <span class=mi>1</span> <span class=n>ken</span> <span class=n>ken</span>     <span class=mi>262</span> <span class=n>Jan</span> <span class=mi>16</span> <span class=mi>09</span><span class=p>:</span><span class=mi>44</span> <span class=n>rancher</span><span class=o>-</span><span class=n>service</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=n>rancher</span><span class=p>]</span><span class=o>$</span> <span class=n>kubectl</span> <span class=n>apply</span> <span class=o>--</span><span class=n>validate</span><span class=o>=</span><span class=bp>false</span> <span class=o>-</span><span class=n>f</span> <span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>.</span><span class=n>crds</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=n>customresourcedefinition</span><span class=o>.</span><span class=n>apiextensions</span><span class=o>.</span><span class=n>k8s</span><span class=o>.</span><span class=n>io</span><span class=o>/</span><span class=n>certificaterequests</span><span class=o>.</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>.</span><span class=n>io</span> <span class=n>configured</span>
</span></span><span class=line><span class=cl><span class=n>customresourcedefinition</span><span class=o>.</span><span class=n>apiextensions</span><span class=o>.</span><span class=n>k8s</span><span class=o>.</span><span class=n>io</span><span class=o>/</span><span class=n>certificates</span><span class=o>.</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>.</span><span class=n>io</span> <span class=n>configured</span>
</span></span><span class=line><span class=cl><span class=n>customresourcedefinition</span><span class=o>.</span><span class=n>apiextensions</span><span class=o>.</span><span class=n>k8s</span><span class=o>.</span><span class=n>io</span><span class=o>/</span><span class=n>challenges</span><span class=o>.</span><span class=n>acme</span><span class=o>.</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>.</span><span class=n>io</span> <span class=n>configured</span>
</span></span><span class=line><span class=cl><span class=n>customresourcedefinition</span><span class=o>.</span><span class=n>apiextensions</span><span class=o>.</span><span class=n>k8s</span><span class=o>.</span><span class=n>io</span><span class=o>/</span><span class=n>clusterissuers</span><span class=o>.</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>.</span><span class=n>io</span> <span class=n>configured</span>
</span></span><span class=line><span class=cl><span class=n>customresourcedefinition</span><span class=o>.</span><span class=n>apiextensions</span><span class=o>.</span><span class=n>k8s</span><span class=o>.</span><span class=n>io</span><span class=o>/</span><span class=n>issuers</span><span class=o>.</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>.</span><span class=n>io</span> <span class=n>configured</span>
</span></span><span class=line><span class=cl><span class=n>customresourcedefinition</span><span class=o>.</span><span class=n>apiextensions</span><span class=o>.</span><span class=n>k8s</span><span class=o>.</span><span class=n>io</span><span class=o>/</span><span class=n>orders</span><span class=o>.</span><span class=n>acme</span><span class=o>.</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>.</span><span class=n>io</span> <span class=n>configured</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>安裝rancher</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[ken@bastion rancher]$ kubectl create namespace cattle-system
</span></span><span class=line><span class=cl>namespace/cattle-system created
</span></span><span class=line><span class=cl>[ken@bastion rancher]$ kubectl apply -f rancher-service.yaml 
</span></span><span class=line><span class=cl>service/rancher-service created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>### helm install
</span></span><span class=line><span class=cl>[ken@bastion rancher]$ wget https://get.helm.sh/helm-v3.11.0-rc.2-linux-amd64.tar.gz
</span></span><span class=line><span class=cl>[ken@bastion rancher]$ tar xvf helm-v3.10.3-linux-amd64.tar.gz 
</span></span><span class=line><span class=cl>linux-amd64/
</span></span><span class=line><span class=cl>linux-amd64/helm
</span></span><span class=line><span class=cl>linux-amd64/LICENSE
</span></span><span class=line><span class=cl>linux-amd64/README.md
</span></span><span class=line><span class=cl>[ken@bastion linux-amd64]$ sudo cp helm /usr/local/bin/
</span></span><span class=line><span class=cl>[sudo] password for ken:
</span></span><span class=line><span class=cl>[ken@bastion linux-amd64]$ helm version
</span></span><span class=line><span class=cl>WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/ken/nke.cfg
</span></span><span class=line><span class=cl>WARNING: Kubernetes configuration file is world-readable. This is insecure. Location: /home/ken/nke.cfg
</span></span><span class=line><span class=cl>version.BuildInfo{Version:&#34;v3.10.3&#34;, GitCommit:&#34;835b7334cfe2e5e27870ab3ed4135f136eecc704&#34;, GitTreeState:&#34;clean&#34;, GoVersion:&#34;go1.18.9&#34;}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>##rancher install
</span></span><span class=line><span class=cl>[ken@bastion rancher]$ helm repo add rancher-stable https://releases.rancher.com/server-charts/stable
</span></span><span class=line><span class=cl>[ken@bastion rancher]$ helm install rancher rancher-stable/rancher --namespace cattle-system --set hostname=rancher.netfos.ken.lab --set replicas=1
</span></span><span class=line><span class=cl>[ken@bastion rancher]$ kubectl get all -n cattle-system
</span></span><span class=line><span class=cl>NAME                           READY   STATUS      RESTARTS   AGE
</span></span><span class=line><span class=cl>pod/helm-operation-9bhx6       0/2     Completed   0          72s
</span></span><span class=line><span class=cl>pod/helm-operation-h7rnz       0/2     Completed   0          25s
</span></span><span class=line><span class=cl>pod/helm-operation-j8wx2       0/2     Completed   0          6s
</span></span><span class=line><span class=cl>pod/rancher-687bc6596d-xf4pw   1/1     Running     0          2m38s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                      TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
</span></span><span class=line><span class=cl>service/rancher           ClusterIP   172.19.196.248   &lt;none&gt;        80/TCP,443/TCP   2m39s
</span></span><span class=line><span class=cl>service/rancher-service   NodePort    172.19.29.29     &lt;none&gt;        443:31443/TCP    36m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment.apps/rancher   1/1     1            1           2m39s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                 DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>replicaset.apps/rancher-687bc6596d   1         1         1       2m39s
</span></span></code></pre></td></tr></table></div></div></li><li><p>browser to https://192.168.1.15:31443
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230116102459000.png loading=lazy alt=image-20230116102459000></p></li><li><p>改密碼
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230116102741258.png alt=image-20230116102741258 style=zoom:50%></p></li><li><p>即可透過Rancher來查看叢集Status
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230116102900002.png loading=lazy alt=image-20230116102900002>
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230116103502845.png loading=lazy alt=image-20230116103502845></p></li></ol><h2 id=files>FIles</h2><p><a class=link href="https://portal.nutanix.com/page/documents/details?targetId=Files-v4_2:fil-file-server-create-wc-t.html#ntask_dgl_l3j_j5" target=_blank rel=noopener>https://portal.nutanix.com/page/documents/details?targetId=Files-v4_2:fil-file-server-create-wc-t.html#ntask_dgl_l3j_j5</a>
<a class=link href="https://portal.nutanix.com/page/documents/details?targetId=Files-v4_2:Files-v4_2" target=_blank rel=noopener>https://portal.nutanix.com/page/documents/details?targetId=Files-v4_2:Files-v4_2</a></p><ul><li><p>安裝設定AD (optional 如要使用SMB就需有AD)</p></li><li><p>Domain: netfos.ken.lab</p></li><li><p>分為Storage Network (172.16.90.0)、Client Network (192.168.1.0)</p></li><li><p>Client Network不能與CVM同網段</p></li><li><p>Virtual IP用在Storage Network, Client 的IP, FSVM會自動HA</p></li><li><p>先用LCM將File升級到最新</p></li><li><p>網路Port圖
<a class=link href="https://portal.nutanix.com/page/documents/details?targetId=Port-Reference:Files_port_auto_r.html" target=_blank rel=noopener>https://portal.nutanix.com/page/documents/details?targetId=Port-Reference:Files_port_auto_r.html</a></p></li></ul><h4 id=架構>架構</h4><img src=https://kenkenny.synology.me:5543/images/2023/09/fs-file-server-network-relationship.png alt=img style=zoom:50%><h4 id=安裝ad>安裝AD</h4><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112103131877.png alt=image-20230112103131877 style=zoom:50%><h4 id=安裝file-server-on-pe>安裝File Server on PE</h4><p><a class=link href="https://portal.nutanix.com/page/documents/details?targetId=Files-v4_2:fil-file-server-create-wc-t.html#ntask_dgl_l3j_j5" target=_blank rel=noopener>https://portal.nutanix.com/page/documents/details?targetId=Files-v4_2:fil-file-server-create-wc-t.html#ntask_dgl_l3j_j5</a></p><ol><li><p>在PE的 File Server ADD,先確認有達到最低需求
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112104219863.png alt=image-20230112104219863 style=zoom:50%></p></li><li><p>設定FQDN、大小</p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112104042391.png loading=lazy alt=image-20230112104042391></p></li><li><p>設定Client Network (192.168.1.0 要與CVM的網段不同)
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112105256290.png alt=image-20230112105256290 style=zoom:50%></p></li><li><p>設定DNS&amp;NTP</p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112105434906.png alt=image-20230112105434906 style=zoom:50%></li><li><p>設定Storage Network (172.16.90.206-209)
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112105545032.png alt=image-20230112105545032 style=zoom:50%></p></li><li><p>設定目錄服務 SMB、NFS (SMB要AD)
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112104942496.png alt=image-20230112104942496 style=zoom:50%></p></li><li><p>Summary & Protection Domain (Snapshot)
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112105055627.png alt=image-20230112105055627 style=zoom:50%></p></li><li><p>去PE的Setting查看fs被分配到什麼IP (192.168.1.26,81,97)</p><p>並在DNS上註記 &ndash; 使用auto update</p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230113151039168.png loading=lazy alt=image-20230113151039168></p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112105750255.png alt=image-20230112105750255 style=zoom:50%></li><li><p>查看Takss
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112110132893.png loading=lazy alt=image-20230112110132893></p></li><li><p>安裝完畢
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112111921165.png loading=lazy alt=image-20230112111921165></p></li><li><p>可以點選console來查看File Server的狀態
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112112012184.png loading=lazy alt=image-20230112112012184></p></li><li><p>有出現無法連到AD 需查找問題&ndash; 將兩台DNS Server的註記都設定上去後即正常
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112112151953.png loading=lazy alt=image-20230112112151953></p></li><li><p>新增Share資料夾 (SMB)
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112112521953.png alt=image-20230112112521953 style=zoom:50%></p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112112613066.png alt=image-20230112112613066 style=zoom:50%><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112112657224.png loading=lazy alt=image-20230112112657224></p></li><li><p>測試連線,點進去file-test即可看到mount path
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112112723327.png loading=lazy alt=image-20230112112723327></p></li><li><p>在一台Windows上連線測試 ( 走的是192.168.1.0網段 )</p><p>測試資料夾有出現，但要開權限</p><p><a class=link href="https://portal.nutanix.com/page/documents/details?targetId=Files-v4_2:fil-fs-rbac-workflow-c.html![image-20230112112909758]%28https://kenkenny.synology.me:5543/images/2023/09/image-20230112112909758.png%29" target=_blank rel=noopener>https://portal.nutanix.com/page/documents/details?targetId=Files-v4_2:fil-fs-rbac-workflow-c.html![image-20230112112909758](https://kenkenny.synology.me:5543/images/2023/09/image-20230112112909758.png)</a></p></li><li><p>查詢
<a class=link href="https://portal.nutanix.com/page/documents/kbs/details?targetId=kA032000000TWZMCA4" target=_blank rel=noopener>https://portal.nutanix.com/page/documents/kbs/details?targetId=kA032000000TWZMCA4</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>nutanix@NTNX-22SH6M380125-C-CVM:172.16.90.213:~$ ncli fs ls
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Uuid                      : dcb7f7d3-1beb-423e-92d8-0004978542c8
</span></span><span class=line><span class=cl>    Name                      : fs01
</span></span><span class=line><span class=cl>    DNS Domain Name           : netfos.ken.lab
</span></span><span class=line><span class=cl>    Version                   : 4.2.1
</span></span><span class=line><span class=cl>    Container ID              : 0005f1d0-ce0d-147b-16c3-7cc25505da5a::169299
</span></span><span class=line><span class=cl>    Container Uuid            : 5d3fd980-8192-4a8c-ab18-5fb605f58bae
</span></span><span class=line><span class=cl>    Virtual IP address        : 172.16.90.206
</span></span><span class=line><span class=cl>    DNS Server IP Addresses   : 192.168.1.1, 192.168.1.100
</span></span><span class=line><span class=cl>    NTP Servers               : clock.stdtime.gov.tw, tick.stdtime.gov.tw, time.stdtime.gov.tw, tock.stdtime.gov.tw, watch.stdtime.gov.tw
</span></span><span class=line><span class=cl>    File server PD name       : NTNX-fs01
</span></span><span class=line><span class=cl>    File server PD status     : Active
</span></span><span class=line><span class=cl>    File server status        : Active
</span></span><span class=line><span class=cl>    AD Domain Name            : netfos.ken.lab
</span></span><span class=line><span class=cl>    AD Username               : administrator
</span></span><span class=line><span class=cl>    Preferred Domain Contr... : true
</span></span><span class=line><span class=cl>    Overwrite User Account    : false
</span></span><span class=line><span class=cl>    AD Protocol Type          : SMB
</span></span><span class=line><span class=cl>    Local Protocol Type       : NFS
</span></span><span class=line><span class=cl>    Nfs version               : NFSV3
</span></span><span class=line><span class=cl>    Total Snapshot Space Used : 0 bytes
</span></span><span class=line><span class=cl>    Total Space Used          : 808 KiB (827,392 bytes)
</span></span><span class=line><span class=cl>    Total Space Available     : 1024 GiB (1,099,510,800,384 bytes)
</span></span><span class=line><span class=cl>    Total SMB Connections     : 1
</span></span><span class=line><span class=cl>    Storage User Capacity     : 23.31 TiB (25,633,686,087,723 bytes)
</span></span><span class=line><span class=cl>    Size                      : 1 TiB (1,099,511,627,776 bytes)
</span></span><span class=line><span class=cl>    Data savings              : 0 bytes
</span></span><span class=line><span class=cl>    Data reduction ratio      : 1:1
</span></span><span class=line><span class=cl>    Controller Num IOPs       : 100
</span></span><span class=line><span class=cl>    Controller IO Bandwidth   : 751
</span></span><span class=line><span class=cl>    Controller Avg IO Latency : 867
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        Network UUID              : c5b9824f-4fba-4c01-9fb2-d02a88daf933
</span></span><span class=line><span class=cl>        Default Gateway           : 172.16.90.254
</span></span><span class=line><span class=cl>        Subnet Mask               : 255.255.255.0
</span></span><span class=line><span class=cl>        Network Type              : Internal
</span></span><span class=line><span class=cl>        IP Pool                   : 172.16.90.206 - 172.16.90.209
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        Network UUID              : ac09299f-322e-4750-9183-6d106be2a0df
</span></span><span class=line><span class=cl>        Default Gateway           : 192.168.1.1
</span></span><span class=line><span class=cl>        Subnet Mask               : 255.255.255.0
</span></span><span class=line><span class=cl>        Network Type              : External
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        Nvm UUID                  : 5a7aef2d-2052-4a6b-935a-bfa46b493b98
</span></span><span class=line><span class=cl>        Nvm ID                    : 0005f1d0-ce0d-147b-16c3-7cc25505da5a::0749859d-c8d7-4199-876f-92ee9215ba26
</span></span><span class=line><span class=cl>        Nvm Name                  : NTNX-fs01-3
</span></span><span class=line><span class=cl>        Memory In GiB             : 12
</span></span><span class=line><span class=cl>        Virtual CPUs              : 4
</span></span><span class=line><span class=cl>        Nvm IP Addresses          : 192.168.1.26, 172.16.90.209
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        Nvm UUID                  : 275adefc-0e3f-4f26-8680-9dd7ff7223b4
</span></span><span class=line><span class=cl>        Nvm ID                    : 0005f1d0-ce0d-147b-16c3-7cc25505da5a::a0a930a7-cafd-4dd3-b4f9-559a48a6db00
</span></span><span class=line><span class=cl>        Nvm Name                  : NTNX-fs01-1
</span></span><span class=line><span class=cl>        Memory In GiB             : 12
</span></span><span class=line><span class=cl>        Virtual CPUs              : 4
</span></span><span class=line><span class=cl>        Nvm IP Addresses          : 192.168.1.97, 172.16.90.207
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        Nvm UUID                  : 3eec8305-8d7c-41ec-804d-9f217b41669c
</span></span><span class=line><span class=cl>        Nvm ID                    : 0005f1d0-ce0d-147b-16c3-7cc25505da5a::d3b41d19-1bf1-4c4b-8ece-e09d2b9dac2d
</span></span><span class=line><span class=cl>        Nvm Name                  : NTNX-fs01-2
</span></span><span class=line><span class=cl>        Memory In GiB             : 12
</span></span><span class=line><span class=cl>        Virtual CPUs              : 4
</span></span><span class=line><span class=cl>        Nvm IP Addresses          : 192.168.1.81, 172.16.90.208
</span></span></code></pre></td></tr></table></div></div></li><li><p>最後問題點是FQDN帶了多個IP出來，直接用IP就可以連線</p><p>並且資料會同步到其他FSVM上
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112145143605.png loading=lazy alt=image-20230112145143605>
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112153035796.png loading=lazy alt=image-20230112153035796></p></li><li><p>可以針對檔案副檔名封鎖存取</p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112145238291.png alt=image-20230112145238291 style=zoom:50%></li><li><p>Dashboard查看目前Share Folder的狀態</p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112145309865.png loading=lazy alt=image-20230112145309865></p></li><li><p>測試NFS,新增NFS Share</p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112150448407.png loading=lazy alt=image-20230112150448407></p></li><li><p>在Linux上安裝nfs-utils後mount測試</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=o>~</span><span class=p>]</span><span class=o>$</span> <span class=n>sudo</span> <span class=n>yum</span> <span class=n>install</span> <span class=n>nfs</span><span class=o>-</span><span class=n>utils</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=o>~</span><span class=p>]</span><span class=o>$</span> <span class=n>sudo</span> <span class=n>mount</span> <span class=o>-</span><span class=n>t</span> <span class=n>nfs</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>1.26</span><span class=p>:</span><span class=o>/</span><span class=n>nfs01</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>nfs</span>
</span></span><span class=line><span class=cl><span class=n>Created</span> <span class=n>symlink</span> <span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>systemd</span><span class=o>/</span><span class=n>system</span><span class=o>/</span><span class=n>remote</span><span class=o>-</span><span class=n>fs</span><span class=o>.</span><span class=n>target</span><span class=o>.</span><span class=n>wants</span><span class=o>/</span><span class=n>rpc</span><span class=o>-</span><span class=n>statd</span><span class=o>.</span><span class=n>service</span> <span class=err>→</span> <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>systemd</span><span class=o>/</span><span class=n>system</span><span class=o>/</span><span class=n>rpc</span><span class=o>-</span><span class=n>statd</span><span class=o>.</span><span class=n>service</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>mount</span><span class=o>.</span><span class=n>nfs</span><span class=p>:</span> <span class=n>access</span> <span class=n>denied</span> <span class=n>by</span> <span class=n>server</span> <span class=k>while</span> <span class=n>mounting</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>1.26</span><span class=p>:</span><span class=o>/</span><span class=n>nfs01</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>出現 Access Denied 需要調整權限,Authentication調整為none,mount時要加sec=none
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112150700831.png alt=image-20230112150700831 style=zoom:50%></p></li><li><p>測試連線</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=o>~</span><span class=p>]</span><span class=o>$</span> <span class=n>sudo</span> <span class=n>mount</span> <span class=o>-</span><span class=n>t</span> <span class=n>nfs</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>1.26</span><span class=p>:</span><span class=o>/</span><span class=n>nfs01</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>nfs</span> <span class=o>-</span><span class=n>o</span> <span class=n>sec</span><span class=o>=</span><span class=n>none</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=o>~</span><span class=p>]</span><span class=o>$</span> <span class=n>cd</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>nfs</span><span class=o>/</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=n>nfs</span><span class=p>]</span><span class=o>$</span> <span class=n>mkdir</span> <span class=n>test</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=n>nfs</span><span class=p>]</span><span class=o>$</span> <span class=n>touch</span> <span class=mi>123</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=n>nfs</span><span class=p>]</span><span class=o>$</span> <span class=n>touch</span> <span class=mf>321.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>ken</span><span class=err>@</span><span class=n>bastion</span> <span class=n>nfs</span><span class=p>]</span><span class=o>$</span> <span class=n>ll</span>
</span></span><span class=line><span class=cl><span class=n>total</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--.</span> <span class=mi>1</span> <span class=mi>4294967294</span> <span class=mi>4294967294</span> <span class=mi>0</span> <span class=n>Jan</span> <span class=mi>12</span>  <span class=mi>2023</span> <span class=mi>123</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--.</span> <span class=mi>1</span> <span class=mi>4294967294</span> <span class=mi>4294967294</span> <span class=mi>0</span> <span class=n>Jan</span> <span class=mi>12</span>  <span class=mi>2023</span> <span class=mf>321.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl><span class=n>drwxr</span><span class=o>-</span><span class=n>xr</span><span class=o>-</span><span class=n>x</span><span class=o>.</span> <span class=mi>2</span> <span class=mi>4294967294</span> <span class=mi>4294967294</span> <span class=mi>2</span> <span class=n>Jan</span> <span class=mi>12</span> <span class=mi>15</span><span class=p>:</span><span class=mi>10</span> <span class=n>test</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>測試阻擋副檔名*.txt
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112151230300.png alt=image-20230112151230300 style=zoom:50%></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[ken@bastion nfs]$ touch 333.txt
</span></span><span class=line><span class=cl>touch: cannot touch &#39;333.txt&#39;: Permission denied
</span></span><span class=line><span class=cl>[ken@bastion nfs]$ rm 321.txt 
</span></span><span class=line><span class=cl>rm: cannot remove &#39;321.txt&#39;: Operation not permitted
</span></span><span class=line><span class=cl>[ken@bastion nfs]$ rm 123
</span></span><span class=line><span class=cl>rm: cannot remove &#39;123&#39;: Operation not permitted
</span></span></code></pre></td></tr></table></div></div></li><li><p>若新增時選擇的是Use &ldquo;Distributed&rdquo; share type instead of &ldquo;Standard&rdquo;</p><p>提示要安裝MMC Plugin</p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112152924185.png alt=image-20230112152924185 style=zoom:50%></li><li><p>可以連線至該資料夾，但無法新增檔案
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230112153247015.png alt=image-20230112153247015 style=zoom:50%></p></li><li><p>可以新增資料夾並在子資料夾內可新增檔案</p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230113141034500.png alt=image-20230113141034500 style=zoom:50%></li><li><p>Standard vs Distributed</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Standard: 一般的Share Folder,實測資料都會同步到其他FSVM上,第一層資料夾即可開始使用。
</span></span><span class=line><span class=cl>Distributed: 多用來當作家目錄資料夾底下會放多個使用者的資料夾，可以有比較好的效能跟分流作用。
</span></span></code></pre></td></tr></table></div></div><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230113140218786.png loading=lazy></p><h5 id=distributed>Distributed</h5><p><img src=https://kenkenny.synology.me:5543/images/2023/09/share-export-distributed.png loading=lazy alt="Shares, in this example \profile, distributed across FSVMs."></p><h5 id=standard>Standard</h5><p><img src=https://kenkenny.synology.me:5543/images/2023/09/share-export-standard.png loading=lazy alt="Shares, in this example \finance, \hr, and \eng, are not distributed across FSVMs."></p></li></ol><h4 id=file-ha>File HA</h4><ol><li><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>Fail</span> <span class=n>over</span> <span class=k>for</span> <span class=n>file</span> <span class=n>server</span> <span class=n>VMs</span> <span class=p>(</span><span class=n>FSVMs</span><span class=p>)</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>High</span> <span class=n>Availability</span> <span class=p>(</span><span class=n>HA</span><span class=p>)</span> <span class=k>for</span> <span class=n>Files</span> <span class=n>insures</span> <span class=n>that</span> <span class=n>during</span> <span class=n>a</span> <span class=n>disruption</span> <span class=n>of</span> <span class=n>service</span> <span class=n>a</span> <span class=n>file</span> <span class=n>server</span> <span class=n>VM</span> <span class=p>(</span><span class=n>FSVM</span><span class=p>),</span> <span class=n>on</span> <span class=n>clusters</span> <span class=n>of</span> <span class=n>two</span> <span class=ow>or</span> <span class=n>more</span> <span class=n>FSVMs</span><span class=p>,</span> <span class=n>can</span> <span class=n>fail</span> <span class=n>over</span> <span class=n>to</span> <span class=n>another</span> <span class=n>FSVM</span><span class=o>.</span> <span class=n>High</span> <span class=n>Availability</span> <span class=n>is</span> <span class=n>enabled</span> <span class=n>by</span> <span class=n>default</span> <span class=n>on</span> <span class=n>all</span> <span class=n>clusters</span> <span class=n>of</span> <span class=n>two</span> <span class=ow>or</span> <span class=n>more</span> <span class=n>FSVMs</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>When</span> <span class=n>an</span> <span class=n>FSVM</span> <span class=n>experiences</span> <span class=n>an</span> <span class=n>issue</span><span class=p>,</span> <span class=n>Files</span> <span class=n>reassigns</span> <span class=n>the</span> <span class=ne>IP</span> <span class=n>address</span> <span class=n>of</span> <span class=n>the</span> <span class=n>FSVM</span> <span class=n>to</span> <span class=n>another</span> <span class=n>FSVM</span> <span class=ow>in</span> <span class=n>the</span> <span class=n>cluster</span><span class=o>.</span> <span class=n>The</span> <span class=ne>IP</span> <span class=n>address</span> <span class=n>of</span> <span class=n>the</span> <span class=n>out</span><span class=o>-</span><span class=n>of</span><span class=o>-</span><span class=n>service</span> <span class=n>FSVM</span> <span class=n>remains</span> <span class=n>available</span><span class=o>.</span> <span class=n>However</span><span class=p>,</span> <span class=n>the</span> <span class=n>shares</span> <span class=ow>and</span> <span class=n>exports</span> <span class=n>on</span> <span class=n>the</span> <span class=n>impacted</span> <span class=n>FSVM</span> <span class=n>are</span> <span class=n>unavailable</span> <span class=k>for</span> <span class=n>several</span> <span class=n>minutes</span> <span class=n>during</span> <span class=n>a</span> <span class=n>failover</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Affinity</span> <span class=n>rules</span> <span class=k>do</span> <span class=ow>not</span> <span class=n>affect</span> <span class=n>HA</span><span class=p>;</span> <span class=n>multiple</span> <span class=n>FSVMs</span> <span class=n>can</span> <span class=n>share</span> <span class=n>a</span> <span class=n>single</span> <span class=n>host</span> <span class=n>during</span> <span class=n>a</span> <span class=n>HA</span> <span class=n>event</span><span class=o>.</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>情境模擬,目前DNS設定
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230113152719949.png alt=image-20230113152719949 style=zoom:50%></p></li><li><p>資料夾連線狀態,兩邊都可以新增檔案
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230113152849603.png loading=lazy alt=image-20230113152849603></p></li><li><p>將ntnx-fs01-1關機
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230113153317896.png loading=lazy alt=image-20230113153317896></p></li><li><p>同樣路徑下還是可以進行檔案編輯、新增
192.168.1.97 還是ping得通。</p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230113153249886.png loading=lazy alt=image-20230113153249886></p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230113153717326.png alt=image-20230113153717326 style=zoom:50%></li></ol><h4 id=csi>CSI</h4><p><a class=link href=https://github.com/nutanix/csi-plugin/blob/master/README.md target=_blank rel=noopener>https://github.com/nutanix/csi-plugin/blob/master/README.md</a></p><p>分為Volume 跟Files
Files 分為專用的Share以及Dynamic NFS
先確認worker node 有啟動nfs-server服務</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=n>nutanix</span><span class=err>@</span><span class=n>anthos</span><span class=o>-</span><span class=n>lab01</span><span class=o>-</span><span class=n>anthos</span><span class=o>-</span><span class=n>workerVm</span><span class=o>-</span><span class=mi>0</span> <span class=o>~</span><span class=p>]</span><span class=o>$</span> <span class=n>sudo</span> <span class=n>systemctl</span> <span class=n>enable</span> <span class=n>nfs</span><span class=o>-</span><span class=n>server</span> <span class=o>--</span><span class=n>now</span>
</span></span><span class=line><span class=cl><span class=n>Created</span> <span class=n>symlink</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>systemd</span><span class=o>/</span><span class=n>system</span><span class=o>/</span><span class=n>multi</span><span class=o>-</span><span class=n>user</span><span class=o>.</span><span class=n>target</span><span class=o>.</span><span class=n>wants</span><span class=o>/</span><span class=n>nfs</span><span class=o>-</span><span class=n>server</span><span class=o>.</span><span class=n>service</span> <span class=err>→</span> <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>systemd</span><span class=o>/</span><span class=n>system</span><span class=o>/</span><span class=n>nfs</span><span class=o>-</span><span class=n>server</span><span class=o>.</span><span class=n>service</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>nutanix</span><span class=err>@</span><span class=n>anthos</span><span class=o>-</span><span class=n>lab01</span><span class=o>-</span><span class=n>anthos</span><span class=o>-</span><span class=n>workerVm</span><span class=o>-</span><span class=mi>0</span> <span class=o>~</span><span class=p>]</span><span class=o>$</span> <span class=n>sudo</span> <span class=n>systemctl</span> <span class=n>status</span> <span class=n>nfs</span><span class=o>-</span><span class=n>server</span>
</span></span><span class=line><span class=cl><span class=err>●</span> <span class=n>nfs</span><span class=o>-</span><span class=n>server</span><span class=o>.</span><span class=n>service</span> <span class=o>-</span> <span class=n>NFS</span> <span class=n>server</span> <span class=ow>and</span> <span class=n>services</span>
</span></span><span class=line><span class=cl>   <span class=n>Loaded</span><span class=p>:</span> <span class=n>loaded</span> <span class=p>(</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>systemd</span><span class=o>/</span><span class=n>system</span><span class=o>/</span><span class=n>nfs</span><span class=o>-</span><span class=n>server</span><span class=o>.</span><span class=n>service</span><span class=p>;</span> <span class=n>enabled</span><span class=p>;</span> <span class=n>vendor</span> <span class=n>preset</span><span class=p>:</span> <span class=n>disabled</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=n>Active</span><span class=p>:</span> <span class=n>active</span> <span class=p>(</span><span class=n>exited</span><span class=p>)</span> <span class=n>since</span> <span class=n>Fri</span> <span class=mi>2023</span><span class=o>-</span><span class=mi>07</span><span class=o>-</span><span class=mi>14</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>10</span> <span class=n>UTC</span><span class=p>;</span> <span class=mi>12</span><span class=n>s</span> <span class=n>ago</span>
</span></span><span class=line><span class=cl>  <span class=n>Process</span><span class=p>:</span> <span class=mi>46413</span> <span class=n>ExecStart</span><span class=o>=/</span><span class=n>bin</span><span class=o>/</span><span class=n>sh</span> <span class=o>-</span><span class=n>c</span> <span class=k>if</span> <span class=n>systemctl</span> <span class=o>-</span><span class=n>q</span> <span class=n>is</span><span class=o>-</span><span class=n>active</span> <span class=n>gssproxy</span><span class=p>;</span> <span class=n>then</span> <span class=n>systemctl</span> <span class=n>reload</span> <span class=n>gssproxy</span> <span class=p>;</span> <span class=n>fi</span> <span class=p>(</span><span class=n>code</span><span class=o>=</span><span class=n>exited</span><span class=p>,</span> <span class=n>status</span><span class=o>=</span><span class=mi>0</span><span class=o>/</span><span class=n>SUCCESS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>Process</span><span class=p>:</span> <span class=mi>46400</span> <span class=n>ExecStart</span><span class=o>=/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>rpc</span><span class=o>.</span><span class=n>nfsd</span> <span class=p>(</span><span class=n>code</span><span class=o>=</span><span class=n>exited</span><span class=p>,</span> <span class=n>status</span><span class=o>=</span><span class=mi>0</span><span class=o>/</span><span class=n>SUCCESS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>Process</span><span class=p>:</span> <span class=mi>46398</span> <span class=n>ExecStartPre</span><span class=o>=/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>exportfs</span> <span class=o>-</span><span class=n>r</span> <span class=p>(</span><span class=n>code</span><span class=o>=</span><span class=n>exited</span><span class=p>,</span> <span class=n>status</span><span class=o>=</span><span class=mi>0</span><span class=o>/</span><span class=n>SUCCESS</span><span class=p>)</span>
</span></span><span class=line><span class=cl> <span class=n>Main</span> <span class=n>PID</span><span class=p>:</span> <span class=mi>46413</span> <span class=p>(</span><span class=n>code</span><span class=o>=</span><span class=n>exited</span><span class=p>,</span> <span class=n>status</span><span class=o>=</span><span class=mi>0</span><span class=o>/</span><span class=n>SUCCESS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=mi>7</span><span class=err>月</span> <span class=mi>14</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>10</span> <span class=n>anthos</span><span class=o>-</span><span class=n>lab01</span><span class=o>-</span><span class=n>anthos</span><span class=o>-</span><span class=n>workerVm</span><span class=o>-</span><span class=mi>0</span> <span class=n>systemd</span><span class=p>[</span><span class=mi>1</span><span class=p>]:</span> <span class=n>Starting</span> <span class=n>NFS</span> <span class=n>server</span> <span class=ow>and</span> <span class=n>services</span><span class=o>...</span>
</span></span><span class=line><span class=cl> <span class=mi>7</span><span class=err>月</span> <span class=mi>14</span> <span class=mi>09</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>10</span> <span class=n>anthos</span><span class=o>-</span><span class=n>lab01</span><span class=o>-</span><span class=n>anthos</span><span class=o>-</span><span class=n>workerVm</span><span class=o>-</span><span class=mi>0</span> <span class=n>systemd</span><span class=p>[</span><span class=mi>1</span><span class=p>]:</span> <span class=n>Started</span> <span class=n>NFS</span> <span class=n>server</span> <span class=ow>and</span> <span class=n>services</span><span class=o>.</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=files-dynamic>Files Dynamic</h5><p>Prism 上有建立Files Server即可使用，不用新增Share</p><ol><li><p>建立Secret</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[nutanix@anthos-lab01-anthos-adminVm-0 ~]$ cat ntnx-secret74.yaml 
</span></span><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>kind: Secret
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: ntnx-secret74
</span></span><span class=line><span class=cl>  namespace: ntnx-system
</span></span><span class=line><span class=cl>data:
</span></span><span class=line><span class=cl>  # base64 encoded prism-ip:prism-port:admin:password. 
</span></span><span class=line><span class=cl>  # E.g.: echo -n &#34;172.16.90.74:9440:admin:mypassword&#34; | base64
</span></span><span class=line><span class=cl>  key: MTcyLjE2LjkwLjc0Ojk0NDA6YWRtaW46TnV0YW5peC9MYWIxMjM=
</span></span></code></pre></td></tr></table></div></div></li><li><p>建立Dynamic NFS Storageclass</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[nutanix@anthos-lab01-anthos-adminVm-0 ~]$ cat ntnx-secret74.yaml 
</span></span><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>kind: Secret
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: ntnx-secret74
</span></span><span class=line><span class=cl>  namespace: ntnx-system
</span></span><span class=line><span class=cl>data:
</span></span><span class=line><span class=cl>  # base64 encoded prism-ip:prism-port:admin:password. 
</span></span><span class=line><span class=cl>  # E.g.: echo -n &#34;10.6.47.155:9440:admin:mypassword&#34; | base64
</span></span><span class=line><span class=cl>  key: MTcyLjE2LjkwLjc0Ojk0NDA6YWRtaW46TnV0YW5peC9MYWIxMjM=
</span></span><span class=line><span class=cl>[nutanix@anthos-lab01-anthos-adminVm-0 ~]$ cat dyn-files.yaml 
</span></span><span class=line><span class=cl>kind: StorageClass
</span></span><span class=line><span class=cl>apiVersion: storage.k8s.io/v1
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>    name: ntnx-files
</span></span><span class=line><span class=cl>provisioner: csi.nutanix.com
</span></span><span class=line><span class=cl>parameters:
</span></span><span class=line><span class=cl>    dynamicProv: ENABLED
</span></span><span class=line><span class=cl>    nfsServerName: Files
</span></span><span class=line><span class=cl>    csi.storage.k8s.io/provisioner-secret-name: ntnx-secret74
</span></span><span class=line><span class=cl>    csi.storage.k8s.io/provisioner-secret-namespace: ntnx-system
</span></span><span class=line><span class=cl>    storageType: NutanixFiles
</span></span></code></pre></td></tr></table></div></div></li><li><p>建立測試pvc</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[nutanix@anthos-lab01-anthos-adminVm-0 ~]$ cat test-claim.yaml 
</span></span><span class=line><span class=cl>kind: PersistentVolumeClaim
</span></span><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>   name: claim2
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>   accessModes:
</span></span><span class=line><span class=cl>      - ReadWriteMany
</span></span><span class=line><span class=cl>   resources:
</span></span><span class=line><span class=cl>      requests:
</span></span><span class=line><span class=cl>         storage: 10Gi
</span></span><span class=line><span class=cl>   storageClassName: ntnx-files
</span></span></code></pre></td></tr></table></div></div></li><li><p>驗證OK</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[nutanix@anthos-lab01-anthos-adminVm-0 ~]$ kubectl get pvc
</span></span><span class=line><span class=cl>NAME     STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
</span></span><span class=line><span class=cl>claim2   Bound    pvc-a338991c-13f8-4c2f-811b-10911f543e97   10Gi       RWX            ntnx-files     93m
</span></span></code></pre></td></tr></table></div></div></li><li><p>實際Prism 畫面
<img src=https://kenkenny.synology.me:5543/images/2023/09/dyn-files.png loading=lazy alt=image-20230714135126573></p></li><li><p>Anthos 畫面
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230714135206479.png loading=lazy alt=image-20230714135206479></p></li></ol><h5 id=files-share>Files Share</h5><ol><li><p>Prism 建立Files Share
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230714140331520.png loading=lazy alt=image-20230714140331520></p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230714140358134.png loading=lazy alt=image-20230714140358134></p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230714140415066.png loading=lazy alt=image-20230714140415066></p><p><img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230714140434787.png loading=lazy alt=image-20230714140434787>
<img src=https://kenkenny.synology.me:5543/images/2023/09/image-20230714140451932.png loading=lazy alt=image-20230714140451932></p></li><li><p>建立Storageclass 針對anthos 這個share</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[nutanix@anthos-lab01-anthos-adminVm-0 ~]$ cat ntnx-files.yaml 
</span></span><span class=line><span class=cl>kind: StorageClass
</span></span><span class=line><span class=cl>apiVersion: storage.k8s.io/v1
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>    name: ntnx-files-anthos
</span></span><span class=line><span class=cl>    annotations:
</span></span><span class=line><span class=cl>        storageclass.kubernetes.io/is-default-class: &#34;false&#34;
</span></span><span class=line><span class=cl>provisioner: csi.nutanix.com
</span></span><span class=line><span class=cl>parameters:
</span></span><span class=line><span class=cl>    nfsServer: Files.nutanixlab.local
</span></span><span class=line><span class=cl>    nfsPath: anthos
</span></span><span class=line><span class=cl>    storageType: NutanixFiles
</span></span><span class=line><span class=cl>reclaimPolicy: Delete
</span></span></code></pre></td></tr></table></div></div></li><li><p>確認Storageclass &ldquo;ntnx-files-anthos&rdquo;</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[nutanix@anthos-lab01-anthos-adminVm-0 ~]$ kubectl get storageclass
</span></span><span class=line><span class=cl>NAME                       PROVISIONER                    RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE
</span></span><span class=line><span class=cl>anthos-system              kubernetes.io/no-provisioner   Delete          WaitForFirstConsumer   false                  29d
</span></span><span class=line><span class=cl>local-disks                kubernetes.io/no-provisioner   Delete          WaitForFirstConsumer   false                  29d
</span></span><span class=line><span class=cl>local-shared               kubernetes.io/no-provisioner   Delete          WaitForFirstConsumer   false                  29d
</span></span><span class=line><span class=cl>ntnx-files                 csi.nutanix.com                Delete          Immediate              false                  108m
</span></span><span class=line><span class=cl>ntnx-files-anthos          csi.nutanix.com                Delete          Immediate              false                  6s
</span></span><span class=line><span class=cl>nutanix-volume (default)   csi.nutanix.com                Delete          Immediate              true                   29d
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[nutanix@anthos-lab01-anthos-adminVm-0 ~]$ kubectl describe storageclass ntnx-files-anthos
</span></span><span class=line><span class=cl>Name:                  ntnx-files-anthos
</span></span><span class=line><span class=cl>IsDefaultClass:        No
</span></span><span class=line><span class=cl>Annotations:           storageclass.kubernetes.io/is-default-class=false
</span></span><span class=line><span class=cl>Provisioner:           csi.nutanix.com
</span></span><span class=line><span class=cl>Parameters:            nfsPath=anthos,nfsServer=Files.nutanixlab.local,storageType=NutanixFiles
</span></span><span class=line><span class=cl>AllowVolumeExpansion:  &lt;unset&gt;
</span></span><span class=line><span class=cl>MountOptions:          &lt;none&gt;
</span></span><span class=line><span class=cl>ReclaimPolicy:         Delete
</span></span><span class=line><span class=cl>VolumeBindingMode:     Immediate
</span></span><span class=line><span class=cl>Events:                &lt;none&gt;
</span></span></code></pre></td></tr></table></div></div></li></ol></section><footer class=article-footer><section class=article-tags><a href=/tags/nutanix/>Nutanix</a>
<a href=/tags/karbon/>Karbon</a>
<a href=/tags/kubernetes/>Kubernetes</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相關文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/nutanix_nkp-v2.13_ahv/><div class=article-details><h2 class=article-title>Nutanix_NKP-v2.13_AHV</h2></div></a></article><article><a href=/p/ocp-4.16.3_on_nutanixipi/><div class=article-details><h2 class=article-title>OCP-4.16.3_on_Nutanix(IPI)</h2></div></a></article><article><a href=/p/nutanix_nkp-v2.13_preprovisioned/><div class=article-details><h2 class=article-title>Nutanix_NKP-v2.13_Preprovisioned</h2></div></a></article><article><a href=/p/nutanix_nkp-v2.12_ahv/><div class=article-details><h2 class=article-title>Nutanix_NKP-v2.12_AHV</h2></div></a></article><article><a href=/p/nutanix_ndk-v1.0.0_on_ocp-4.13/><div class=article-details><h2 class=article-title>Nutanix_NDK-v1.0.0_On_OCP-4.13</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//wangken0129.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2023 -
2025 Ken's blog</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 建立<br>主題 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 設計</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>