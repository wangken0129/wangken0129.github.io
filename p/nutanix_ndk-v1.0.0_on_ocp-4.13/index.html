<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Nutanix_NDK-v1.0.0_On_OCP-4.13"><title>Nutanix_NDK-v1.0.0_On_OCP-4.13</title>
<link rel=canonical href=https://wangken0129.github.io/p/nutanix_ndk-v1.0.0_on_ocp-4.13/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="Nutanix_NDK-v1.0.0_On_OCP-4.13"><meta property='og:description' content="Nutanix_NDK-v1.0.0_On_OCP-4.13"><meta property='og:url' content='https://wangken0129.github.io/p/nutanix_ndk-v1.0.0_on_ocp-4.13/'><meta property='og:site_name' content="Ken's blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Kubernetes'><meta property='article:tag' content='Nutanix'><meta property='article:tag' content='Openshift'><meta property='article:published_time' content='2024-05-23T08:00:46+08:00'><meta property='article:modified_time' content='2024-05-23T08:00:46+08:00'><meta name=twitter:title content="Nutanix_NDK-v1.0.0_On_OCP-4.13"><meta name=twitter:description content="Nutanix_NDK-v1.0.0_On_OCP-4.13"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切換選單>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_c68a00bbf16dac8.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🇹🇼</span></figure><div class=site-meta><h1 class=site-name><a href=/>Ken's blog</a></h1><h2 class=site-description>紀錄與分享，當個快樂的工程師</h2></div></header><ol class=menu-social><li><a href=https://github.com/wangken0129/wangken0129.github.io target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/ken-wang-88924b181/ target=_blank title=LinkedIn rel=me><svg class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>夜晚模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目錄</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#reference>Reference</a></li><li><a href=#requirements>Requirements</a></li><li><a href=#lab-enviroments>Lab Enviroments</a></li><li><a href=#ndk-install-lab>NDK install Lab</a><ol><li><a href=#install-helm-chart-on-bastion>install helm chart on bastion</a></li><li><a href=#nutanix--csi-30-beta>Nutanix CSI 3.0 (beta)</a><ol><li><a href=#create-ocp-secret>Create OCP Secret</a></li><li><a href=#install-csi-driver>Install CSI Driver</a></li><li><a href=#create-storageclass>Create StorageClass</a></li></ol></li><li><a href=#cert-manager>Cert-manager</a></li><li><a href=#onboard-ocp-to-pc>Onboard OCP to PC</a></li><li><a href=#ndk-install-without-tls>NDK Install without TLS</a></li><li><a href=#storage-cluster>Storage Cluster</a></li><li><a href=#create-sample-app>Create Sample App</a><ol><li><a href=#mysql>MySQL</a></li></ol></li><li><a href=#ndk-snapshot>NDK Snapshot</a><ol><li><a href=#manual-local-snapshot>Manual Local Snapshot</a></li></ol></li><li><a href=#ndk-restore>NDK Restore</a><ol><li><a href=#restore--local-snapshot>Restore Local Snapshot</a></li></ol></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/lab-category/ style=background-color:#2a9d8f;color:#fff>Lab Category</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/nutanix_ndk-v1.0.0_on_ocp-4.13/>Nutanix_NDK-v1.0.0_On_OCP-4.13</a></h2><h3 class=article-subtitle>Nutanix_NDK-v1.0.0_On_OCP-4.13</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>May 23, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>閱讀時間: 24 分鐘</time></div></footer></div></header><section class=article-content><h1 id=ndk-v100-on-ocp-v413>NDK v1.0.0 on OCP v4.13</h1><p>NDK ( Nutanix Data Service for Kubernetes ) ：針對Kubernetes 的容器備份還原</p><p>目前備援功能只支援在同一個供應商提供的 Kubernetes 叢集，且目前只有Volume 的PVC才可快照</p><p>排程備份只支援Async ，此測試僅有針對 Namespace 內全部的項目做手動快照還原</p><p>OCP IPI 安裝此篇不贅述，請參考其他篇</p><p>2024.05.23</p><h2 id=reference>Reference</h2><p><a class=link href="https://portal.nutanix.com/page/documents/solutions/details?targetId=TN-2030-Red-Hat-OpenShift-on-Nutanix:TN-2030-Red-Hat-OpenShift-on-Nutanix" target=_blank rel=noopener>https://portal.nutanix.com/page/documents/solutions/details?targetId=TN-2030-Red-Hat-OpenShift-on-Nutanix:TN-2030-Red-Hat-OpenShift-on-Nutanix</a></p><p><a class=link href="https://portal.nutanix.com/page/documents/details?targetId=Nutanix-Data-Services-for-Kubernetes-v1_0:Nutanix-Data-Services-for-Kubernetes-v1_0" target=_blank rel=noopener>https://portal.nutanix.com/page/documents/details?targetId=Nutanix-Data-Services-for-Kubernetes-v1_0:Nutanix-Data-Services-for-Kubernetes-v1_0</a></p><p><a class=link href="https://portal.nutanix.com/page/documents/details?targetId=Release-Notes-Nutanix-Data-Services-for-Kubernetes-v1_0:Release-Notes-Nutanix-Data-Services-for-Kubernetes-v1_0" target=_blank rel=noopener>https://portal.nutanix.com/page/documents/details?targetId=Release-Notes-Nutanix-Data-Services-for-Kubernetes-v1_0:Release-Notes-Nutanix-Data-Services-for-Kubernetes-v1_0</a></p><p><a class=link href=https://github.com/nutanix/helm/tree/nutanix-csi-snapshot-6.3.2/charts/nutanix-csi-snapshot#install target=_blank rel=noopener>https://github.com/nutanix/helm/tree/nutanix-csi-snapshot-6.3.2/charts/nutanix-csi-snapshot#install</a></p><p><a class=link href=https://github.com/nutanix/helm/tree/csi-v3.0.0-beta-beta1/charts/nutanix-csi-storage target=_blank rel=noopener>https://github.com/nutanix/helm/tree/csi-v3.0.0-beta-beta1/charts/nutanix-csi-storage</a></p><p><a class=link href=https://access.redhat.com/documentation/zh-tw/openshift_container_platform/4.13/html/building_applications/working-with-helm-charts target=_blank rel=noopener>https://access.redhat.com/documentation/zh-tw/openshift_container_platform/4.13/html/building_applications/working-with-helm-charts</a></p><p><a class=link href=https://blog.csdn.net/u010918487/article/details/115509935 target=_blank rel=noopener>https://blog.csdn.net/u010918487/article/details/115509935</a></p><p><a class=link href="https://portal.nutanix.com/page/documents/kbs/details?targetId=kA0VO00000008Qb0AI" target=_blank rel=noopener>https://portal.nutanix.com/page/documents/kbs/details?targetId=kA0VO00000008Qb0AI</a></p><p><a class=link href="https://quay.io/repository/karbon/k8s-agent?tab=tags" target=_blank rel=noopener>https://quay.io/repository/karbon/k8s-agent?tab=tags</a></p><p><a class=link href=https://github.com/nutanix/helm-releases/releases target=_blank rel=noopener>https://github.com/nutanix/helm-releases/releases</a></p><p><a class=link href="https://github.com/orgs/nutanix-cloud-native/repositories?type=all" target=_blank rel=noopener>https://github.com/orgs/nutanix-cloud-native/repositories?type=all</a></p><h2 id=requirements>Requirements</h2><p>NKE v2.9 以上</p><p>Prism Central 2023.4 以上</p><p>Kubernetes version v1.26 以上</p><p>Nutanix CSI Driver v3.0 (beta) 以上</p><p><img src=https://kenkenny.synology.me:5543/images/2024/05/image-20240523120449110.png loading=lazy alt=image-20240523120449110></p><p><img src=https://kenkenny.synology.me:5543/images/2024/05/image-20240515115102568.png loading=lazy alt=image-20240515115102568></p><h2 id=lab-enviroments>Lab Enviroments</h2><p>Prism Central : 2024.1</p><p>AOS: 6.7.1</p><p>NKE: 2.9</p><p>OpenShift : 4.13</p><p>Openshift IPI on Nutanix AHV</p><h2 id=ndk-install-lab>NDK install Lab</h2><h3 id=install-helm-chart-on-bastion>install helm chart on bastion</h3><p><a class=link href=https://access.redhat.com/documentation/zh-tw/openshift_container_platform/4.13/html/building_applications/working-with-helm-charts target=_blank rel=noopener>https://access.redhat.com/documentation/zh-tw/openshift_container_platform/4.13/html/building_applications/working-with-helm-charts</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sudo curl -L https://mirror.openshift.com/pub/openshift-v4/clients/helm/latest/helm-linux-amd64 -o /usr/local/bin/helm
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ sudo chmod +x /usr/local/bin/helm
</span></span><span class=line><span class=cl>$ helm version
</span></span><span class=line><span class=cl>WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/nutanix/.kube/config
</span></span><span class=line><span class=cl>version.BuildInfo{Version:&#34;v3.13.2+35.el9&#34;, GitCommit:&#34;fa6e939d7984e1be0d6fbc2dc920b6bbcf395932&#34;, GitTreeState:&#34;clean&#34;, GoVersion:&#34;go1.20.12&#34;}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ helm repo add nutanix https://nutanix.github.io/helm/
</span></span></code></pre></td></tr></table></div></div><h3 id=nutanix--csi-30-beta>Nutanix CSI 3.0 (beta)</h3><h4 id=create-ocp-secret>Create OCP Secret</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Create Secret pc and pe
</span></span><span class=line><span class=cl>$ vi ntnx-secret.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>kind: Secret
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: ntnx-secret
</span></span><span class=line><span class=cl>  namespace: ntnx-system
</span></span><span class=line><span class=cl>stringData:
</span></span><span class=line><span class=cl>  # prism-element-ip:prism-port:admin:password
</span></span><span class=line><span class=cl>  key: pe-ip:9440:admin:password
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>$ vi ntnx-pc-secret.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>kind: Secret
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: ntnx-pc-secret
</span></span><span class=line><span class=cl>  namespace: ntnx-system
</span></span><span class=line><span class=cl>stringData:
</span></span><span class=line><span class=cl>  # prism-pc-ip:prism-port:admin:password
</span></span><span class=line><span class=cl>  key: pc-ip:9440:admin:password
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc apply -f ntnx-pc-secret.yaml
</span></span><span class=line><span class=cl>$ oc apply -f ntnx-secret.yaml
</span></span></code></pre></td></tr></table></div></div><h4 id=install-csi-driver>Install CSI Driver</h4><ol><li>Download CSI Driver and Edit value.yaml</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>wget</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>nutanix</span><span class=o>/</span><span class=n>helm</span><span class=o>-</span><span class=n>releases</span><span class=o>/</span><span class=n>releases</span><span class=o>/</span><span class=n>download</span><span class=o>/</span><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>storage</span><span class=o>/</span><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>storage</span><span class=o>-</span><span class=mf>3.0</span><span class=o>.</span><span class=mi>0</span><span class=o>-</span><span class=n>beta</span><span class=o>.</span><span class=mf>1912.</span><span class=n>tgz</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>tar</span> <span class=o>-</span><span class=n>xvf</span> <span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>storage</span><span class=o>-</span><span class=mf>3.0</span><span class=o>.</span><span class=mi>0</span><span class=o>-</span><span class=n>beta</span><span class=o>.</span><span class=mf>1912.</span><span class=n>tgz</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>storage</span><span class=o>/</span><span class=n>Chart</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>storage</span><span class=o>/</span><span class=n>values</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>storage</span><span class=o>/</span><span class=n>templates</span><span class=o>/</span><span class=n>NOTES</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>storage</span><span class=o>/</span><span class=n>templates</span><span class=o>/</span><span class=n>_helpers</span><span class=o>.</span><span class=n>tpl</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>storage</span><span class=o>/</span><span class=n>templates</span><span class=o>/</span><span class=n>csi</span><span class=o>-</span><span class=n>driver</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>storage</span><span class=o>/</span><span class=n>templates</span><span class=o>/</span><span class=n>machine</span><span class=o>-</span><span class=n>config</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>storage</span><span class=o>/</span><span class=n>templates</span><span class=o>/</span><span class=n>ntnx</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>controller</span><span class=o>-</span><span class=n>deployment</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>storage</span><span class=o>/</span><span class=n>templates</span><span class=o>/</span><span class=n>ntnx</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>init</span><span class=o>-</span><span class=n>configmap</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>storage</span><span class=o>/</span><span class=n>templates</span><span class=o>/</span><span class=n>ntnx</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>node</span><span class=o>-</span><span class=n>ds</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>storage</span><span class=o>/</span><span class=n>templates</span><span class=o>/</span><span class=n>ntnx</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>rbac</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>storage</span><span class=o>/</span><span class=n>templates</span><span class=o>/</span><span class=n>ntnx</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>scc</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>storage</span><span class=o>/</span><span class=n>templates</span><span class=o>/</span><span class=n>ntnx</span><span class=o>-</span><span class=n>sc</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>storage</span><span class=o>/</span><span class=n>templates</span><span class=o>/</span><span class=n>ntnx</span><span class=o>-</span><span class=n>secret</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>storage</span><span class=o>/</span><span class=n>templates</span><span class=o>/</span><span class=n>service</span><span class=o>-</span><span class=n>prometheus</span><span class=o>-</span><span class=n>csi</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>storage</span><span class=o>/.</span><span class=n>helmignore</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>storage</span><span class=o>/</span><span class=n>Nutanix</span> <span class=n>core_k8s</span><span class=o>-</span><span class=n>csi_beta1</span> <span class=n>Notice</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>storage</span><span class=o>/</span><span class=n>README</span><span class=o>.</span><span class=n>md</span>
</span></span><span class=line><span class=cl><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>storage</span><span class=o>/</span><span class=n>questions</span><span class=o>.</span><span class=n>yml</span>
</span></span></code></pre></td></tr></table></div></div><ol start=2><li><p>Edit values.yaml</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ cd nutanix-csi-storage
</span></span><span class=line><span class=cl>$ vim values.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl># all namespace
</span></span><span class=line><span class=cl>namespace: ntnx-system
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>createPrismCentralSecret: false
</span></span><span class=line><span class=cl># prismCentralEndPoint: 00.00.00.00
</span></span><span class=line><span class=cl># pcUsername: username
</span></span><span class=line><span class=cl># pcPassword: password
</span></span><span class=line><span class=cl>pcSecretName: ntnx-pc-secret
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>createSecret: false
</span></span><span class=line><span class=cl># prismEndPoint: 00.00.000.000
</span></span><span class=line><span class=cl># username: username
</span></span><span class=line><span class=cl># password: password
</span></span><span class=line><span class=cl>peSecretName: ntnx-secret
</span></span></code></pre></td></tr></table></div></div></li><li><p>Install CSI Driver using helm</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>helm</span> <span class=n>install</span> <span class=o>-</span><span class=n>n</span> <span class=n>ntnx</span><span class=o>-</span><span class=n>system</span> <span class=o>-</span><span class=n>f</span> <span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>storage</span><span class=o>/</span><span class=n>values</span><span class=o>.</span><span class=n>yaml</span> <span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span> <span class=o>./</span><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>storage</span>
</span></span><span class=line><span class=cl><span class=n>WARNING</span><span class=p>:</span> <span class=n>Kubernetes</span> <span class=n>configuration</span> <span class=n>file</span> <span class=n>is</span> <span class=n>group</span><span class=o>-</span><span class=n>readable</span><span class=o>.</span> <span class=n>This</span> <span class=n>is</span> <span class=n>insecure</span><span class=o>.</span> <span class=n>Location</span><span class=p>:</span> <span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>nutanix</span><span class=o>/.</span><span class=n>kube</span><span class=o>/</span><span class=n>config</span>
</span></span><span class=line><span class=cl><span class=n>NAME</span><span class=p>:</span> <span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span>
</span></span><span class=line><span class=cl><span class=n>LAST</span> <span class=n>DEPLOYED</span><span class=p>:</span> <span class=n>Mon</span> <span class=n>May</span> <span class=mi>20</span> <span class=mi>16</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=mi>01</span> <span class=mi>2024</span>
</span></span><span class=line><span class=cl><span class=n>NAMESPACE</span><span class=p>:</span> <span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>
</span></span><span class=line><span class=cl><span class=n>STATUS</span><span class=p>:</span> <span class=n>deployed</span>
</span></span><span class=line><span class=cl><span class=n>REVISION</span><span class=p>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>TEST</span> <span class=n>SUITE</span><span class=p>:</span> <span class=n>None</span>
</span></span><span class=line><span class=cl><span class=n>NOTES</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=n>Driver</span> <span class=n>name</span><span class=p>:</span> <span class=n>csi</span><span class=o>.</span><span class=n>nutanix</span><span class=o>.</span><span class=n>com</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Nutanix</span> <span class=n>CSI</span> <span class=n>provider</span> <span class=n>was</span> <span class=n>deployed</span> <span class=ow>in</span> <span class=n>namespace</span> <span class=n>ntnx</span><span class=o>-</span><span class=n>system</span><span class=o>.</span> <span class=n>Check</span> <span class=n>it</span><span class=s1>&#39;s status by running:</span>
</span></span><span class=line><span class=cl><span class=n>kubectl</span> <span class=o>-</span><span class=n>n</span> <span class=n>ntnx</span><span class=o>-</span><span class=n>system</span> <span class=n>get</span> <span class=n>pods</span> <span class=o>|</span> <span class=n>grep</span> <span class=s1>&#39;nutanix-csi&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>oc</span> <span class=n>describe</span> <span class=n>daemonset</span><span class=o>.</span><span class=n>apps</span><span class=o>/</span><span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>node</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=o>----</span>                  <span class=o>-------</span>
</span></span><span class=line><span class=cl>  <span class=n>Warning</span>  <span class=n>FailedCreate</span>  <span class=mi>12</span><span class=n>m</span> <span class=p>(</span><span class=n>x19</span> <span class=n>over</span> <span class=mi>23</span><span class=n>m</span><span class=p>)</span>  <span class=n>daemonset</span><span class=o>-</span><span class=n>controller</span>  <span class=n>Error</span> <span class=n>creating</span><span class=p>:</span> <span class=n>pods</span> <span class=s2>&#34;nutanix-csi-node-&#34;</span> <span class=n>is</span> <span class=n>forbidden</span><span class=p>:</span> <span class=n>unable</span> <span class=n>to</span> <span class=n>validate</span> <span class=n>against</span> <span class=n>any</span> <span class=n>security</span> <span class=n>context</span> <span class=n>constraint</span><span class=p>:</span> <span class=p>[</span><span class=n>provider</span> <span class=s2>&#34;anyuid&#34;</span><span class=p>:</span> <span class=n>Forbidden</span><span class=p>:</span> <span class=ow>not</span> <span class=n>usable</span> <span class=n>by</span> <span class=n>user</span> <span class=ow>or</span> <span class=n>serviceaccount</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Apply privilege to openshift-cluster-csi-drivers namespace</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>oc</span> <span class=n>project</span> <span class=n>ntnx</span><span class=o>-</span><span class=n>system</span>
</span></span><span class=line><span class=cl><span class=n>Now</span> <span class=n>using</span> <span class=n>project</span> <span class=s2>&#34;ntnx-system&#34;</span> <span class=n>on</span> <span class=n>server</span> <span class=s2>&#34;https://api.ocplab.nutanixlab.local:6443&#34;</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>oc</span> <span class=n>adm</span> <span class=n>policy</span> <span class=n>add</span><span class=o>-</span><span class=n>scc</span><span class=o>-</span><span class=n>to</span><span class=o>-</span><span class=n>user</span> <span class=n>privileged</span> <span class=o>-</span><span class=n>z</span> <span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>controller</span>
</span></span><span class=line><span class=cl><span class=n>clusterrole</span><span class=o>.</span><span class=n>rbac</span><span class=o>.</span><span class=n>authorization</span><span class=o>.</span><span class=n>k8s</span><span class=o>.</span><span class=n>io</span><span class=o>/</span><span class=n>system</span><span class=p>:</span><span class=n>openshift</span><span class=p>:</span><span class=n>scc</span><span class=p>:</span><span class=n>privileged</span> <span class=n>added</span><span class=p>:</span> <span class=s2>&#34;nutanix-csi-controller&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>oc</span> <span class=n>adm</span> <span class=n>policy</span> <span class=n>add</span><span class=o>-</span><span class=n>scc</span><span class=o>-</span><span class=n>to</span><span class=o>-</span><span class=n>user</span> <span class=n>privileged</span> <span class=o>-</span><span class=n>z</span> <span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>node</span>
</span></span><span class=line><span class=cl><span class=n>clusterrole</span><span class=o>.</span><span class=n>rbac</span><span class=o>.</span><span class=n>authorization</span><span class=o>.</span><span class=n>k8s</span><span class=o>.</span><span class=n>io</span><span class=o>/</span><span class=n>system</span><span class=p>:</span><span class=n>openshift</span><span class=p>:</span><span class=n>scc</span><span class=p>:</span><span class=n>privileged</span> <span class=n>added</span><span class=p>:</span> <span class=s2>&#34;nutanix-csi-node&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>oc</span> <span class=n>adm</span> <span class=n>policy</span> <span class=n>add</span><span class=o>-</span><span class=n>scc</span><span class=o>-</span><span class=n>to</span><span class=o>-</span><span class=n>user</span> <span class=n>privileged</span> <span class=o>-</span><span class=n>z</span> <span class=n>node</span><span class=o>-</span><span class=n>exporter</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>oc</span> <span class=n>adm</span> <span class=n>policy</span> <span class=n>add</span><span class=o>-</span><span class=n>scc</span><span class=o>-</span><span class=n>to</span><span class=o>-</span><span class=n>user</span> <span class=n>anyuid</span> <span class=o>-</span><span class=n>z</span> <span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>controller</span>
</span></span><span class=line><span class=cl><span class=n>clusterrole</span><span class=o>.</span><span class=n>rbac</span><span class=o>.</span><span class=n>authorization</span><span class=o>.</span><span class=n>k8s</span><span class=o>.</span><span class=n>io</span><span class=o>/</span><span class=n>system</span><span class=p>:</span><span class=n>openshift</span><span class=p>:</span><span class=n>scc</span><span class=p>:</span><span class=n>anyuid</span> <span class=n>added</span><span class=p>:</span> <span class=s2>&#34;nutanix-csi-controller&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>oc</span> <span class=n>adm</span> <span class=n>policy</span> <span class=n>add</span><span class=o>-</span><span class=n>scc</span><span class=o>-</span><span class=n>to</span><span class=o>-</span><span class=n>user</span> <span class=n>anyuid</span> <span class=o>-</span><span class=n>z</span> <span class=n>nutanix</span><span class=o>-</span><span class=n>csi</span><span class=o>-</span><span class=n>node</span>
</span></span><span class=line><span class=cl><span class=n>clusterrole</span><span class=o>.</span><span class=n>rbac</span><span class=o>.</span><span class=n>authorization</span><span class=o>.</span><span class=n>k8s</span><span class=o>.</span><span class=n>io</span><span class=o>/</span><span class=n>system</span><span class=p>:</span><span class=n>openshift</span><span class=p>:</span><span class=n>scc</span><span class=p>:</span><span class=n>anyuid</span> <span class=n>added</span><span class=p>:</span> <span class=s2>&#34;nutanix-csi-node&#34;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Check CSI installed</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ oc get all
</span></span><span class=line><span class=cl>NAME                                          READY   STATUS    RESTARTS      AGE
</span></span><span class=line><span class=cl>pod/nutanix-csi-controller-844589fc9f-4jr5m   7/7     Running   3 (16h ago)   16h
</span></span><span class=line><span class=cl>pod/nutanix-csi-controller-844589fc9f-wwq7m   7/7     Running   4 (16h ago)   16h
</span></span><span class=line><span class=cl>pod/nutanix-csi-node-fkmdd                    3/3     Running   0             16h
</span></span><span class=line><span class=cl>pod/nutanix-csi-node-hjnwg                    3/3     Running   0             16h
</span></span><span class=line><span class=cl>pod/nutanix-csi-node-pwqwl                    3/3     Running   0             16h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                          TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                               AGE
</span></span><span class=line><span class=cl>service/nutanix-csi-metrics   ClusterIP   172.30.168.77   &lt;none&gt;        9809/TCP,9810/TCP,9811/TCP,9812/TCP   17h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                              DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE
</span></span><span class=line><span class=cl>daemonset.apps/nutanix-csi-node   3         3         3       3            3           kubernetes.io/os=linux   17h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                     READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment.apps/nutanix-csi-controller   2/2     2            2           17h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                                DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>replicaset.apps/nutanix-csi-controller-844589fc9f   2         2         2       17h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc describe daemonset.apps/nutanix-csi-node
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  Normal   SuccessfulCreate  40s                    daemonset-controller  Created pod: nutanix-csi-node-cgdvs
</span></span><span class=line><span class=cl>  Normal   SuccessfulCreate  40s                    daemonset-controller  Created pod: nutanix-csi-node-c49f5
</span></span><span class=line><span class=cl>  Normal   SuccessfulCreate  40s                    daemonset-controller  Created pod: nutanix-csi-node-4j69r
</span></span></code></pre></td></tr></table></div></div></li><li><p>OCP Console</p><p><img src=https://kenkenny.synology.me:5543/images/2024/05/image-20240509134700168.png loading=lazy alt=image-20240509134700168></p></li></ol><h4 id=create-storageclass>Create StorageClass</h4><ol><li><p>create nutanix-volume.yaml</p></li><li><p>oc apply -f nutanix-volume.yaml</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ vim nutanix-volume.yaml 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kind: StorageClass
</span></span><span class=line><span class=cl>apiVersion: storage.k8s.io/v1
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  annotations:
</span></span><span class=line><span class=cl>    storageclass.kubernetes.io/is-default-class: &#34;true&#34;
</span></span><span class=line><span class=cl>  name: nutanixvolume
</span></span><span class=line><span class=cl>provisioner: csi.nutanix.com
</span></span><span class=line><span class=cl>parameters:
</span></span><span class=line><span class=cl>  csi.storage.k8s.io/provisioner-secret-name: ntnx-secret
</span></span><span class=line><span class=cl>  csi.storage.k8s.io/provisioner-secret-namespace: ntnx-system
</span></span><span class=line><span class=cl>  csi.storage.k8s.io/node-publish-secret-name: ntnx-secret
</span></span><span class=line><span class=cl>  csi.storage.k8s.io/node-publish-secret-namespace: ntnx-system
</span></span><span class=line><span class=cl>  csi.storage.k8s.io/controller-expand-secret-name: ntnx-secret
</span></span><span class=line><span class=cl>  csi.storage.k8s.io/controller-expand-secret-namespace: ntnx-system
</span></span><span class=line><span class=cl>  csi.storage.k8s.io/fstype: ext4
</span></span><span class=line><span class=cl>  dataServiceEndPoint: IP:3260 # Prism data service ip
</span></span><span class=line><span class=cl>  storageContainer: NX_1365_AHV_cr # Prism 上建立的Storage Container
</span></span><span class=line><span class=cl>  storageType: NutanixVolumes
</span></span><span class=line><span class=cl>  #whitelistIPMode: ENABLED
</span></span><span class=line><span class=cl>  #chapAuth: ENABLED
</span></span><span class=line><span class=cl>allowVolumeExpansion: true
</span></span><span class=line><span class=cl>reclaimPolicy: Delete
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc apply -f nutanix-volume.yaml
</span></span></code></pre></td></tr></table></div></div></li><li><p>Check StorageClass</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ oc get storageclass
</span></span><span class=line><span class=cl>NAME            PROVISIONER       RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
</span></span><span class=line><span class=cl>nutanixvolume   csi.nutanix.com   Delete          Immediate           true                   121m
</span></span></code></pre></td></tr></table></div></div><p><img src=https://kenkenny.synology.me:5543/images/2024/05/image-20240509140930382.png loading=lazy alt=image-20240509140930382></p></li><li><p>Create test-pvc</p><p><img src=https://kenkenny.synology.me:5543/images/2024/05/image-20240509140956018.png loading=lazy alt=image-20240509140956018></p><p><img src=https://kenkenny.synology.me:5543/images/2024/05/image-20240509141008518.png loading=lazy alt=image-20240509141008518></p></li></ol><h3 id=cert-manager>Cert-manager</h3><ol><li><p>Install cert-manager tools</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=err>路徑</span> 
</span></span><span class=line><span class=cl><span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>/</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>/</span><span class=n>releases</span><span class=o>/</span><span class=n>tag</span><span class=o>/</span><span class=n>v1</span><span class=o>.</span><span class=mf>14.5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>/</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>/</span><span class=n>releases</span><span class=o>/</span><span class=n>download</span><span class=o>/</span><span class=n>v1</span><span class=o>.</span><span class=mf>14.5</span><span class=o>/</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>oc</span> <span class=n>new</span><span class=o>-</span><span class=n>project</span> <span class=n>cert</span><span class=o>-</span><span class=n>manager</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>oc</span> <span class=n>apply</span> <span class=o>-</span><span class=n>f</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>/</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>/</span><span class=n>releases</span><span class=o>/</span><span class=n>download</span><span class=o>/</span><span class=n>v1</span><span class=o>.</span><span class=mf>14.5</span><span class=o>/</span><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>oc</span> <span class=n>get</span> <span class=n>pods</span> <span class=o>-</span><span class=n>n</span> <span class=n>cert</span><span class=o>-</span><span class=n>manager</span>
</span></span><span class=line><span class=cl><span class=n>NAME</span>                                      <span class=n>READY</span>   <span class=n>STATUS</span>    <span class=n>RESTARTS</span>   <span class=n>AGE</span>
</span></span><span class=line><span class=cl><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>-</span><span class=mi>5658</span><span class=n>d944df</span><span class=o>-</span><span class=mi>9</span><span class=n>tqqp</span>             <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>34</span><span class=n>s</span>
</span></span><span class=line><span class=cl><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>-</span><span class=n>cainjector</span><span class=o>-</span><span class=n>cb99ff845</span><span class=o>-</span><span class=mi>24</span><span class=n>r6d</span>   <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>34</span><span class=n>s</span>
</span></span><span class=line><span class=cl><span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>-</span><span class=n>webhook</span><span class=o>-</span><span class=mi>7</span><span class=n>fd74b8dc7</span><span class=o>-</span><span class=n>ts6pk</span>     <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>     <span class=n>Running</span>   <span class=mi>0</span>          <span class=mi>34</span><span class=n>s</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=onboard-ocp-to-pc>Onboard OCP to PC</h3><p>建立Project 把 ocp相關的VM放進去 (ocp-lab)</p><p>用Support Portal 上下載的k8s-agent.tar 需要自行上傳到Dokcer Hub或是其他私倉，並且修改value.yaml 內的image路徑</p><ol><li><p>get cluster uid and name</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>kubectl</span> <span class=n>get</span> <span class=n>ns</span> <span class=n>kube</span><span class=o>-</span><span class=n>system</span> <span class=o>-</span><span class=n>o</span> <span class=n>json</span> <span class=o>|</span><span class=n>grep</span> <span class=n>uid</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;openshift.io/sa.scc.uid-range&#34;</span><span class=p>:</span> <span class=s2>&#34;1000020000/10000&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;uid&#34;</span><span class=p>:</span> <span class=s2>&#34;25c8543a-3df0-442a-83eb-5af1ab1b7be3&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>kubectl</span> <span class=n>get</span> <span class=n>infrastructure</span> <span class=n>cluster</span> <span class=o>-</span><span class=n>o</span> <span class=n>yaml</span> <span class=o>|</span> <span class=n>grep</span> <span class=n>infrastructureName</span>
</span></span><span class=line><span class=cl>  <span class=n>infrastructureName</span><span class=p>:</span> <span class=n>ocplab</span><span class=o>-</span><span class=n>qx6t5</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>oc</span> <span class=n>get</span> <span class=o>-</span><span class=n>o</span> <span class=n>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.status.infrastructureName}{&#34;</span><span class=se>\n</span><span class=s1>&#34;}&#39;</span> <span class=n>infrastructure</span> <span class=n>cluster</span>
</span></span><span class=line><span class=cl><span class=n>ocplab</span><span class=o>-</span><span class=n>qx6t5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=k>export</span> <span class=n>CLUSTER_UUID</span><span class=o>=</span><span class=mi>25</span><span class=n>c8543a</span><span class=o>-</span><span class=mi>3</span><span class=n>df0</span><span class=o>-</span><span class=mi>442</span><span class=n>a</span><span class=o>-</span><span class=mi>83</span><span class=n>eb</span><span class=o>-</span><span class=mi>5</span><span class=n>af1ab1b7be3</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=k>export</span> <span class=n>CLUSTER_INFRA_NAME</span><span class=o>=</span><span class=n>ocplab</span><span class=o>-</span><span class=n>qx6t5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>PC上的VG會多k8s</span><span class=o>-</span><span class=err>的</span><span class=n>prefix</span>
</span></span><span class=line><span class=cl><span class=n>k8s</span><span class=o>-</span><span class=mi>25</span><span class=n>c8543a</span><span class=o>-</span><span class=mi>3</span><span class=n>df0</span><span class=o>-</span><span class=mi>442</span><span class=n>a</span><span class=o>-</span><span class=mi>83</span><span class=n>eb</span><span class=o>-</span><span class=mi>5</span><span class=n>af1ab1b7be3</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Download k8s-agent.tar and ndk-1.0.0.tar</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 下載連結要重新產生</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>curl</span> <span class=o>-</span><span class=n>o</span> <span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mf>0.</span><span class=n>tar</span> <span class=o>-</span><span class=n>O</span> <span class=s2>&#34;https://download.nutanix.com/downloads/ndk/1.0.0/k8s-agent-1.0.0.tar?Expires=1715275315306&amp;Key-Pair-Id=APKAJTTNCWPEI42QKMSA&amp;Signature=exuDWlLvpFIhLfN6YpDd9SyAz1a8o0CudJabSf8j~FEAVpwd6CjFe2WgCae2Jp5gZjNwwIEvHq4lXbvRMqDWm~LEVxO9E84ribrxu2uDNbkbAuG7I0OeWEDROsdpM1-qN~g9fp16-X~Y8lG-sh1cOLz-N8hjgq83vDMeusfTUrRMQOjlrGV7h44QL0-LlIs8GkkoIJbh3rxhZO~vavCvs4EJ9uec9qH6BrQLMfstVZr7j6uLu4juf6hnEsWJzalJXZ04YaA8onpgm-jhNBj2m5fxjXlJ-iCsu6u6BSLmm2ffpzSkUUlFpoSJZX~QODiHHiQi9V9xe9R8wdkQPfo-1g__&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>%</span> <span class=n>Total</span>    <span class=o>%</span> <span class=n>Received</span> <span class=o>%</span> <span class=n>Xferd</span>  <span class=n>Average</span> <span class=n>Speed</span>   <span class=n>Time</span>    <span class=n>Time</span>     <span class=n>Time</span>  <span class=n>Current</span>
</span></span><span class=line><span class=cl>                                 <span class=n>Dload</span>  <span class=n>Upload</span>   <span class=n>Total</span>   <span class=n>Spent</span>    <span class=n>Left</span>  <span class=n>Speed</span>
</span></span><span class=line><span class=cl><span class=mi>100</span> <span class=mf>59.2</span><span class=n>M</span>  <span class=mi>100</span> <span class=mf>59.2</span><span class=n>M</span>    <span class=mi>0</span>     <span class=mi>0</span>  <span class=mf>10.4</span><span class=n>M</span>      <span class=mi>0</span>  <span class=mi>0</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>05</span>  <span class=mi>0</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>05</span> <span class=o>--</span><span class=p>:</span><span class=o>--</span><span class=p>:</span><span class=o>--</span> <span class=mf>13.2</span><span class=n>M</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>curl</span> <span class=o>-</span><span class=n>o</span> <span class=n>ndk</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mf>0.</span><span class=n>tar</span> <span class=o>-</span><span class=n>O</span> <span class=s2>&#34;https://download.nutanix.com/downloads/ndk/1.0.0/ndk-1.0.0.tar?Expires=1715276310943&amp;Key-Pair-Id=APKAJTTNCWPEI42QKMSA&amp;Signature=A8y8JoJupVvWedB~jSHTysEZK18eyITvdT6DFw9C9JpVOhKc9jnZraaDir2DZDeRVpnPaOraMF2lR5lFqlSaikGj274ETgetuz33R0jcJ-fB44~xfXL~eK5cpqNhuuG3Yufs0biq1b8CC-frrVeupzKzOdmJyBEWXPe4GSCLWwqPubPjhUAHMKyoOgcxSd-A6kS9f~c0eEikartUrgtCjyZP-iZwPxn6gg3jGoZuHK3f2Nf~HjmyrJqwBmLQA0ibVdRTN0YkYVfplpkr5ucp8MLMPFbhdmAJZIAot8vc2-qMPoidczgU1Msd1w8NsXWMUFQBnO-Y73VZ31d4yxI31A__&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>mkdir</span> <span class=n>ndk</span><span class=o>-</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>cd</span> <span class=n>ndk</span><span class=o>-</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>ls</span> <span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mf>0.</span><span class=n>tar</span> 
</span></span><span class=line><span class=cl><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mf>0.</span><span class=n>tar</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>mv</span> <span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mf>0.</span><span class=n>tar</span> <span class=n>ndk</span><span class=o>-</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>tar</span> <span class=n>xvf</span> <span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mf>0.</span><span class=n>tar</span> 
</span></span><span class=line><span class=cl><span class=o>./</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span><span class=o>/</span>
</span></span><span class=line><span class=cl><span class=o>./</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span><span class=o>/</span><span class=n>Chart</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=o>./</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span><span class=o>/.</span><span class=n>helmignore</span>
</span></span><span class=line><span class=cl><span class=o>./</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span><span class=o>/</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mf>0.</span><span class=n>tar</span>
</span></span><span class=line><span class=cl><span class=o>./</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span><span class=o>/</span><span class=n>templates</span><span class=o>/</span>
</span></span><span class=line><span class=cl><span class=o>./</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span><span class=o>/</span><span class=n>templates</span><span class=o>/</span><span class=n>hook</span><span class=o>-</span><span class=n>predelete</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=o>./</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span><span class=o>/</span><span class=n>templates</span><span class=o>/</span><span class=n>hook</span><span class=o>-</span><span class=n>preinstall</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=o>./</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span><span class=o>/</span><span class=n>templates</span><span class=o>/</span><span class=n>hook</span><span class=o>-</span><span class=n>postdelete</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=o>./</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span><span class=o>/</span><span class=n>templates</span><span class=o>/</span><span class=n>hook</span><span class=o>-</span><span class=n>postupgrade</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=o>./</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span><span class=o>/</span><span class=n>templates</span><span class=o>/</span><span class=n>hook</span><span class=o>-</span><span class=n>postinstall</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=o>./</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span><span class=o>/</span><span class=n>templates</span><span class=o>/</span><span class=n>nutanix_agent_deployment</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=o>./</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span><span class=o>/</span><span class=n>values</span><span class=o>.</span><span class=n>schema</span><span class=o>.</span><span class=n>json</span>
</span></span><span class=line><span class=cl><span class=o>./</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span><span class=o>/</span><span class=n>README</span><span class=o>.</span><span class=n>md</span>
</span></span><span class=line><span class=cl><span class=o>./</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span><span class=o>/</span><span class=n>values</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=o>./</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span><span class=o>/</span><span class=n>Nutanix</span><span class=o>-</span><span class=n>core_k8s</span><span class=o>-</span><span class=n>agent</span><span class=o>-</span><span class=n>Notice</span><span class=o>.</span><span class=n>txt</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>push image to docker hub</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>echo</span> <span class=o>-</span><span class=n>n</span> <span class=s1>&#39;kenxxxxxxxx:xuxxxxxxxx&#39;</span> <span class=o>|</span><span class=n>base64</span>
</span></span><span class=line><span class=cl><span class=n>dockerconfigVubnxxxxxxxxxxxxxxxx2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;auths&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;https://index.docker.io/v1/&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;auth&#34;</span><span class=p>:</span> <span class=s2>&#34;a2Vua2Vubnxxxxxxxxxxxxxxxx2&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>vim</span> <span class=n>dockerconfig</span><span class=o>.</span><span class=n>json</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>cat</span> <span class=n>dockerconfig</span><span class=o>.</span><span class=n>json</span> <span class=o>|</span><span class=n>base64</span>
</span></span><span class=line><span class=cl><span class=n>dockerconfigVubnxxxxxxxxxxxxxxxx2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>podman</span> <span class=nb>load</span> <span class=o>-</span><span class=n>i</span> <span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mf>0.</span><span class=n>tar</span> 
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>podman</span> <span class=n>tag</span> <span class=n>localhost</span><span class=o>/</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=p>:</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span> <span class=n>kenkennyinfo</span><span class=o>/</span><span class=n>nke</span><span class=o>-</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=p>:</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>podman</span> <span class=n>push</span> <span class=n>kenkennyinfo</span><span class=o>/</span><span class=n>nke</span><span class=o>-</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=p>:</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>podman</span> <span class=n>tag</span> <span class=n>localhost</span><span class=o>/</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=p>:</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span> <span class=n>kenkennyinfo</span><span class=o>/</span><span class=n>nke</span><span class=o>-</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=p>:</span><span class=mi>668</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>podman</span> <span class=n>push</span> <span class=n>kenkennyinfo</span><span class=o>/</span><span class=n>nke</span><span class=o>-</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span><span class=p>:</span><span class=mi>668</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=https://kenkenny.synology.me:5543/images/2024/05/image-20240510154840948.png loading=lazy alt=image-20240510154840948></p></li><li><p>Install k8s-agent</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>安裝失敗時可用刪除指令
</span></span><span class=line><span class=cl>$ oc delete clusterroles.rbac.authorization.k8s.io &#34;nke-k8s-agent-preinstall&#34;
</span></span><span class=line><span class=cl>$ oc delete ClusterRoleBinding nke-k8s-agent-preinstall
</span></span><span class=line><span class=cl>$ oc delete project ntnx-system
</span></span><span class=line><span class=cl>$ oc new-project ntnx-system
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>!用最新版本的需要自行上傳!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## Docker Hub (版本較新 v668)
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>$ vim values.yaml 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>agent:
</span></span><span class=line><span class=cl>  namespaceOverride: ntnx-system
</span></span><span class=line><span class=cl>  name: nutanix-agent
</span></span><span class=line><span class=cl>  port: 8080
</span></span><span class=line><span class=cl>  image:
</span></span><span class=line><span class=cl>    repository: docker.io/kenkennyinfo
</span></span><span class=line><span class=cl>    name: nke-k8s-agent
</span></span><span class=line><span class=cl>    pullPolicy: IfNotPresent
</span></span><span class=line><span class=cl>    tag: 668
</span></span><span class=line><span class=cl>    privateRegistry: true
</span></span><span class=line><span class=cl>    imageCredentials:
</span></span><span class=line><span class=cl>      dockerconfig: &#34;dockerconfigVubnxxxxxxxxxxxxxxxx2&#34;
</span></span><span class=line><span class=cl>  updateConfigInMin: 10
</span></span><span class=line><span class=cl>  updateMetricsInMin: 360
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>pc:
</span></span><span class=line><span class=cl>  port: 9440
</span></span><span class=line><span class=cl>  insecure: false #set this to true if PC does not have https enabled
</span></span><span class=line><span class=cl>  endpoint: &#34;&#34; # eg: ip or fqdn
</span></span><span class=line><span class=cl>  username: &#34;&#34; # eg: admin or any other user with Kubernetes Infrastructure provision role
</span></span><span class=line><span class=cl>  password: &#34;&#34;
</span></span><span class=line><span class=cl>k8sClusterName: &#34;&#34;
</span></span><span class=line><span class=cl>k8sClusterUUID: &#34;&#34;
</span></span><span class=line><span class=cl>k8sDistribution: &#34;OCP&#34; # eg: CAPX or NKE or OCP
</span></span><span class=line><span class=cl>categoryMappings: &#34;&#34; # &#34;one or more comma separated key=value&#34; eg: &#34;key1=value1&#34; or &#34;key1=value1,key2=value2&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>## 官方quay.io (版本較舊 v594)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ vim values.yaml 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>agent:
</span></span><span class=line><span class=cl>  namespaceOverride: ntnx-system
</span></span><span class=line><span class=cl>  name: nutanix-agent
</span></span><span class=line><span class=cl>  port: 8080
</span></span><span class=line><span class=cl>  image:
</span></span><span class=line><span class=cl>    repository: quay.io/karbon
</span></span><span class=line><span class=cl>    name: k8s-agent
</span></span><span class=line><span class=cl>    pullPolicy: IfNotPresent
</span></span><span class=line><span class=cl>    tag: 594
</span></span><span class=line><span class=cl>    privateRegistry: false
</span></span><span class=line><span class=cl>  updateConfigInMin: 10
</span></span><span class=line><span class=cl>  updateMetricsInMin: 360
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>pc:
</span></span><span class=line><span class=cl>  port: 9440
</span></span><span class=line><span class=cl>  insecure: false #set this to true if PC does not have https enabled
</span></span><span class=line><span class=cl>  endpoint: &#34;&#34; # eg: ip or fqdn
</span></span><span class=line><span class=cl>  username: &#34;&#34; # eg: admin or any other user with Kubernetes Infrastructure provision role
</span></span><span class=line><span class=cl>  password: &#34;&#34;
</span></span><span class=line><span class=cl>k8sClusterName: &#34;&#34;
</span></span><span class=line><span class=cl>k8sClusterUUID: &#34;&#34;
</span></span><span class=line><span class=cl>k8sDistribution: &#34;OCP&#34; # eg: CAPX or NKE or OCP
</span></span><span class=line><span class=cl>categoryMappings: &#34;&#34; # &#34;one or more comma separated key=value&#34; eg: &#34;key1=value1&#34; or &#34;key1=value1,key2=value2&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Helm 安裝
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ helm install k8s-agent-1.0.0 /home/nutanix/k8s-agent-1.0.0  --set pc.endpoint=172.16.90.75,pc.username=ocpadmin,pc.password=password,pc.insecure=true,k8sClusterName=ocplab-qx6t5,k8sClusterUUID=25c8543a-3df0-442a-83eb-5af1ab1b7be3,k8sDistribution=OCP -n ntnx-system --create-namespace
</span></span><span class=line><span class=cl>WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/nutanix/.kube/config
</span></span><span class=line><span class=cl>NAME: k8s-agent-594
</span></span><span class=line><span class=cl>LAST DEPLOYED: Wed May 15 14:09:01 2024
</span></span><span class=line><span class=cl>NAMESPACE: ntnx-system
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: 1
</span></span><span class=line><span class=cl>TEST SUITE: None
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## 安裝新版本或是更改密碼可以使用helm upgrade (修改values.yaml)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ helm upgrade k8s-agent-594 /home/nutanix/k8s-agent-1.0.0 --set pc.endpoint=172.16.90.75,pc.username=ocpadmin,pc.password=password,pc.insecure=true,k8sClusterName=ocplab-qx6t5,k8sClusterUUID=25c8543a-3df0-442a-83eb-5af1ab1b7be3 -n ntnx-system
</span></span><span class=line><span class=cl>WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/nutanix/.kube/config
</span></span><span class=line><span class=cl>Release &#34;k8s-agent-594&#34; has been upgraded. Happy Helming!
</span></span><span class=line><span class=cl>NAME: k8s-agent-594
</span></span><span class=line><span class=cl>LAST DEPLOYED: Wed May 15 14:13:56 2024
</span></span><span class=line><span class=cl>NAMESPACE: ntnx-system
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: 2
</span></span><span class=line><span class=cl>TEST SUITE: None
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ helm upgrade k8s-agent-594 /home/nutanix/k8s-agent-1.0.0 --set pc.endpoint=172.16.90.75,pc.username=ocpadmin,pc.password=password,pc.insecure=true,k8sClusterName=ocplab-qx6t5,k8sClusterUUID=25c8543a-3df0-442a-83eb-5af1ab1b7be3 -n ntnx-system
</span></span><span class=line><span class=cl>WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/nutanix/.kube/config
</span></span><span class=line><span class=cl>Release &#34;k8s-agent-594&#34; has been upgraded. Happy Helming!
</span></span><span class=line><span class=cl>NAME: k8s-agent-594
</span></span><span class=line><span class=cl>LAST DEPLOYED: Wed May 15 15:18:35 2024
</span></span><span class=line><span class=cl>NAMESPACE: ntnx-system
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: 3
</span></span><span class=line><span class=cl>TEST SUITE: None
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>## Check pods and deployments
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc get all -n ntnx-system
</span></span><span class=line><span class=cl>NAME                                 READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod/nutanix-agent-75df9d879b-98smz   1/1     Running   0          80s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                            READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment.apps/nutanix-agent   1/1     1            1           70m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                       DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>replicaset.apps/nutanix-agent-75df9d879b   1         1         1       80s
</span></span><span class=line><span class=cl>replicaset.apps/nutanix-agent-7c4b644996   0         0         0       70m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc describe deployment.apps/nutanix-agent -n ntnx-system
</span></span><span class=line><span class=cl>Name:                   nutanix-agent
</span></span><span class=line><span class=cl>Namespace:              ntnx-system
</span></span><span class=line><span class=cl>CreationTimestamp:      Wed, 15 May 2024 14:09:31 +0800
</span></span><span class=line><span class=cl>Labels:                 app.kubernetes.io/managed-by=Helm
</span></span><span class=line><span class=cl>Annotations:            deployment.kubernetes.io/revision: 2
</span></span><span class=line><span class=cl>                        meta.helm.sh/release-name: k8s-agent-594
</span></span><span class=line><span class=cl>                        meta.helm.sh/release-namespace: ntnx-system
</span></span><span class=line><span class=cl>Selector:               app=nutanix-agent
</span></span><span class=line><span class=cl>Replicas:               1 desired | 1 updated | 1 total | 1 available | 0 unavailable
</span></span><span class=line><span class=cl>StrategyType:           RollingUpdate
</span></span><span class=line><span class=cl>MinReadySeconds:        0
</span></span><span class=line><span class=cl>RollingUpdateStrategy:  25% max unavailable, 25% max surge
</span></span><span class=line><span class=cl>Pod Template:
</span></span><span class=line><span class=cl>  Labels:           app=nutanix-agent
</span></span><span class=line><span class=cl>  Service Account:  nutanix-agent
</span></span><span class=line><span class=cl>  Containers:
</span></span><span class=line><span class=cl>   nutanix-agent:
</span></span><span class=line><span class=cl>    Image:      docker.io/kenkennyinfo/nke-k8s-agent:668
</span></span><span class=line><span class=cl>    Port:       8080/TCP
</span></span><span class=line><span class=cl>    Host Port:  0/TCP
</span></span><span class=line><span class=cl>    Command:
</span></span><span class=line><span class=cl>      /k8s-agent/k8s-agent
</span></span><span class=line><span class=cl>    Args:
</span></span><span class=line><span class=cl>      -pc-endpoint=172.16.90.75
</span></span><span class=line><span class=cl>      -pc-port=9440
</span></span><span class=line><span class=cl>      -insecure=true
</span></span><span class=line><span class=cl>      -k8s-cluster-name=ocplab-qx6t5
</span></span><span class=line><span class=cl>      -k8s-cluster-uuid=25c8543a-3df0-442a-83eb-5af1ab1b7be3
</span></span><span class=line><span class=cl>      -k8s-distribution=OCP
</span></span><span class=line><span class=cl>      -k8s-cluster-category=
</span></span><span class=line><span class=cl>      -update-config-in-min=10
</span></span><span class=line><span class=cl>      -update-metrics-in-min=360
</span></span><span class=line><span class=cl>    Limits:
</span></span><span class=line><span class=cl>      cpu:     500m
</span></span><span class=line><span class=cl>      memory:  128Mi
</span></span><span class=line><span class=cl>    Requests:
</span></span><span class=line><span class=cl>      cpu:        250m
</span></span><span class=line><span class=cl>      memory:     64Mi
</span></span><span class=line><span class=cl>    Liveness:     http-get http://:8080/health delay=5s timeout=5s period=15s #success=1 #failure=3
</span></span><span class=line><span class=cl>    Readiness:    http-get http://:8080/readiness delay=5s timeout=1s period=10s #success=1 #failure=3
</span></span><span class=line><span class=cl>    Environment:  &lt;none&gt;
</span></span><span class=line><span class=cl>    Mounts:
</span></span><span class=line><span class=cl>      /certs from pc-creds-volume (ro)
</span></span><span class=line><span class=cl>  Volumes:
</span></span><span class=line><span class=cl>   pc-creds-volume:
</span></span><span class=line><span class=cl>    Type:        Secret (a volume populated by a Secret)
</span></span><span class=line><span class=cl>    SecretName:  nutanix-agent
</span></span><span class=line><span class=cl>    Optional:    false
</span></span><span class=line><span class=cl>Conditions:
</span></span><span class=line><span class=cl>  Type           Status  Reason
</span></span><span class=line><span class=cl>  ----           ------  ------
</span></span><span class=line><span class=cl>  Available      True    MinimumReplicasAvailable
</span></span><span class=line><span class=cl>  Progressing    True    NewReplicaSetAvailable
</span></span><span class=line><span class=cl>OldReplicaSets:  &lt;none&gt;
</span></span><span class=line><span class=cl>NewReplicaSet:   nutanix-agent-75df9d879b (1/1 replicas created)
</span></span><span class=line><span class=cl>Events:
</span></span><span class=line><span class=cl>  Type    Reason             Age   From                   Message
</span></span><span class=line><span class=cl>  ----    ------             ----  ----                   -------
</span></span><span class=line><span class=cl>  Normal  ScalingReplicaSet  70m   deployment-controller  Scaled up replica set nutanix-agent-7c4b644996 to 1
</span></span><span class=line><span class=cl>  Normal  ScalingReplicaSet  84s   deployment-controller  Scaled up replica set nutanix-agent-75df9d879b to 1
</span></span><span class=line><span class=cl>  Normal  ScalingReplicaSet  73s   deployment-controller  Scaled down replica set nutanix-agent-7c4b644996 to 0 from 1
</span></span></code></pre></td></tr></table></div></div><p>安裝後進入Prism Central 確認已 Onboard 完成</p><p><img src=https://kenkenny.synology.me:5543/images/2024/05/image-20240515150336316.png loading=lazy alt=image-20240515150336316></p><p><img src=https://kenkenny.synology.me:5543/images/2024/05/image-20240515150407687.png loading=lazy alt=image-20240515150407687></p><p><img src=https://kenkenny.synology.me:5543/images/2024/05/image-20240515142010187.png loading=lazy></p><p><img src=https://kenkenny.synology.me:5543/images/2024/05/image-20240515142031619.png loading=lazy alt=image-20240515142031619></p><p><img src=https://kenkenny.synology.me:5543/images/2024/05/image-20240515142042758.png loading=lazy alt=image-20240515142042758></p></li></ol><h3 id=ndk-install-without-tls>NDK Install without TLS</h3><ol><li><p>下載 ndk-1.0.0.tar 並解壓縮</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>wget</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>download</span><span class=o>.</span><span class=n>nutanix</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>downloads</span><span class=o>/</span><span class=n>ndk</span><span class=o>/</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span><span class=o>/</span><span class=n>ndk</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mf>0.</span><span class=n>tar</span><span class=err>?</span><span class=n>Expires</span><span class=o>=</span><span class=mi>1715793783203</span><span class=o>&amp;</span><span class=n>Key</span><span class=o>-</span><span class=n>Pair</span><span class=o>-</span><span class=n>Id</span><span class=o>=</span><span class=n>APKAJTTNCWPEI42QKMSA</span><span class=o>&amp;</span><span class=n>Signature</span><span class=o>=</span><span class=n>bT</span><span class=o>~</span><span class=n>JG3wJjEQ3dvNO85khPiJq1yVxAH6YPV7PGtJvKaf4iJVRDfQIockkqSyH3ZubXpSvF2loZAXqvueSef41SZa9vSzEC1zrc</span><span class=o>~</span><span class=n>IzwcCjAcXnAbXC1LGy566yIBvwNaFm1qSr0jONb3zwzckNHidS8QmTRRyscaiHdF8xQ</span><span class=o>~</span><span class=n>gD0MQfKBlrl4hej3Pnae0ckMZoT5yCPzAv8vQU5XhvL0YECmy2T6LhBH13mxHpijM70aACCjdE5KdlCHFrSZhsDYYy5FWRYT02q70mM4SAUNYYcBnW4FNmmKuPWPyq0r2lcJRktIOgfQOHvUv</span><span class=o>-</span><span class=n>qw0vyrEdRj7QmgWpiCAAoSfqWl</span><span class=o>-</span><span class=n>lKA__</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>tar</span> <span class=o>-</span><span class=n>xvf</span> <span class=n>ndk</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mf>0.</span><span class=n>tar</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>tree</span> <span class=n>ndk</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>ndk</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=err>├──</span> <span class=n>chart</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>├──</span> <span class=n>Chart</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>├──</span> <span class=n>crds</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>dataservices</span><span class=o>.</span><span class=n>nutanix</span><span class=o>.</span><span class=n>com_applicationsnapshotcontents</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>dataservices</span><span class=o>.</span><span class=n>nutanix</span><span class=o>.</span><span class=n>com_applicationsnapshotreplications</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>dataservices</span><span class=o>.</span><span class=n>nutanix</span><span class=o>.</span><span class=n>com_applicationsnapshotrestores</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>dataservices</span><span class=o>.</span><span class=n>nutanix</span><span class=o>.</span><span class=n>com_applicationsnapshots</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>dataservices</span><span class=o>.</span><span class=n>nutanix</span><span class=o>.</span><span class=n>com_applications</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>dataservices</span><span class=o>.</span><span class=n>nutanix</span><span class=o>.</span><span class=n>com_appprotectionplans</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>dataservices</span><span class=o>.</span><span class=n>nutanix</span><span class=o>.</span><span class=n>com_protectionplans</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>dataservices</span><span class=o>.</span><span class=n>nutanix</span><span class=o>.</span><span class=n>com_remotes</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>dataservices</span><span class=o>.</span><span class=n>nutanix</span><span class=o>.</span><span class=n>com_replicationtargets</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>dataservices</span><span class=o>.</span><span class=n>nutanix</span><span class=o>.</span><span class=n>com_storageclusters</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>└──</span> <span class=n>scheduler</span><span class=o>.</span><span class=n>nutanix</span><span class=o>.</span><span class=n>com_jobschedulers</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>├──</span> <span class=n>Nutanix</span><span class=o>-</span><span class=n>core</span><span class=o>-</span><span class=n>k8s</span><span class=o>-</span><span class=n>job</span><span class=o>-</span><span class=n>scheduler</span><span class=o>-</span><span class=n>Disclosure</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>├──</span> <span class=n>Nutanix</span><span class=o>-</span><span class=n>core</span><span class=o>-</span><span class=n>k8s</span><span class=o>-</span><span class=n>juno</span><span class=o>-</span><span class=n>aos</span><span class=o>-</span><span class=n>pc</span><span class=o>-</span><span class=n>client</span><span class=o>-</span><span class=n>Disclosure</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>├──</span> <span class=n>Nutanix</span><span class=o>-</span><span class=n>core</span><span class=o>-</span><span class=n>k8s</span><span class=o>-</span><span class=n>juno</span><span class=o>-</span><span class=n>Disclosure</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>├──</span> <span class=n>Nutanix</span><span class=o>-</span><span class=n>kube</span><span class=o>-</span><span class=n>rbac</span><span class=o>-</span><span class=n>proxy</span><span class=o>-</span><span class=n>Disclosure</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>├──</span> <span class=n>templates</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>cert</span><span class=o>-</span><span class=n>manager</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>controller</span><span class=o>-</span><span class=n>manager</span><span class=o>-</span><span class=n>metrics</span><span class=o>-</span><span class=n>monitor</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>csi</span><span class=o>-</span><span class=n>precheck</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>deployment</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>_helpers</span><span class=o>.</span><span class=n>tpl</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>intercom</span><span class=o>-</span><span class=n>service</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>leader</span><span class=o>-</span><span class=n>election</span><span class=o>-</span><span class=n>rbac</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>manager</span><span class=o>-</span><span class=n>config</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>manager</span><span class=o>-</span><span class=n>rbac</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>metrics</span><span class=o>-</span><span class=n>reader</span><span class=o>-</span><span class=n>rbac</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>metrics</span><span class=o>-</span><span class=n>service</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>ndk</span><span class=o>-</span><span class=n>logs</span><span class=o>-</span><span class=n>pvc</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>ntnx</span><span class=o>-</span><span class=nb>log</span><span class=o>-</span><span class=n>sc</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>proxy</span><span class=o>-</span><span class=n>rbac</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>registry</span><span class=o>-</span><span class=n>secret</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>scheduler</span><span class=o>-</span><span class=n>webhook</span><span class=o>-</span><span class=n>service</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>├──</span> <span class=n>webhook</span><span class=o>-</span><span class=n>certificate</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>│</span>   <span class=err>└──</span> <span class=n>webhook</span><span class=o>-</span><span class=n>service</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>│</span>   <span class=err>└──</span> <span class=n>values</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl><span class=err>└──</span> <span class=n>ndk</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mf>0.</span><span class=n>tar</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>3</span> <span class=n>directories</span><span class=p>,</span> <span class=mi>36</span> <span class=n>files</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>儲存Container image 並上傳至Docker hub or 私倉</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=c1># Load Images</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>podman</span> <span class=nb>load</span> <span class=o>-</span><span class=n>i</span> <span class=n>ndk</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span><span class=o>/</span><span class=n>ndk</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mf>0.</span><span class=n>tar</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Writing</span> <span class=n>manifest</span> <span class=n>to</span> <span class=n>image</span> <span class=n>destination</span>
</span></span><span class=line><span class=cl><span class=n>Storing</span> <span class=n>signatures</span>
</span></span><span class=line><span class=cl><span class=n>Loaded</span> <span class=n>image</span><span class=p>:</span> <span class=n>localhost</span><span class=o>/</span><span class=n>ndk</span><span class=o>/</span><span class=n>infra</span><span class=o>-</span><span class=n>manager</span><span class=p>:</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Loaded</span> <span class=n>image</span><span class=p>:</span> <span class=n>localhost</span><span class=o>/</span><span class=n>ndk</span><span class=o>/</span><span class=n>job</span><span class=o>-</span><span class=n>scheduler</span><span class=p>:</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>Loaded</span> <span class=n>image</span><span class=p>:</span> <span class=n>localhost</span><span class=o>/</span><span class=n>ndk</span><span class=o>/</span><span class=n>kube</span><span class=o>-</span><span class=n>rbac</span><span class=o>-</span><span class=n>proxy</span><span class=p>:</span><span class=n>v0</span><span class=o>.</span><span class=mf>8.0</span>
</span></span><span class=line><span class=cl><span class=n>Loaded</span> <span class=n>image</span><span class=p>:</span> <span class=n>localhost</span><span class=o>/</span><span class=n>ndk</span><span class=o>/</span><span class=n>manager</span><span class=p>:</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Tag Images</span>
</span></span><span class=line><span class=cl><span class=n>podman</span> <span class=n>tag</span> <span class=o>&lt;</span><span class=n>ndk</span><span class=o>-</span><span class=n>image</span><span class=o>-</span><span class=n>name</span><span class=o>&gt;</span><span class=p>:</span><span class=n>tag</span> <span class=o>&lt;</span><span class=n>image</span><span class=o>-</span><span class=n>registry</span><span class=o>-</span><span class=n>url</span><span class=o>&gt;/</span><span class=n>ndk</span><span class=o>/&lt;</span><span class=n>conatiner</span><span class=o>-</span><span class=n>name</span><span class=o>&gt;</span><span class=p>:</span><span class=n>tag</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>podman</span> <span class=n>tag</span> <span class=n>ndk</span><span class=o>/</span><span class=n>manager</span><span class=p>:</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span> <span class=n>kenkennyinfo</span><span class=o>/</span><span class=n>ndk</span><span class=o>-</span><span class=n>manager</span><span class=p>:</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>podman</span> <span class=n>tag</span> <span class=n>ndk</span><span class=o>/</span><span class=n>job</span><span class=o>-</span><span class=n>scheduler</span><span class=p>:</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span> <span class=n>kenkennyinfo</span><span class=o>/</span><span class=n>ndk</span><span class=o>-</span><span class=n>job</span><span class=o>-</span><span class=n>scheduler</span><span class=p>:</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>podman</span> <span class=n>tag</span> <span class=n>ndk</span><span class=o>/</span><span class=n>kube</span><span class=o>-</span><span class=n>rbac</span><span class=o>-</span><span class=n>proxy</span><span class=p>:</span><span class=n>v0</span><span class=o>.</span><span class=mf>8.0</span> <span class=n>kenkennyinfo</span><span class=o>/</span><span class=n>ndk</span><span class=o>-</span><span class=n>kube</span><span class=o>-</span><span class=n>rbac</span><span class=o>-</span><span class=n>proxy</span><span class=p>:</span><span class=n>v0</span><span class=o>.</span><span class=mf>8.0</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>podman</span> <span class=n>tag</span> <span class=n>ndk</span><span class=o>/</span><span class=n>infra</span><span class=o>-</span><span class=n>manager</span><span class=p>:</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span> <span class=n>kenkennyinfo</span><span class=o>/</span><span class=n>ndk</span><span class=o>-</span><span class=n>infra</span><span class=o>-</span><span class=n>manager</span><span class=p>:</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># batch tag images</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=k>for</span> <span class=n>img</span> <span class=ow>in</span> <span class=n>ndk</span><span class=o>/</span><span class=n>manager</span><span class=p>:</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span> <span class=n>ndk</span><span class=o>/</span><span class=n>infra</span><span class=o>-</span><span class=n>manager</span><span class=p>:</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span> <span class=n>ndk</span><span class=o>/</span><span class=n>job</span><span class=o>-</span><span class=n>scheduler</span><span class=p>:</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span> <span class=n>ndk</span><span class=o>/</span><span class=n>kube</span><span class=o>-</span><span class=n>rbac</span><span class=o>-</span><span class=n>proxy</span><span class=p>:</span><span class=n>v0</span><span class=o>.</span><span class=mf>8.0</span><span class=p>;</span> <span class=k>do</span> <span class=n>docker</span> <span class=n>tag</span> <span class=o>$</span><span class=n>img</span> <span class=n>kenkennyinfo</span><span class=o>/$</span><span class=p>{</span><span class=n>img</span><span class=p>};</span> <span class=n>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Emulate</span> <span class=n>Docker</span> <span class=n>CLI</span> <span class=n>using</span> <span class=n>podman</span><span class=o>.</span> <span class=n>Create</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>containers</span><span class=o>/</span><span class=n>nodocker</span> <span class=n>to</span> <span class=n>quiet</span> <span class=n>msg</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>Emulate</span> <span class=n>Docker</span> <span class=n>CLI</span> <span class=n>using</span> <span class=n>podman</span><span class=o>.</span> <span class=n>Create</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>containers</span><span class=o>/</span><span class=n>nodocker</span> <span class=n>to</span> <span class=n>quiet</span> <span class=n>msg</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>Error</span><span class=p>:</span> <span class=n>ndk</span><span class=o>/</span><span class=n>infra</span><span class=o>-</span><span class=n>manager</span><span class=o>-</span><span class=n>client</span><span class=p>:</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span><span class=p>:</span> <span class=n>image</span> <span class=ow>not</span> <span class=n>known</span>
</span></span><span class=line><span class=cl><span class=n>Emulate</span> <span class=n>Docker</span> <span class=n>CLI</span> <span class=n>using</span> <span class=n>podman</span><span class=o>.</span> <span class=n>Create</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>containers</span><span class=o>/</span><span class=n>nodocker</span> <span class=n>to</span> <span class=n>quiet</span> <span class=n>msg</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>Emulate</span> <span class=n>Docker</span> <span class=n>CLI</span> <span class=n>using</span> <span class=n>podman</span><span class=o>.</span> <span class=n>Create</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>containers</span><span class=o>/</span><span class=n>nodocker</span> <span class=n>to</span> <span class=n>quiet</span> <span class=n>msg</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>podman</span> <span class=n>images</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>nutanix</span><span class=err>@</span><span class=n>ken</span><span class=o>-</span><span class=n>rhel9</span> <span class=n>ndk</span><span class=o>-</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span><span class=p>]</span><span class=o>$</span> <span class=n>podman</span> <span class=n>images</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>REPOSITORY</span>                                                     <span class=n>TAG</span>         <span class=n>IMAGE</span> <span class=n>ID</span>      <span class=n>CREATED</span>       <span class=n>SIZE</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>localhost</span><span class=o>/</span><span class=n>kenkennyinfo</span><span class=o>/</span><span class=n>ndk</span><span class=o>-</span><span class=n>manager</span>                             <span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span>       <span class=n>ebffd7549ea5</span>  <span class=mi>2</span> <span class=n>months</span> <span class=n>ago</span>  <span class=mf>69.2</span> <span class=n>MB</span>
</span></span><span class=line><span class=cl><span class=n>localhost</span><span class=o>/</span><span class=n>ndk</span><span class=o>/</span><span class=n>manager</span>                                          <span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span>       <span class=n>ebffd7549ea5</span>  <span class=mi>2</span> <span class=n>months</span> <span class=n>ago</span>  <span class=mf>69.2</span> <span class=n>MB</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>localhost</span><span class=o>/</span><span class=n>kenkennyinfo</span><span class=o>/</span><span class=n>ndk</span><span class=o>-</span><span class=n>infra</span><span class=o>-</span><span class=n>manager</span>                       <span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span>       <span class=mi>2982</span><span class=n>ed521b0e</span>  <span class=mi>2</span> <span class=n>months</span> <span class=n>ago</span>  <span class=mi>60</span> <span class=n>MB</span>
</span></span><span class=line><span class=cl><span class=n>localhost</span><span class=o>/</span><span class=n>ndk</span><span class=o>/</span><span class=n>infra</span><span class=o>-</span><span class=n>manager</span>                                    <span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span>       <span class=mi>2982</span><span class=n>ed521b0e</span>  <span class=mi>2</span> <span class=n>months</span> <span class=n>ago</span>  <span class=mi>60</span> <span class=n>MB</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>localhost</span><span class=o>/</span><span class=n>kenkennyinfo</span><span class=o>/</span><span class=n>nke</span><span class=o>-</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span>                           <span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span>       <span class=mi>9</span><span class=n>bda464636b6</span>  <span class=mi>2</span> <span class=n>months</span> <span class=n>ago</span>  <span class=mf>61.7</span> <span class=n>MB</span>
</span></span><span class=line><span class=cl><span class=n>localhost</span><span class=o>/</span><span class=n>kenkennyinfo</span><span class=o>/</span><span class=n>nke</span><span class=o>-</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span>                           <span class=mi>668</span>         <span class=mi>9</span><span class=n>bda464636b6</span>  <span class=mi>2</span> <span class=n>months</span> <span class=n>ago</span>  <span class=mf>61.7</span> <span class=n>MB</span>
</span></span><span class=line><span class=cl><span class=n>localhost</span><span class=o>/</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span>                                            <span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span>       <span class=mi>9</span><span class=n>bda464636b6</span>  <span class=mi>2</span> <span class=n>months</span> <span class=n>ago</span>  <span class=mf>61.7</span> <span class=n>MB</span>
</span></span><span class=line><span class=cl><span class=n>docker</span><span class=o>.</span><span class=n>io</span><span class=o>/</span><span class=n>kenkennyinfo</span><span class=o>/</span><span class=n>nke</span><span class=o>-</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span>                           <span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span>       <span class=mi>9</span><span class=n>bda464636b6</span>  <span class=mi>2</span> <span class=n>months</span> <span class=n>ago</span>  <span class=mf>61.7</span> <span class=n>MB</span>
</span></span><span class=line><span class=cl><span class=n>quay</span><span class=o>.</span><span class=n>io</span><span class=o>/</span><span class=n>karbon</span><span class=o>/</span><span class=n>k8s</span><span class=o>-</span><span class=n>agent</span>                                       <span class=mi>594</span>         <span class=mi>171</span><span class=n>ea3376596</span>  <span class=mi>3</span> <span class=n>months</span> <span class=n>ago</span>  <span class=mf>58.4</span> <span class=n>MB</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>localhost</span><span class=o>/</span><span class=n>ndk</span><span class=o>/</span><span class=n>job</span><span class=o>-</span><span class=n>scheduler</span>                                    <span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span>       <span class=n>d594a3e567b7</span>  <span class=mi>3</span> <span class=n>months</span> <span class=n>ago</span>  <span class=mf>59.1</span> <span class=n>MB</span>
</span></span><span class=line><span class=cl><span class=n>localhost</span><span class=o>/</span><span class=n>kenkennyinfo</span><span class=o>/</span><span class=n>ndk</span><span class=o>-</span><span class=n>job</span><span class=o>-</span><span class=n>scheduler</span>                       <span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span>       <span class=n>d594a3e567b7</span>  <span class=mi>3</span> <span class=n>months</span> <span class=n>ago</span>  <span class=mf>59.1</span> <span class=n>MB</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>localhost</span><span class=o>/</span><span class=n>kenkennyinfo</span><span class=o>/</span><span class=n>ndk</span><span class=o>-</span><span class=n>kube</span><span class=o>-</span><span class=n>rbac</span><span class=o>-</span><span class=n>proxy</span>                     <span class=n>v0</span><span class=o>.</span><span class=mf>8.0</span>      <span class=n>ad393d6a4d1b</span>  <span class=mi>3</span> <span class=n>years</span> <span class=n>ago</span>   <span class=mf>50.2</span> <span class=n>MB</span>
</span></span><span class=line><span class=cl><span class=n>localhost</span><span class=o>/</span><span class=n>ndk</span><span class=o>/</span><span class=n>kube</span><span class=o>-</span><span class=n>rbac</span><span class=o>-</span><span class=n>proxy</span>                                  <span class=n>v0</span><span class=o>.</span><span class=mf>8.0</span>      <span class=n>ad393d6a4d1b</span>  <span class=mi>3</span> <span class=n>years</span> <span class=n>ago</span>   <span class=mf>50.2</span> <span class=n>MB</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Push Images</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>podman</span> <span class=n>push</span> <span class=n>kenkennyinfo</span><span class=o>/</span><span class=n>ndk</span><span class=o>-</span><span class=n>kube</span><span class=o>-</span><span class=n>rbac</span><span class=o>-</span><span class=n>proxy</span><span class=p>:</span><span class=n>v0</span><span class=o>.</span><span class=mf>8.0</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>podman</span> <span class=n>push</span> <span class=n>kenkennyinfo</span><span class=o>/</span><span class=n>ndk</span><span class=o>-</span><span class=n>job</span><span class=o>-</span><span class=n>scheduler</span><span class=p>:</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>podman</span> <span class=n>push</span> <span class=n>kenkennyinfo</span><span class=o>/</span><span class=n>ndk</span><span class=o>-</span><span class=n>infra</span><span class=o>-</span><span class=n>manager</span><span class=p>:</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>podman</span> <span class=n>push</span> <span class=n>kenkennyinfo</span><span class=o>/</span><span class=n>ndk</span><span class=o>-</span><span class=n>manager</span><span class=p>:</span><span class=mf>1.0</span><span class=o>.</span><span class=mi>0</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>建立Secret，修改 chart/values.yaml</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 建立Docker hub secret
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ vim nutanix-k8s-agent-pull-secret.yaml 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>kind: Secret
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: nutanix-k8s-agent-pull-secret
</span></span><span class=line><span class=cl>type: kubernetes.io/dockerconfigjson
</span></span><span class=line><span class=cl>data:
</span></span><span class=line><span class=cl>  .dockerconfigjson: &#34;dockerconfigVubnxxxxxxxxxxxxxxxx2&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>$ vim ntnx-pc-secret2.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>kind: Secret
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: ntnx-pc-secret
</span></span><span class=line><span class=cl>  namespace: ntnx-system
</span></span><span class=line><span class=cl>stringData:
</span></span><span class=line><span class=cl>  # prism-pc-ip:prism-port:admin:password
</span></span><span class=line><span class=cl>  key: 172.16.90.75:9440:ocpadmin:password
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc apply -f nutanix-k8s-agent-pull-secret.yaml -n ntnx-system
</span></span><span class=line><span class=cl>$ oc apply -f ntnx-pc-secret2.yaml -n ntnx-system
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc get secret -n ntnx-system
</span></span><span class=line><span class=cl>NAME                                  TYPE                                  DATA   AGE
</span></span><span class=line><span class=cl>nutanix-k8s-agent-pull-secret         kubernetes.io/dockerconfigjson        1      12s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>$ vim /home/nutanix/ndk-1.0.0/chart/values.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>manager:
</span></span><span class=line><span class=cl>  # -- Image Repository
</span></span><span class=line><span class=cl>  repository: kenkennyinfo/ndk-manager
</span></span><span class=line><span class=cl>  # -- Image tag
</span></span><span class=line><span class=cl>  # @default -- .Chart.AppVersion
</span></span><span class=line><span class=cl>  tag: 1.0.0
</span></span><span class=line><span class=cl>  # -- Image pull policy
</span></span><span class=line><span class=cl>  pullPolicy: Always
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>infraManager:
</span></span><span class=line><span class=cl>  # -- Image Repository
</span></span><span class=line><span class=cl>  repository: kenkennyinfo/ndk-infra-manager
</span></span><span class=line><span class=cl>  # -- Image tag
</span></span><span class=line><span class=cl>  # @default -- .Chart.AppVersion
</span></span><span class=line><span class=cl>  tag: 1.0.0
</span></span><span class=line><span class=cl>  # -- Image pull policy
</span></span><span class=line><span class=cl>  pullPolicy: Always
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubeRbacProxy:
</span></span><span class=line><span class=cl>  # -- Image Repository
</span></span><span class=line><span class=cl>  repository: kenkennyinfo/ndk-kube-rbac-proxy
</span></span><span class=line><span class=cl>  # -- Image tag
</span></span><span class=line><span class=cl>  # @default -- .Chart.AppVersion
</span></span><span class=line><span class=cl>  tag: v0.8.0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>jobScheduler:
</span></span><span class=line><span class=cl>  # -- Image Repository
</span></span><span class=line><span class=cl>  repository: kenkennyinfo/ndk-job-scheduler
</span></span><span class=line><span class=cl>  # -- Image tag
</span></span><span class=line><span class=cl>  # @default -- .Chart.AppVersion
</span></span><span class=line><span class=cl>  tag: 1.0.0
</span></span><span class=line><span class=cl>  # -- Image pull policy
</span></span><span class=line><span class=cl>  pullPolicy: Always
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>imageCredentials:
</span></span><span class=line><span class=cl>  # Name of the secret containing the credentials to pull image from the container registry.
</span></span><span class=line><span class=cl>  imagePullSecretName: nutanix-k8s-agent-pull-secret
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> clusterName: ocplab.nutanixlab.local
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> intercomService:
</span></span><span class=line><span class=cl>  ports:
</span></span><span class=line><span class=cl>  - port: 2021
</span></span><span class=line><span class=cl>    protocol: TCP
</span></span><span class=line><span class=cl>    targetPort: 2021
</span></span><span class=line><span class=cl>  type: NodePort
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> ---end
</span></span></code></pre></td></tr></table></div></div></li><li><p>安裝NDK</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl> helm install ndk -n ntnx-system &lt;chart-location&gt; --set tls.server.enable=false 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ helm install ndk -n ntnx-system /home/nutanix/ndk-1.0.0/chart/ --set tls.server.enable=false
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/nutanix/.kube/config
</span></span><span class=line><span class=cl>NAME: ndk
</span></span><span class=line><span class=cl>LAST DEPLOYED: Wed May 15 17:14:37 2024
</span></span><span class=line><span class=cl>NAMESPACE: ntnx-system
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: 1
</span></span><span class=line><span class=cl>TEST SUITE: None
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc get pods -n ntnx-system
</span></span><span class=line><span class=cl>NAME                                      READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>ndk-controller-manager-55bf75f64b-blnfc   4/4     Running   0          3m57s
</span></span><span class=line><span class=cl>nutanix-agent-75df9d879b-98smz            1/1     Running   0          120m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc adm policy add-scc-to-user anyuid -z ndk-controller-manager
</span></span><span class=line><span class=cl>clusterrole.rbac.authorization.k8s.io/system:openshift:scc:anyuid added: &#34;ndk-controller-manager&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ helm upgrade ndk -n ntnx-system /home/nutanix/ndk-1.0.0/chart/ --set tls.server.enable=false
</span></span><span class=line><span class=cl>WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/nutanix/.kube/config
</span></span><span class=line><span class=cl>Release &#34;ndk&#34; has been upgraded. Happy Helming!
</span></span><span class=line><span class=cl>NAME: ndk
</span></span><span class=line><span class=cl>LAST DEPLOYED: Mon May 20 17:57:43 2024
</span></span><span class=line><span class=cl>NAMESPACE: ntnx-system
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: 3
</span></span><span class=line><span class=cl>TEST SUITE: None
</span></span></code></pre></td></tr></table></div></div></li><li><p>安裝完成</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ oc get all -n ntnx-system
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                          READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod/ndk-controller-manager-55bf75f64b-blnfc   4/4     Running   0          17h
</span></span><span class=line><span class=cl>pod/nutanix-agent-75df9d879b-98smz            1/1     Running   0          19h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                             TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
</span></span><span class=line><span class=cl>service/ndk-controller-manager-metrics-service   ClusterIP   172.30.186.204   &lt;none&gt;        8443/TCP         17h
</span></span><span class=line><span class=cl>service/ndk-intercom-service                     NodePort    172.30.237.126   &lt;none&gt;        2021:30998/TCP   17h
</span></span><span class=line><span class=cl>service/ndk-scheduler-webhook-service            ClusterIP   172.30.64.110    &lt;none&gt;        9444/TCP         17h
</span></span><span class=line><span class=cl>service/ndk-webhook-service                      ClusterIP   172.30.66.56     &lt;none&gt;        443/TCP          17h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                     READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment.apps/ndk-controller-manager   1/1     1            1           17h
</span></span><span class=line><span class=cl>deployment.apps/nutanix-agent            1/1     1            1           20h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                                DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>replicaset.apps/ndk-controller-manager-55bf75f64b   1         1         1       17h
</span></span><span class=line><span class=cl>replicaset.apps/nutanix-agent-75df9d879b            1         1         1       19h
</span></span><span class=line><span class=cl>replicaset.apps/nutanix-agent-7c4b644996            0         0         0       20h
</span></span></code></pre></td></tr></table></div></div><p><img src=https://kenkenny.synology.me:5543/images/2024/05/image-20240516110205960.png loading=lazy alt=image-20240516110205960></p></li><li><p>測試NDK 連線 grpcurl</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ podman pull fullstorydev/grpcurl:latest
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ podman run  fullstorydev/grpcurl  -plaintext 172.16.90.180:30998 list
</span></span><span class=line><span class=cl>grpc.reflection.v1.ServerReflection
</span></span><span class=line><span class=cl>grpc.reflection.v1alpha.ServerReflection
</span></span><span class=line><span class=cl>juno_interface.Juno
</span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=storage-cluster>Storage Cluster</h3><ol><li><p>取得PC、PE的Cluster UUID</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>on Prism Central CVM
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ ncli cluster info
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Cluster Id                : 8c52e6be-697b-42a4-bacd-8e6ada7994f2::4237199414008583410
</span></span><span class=line><span class=cl>    Cluster Uuid              : 8c52e6be-697b-42a4-bacd-8e6ada7994f2
</span></span><span class=line><span class=cl>    Cluster Name              : NTNXSELABPC
</span></span><span class=line><span class=cl>    Cluster Version           : pc.2023.4
</span></span><span class=line><span class=cl>    Cluster Full Version      : el7.3-release-fraser-2023.4-stable-e10760423ef518a91beb02b784c7ff2e0cf3a45c
</span></span><span class=line><span class=cl>    Cluster FQDN              : NTNXSELABPC.nutanixlab.local
</span></span><span class=line><span class=cl>    Is LTS                    : false
</span></span><span class=line><span class=cl>    External Data Services... : 
</span></span><span class=line><span class=cl>    Support Verbosity Level   : BASIC_COREDUMP
</span></span><span class=line><span class=cl>    Lock Down Status          : Disabled
</span></span><span class=line><span class=cl>    Password Remote Login ... : Enabled
</span></span><span class=line><span class=cl>    Timezone                  : America/Los_Angeles
</span></span><span class=line><span class=cl>    NCC Version               : ncc-4.6.6.1
</span></span><span class=line><span class=cl>    Degraded Node Monitoring  : Enabled
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>on Prism Element CVM
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ ncli cluster info
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Cluster Id                : 00060f36-1379-a8ba-0000-000000028e95::167573
</span></span><span class=line><span class=cl>    Cluster Uuid              : 00060f36-1379-a8ba-0000-000000028e95
</span></span><span class=line><span class=cl>    Cluster Name              : NX1365G6PE
</span></span><span class=line><span class=cl>    Cluster Version           : 6.7.1
</span></span><span class=line><span class=cl>    Cluster Full Version      : el7.3-release-fraser-6.7.1-stable-104e6662e8b936a9225379d2d68efd93b5448289
</span></span><span class=line><span class=cl>    External IP address       : 172.16.90.74
</span></span><span class=line><span class=cl>    Node Count                : 3
</span></span><span class=line><span class=cl>    Block Count               : 1
</span></span><span class=line><span class=cl>    Shadow Clones Status      : Enabled
</span></span><span class=line><span class=cl>    Has Self Encrypting Disk  : no
</span></span><span class=line><span class=cl>    Cluster Masquerading I... : 
</span></span><span class=line><span class=cl>    Cluster Masquerading PORT : 
</span></span><span class=line><span class=cl>    Is registered to PC       : true
</span></span><span class=line><span class=cl>    Rf1 Container Support     : Enabled
</span></span><span class=line><span class=cl>    Rebuild Reservation       : Disabled
</span></span><span class=line><span class=cl>    Encryption In Transit     : Disabled
</span></span><span class=line><span class=cl>    Is LTS                    : false
</span></span><span class=line><span class=cl>    External Data Services... : 172.16.90.76
</span></span><span class=line><span class=cl>    Support Verbosity Level   : BASIC_COREDUMP
</span></span><span class=line><span class=cl>    Lock Down Status          : Disabled
</span></span><span class=line><span class=cl>    Password Remote Login ... : Enabled
</span></span><span class=line><span class=cl>    Timezone                  : Asia/Taipei
</span></span><span class=line><span class=cl>    NCC Version               : ncc-4.6.6.1
</span></span><span class=line><span class=cl>    Degraded Node Monitoring  : Enabled
</span></span></code></pre></td></tr></table></div></div></li><li><p>建立StorageCluster.yaml</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ vim storagecluster-1365g6.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apiVersion: dataservices.nutanix.com/v1alpha1
</span></span><span class=line><span class=cl>kind: StorageCluster
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl> name: nx1365g6pe
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl> storageServerUuid: 00060f36-1379-a8ba-0000-000000028e95
</span></span><span class=line><span class=cl> managementServerUuid: 8c52e6be-697b-42a4-bacd-8e6ada7994f2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc apply -f storagecluster-1365g6.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc get storagecluster
</span></span><span class=line><span class=cl>NAME                    AVAILABLE
</span></span><span class=line><span class=cl>storagecluster-1365g6   true
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc get storagecluster
</span></span><span class=line><span class=cl>NAME         AVAILABLE
</span></span><span class=line><span class=cl>nx1365g6pe   false
</span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=create-sample-app>Create Sample App</h3><h4 id=mysql>MySQL</h4><ol><li><p>Mysql 測試，建立mysql.yaml</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>vim</span> <span class=n>mysql</span><span class=o>-</span><span class=n>deploy</span><span class=o>.</span><span class=n>yaml</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>apiVersion</span><span class=p>:</span> <span class=n>v1</span>
</span></span><span class=line><span class=cl><span class=n>kind</span><span class=p>:</span> <span class=n>Secret</span>
</span></span><span class=line><span class=cl><span class=n>metadata</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=n>name</span><span class=p>:</span> <span class=n>mysql</span><span class=o>-</span><span class=n>password</span>
</span></span><span class=line><span class=cl><span class=n>type</span><span class=p>:</span> <span class=n>opaque</span>
</span></span><span class=line><span class=cl><span class=n>stringData</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=n>MYSQL_ROOT_PASSWORD</span><span class=p>:</span> <span class=n>password</span>
</span></span><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=n>apiVersion</span><span class=p>:</span> <span class=n>apps</span><span class=o>/</span><span class=n>v1</span>
</span></span><span class=line><span class=cl><span class=n>kind</span><span class=p>:</span> <span class=n>StatefulSet</span>
</span></span><span class=line><span class=cl><span class=n>metadata</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=n>name</span><span class=p>:</span> <span class=n>mysql</span><span class=o>-</span><span class=n>set</span>
</span></span><span class=line><span class=cl><span class=n>spec</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=n>selector</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>matchLabels</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>app</span><span class=p>:</span> <span class=n>mysql</span>
</span></span><span class=line><span class=cl>  <span class=n>serviceName</span><span class=p>:</span> <span class=s2>&#34;mysql&#34;</span>
</span></span><span class=line><span class=cl>  <span class=n>replicas</span><span class=p>:</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>  <span class=n>template</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>metadata</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>labels</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>app</span><span class=p>:</span> <span class=n>mysql</span>
</span></span><span class=line><span class=cl>    <span class=n>spec</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>terminationGracePeriodSeconds</span><span class=p>:</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>      <span class=n>containers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=o>-</span> <span class=n>name</span><span class=p>:</span> <span class=n>mysql</span>
</span></span><span class=line><span class=cl>        <span class=n>image</span><span class=p>:</span> <span class=n>mysql</span><span class=p>:</span><span class=mf>8.0</span>
</span></span><span class=line><span class=cl>        <span class=n>ports</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=o>-</span> <span class=n>containerPort</span><span class=p>:</span> <span class=mi>3306</span>
</span></span><span class=line><span class=cl>        <span class=n>volumeMounts</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=o>-</span> <span class=n>name</span><span class=p>:</span> <span class=n>mysql</span><span class=o>-</span><span class=n>store</span>
</span></span><span class=line><span class=cl>          <span class=n>mountPath</span><span class=p>:</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>mysql</span>
</span></span><span class=line><span class=cl>        <span class=o>-</span> <span class=n>name</span><span class=p>:</span> <span class=n>mysql</span><span class=o>-</span><span class=n>data</span><span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>          <span class=n>mountPath</span><span class=p>:</span> <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>data1</span>
</span></span><span class=line><span class=cl>        <span class=n>env</span><span class=p>:</span>
</span></span><span class=line><span class=cl>          <span class=o>-</span> <span class=n>name</span><span class=p>:</span> <span class=n>MYSQL_ROOT_PASSWORD</span>
</span></span><span class=line><span class=cl>            <span class=n>valueFrom</span><span class=p>:</span>
</span></span><span class=line><span class=cl>              <span class=n>secretKeyRef</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>name</span><span class=p>:</span> <span class=n>mysql</span><span class=o>-</span><span class=n>password</span>
</span></span><span class=line><span class=cl>                <span class=n>key</span><span class=p>:</span> <span class=n>MYSQL_ROOT_PASSWORD</span>
</span></span><span class=line><span class=cl>  <span class=n>volumeClaimTemplates</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=o>-</span> <span class=n>metadata</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>name</span><span class=p>:</span> <span class=n>mysql</span><span class=o>-</span><span class=n>store</span>
</span></span><span class=line><span class=cl>    <span class=n>spec</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>accessModes</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;ReadWriteOnce&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=n>storageClassName</span><span class=p>:</span> <span class=n>nutanixvolume</span>
</span></span><span class=line><span class=cl>      <span class=n>resources</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>requests</span><span class=p>:</span>
</span></span><span class=line><span class=cl>          <span class=n>storage</span><span class=p>:</span> <span class=mi>5</span><span class=n>Gi</span>
</span></span><span class=line><span class=cl>  <span class=o>-</span> <span class=n>metadata</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>name</span><span class=p>:</span> <span class=n>mysql</span><span class=o>-</span><span class=n>data</span><span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>spec</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>accessModes</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;ReadWriteOnce&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=n>storageClassName</span><span class=p>:</span> <span class=n>nutanixvolume</span>
</span></span><span class=line><span class=cl>      <span class=n>resources</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>requests</span><span class=p>:</span>
</span></span><span class=line><span class=cl>          <span class=n>storage</span><span class=p>:</span> <span class=mi>3</span><span class=n>Gi</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>建立Mysql app</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ oc new-project ndk-mysql
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc apply -f mysql-deploy.yaml -n ndk-mysql
</span></span><span class=line><span class=cl>secret/mysql-password created
</span></span><span class=line><span class=cl>statefulset.apps/mysql-set created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc get pods
</span></span><span class=line><span class=cl>NAME          READY   STATUS              RESTARTS   AGE
</span></span><span class=line><span class=cl>mysql-set-0   0/1     ContainerCreating   0          42s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc get pods
</span></span><span class=line><span class=cl>NAME          READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>mysql-set-0   1/1     Running   0          3m18s
</span></span><span class=line><span class=cl>mysql-set-1   1/1     Running   0          2m22s
</span></span><span class=line><span class=cl>mysql-set-2   1/1     Running   0          72s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc get pvc,pv
</span></span><span class=line><span class=cl>NAME                                             STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS    AGE
</span></span><span class=line><span class=cl>persistentvolumeclaim/mysql-data-1-mysql-set-0   Bound    pvc-276ea905-a815-4635-98c0-3a4fade1bc44   3Gi        RWO            nutanixvolume   6m24s
</span></span><span class=line><span class=cl>persistentvolumeclaim/mysql-data-1-mysql-set-1   Bound    pvc-5638dc79-8271-4a49-94b9-d22c6212e232   3Gi        RWO            nutanixvolume   5m28s
</span></span><span class=line><span class=cl>persistentvolumeclaim/mysql-data-1-mysql-set-2   Bound    pvc-a4e832f4-e99b-4bdc-bc5b-253731447ce4   3Gi        RWO            nutanixvolume   4m18s
</span></span><span class=line><span class=cl>persistentvolumeclaim/mysql-store-mysql-set-0    Bound    pvc-262a52dc-1861-4992-b2aa-e41f448a6db5   5Gi        RWO            nutanixvolume   6m24s
</span></span><span class=line><span class=cl>persistentvolumeclaim/mysql-store-mysql-set-1    Bound    pvc-1e809e1d-2190-4220-80ba-35712900d3a6   5Gi        RWO            nutanixvolume   5m28s
</span></span><span class=line><span class=cl>persistentvolumeclaim/mysql-store-mysql-set-2    Bound    pvc-fafd94af-11be-4b02-aef1-4d959607c0cf   5Gi        RWO            nutanixvolume   4m18s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                                STORAGECLASS    REASON   AGE
</span></span><span class=line><span class=cl>persistentvolume/pvc-127de2ed-452d-4fc2-a08e-f320cc4c85e0   1Gi        RWO            Delete           Bound    default/my-pvc                       nutanixvolume            6d23h
</span></span><span class=line><span class=cl>persistentvolume/pvc-1e809e1d-2190-4220-80ba-35712900d3a6   5Gi        RWO            Delete           Bound    ndk-mysql/mysql-store-mysql-set-1    nutanixvolume            5m22s
</span></span><span class=line><span class=cl>persistentvolume/pvc-262a52dc-1861-4992-b2aa-e41f448a6db5   5Gi        RWO            Delete           Bound    ndk-mysql/mysql-store-mysql-set-0    nutanixvolume            6m15s
</span></span><span class=line><span class=cl>persistentvolume/pvc-276ea905-a815-4635-98c0-3a4fade1bc44   3Gi        RWO            Delete           Bound    ndk-mysql/mysql-data-1-mysql-set-0   nutanixvolume            6m14s
</span></span><span class=line><span class=cl>persistentvolume/pvc-5638dc79-8271-4a49-94b9-d22c6212e232   3Gi        RWO            Delete           Bound    ndk-mysql/mysql-data-1-mysql-set-1   nutanixvolume            5m21s
</span></span><span class=line><span class=cl>persistentvolume/pvc-8468392e-a564-4d05-81f1-175820eceba2   1Gi        RWO            Delete           Bound    default/test-pvc                     nutanixvolume            20h
</span></span><span class=line><span class=cl>persistentvolume/pvc-a4e832f4-e99b-4bdc-bc5b-253731447ce4   3Gi        RWO            Delete           Bound    ndk-mysql/mysql-data-1-mysql-set-2   nutanixvolume            4m9s
</span></span><span class=line><span class=cl>persistentvolume/pvc-fafd94af-11be-4b02-aef1-4d959607c0cf   5Gi        RWO            Delete           Bound    ndk-mysql/mysql-store-mysql-set-2    nutanixvolume            4m9s
</span></span></code></pre></td></tr></table></div></div><p><img src=https://kenkenny.synology.me:5543/images/2024/05/image-20240521094917993.png loading=lazy alt=image-20240521094917993>
<img src=https://kenkenny.synology.me:5543/images/2024/05/image-20240521094932643.png loading=lazy alt=image-20240521094932643></p></li><li><p>建立Application CR</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ vim mysql-cr.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apiVersion: dataservices.nutanix.com/v1alpha1
</span></span><span class=line><span class=cl>kind: Application
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: mysql-cr
</span></span><span class=line><span class=cl>  namespace: ndk-mysql
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  applicationSelector:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc apply -f mysql-cr.yaml 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc get application
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME       AGE   LAST-STATUS-UPDATE
</span></span><span class=line><span class=cl>mysql-cr   31s   31s
</span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=ndk-snapshot>NDK Snapshot</h3><h4 id=manual-local-snapshot>Manual Local Snapshot</h4><ol><li><p>Create Application Snapshot CR</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ vim mysql-snap.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apiVersion: dataservices.nutanix.com/v1alpha1
</span></span><span class=line><span class=cl>kind: ApplicationSnapshot
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: mysql-snap-1
</span></span><span class=line><span class=cl>  namespace: ndk-mysql
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  source:
</span></span><span class=line><span class=cl>    applicationRef:
</span></span><span class=line><span class=cl>      name: mysql-cr
</span></span></code></pre></td></tr></table></div></div></li><li><p>Apply Snapshot</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ oc apply -f mysql-snap.yaml 
</span></span><span class=line><span class=cl>applicationsnapshot.dataservices.nutanix.com/mysql-snap-1 created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc get applicationsnapshot -n ndk-mysql
</span></span><span class=line><span class=cl>NAME           AGE   READY-TO-USE   BOUND-SNAPSHOTCONTENT                      SNAPSHOT-AGE
</span></span><span class=line><span class=cl>mysql-snap-1   8s    false          asc-8889156a-43f2-4d95-9075-11ccd52c9457   
</span></span><span class=line><span class=cl>$ oc get applicationsnapshot -n ndk-mysql
</span></span><span class=line><span class=cl>NAME           AGE   READY-TO-USE   BOUND-SNAPSHOTCONTENT                      SNAPSHOT-AGE
</span></span><span class=line><span class=cl>mysql-snap-1   58s   true           asc-8889156a-43f2-4d95-9075-11ccd52c9457   30s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc describe applicationsnapshot -n ndk-mysql
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Name:         mysql-snap-1
</span></span><span class=line><span class=cl>Namespace:    ndk-mysql
</span></span><span class=line><span class=cl>Labels:       &lt;none&gt;
</span></span><span class=line><span class=cl>Annotations:  &lt;none&gt;
</span></span><span class=line><span class=cl>API Version:  dataservices.nutanix.com/v1alpha1
</span></span><span class=line><span class=cl>Kind:         ApplicationSnapshot
</span></span><span class=line><span class=cl>Metadata:
</span></span><span class=line><span class=cl>  Creation Timestamp:  2024-05-22T10:10:24Z
</span></span><span class=line><span class=cl>  Finalizers:
</span></span><span class=line><span class=cl>    dataservices.nutanix.com/app-snap
</span></span><span class=line><span class=cl>  Generation:  1
</span></span><span class=line><span class=cl>  Managed Fields:
</span></span><span class=line><span class=cl>    API Version:  dataservices.nutanix.com/v1alpha1
</span></span><span class=line><span class=cl>    Fields Type:  FieldsV1
</span></span><span class=line><span class=cl>    fieldsV1:
</span></span><span class=line><span class=cl>      f:metadata:
</span></span><span class=line><span class=cl>        f:annotations:
</span></span><span class=line><span class=cl>          .:
</span></span><span class=line><span class=cl>          f:kubectl.kubernetes.io/last-applied-configuration:
</span></span><span class=line><span class=cl>      f:spec:
</span></span><span class=line><span class=cl>        .:
</span></span><span class=line><span class=cl>        f:source:
</span></span><span class=line><span class=cl>          .:
</span></span><span class=line><span class=cl>          f:applicationRef:
</span></span><span class=line><span class=cl>            .:
</span></span><span class=line><span class=cl>            f:name:
</span></span><span class=line><span class=cl>    Manager:      kubectl-client-side-apply
</span></span><span class=line><span class=cl>    Operation:    Update
</span></span><span class=line><span class=cl>    Time:         2024-05-22T10:10:24Z
</span></span><span class=line><span class=cl>    API Version:  dataservices.nutanix.com/v1alpha1
</span></span><span class=line><span class=cl>    Fields Type:  FieldsV1
</span></span><span class=line><span class=cl>    fieldsV1:
</span></span><span class=line><span class=cl>      f:metadata:
</span></span><span class=line><span class=cl>        f:finalizers:
</span></span><span class=line><span class=cl>          .:
</span></span><span class=line><span class=cl>          v:&#34;dataservices.nutanix.com/app-snap&#34;:
</span></span><span class=line><span class=cl>    Manager:      manager
</span></span><span class=line><span class=cl>    Operation:    Update
</span></span><span class=line><span class=cl>    Time:         2024-05-22T10:10:24Z
</span></span><span class=line><span class=cl>    API Version:  dataservices.nutanix.com/v1alpha1
</span></span><span class=line><span class=cl>    Fields Type:  FieldsV1
</span></span><span class=line><span class=cl>    fieldsV1:
</span></span><span class=line><span class=cl>      f:status:
</span></span><span class=line><span class=cl>        .:
</span></span><span class=line><span class=cl>        f:boundApplicationSnapshotContentName:
</span></span><span class=line><span class=cl>        f:creationTime:
</span></span><span class=line><span class=cl>        f:readyToUse:
</span></span><span class=line><span class=cl>        f:summary:
</span></span><span class=line><span class=cl>          .:
</span></span><span class=line><span class=cl>          f:snapshotArtifacts:
</span></span><span class=line><span class=cl>            .:
</span></span><span class=line><span class=cl>            f:apps/v1/StatefulSet:
</span></span><span class=line><span class=cl>            f:authorization.openshift.io/v1/RoleBinding:
</span></span><span class=line><span class=cl>            f:rbac.authorization.k8s.io/v1/RoleBinding:
</span></span><span class=line><span class=cl>            f:v1/ConfigMap:
</span></span><span class=line><span class=cl>            f:v1/PersistentVolumeClaim:
</span></span><span class=line><span class=cl>            f:v1/Secret:
</span></span><span class=line><span class=cl>            f:v1/ServiceAccount:
</span></span><span class=line><span class=cl>    Manager:         manager
</span></span><span class=line><span class=cl>    Operation:       Update
</span></span><span class=line><span class=cl>    Subresource:     status
</span></span><span class=line><span class=cl>    Time:            2024-05-22T10:10:52Z
</span></span><span class=line><span class=cl>  Resource Version:  48052327
</span></span><span class=line><span class=cl>  UID:               8889156a-43f2-4d95-9075-11ccd52c9457
</span></span><span class=line><span class=cl>Spec:
</span></span><span class=line><span class=cl>  Source:
</span></span><span class=line><span class=cl>    Application Ref:
</span></span><span class=line><span class=cl>      Name:  mysql-cr
</span></span><span class=line><span class=cl>Status:
</span></span><span class=line><span class=cl>  Bound Application Snapshot Content Name:  asc-8889156a-43f2-4d95-9075-11ccd52c9457
</span></span><span class=line><span class=cl>  Creation Time:                            2024-05-22T10:10:52Z
</span></span><span class=line><span class=cl>  Ready To Use:                             true
</span></span><span class=line><span class=cl>  Summary:
</span></span><span class=line><span class=cl>    Snapshot Artifacts:
</span></span><span class=line><span class=cl>      apps/v1/StatefulSet:
</span></span><span class=line><span class=cl>        Name:  mysql-set
</span></span><span class=line><span class=cl>      authorization.openshift.io/v1/RoleBinding:
</span></span><span class=line><span class=cl>        Name:  admin
</span></span><span class=line><span class=cl>        Name:  system:image-builders
</span></span><span class=line><span class=cl>        Name:  system:deployers
</span></span><span class=line><span class=cl>        Name:  system:image-pullers
</span></span><span class=line><span class=cl>      rbac.authorization.k8s.io/v1/RoleBinding:
</span></span><span class=line><span class=cl>        Name:  system:image-builders
</span></span><span class=line><span class=cl>        Name:  admin
</span></span><span class=line><span class=cl>        Name:  system:image-pullers
</span></span><span class=line><span class=cl>        Name:  system:deployers
</span></span><span class=line><span class=cl>      v1/ConfigMap:
</span></span><span class=line><span class=cl>        Name:  openshift-service-ca.crt
</span></span><span class=line><span class=cl>        Name:  kube-root-ca.crt
</span></span><span class=line><span class=cl>      v1/PersistentVolumeClaim:
</span></span><span class=line><span class=cl>        Name:  mysql-store-mysql-set-1
</span></span><span class=line><span class=cl>        Name:  mysql-store-mysql-set-2
</span></span><span class=line><span class=cl>        Name:  mysql-data-1-mysql-set-0
</span></span><span class=line><span class=cl>        Name:  mysql-data-1-mysql-set-1
</span></span><span class=line><span class=cl>        Name:  mysql-data-1-mysql-set-2
</span></span><span class=line><span class=cl>        Name:  mysql-store-mysql-set-0
</span></span><span class=line><span class=cl>      v1/Secret:
</span></span><span class=line><span class=cl>        Name:  default-token-rpqq4
</span></span><span class=line><span class=cl>        Name:  mysql-password
</span></span><span class=line><span class=cl>        Name:  deployer-token-cc92m
</span></span><span class=line><span class=cl>        Name:  builder-token-xk5g4
</span></span><span class=line><span class=cl>      v1/ServiceAccount:
</span></span><span class=line><span class=cl>        Name:  deployer
</span></span><span class=line><span class=cl>        Name:  default
</span></span><span class=line><span class=cl>        Name:  builder
</span></span><span class=line><span class=cl>Events:        &lt;none&gt;
</span></span></code></pre></td></tr></table></div></div><p>OCP 上的 Volume Snapshot</p><p><img src=https://kenkenny.synology.me:5543/images/2024/05/image-20240523091131334.png loading=lazy alt=image-20240523091131334></p><p>OCP Volume SnapshotContents</p><p><img src=https://kenkenny.synology.me:5543/images/2024/05/image-20240523091201873.png loading=lazy alt=image-20240523091201873></p><p>Nutanix Prism Central - VG Recovery Point</p><p><img src=https://kenkenny.synology.me:5543/images/2024/05/image-20240523091508568.png loading=lazy alt=image-20240523091508568></p></li></ol><h3 id=ndk-restore>NDK Restore</h3><h4 id=restore--local-snapshot>Restore Local Snapshot</h4><ol><li><p>Delete mysql.yaml</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ ll
</span></span><span class=line><span class=cl>total 12
</span></span><span class=line><span class=cl>-rw-r--r--. 1 nutanix nutanix  393 May 16 13:45 mysql-cr.yaml
</span></span><span class=line><span class=cl>-rw-r--r--. 1 nutanix nutanix 1213 May 16 11:18 mysql-deploy.yaml
</span></span><span class=line><span class=cl>-rw-r--r--. 1 nutanix nutanix  183 May 20 15:45 mysql-snap.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc get pvc -n ndk-mysql
</span></span><span class=line><span class=cl>NAME                       STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS    AGE
</span></span><span class=line><span class=cl>mysql-data-1-mysql-set-0   Bound    pvc-276ea905-a815-4635-98c0-3a4fade1bc44   3Gi        RWO            nutanixvolume   4d4h
</span></span><span class=line><span class=cl>mysql-data-1-mysql-set-1   Bound    pvc-5638dc79-8271-4a49-94b9-d22c6212e232   3Gi        RWO            nutanixvolume   4d4h
</span></span><span class=line><span class=cl>mysql-data-1-mysql-set-2   Bound    pvc-a4e832f4-e99b-4bdc-bc5b-253731447ce4   3Gi        RWO            nutanixvolume   4d4h
</span></span><span class=line><span class=cl>mysql-store-mysql-set-0    Bound    pvc-262a52dc-1861-4992-b2aa-e41f448a6db5   5Gi        RWO            nutanixvolume   4d4h
</span></span><span class=line><span class=cl>mysql-store-mysql-set-1    Bound    pvc-1e809e1d-2190-4220-80ba-35712900d3a6   5Gi        RWO            nutanixvolume   4d4h
</span></span><span class=line><span class=cl>mysql-store-mysql-set-2    Bound    pvc-fafd94af-11be-4b02-aef1-4d959607c0cf   5Gi        RWO            nutanixvolume   4d4h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc get all
</span></span><span class=line><span class=cl>NAME              READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod/mysql-set-0   1/1     Running   0          4d4h
</span></span><span class=line><span class=cl>pod/mysql-set-1   1/1     Running   0          4d4h
</span></span><span class=line><span class=cl>pod/mysql-set-2   1/1     Running   0          4d4h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                         READY   AGE
</span></span><span class=line><span class=cl>statefulset.apps/mysql-set   3/3     4d4h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc delete app mysql-cr -n ndk-mysql
</span></span><span class=line><span class=cl>application.dataservices.nutanix.com &#34;mysql-cr&#34; deleted
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc delete -f mysql-deploy.yaml -n ndk-mysql
</span></span><span class=line><span class=cl>secret &#34;mysql-password&#34; deleted
</span></span><span class=line><span class=cl>statefulset.apps &#34;mysql-set&#34; deleted
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc delete pvc --all -n ndk-mysql
</span></span><span class=line><span class=cl>persistentvolumeclaim &#34;mysql-data-1-mysql-set-0&#34; deleted
</span></span><span class=line><span class=cl>persistentvolumeclaim &#34;mysql-data-1-mysql-set-1&#34; deleted
</span></span><span class=line><span class=cl>persistentvolumeclaim &#34;mysql-data-1-mysql-set-2&#34; deleted
</span></span><span class=line><span class=cl>persistentvolumeclaim &#34;mysql-store-mysql-set-0&#34; deleted
</span></span><span class=line><span class=cl>persistentvolumeclaim &#34;mysql-store-mysql-set-1&#34; deleted
</span></span><span class=line><span class=cl>persistentvolumeclaim &#34;mysql-store-mysql-set-2&#34; deleted
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc get pvc -n ndk-mysql
</span></span><span class=line><span class=cl>No resources found in ndk-mysql namespace.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc get all -n ndk-mysql
</span></span><span class=line><span class=cl>No resources found in ndk-mysql namespace.
</span></span></code></pre></td></tr></table></div></div><img src=https://kenkenny.synology.me:5543/images/2024/05/image-20240520160111632.png alt=image-20240520160111632 style=zoom:50%></li><li><p>Create Application Restore CR</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ vim mysql-restore.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apiVersion: dataservices.nutanix.com/v1alpha1
</span></span><span class=line><span class=cl>kind: ApplicationSnapshotRestore
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: restore-mysql-snap-1
</span></span><span class=line><span class=cl>  namespace: ndk-mysql
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  applicationSnapshotName: mysql-snap-1
</span></span></code></pre></td></tr></table></div></div></li><li><p>oc apply restore CR</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span><span class=lnt>94
</span><span class=lnt>95
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ oc apply -f mysql-restore.yaml 
</span></span><span class=line><span class=cl>applicationsnapshotrestore.dataservices.nutanix.com/restore-mysql-snap-1 created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc get applicationsnapshotrestore -n ndk-mysql -o yaml -o wide
</span></span><span class=line><span class=cl>NAME                   SNAPSHOT-NAME   COMPLETED
</span></span><span class=line><span class=cl>restore-mysql-snap-1   mysql-snap-1    true
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc describe applicationsnapshotrestore restore-mysql-snap-1 -n ndk-mysql
</span></span><span class=line><span class=cl>Name:         restore-mysql-snap-1
</span></span><span class=line><span class=cl>Namespace:    ndk-mysql
</span></span><span class=line><span class=cl>Labels:       &lt;none&gt;
</span></span><span class=line><span class=cl>Annotations:  &lt;none&gt;
</span></span><span class=line><span class=cl>API Version:  dataservices.nutanix.com/v1alpha1
</span></span><span class=line><span class=cl>Kind:         ApplicationSnapshotRestore
</span></span><span class=line><span class=cl>Metadata:
</span></span><span class=line><span class=cl>  Creation Timestamp:  2024-05-22T10:14:26Z
</span></span><span class=line><span class=cl>  Finalizers:
</span></span><span class=line><span class=cl>    dataservices.nutanix.com/application-restore
</span></span><span class=line><span class=cl>  Generation:  1
</span></span><span class=line><span class=cl>  Managed Fields:
</span></span><span class=line><span class=cl>    API Version:  dataservices.nutanix.com/v1alpha1
</span></span><span class=line><span class=cl>    Fields Type:  FieldsV1
</span></span><span class=line><span class=cl>    fieldsV1:
</span></span><span class=line><span class=cl>      f:metadata:
</span></span><span class=line><span class=cl>        f:annotations:
</span></span><span class=line><span class=cl>          .:
</span></span><span class=line><span class=cl>          f:kubectl.kubernetes.io/last-applied-configuration:
</span></span><span class=line><span class=cl>      f:spec:
</span></span><span class=line><span class=cl>        .:
</span></span><span class=line><span class=cl>        f:applicationSnapshotName:
</span></span><span class=line><span class=cl>    Manager:      kubectl-client-side-apply
</span></span><span class=line><span class=cl>    Operation:    Update
</span></span><span class=line><span class=cl>    Time:         2024-05-22T10:14:26Z
</span></span><span class=line><span class=cl>    API Version:  dataservices.nutanix.com/v1alpha1
</span></span><span class=line><span class=cl>    Fields Type:  FieldsV1
</span></span><span class=line><span class=cl>    fieldsV1:
</span></span><span class=line><span class=cl>      f:metadata:
</span></span><span class=line><span class=cl>        f:finalizers:
</span></span><span class=line><span class=cl>          .:
</span></span><span class=line><span class=cl>          v:&#34;dataservices.nutanix.com/application-restore&#34;:
</span></span><span class=line><span class=cl>    Manager:      manager
</span></span><span class=line><span class=cl>    Operation:    Update
</span></span><span class=line><span class=cl>    Time:         2024-05-22T10:14:26Z
</span></span><span class=line><span class=cl>    API Version:  dataservices.nutanix.com/v1alpha1
</span></span><span class=line><span class=cl>    Fields Type:  FieldsV1
</span></span><span class=line><span class=cl>    fieldsV1:
</span></span><span class=line><span class=cl>      f:status:
</span></span><span class=line><span class=cl>        .:
</span></span><span class=line><span class=cl>        f:completed:
</span></span><span class=line><span class=cl>        f:conditions:
</span></span><span class=line><span class=cl>    Manager:         manager
</span></span><span class=line><span class=cl>    Operation:       Update
</span></span><span class=line><span class=cl>    Subresource:     status
</span></span><span class=line><span class=cl>    Time:            2024-05-22T10:14:43Z
</span></span><span class=line><span class=cl>  Resource Version:  48054533
</span></span><span class=line><span class=cl>  UID:               7a10fa58-3aaa-4592-8bdf-f6db2e9c4a0d
</span></span><span class=line><span class=cl>Spec:
</span></span><span class=line><span class=cl>  Application Snapshot Name:  mysql-snap-1
</span></span><span class=line><span class=cl>Status:
</span></span><span class=line><span class=cl>  Completed:  true
</span></span><span class=line><span class=cl>  Conditions:
</span></span><span class=line><span class=cl>    Last Transition Time:  2024-05-22T10:14:26Z
</span></span><span class=line><span class=cl>    Message:               
</span></span><span class=line><span class=cl>    Observed Generation:   1
</span></span><span class=line><span class=cl>    Reason:                RequestCompleted
</span></span><span class=line><span class=cl>    Status:                False
</span></span><span class=line><span class=cl>    Type:                  Progressing
</span></span><span class=line><span class=cl>    Last Transition Time:  2024-05-22T10:14:27Z
</span></span><span class=line><span class=cl>    Message:               All prechecks passed and finalizers on dependent resources set. Skipped restoring resources since they already exist: [&#34;/v1, Kind=ConfigMap, ndk-mysql/openshift-service-ca.crt&#34;,&#34;/v1, Kind=ServiceAccount, ndk-mysql/default&#34;,&#34;/v1, Kind=Secret, ndk-mysql/builder-token-xk5g4&#34;,&#34;/v1, Kind=ServiceAccount, ndk-mysql/deployer&#34;,&#34;rbac.authorization.k8s.io/v1, Kind=RoleBinding, ndk-mysql/admin&#34;,&#34;rbac.authorization.k8s.io/v1, Kind=RoleBinding, ndk-mysql/admin&#34;,&#34;/v1, Kind=Secret, ndk-mysql/default-token-rpqq4&#34;,&#34;rbac.authorization.k8s.io/v1, Kind=RoleBinding, ndk-mysql/system:image-pullers&#34;,&#34;rbac.authorization.k8s.io/v1, Kind=RoleBinding, ndk-mysql/system:image-pullers&#34;,&#34;/v1, Kind=Secret, ndk-mysql/deployer-token-cc92m&#34;,&#34;/v1, Kind=ServiceAccount, ndk-mysql/builder&#34;,&#34;rbac.authorization.k8s.io/v1, Kind=RoleBinding, ndk-mysql/system:image-builders&#34;,&#34;rbac.authorization.k8s.io/v1, Kind=RoleBinding, ndk-mysql/system:image-builders&#34;,&#34;/v1, Kind=ConfigMap, ndk-mysql/kube-root-ca.crt&#34;,&#34;rbac.authorization.k8s.io/v1, Kind=RoleBinding, ndk-mysql/system:deployers&#34;,&#34;rbac.authorization.k8s.io/v1, Kind=RoleBinding, ndk-mysql/system:deployers&#34;]
</span></span><span class=line><span class=cl>    Observed Generation:   1
</span></span><span class=line><span class=cl>    Reason:                PrechecksPassed
</span></span><span class=line><span class=cl>    Status:                True
</span></span><span class=line><span class=cl>    Type:                  PrechecksPassed
</span></span><span class=line><span class=cl>    Last Transition Time:  2024-05-22T10:14:27Z
</span></span><span class=line><span class=cl>    Message:               All eligible volumes restored
</span></span><span class=line><span class=cl>    Observed Generation:   1
</span></span><span class=line><span class=cl>    Reason:                VolumesRestored
</span></span><span class=line><span class=cl>    Status:                True
</span></span><span class=line><span class=cl>    Type:                  VolumesRestored
</span></span><span class=line><span class=cl>    Last Transition Time:  2024-05-22T10:14:28Z
</span></span><span class=line><span class=cl>    Message:               All eligible application configs restored
</span></span><span class=line><span class=cl>    Observed Generation:   1
</span></span><span class=line><span class=cl>    Reason:                ApplicationConfigRestored
</span></span><span class=line><span class=cl>    Status:                True
</span></span><span class=line><span class=cl>    Type:                  ApplicationConfigRestored
</span></span><span class=line><span class=cl>    Last Transition Time:  2024-05-22T10:14:43Z
</span></span><span class=line><span class=cl>    Message:               Application restore successfully finalised
</span></span><span class=line><span class=cl>    Observed Generation:   1
</span></span><span class=line><span class=cl>    Reason:                ApplicationRestoreFinalised
</span></span><span class=line><span class=cl>    Status:                True
</span></span><span class=line><span class=cl>    Type:                  ApplicationRestoreFinalised
</span></span><span class=line><span class=cl>Events:
</span></span><span class=line><span class=cl>  Type    Reason                 Age                From  Message
</span></span><span class=line><span class=cl>  ----    ------                 ----               ----  -------
</span></span><span class=line><span class=cl>  Normal  WaitingForVolumeBound  55s (x2 over 55s)  NDK   Waiting for PVCs to get Bound. Unbound PVCs: [mysql-store-mysql-set-2 mysql-data-1-mysql-set-0 mysql-store-mysql-set-1 mysql-data-1-mysql-set-2 mysql-data-1-mysql-set-1 mysql-store-mysql-set-0]
</span></span></code></pre></td></tr></table></div></div></li><li><p>確認Application 、PVC、PV 復原完成</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ oc get all -n ndk-mysql
</span></span><span class=line><span class=cl>NAME              READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod/mysql-set-0   1/1     Running   0          2m9s
</span></span><span class=line><span class=cl>pod/mysql-set-1   1/1     Running   0          106s
</span></span><span class=line><span class=cl>pod/mysql-set-2   1/1     Running   0          92s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                         READY   AGE
</span></span><span class=line><span class=cl>statefulset.apps/mysql-set   3/3     2m10s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ oc get pv,pvc -n ndk-mysql
</span></span><span class=line><span class=cl>NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                                STORAGECLASS    REASON   AGE
</span></span><span class=line><span class=cl>persistentvolume/pvc-06e3f4c4-c4f1-415f-8194-2e4d356570d0   5Gi        RWO            Delete           Bound    ndk-mysql/mysql-store-mysql-set-1    nutanixvolume            3m35s
</span></span><span class=line><span class=cl>persistentvolume/pvc-094bda7b-6a4d-44f1-a275-288d73b5545a   3Gi        RWO            Delete           Bound    ndk-mysql/mysql-data-1-mysql-set-2   nutanixvolume            3m35s
</span></span><span class=line><span class=cl>persistentvolume/pvc-5cc840da-2fc9-431f-8c99-9948fe8b70f1   5Gi        RWO            Delete           Bound    ndk-mysql/mysql-store-mysql-set-2    nutanixvolume            3m39s
</span></span><span class=line><span class=cl>persistentvolume/pvc-928e91ad-87db-41b6-96bd-e12d86608cbf   5Gi        RWO            Delete           Bound    ndk-mysql/mysql-store-mysql-set-0    nutanixvolume            3m35s
</span></span><span class=line><span class=cl>persistentvolume/pvc-9b9aba57-c449-419f-9a09-5e4960604321   3Gi        RWO            Delete           Bound    ndk-mysql/mysql-data-1-mysql-set-1   nutanixvolume            3m40s
</span></span><span class=line><span class=cl>persistentvolume/pvc-dccfcf6d-c9fd-45c0-9a93-53d94e96fdf6   3Gi        RWO            Delete           Bound    ndk-mysql/mysql-data-1-mysql-set-0   nutanixvolume            3m40s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                             STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS    AGE
</span></span><span class=line><span class=cl>persistentvolumeclaim/mysql-data-1-mysql-set-0   Bound    pvc-dccfcf6d-c9fd-45c0-9a93-53d94e96fdf6   3Gi        RWO            nutanixvolume   3m48s
</span></span><span class=line><span class=cl>persistentvolumeclaim/mysql-data-1-mysql-set-1   Bound    pvc-9b9aba57-c449-419f-9a09-5e4960604321   3Gi        RWO            nutanixvolume   3m48s
</span></span><span class=line><span class=cl>persistentvolumeclaim/mysql-data-1-mysql-set-2   Bound    pvc-094bda7b-6a4d-44f1-a275-288d73b5545a   3Gi        RWO            nutanixvolume   3m48s
</span></span><span class=line><span class=cl>persistentvolumeclaim/mysql-store-mysql-set-0    Bound    pvc-928e91ad-87db-41b6-96bd-e12d86608cbf   5Gi        RWO            nutanixvolume   3m48s
</span></span><span class=line><span class=cl>persistentvolumeclaim/mysql-store-mysql-set-1    Bound    pvc-06e3f4c4-c4f1-415f-8194-2e4d356570d0   5Gi        RWO            nutanixvolume   3m48s
</span></span><span class=line><span class=cl>persistentvolumeclaim/mysql-store-mysql-set-2    Bound    pvc-5cc840da-2fc9-431f-8c99-9948fe8b70f1   5Gi        RWO            nutanixvolume   3m48s
</span></span></code></pre></td></tr></table></div></div><p><img src=https://kenkenny.synology.me:5543/images/2024/05/image-20240523091940333.png loading=lazy alt=image-20240523091940333></p><p><img src=https://kenkenny.synology.me:5543/images/2024/05/image-20240523092014313.png loading=lazy alt=image-20240523092014313></p><p><img src=https://kenkenny.synology.me:5543/images/2024/05/image-20240523092030321.png loading=lazy alt=image-20240523092030321></p></li><li><p>Prism Central - Kubernetes Clusters</p><p><img src=https://kenkenny.synology.me:5543/images/2024/05/image-20240523091852050.png loading=lazy alt=image-20240523091852050></p></li></ol></section><footer class=article-footer><section class=article-tags><a href=/tags/kubernetes/>Kubernetes</a>
<a href=/tags/nutanix/>Nutanix</a>
<a href=/tags/openshift/>Openshift</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相關文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/ocp-4.16.3_on_nutanixipi/><div class=article-details><h2 class=article-title>OCP-4.16.3_on_Nutanix(IPI)</h2></div></a></article><article><a href=/p/ocp-4.12.45_on_nutanixipi/><div class=article-details><h2 class=article-title>OCP-4.12.45_on_Nutanix(IPI)</h2></div></a></article><article><a href=/p/hello-world/><div class=article-details><h2 class=article-title>Hello World</h2></div></a></article><article><a href=/p/nutanix_nkp-v2.13_ahv/><div class=article-details><h2 class=article-title>Nutanix_NKP-v2.13_AHV</h2></div></a></article><article><a href=/p/nutanix_nkp-v2.13_preprovisioned/><div class=article-details><h2 class=article-title>Nutanix_NKP-v2.13_Preprovisioned</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//wangken0129.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2023 -
2025 Ken's blog</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 建立<br>主題 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 設計</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>